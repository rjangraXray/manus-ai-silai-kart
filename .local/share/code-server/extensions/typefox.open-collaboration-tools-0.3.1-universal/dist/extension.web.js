"use strict";var Ey=Object.create;var Or=Object.defineProperty;var Cu=Object.getOwnPropertyDescriptor;var Sy=Object.getOwnPropertyNames;var ky=Object.getPrototypeOf,_y=Object.prototype.hasOwnProperty;var Ay=(n,e,t)=>e in n?Or(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t;var M=(n,e)=>()=>(e||n((e={exports:{}}).exports,e),e.exports),Iu=(n,e)=>{for(var t in e)Or(n,t,{get:e[t],enumerable:!0})},Ru=(n,e,t,r)=>{if(e&&typeof e=="object"||typeof e=="function")for(let i of Sy(e))!_y.call(n,i)&&i!==t&&Or(n,i,{get:()=>e[i],enumerable:!(r=Cu(e,i))||r.enumerable});return n};var Fe=(n,e,t)=>(t=n!=null?Ey(ky(n)):{},Ru(e||!n||!n.__esModule?Or(t,"default",{value:n,enumerable:!0}):t,n)),Ty=n=>Ru(Or({},"__esModule",{value:!0}),n),te=(n,e,t,r)=>{for(var i=r>1?void 0:r?Cu(e,t):e,s=n.length-1,o;s>=0;s--)(o=n[s])&&(i=(r?o(e,t,i):o(i))||i);return r&&i&&Or(e,t,i),i};var Du=(n,e,t)=>Ay(n,typeof e!="symbol"?e+"":e,t);var Ea=M(()=>{var Uu;(function(n){(function(e){var t=typeof globalThis=="object"||typeof globalThis=="object"?globalThis:typeof self=="object"?self:typeof this=="object"?this:a(),r=i(n);typeof t.Reflect<"u"&&(r=i(t.Reflect,r)),e(r,t),typeof t.Reflect>"u"&&(t.Reflect=n);function i(c,u){return function(l,h){Object.defineProperty(c,l,{configurable:!0,writable:!0,value:h}),u&&u(l,h)}}function s(){try{return Function("return this;")()}catch{}}function o(){try{return(0,eval)("(function() { return this; })()")}catch{}}function a(){return s()||o()}})(function(e,t){var r=Object.prototype.hasOwnProperty,i=typeof Symbol=="function",s=i&&typeof Symbol.toPrimitive<"u"?Symbol.toPrimitive:"@@toPrimitive",o=i&&typeof Symbol.iterator<"u"?Symbol.iterator:"@@iterator",a=typeof Object.create=="function",c={__proto__:[]}instanceof Array,u=!a&&!c,l={create:a?function(){return ba(Object.create(null))}:c?function(){return ba({__proto__:null})}:function(){return ba({})},has:u?function(m,v){return r.call(m,v)}:function(m,v){return v in m},get:u?function(m,v){return r.call(m,v)?m[v]:void 0}:function(m,v){return m[v]}},h=Object.getPrototypeOf(Function),f=typeof Map=="function"&&typeof Map.prototype.entries=="function"?Map:yy(),d=typeof Set=="function"&&typeof Set.prototype.entries=="function"?Set:wy(),x=typeof WeakMap=="function"?WeakMap:vy(),S=i?Symbol.for("@reflect-metadata:registry"):void 0,j=py(),ue=gy(j);function he(m,v,b,C){if(T(b)){if(!Mn(m))throw new TypeError;if(!gn(v))throw new TypeError;return Oe(m,v)}else{if(!Mn(m))throw new TypeError;if(!q(v))throw new TypeError;if(!q(C)&&!T(C)&&!W(C))throw new TypeError;return W(C)&&(C=void 0),b=nt(b),kt(m,v,b,C)}}e("decorate",he);function le(m,v){function b(C,$){if(!q(C))throw new TypeError;if(!T($)&&!yi($))throw new TypeError;_(m,v,C,$)}return b}e("metadata",le);function de(m,v,b,C){if(!q(b))throw new TypeError;return T(C)||(C=nt(C)),_(m,v,b,C)}e("defineMetadata",de);function G(m,v,b){if(!q(v))throw new TypeError;return T(b)||(b=nt(b)),y(m,v,b)}e("hasMetadata",G);function z(m,v,b){if(!q(v))throw new TypeError;return T(b)||(b=nt(b)),A(m,v,b)}e("hasOwnMetadata",z);function ne(m,v,b){if(!q(v))throw new TypeError;return T(b)||(b=nt(b)),k(m,v,b)}e("getMetadata",ne);function X(m,v,b){if(!q(v))throw new TypeError;return T(b)||(b=nt(b)),E(m,v,b)}e("getOwnMetadata",X);function V(m,v){if(!q(m))throw new TypeError;return T(v)||(v=nt(v)),U(m,v)}e("getMetadataKeys",V);function pe(m,v){if(!q(m))throw new TypeError;return T(v)||(v=nt(v)),ee(m,v)}e("getOwnMetadataKeys",pe);function _e(m,v,b){if(!q(v))throw new TypeError;if(T(b)||(b=nt(b)),!q(v))throw new TypeError;T(b)||(b=nt(b));var C=wi(v,b,!1);return T(C)?!1:C.OrdinaryDeleteMetadata(m,v,b)}e("deleteMetadata",_e);function Oe(m,v){for(var b=m.length-1;b>=0;--b){var C=m[b],$=C(v);if(!T($)&&!W($)){if(!gn($))throw new TypeError;v=$}}return v}function kt(m,v,b,C){for(var $=m.length-1;$>=0;--$){var Ne=m[$],Ve=Ne(v,b,C);if(!T(Ve)&&!W(Ve)){if(!q(Ve))throw new TypeError;C=Ve}}return C}function y(m,v,b){var C=A(m,v,b);if(C)return!0;var $=xa(v);return W($)?!1:y(m,$,b)}function A(m,v,b){var C=wi(v,b,!1);return T(C)?!1:pn(C.OrdinaryHasOwnMetadata(m,v,b))}function k(m,v,b){var C=A(m,v,b);if(C)return E(m,v,b);var $=xa(v);if(!W($))return k(m,$,b)}function E(m,v,b){var C=wi(v,b,!1);if(!T(C))return C.OrdinaryGetOwnMetadata(m,v,b)}function _(m,v,b,C){var $=wi(b,C,!0);$.OrdinaryDefineOwnMetadata(m,v,b,C)}function U(m,v){var b=ee(m,v),C=xa(m);if(C===null)return b;var $=U(C,v);if($.length<=0)return b;if(b.length<=0)return $;for(var Ne=new d,Ve=[],ie=0,D=b;ie<D.length;ie++){var P=D[ie],L=Ne.has(P);L||(Ne.add(P),Ve.push(P))}for(var B=0,se=$;B<se.length;B++){var P=se[B],L=Ne.has(P);L||(Ne.add(P),Ve.push(P))}return Ve}function ee(m,v){var b=wi(m,v,!1);return b?b.OrdinaryOwnMetadataKeys(m,v):[]}function F(m){if(m===null)return 1;switch(typeof m){case"undefined":return 0;case"boolean":return 2;case"string":return 3;case"symbol":return 4;case"number":return 5;case"object":return m===null?1:6;default:return 6}}function T(m){return m===void 0}function W(m){return m===null}function we(m){return typeof m=="symbol"}function q(m){return typeof m=="object"?m!==null:typeof m=="function"}function We(m,v){switch(F(m)){case 0:return m;case 1:return m;case 2:return m;case 3:return m;case 4:return m;case 5:return m}var b=v===3?"string":v===5?"number":"default",C=Eu(m,s);if(C!==void 0){var $=C.call(m,b);if(q($))throw new TypeError;return $}return Ln(m,b==="default"?"number":b)}function Ln(m,v){if(v==="string"){var b=m.toString;if(_t(b)){var C=b.call(m);if(!q(C))return C}var $=m.valueOf;if(_t($)){var C=$.call(m);if(!q(C))return C}}else{var $=m.valueOf;if(_t($)){var C=$.call(m);if(!q(C))return C}var Ne=m.toString;if(_t(Ne)){var C=Ne.call(m);if(!q(C))return C}}throw new TypeError}function pn(m){return!!m}function Ur(m){return""+m}function nt(m){var v=We(m,3);return we(v)?v:Ur(v)}function Mn(m){return Array.isArray?Array.isArray(m):m instanceof Object?m instanceof Array:Object.prototype.toString.call(m)==="[object Array]"}function _t(m){return typeof m=="function"}function gn(m){return typeof m=="function"}function yi(m){switch(F(m)){case 3:return!0;case 4:return!0;default:return!1}}function va(m,v){return m===v||m!==m&&v!==v}function Eu(m,v){var b=m[v];if(b!=null){if(!_t(b))throw new TypeError;return b}}function Su(m){var v=Eu(m,o);if(!_t(v))throw new TypeError;var b=v.call(m);if(!q(b))throw new TypeError;return b}function ku(m){return m.value}function _u(m){var v=m.next();return v.done?!1:v}function Au(m){var v=m.return;v&&v.call(m)}function xa(m){var v=Object.getPrototypeOf(m);if(typeof m!="function"||m===h||v!==h)return v;var b=m.prototype,C=b&&Object.getPrototypeOf(b);if(C==null||C===Object.prototype)return v;var $=C.constructor;return typeof $!="function"||$===m?v:$}function dy(){var m;!T(S)&&typeof t.Reflect<"u"&&!(S in t.Reflect)&&typeof t.Reflect.defineMetadata=="function"&&(m=my(t.Reflect));var v,b,C,$=new x,Ne={registerProvider:Ve,getProvider:D,setProvider:L};return Ne;function Ve(B){if(!Object.isExtensible(Ne))throw new Error("Cannot add provider to a frozen registry.");switch(!0){case m===B:break;case T(v):v=B;break;case v===B:break;case T(b):b=B;break;case b===B:break;default:C===void 0&&(C=new d),C.add(B);break}}function ie(B,se){if(!T(v)){if(v.isProviderFor(B,se))return v;if(!T(b)){if(b.isProviderFor(B,se))return v;if(!T(C))for(var Ae=Su(C);;){var Pe=_u(Ae);if(!Pe)return;var Mt=ku(Pe);if(Mt.isProviderFor(B,se))return Au(Ae),Mt}}}if(!T(m)&&m.isProviderFor(B,se))return m}function D(B,se){var Ae=$.get(B),Pe;return T(Ae)||(Pe=Ae.get(se)),T(Pe)&&(Pe=ie(B,se),T(Pe)||(T(Ae)&&(Ae=new f,$.set(B,Ae)),Ae.set(se,Pe))),Pe}function P(B){if(T(B))throw new TypeError;return v===B||b===B||!T(C)&&C.has(B)}function L(B,se,Ae){if(!P(Ae))throw new Error("Metadata provider not registered.");var Pe=D(B,se);if(Pe!==Ae){if(!T(Pe))return!1;var Mt=$.get(B);T(Mt)&&(Mt=new f,$.set(B,Mt)),Mt.set(se,Ae)}return!0}}function py(){var m;return!T(S)&&q(t.Reflect)&&Object.isExtensible(t.Reflect)&&(m=t.Reflect[S]),T(m)&&(m=dy()),!T(S)&&q(t.Reflect)&&Object.isExtensible(t.Reflect)&&Object.defineProperty(t.Reflect,S,{enumerable:!1,configurable:!1,writable:!1,value:m}),m}function gy(m){var v=new x,b={isProviderFor:function(P,L){var B=v.get(P);return T(B)?!1:B.has(L)},OrdinaryDefineOwnMetadata:Ve,OrdinaryHasOwnMetadata:$,OrdinaryGetOwnMetadata:Ne,OrdinaryOwnMetadataKeys:ie,OrdinaryDeleteMetadata:D};return j.registerProvider(b),b;function C(P,L,B){var se=v.get(P),Ae=!1;if(T(se)){if(!B)return;se=new f,v.set(P,se),Ae=!0}var Pe=se.get(L);if(T(Pe)){if(!B)return;if(Pe=new f,se.set(L,Pe),!m.setProvider(P,L,b))throw se.delete(L),Ae&&v.delete(P),new Error("Wrong provider for target.")}return Pe}function $(P,L,B){var se=C(L,B,!1);return T(se)?!1:pn(se.has(P))}function Ne(P,L,B){var se=C(L,B,!1);if(!T(se))return se.get(P)}function Ve(P,L,B,se){var Ae=C(B,se,!0);Ae.set(P,L)}function ie(P,L){var B=[],se=C(P,L,!1);if(T(se))return B;for(var Ae=se.keys(),Pe=Su(Ae),Mt=0;;){var Tu=_u(Pe);if(!Tu)return B.length=Mt,B;var xy=ku(Tu);try{B[Mt]=xy}catch(by){try{Au(Pe)}finally{throw by}}Mt++}}function D(P,L,B){var se=C(L,B,!1);if(T(se)||!se.delete(P))return!1;if(se.size===0){var Ae=v.get(L);T(Ae)||(Ae.delete(B),Ae.size===0&&v.delete(Ae))}return!0}}function my(m){var v=m.defineMetadata,b=m.hasOwnMetadata,C=m.getOwnMetadata,$=m.getOwnMetadataKeys,Ne=m.deleteMetadata,Ve=new x,ie={isProviderFor:function(D,P){var L=Ve.get(D);return!T(L)&&L.has(P)?!0:$(D,P).length?(T(L)&&(L=new d,Ve.set(D,L)),L.add(P),!0):!1},OrdinaryDefineOwnMetadata:v,OrdinaryHasOwnMetadata:b,OrdinaryGetOwnMetadata:C,OrdinaryOwnMetadataKeys:$,OrdinaryDeleteMetadata:Ne};return ie}function wi(m,v,b){var C=j.getProvider(m,v);if(!T(C))return C;if(b){if(j.setProvider(m,v,ue))return ue;throw new Error("Illegal state.")}}function yy(){var m={},v=[],b=function(){function ie(D,P,L){this._index=0,this._keys=D,this._values=P,this._selector=L}return ie.prototype["@@iterator"]=function(){return this},ie.prototype[o]=function(){return this},ie.prototype.next=function(){var D=this._index;if(D>=0&&D<this._keys.length){var P=this._selector(this._keys[D],this._values[D]);return D+1>=this._keys.length?(this._index=-1,this._keys=v,this._values=v):this._index++,{value:P,done:!1}}return{value:void 0,done:!0}},ie.prototype.throw=function(D){throw this._index>=0&&(this._index=-1,this._keys=v,this._values=v),D},ie.prototype.return=function(D){return this._index>=0&&(this._index=-1,this._keys=v,this._values=v),{value:D,done:!0}},ie}(),C=function(){function ie(){this._keys=[],this._values=[],this._cacheKey=m,this._cacheIndex=-2}return Object.defineProperty(ie.prototype,"size",{get:function(){return this._keys.length},enumerable:!0,configurable:!0}),ie.prototype.has=function(D){return this._find(D,!1)>=0},ie.prototype.get=function(D){var P=this._find(D,!1);return P>=0?this._values[P]:void 0},ie.prototype.set=function(D,P){var L=this._find(D,!0);return this._values[L]=P,this},ie.prototype.delete=function(D){var P=this._find(D,!1);if(P>=0){for(var L=this._keys.length,B=P+1;B<L;B++)this._keys[B-1]=this._keys[B],this._values[B-1]=this._values[B];return this._keys.length--,this._values.length--,va(D,this._cacheKey)&&(this._cacheKey=m,this._cacheIndex=-2),!0}return!1},ie.prototype.clear=function(){this._keys.length=0,this._values.length=0,this._cacheKey=m,this._cacheIndex=-2},ie.prototype.keys=function(){return new b(this._keys,this._values,$)},ie.prototype.values=function(){return new b(this._keys,this._values,Ne)},ie.prototype.entries=function(){return new b(this._keys,this._values,Ve)},ie.prototype["@@iterator"]=function(){return this.entries()},ie.prototype[o]=function(){return this.entries()},ie.prototype._find=function(D,P){if(!va(this._cacheKey,D)){this._cacheIndex=-1;for(var L=0;L<this._keys.length;L++)if(va(this._keys[L],D)){this._cacheIndex=L;break}}return this._cacheIndex<0&&P&&(this._cacheIndex=this._keys.length,this._keys.push(D),this._values.push(void 0)),this._cacheIndex},ie}();return C;function $(ie,D){return ie}function Ne(ie,D){return D}function Ve(ie,D){return[ie,D]}}function wy(){var m=function(){function v(){this._map=new f}return Object.defineProperty(v.prototype,"size",{get:function(){return this._map.size},enumerable:!0,configurable:!0}),v.prototype.has=function(b){return this._map.has(b)},v.prototype.add=function(b){return this._map.set(b,b),this},v.prototype.delete=function(b){return this._map.delete(b)},v.prototype.clear=function(){this._map.clear()},v.prototype.keys=function(){return this._map.keys()},v.prototype.values=function(){return this._map.keys()},v.prototype.entries=function(){return this._map.entries()},v.prototype["@@iterator"]=function(){return this.keys()},v.prototype[o]=function(){return this.keys()},v}();return m}function vy(){var m=16,v=l.create(),b=C();return function(){function D(){this._key=C()}return D.prototype.has=function(P){var L=$(P,!1);return L!==void 0?l.has(L,this._key):!1},D.prototype.get=function(P){var L=$(P,!1);return L!==void 0?l.get(L,this._key):void 0},D.prototype.set=function(P,L){var B=$(P,!0);return B[this._key]=L,this},D.prototype.delete=function(P){var L=$(P,!1);return L!==void 0?delete L[this._key]:!1},D.prototype.clear=function(){this._key=C()},D}();function C(){var D;do D="@@WeakMap@@"+ie();while(l.has(v,D));return v[D]=!0,D}function $(D,P){if(!r.call(D,b)){if(!P)return;Object.defineProperty(D,b,{value:l.create()})}return D[b]}function Ne(D,P){for(var L=0;L<P;++L)D[L]=Math.random()*255|0;return D}function Ve(D){if(typeof Uint8Array=="function"){var P=new Uint8Array(D);return typeof crypto<"u"?crypto.getRandomValues(P):typeof msCrypto<"u"?msCrypto.getRandomValues(P):Ne(P,D),P}return Ne(new Array(D),D)}function ie(){var D=Ve(m);D[6]=D[6]&79|64,D[8]=D[8]&191|128;for(var P="",L=0;L<m;++L){var B=D[L];(L===4||L===6||L===8)&&(P+="-"),B<16&&(P+="0"),P+=B.toString(16).toLowerCase()}return P}}function ba(m){return m.__=void 0,delete m.__,m}})})(Uu||(Uu={}))});var vi=M((bk,Nu)=>{var Cy="2.0.0",Iy=Number.MAX_SAFE_INTEGER||9007199254740991,Ry=16,Dy=250,Uy=["major","premajor","minor","preminor","patch","prepatch","prerelease"];Nu.exports={MAX_LENGTH:256,MAX_SAFE_COMPONENT_LENGTH:Ry,MAX_SAFE_BUILD_LENGTH:Dy,MAX_SAFE_INTEGER:Iy,RELEASE_TYPES:Uy,SEMVER_SPEC_VERSION:Cy,FLAG_INCLUDE_PRERELEASE:1,FLAG_LOOSE:2}});var xi=M((Ek,Pu)=>{var Oy=typeof process=="object"&&process.env&&process.env.NODE_DEBUG&&/\bsemver\b/i.test(process.env.NODE_DEBUG)?(...n)=>console.error("SEMVER",...n):()=>{};Pu.exports=Oy});var Nr=M((Zt,Lu)=>{var{MAX_SAFE_COMPONENT_LENGTH:Sa,MAX_SAFE_BUILD_LENGTH:Ny,MAX_LENGTH:Py}=vi(),Ly=xi();Zt=Lu.exports={};var My=Zt.re=[],By=Zt.safeRe=[],O=Zt.src=[],Fy=Zt.safeSrc=[],N=Zt.t={},jy=0,ka="[a-zA-Z0-9-]",Vy=[["\\s",1],["\\d",Py],[ka,Ny]],$y=n=>{for(let[e,t]of Vy)n=n.split(`${e}*`).join(`${e}{0,${t}}`).split(`${e}+`).join(`${e}{1,${t}}`);return n},Q=(n,e,t)=>{let r=$y(e),i=jy++;Ly(n,i,e),N[n]=i,O[i]=e,Fy[i]=r,My[i]=new RegExp(e,t?"g":void 0),By[i]=new RegExp(r,t?"g":void 0)};Q("NUMERICIDENTIFIER","0|[1-9]\\d*");Q("NUMERICIDENTIFIERLOOSE","\\d+");Q("NONNUMERICIDENTIFIER",`\\d*[a-zA-Z-]${ka}*`);Q("MAINVERSION",`(${O[N.NUMERICIDENTIFIER]})\\.(${O[N.NUMERICIDENTIFIER]})\\.(${O[N.NUMERICIDENTIFIER]})`);Q("MAINVERSIONLOOSE",`(${O[N.NUMERICIDENTIFIERLOOSE]})\\.(${O[N.NUMERICIDENTIFIERLOOSE]})\\.(${O[N.NUMERICIDENTIFIERLOOSE]})`);Q("PRERELEASEIDENTIFIER",`(?:${O[N.NUMERICIDENTIFIER]}|${O[N.NONNUMERICIDENTIFIER]})`);Q("PRERELEASEIDENTIFIERLOOSE",`(?:${O[N.NUMERICIDENTIFIERLOOSE]}|${O[N.NONNUMERICIDENTIFIER]})`);Q("PRERELEASE",`(?:-(${O[N.PRERELEASEIDENTIFIER]}(?:\\.${O[N.PRERELEASEIDENTIFIER]})*))`);Q("PRERELEASELOOSE",`(?:-?(${O[N.PRERELEASEIDENTIFIERLOOSE]}(?:\\.${O[N.PRERELEASEIDENTIFIERLOOSE]})*))`);Q("BUILDIDENTIFIER",`${ka}+`);Q("BUILD",`(?:\\+(${O[N.BUILDIDENTIFIER]}(?:\\.${O[N.BUILDIDENTIFIER]})*))`);Q("FULLPLAIN",`v?${O[N.MAINVERSION]}${O[N.PRERELEASE]}?${O[N.BUILD]}?`);Q("FULL",`^${O[N.FULLPLAIN]}$`);Q("LOOSEPLAIN",`[v=\\s]*${O[N.MAINVERSIONLOOSE]}${O[N.PRERELEASELOOSE]}?${O[N.BUILD]}?`);Q("LOOSE",`^${O[N.LOOSEPLAIN]}$`);Q("GTLT","((?:<|>)?=?)");Q("XRANGEIDENTIFIERLOOSE",`${O[N.NUMERICIDENTIFIERLOOSE]}|x|X|\\*`);Q("XRANGEIDENTIFIER",`${O[N.NUMERICIDENTIFIER]}|x|X|\\*`);Q("XRANGEPLAIN",`[v=\\s]*(${O[N.XRANGEIDENTIFIER]})(?:\\.(${O[N.XRANGEIDENTIFIER]})(?:\\.(${O[N.XRANGEIDENTIFIER]})(?:${O[N.PRERELEASE]})?${O[N.BUILD]}?)?)?`);Q("XRANGEPLAINLOOSE",`[v=\\s]*(${O[N.XRANGEIDENTIFIERLOOSE]})(?:\\.(${O[N.XRANGEIDENTIFIERLOOSE]})(?:\\.(${O[N.XRANGEIDENTIFIERLOOSE]})(?:${O[N.PRERELEASELOOSE]})?${O[N.BUILD]}?)?)?`);Q("XRANGE",`^${O[N.GTLT]}\\s*${O[N.XRANGEPLAIN]}$`);Q("XRANGELOOSE",`^${O[N.GTLT]}\\s*${O[N.XRANGEPLAINLOOSE]}$`);Q("COERCEPLAIN",`(^|[^\\d])(\\d{1,${Sa}})(?:\\.(\\d{1,${Sa}}))?(?:\\.(\\d{1,${Sa}}))?`);Q("COERCE",`${O[N.COERCEPLAIN]}(?:$|[^\\d])`);Q("COERCEFULL",O[N.COERCEPLAIN]+`(?:${O[N.PRERELEASE]})?(?:${O[N.BUILD]})?(?:$|[^\\d])`);Q("COERCERTL",O[N.COERCE],!0);Q("COERCERTLFULL",O[N.COERCEFULL],!0);Q("LONETILDE","(?:~>?)");Q("TILDETRIM",`(\\s*)${O[N.LONETILDE]}\\s+`,!0);Zt.tildeTrimReplace="$1~";Q("TILDE",`^${O[N.LONETILDE]}${O[N.XRANGEPLAIN]}$`);Q("TILDELOOSE",`^${O[N.LONETILDE]}${O[N.XRANGEPLAINLOOSE]}$`);Q("LONECARET","(?:\\^)");Q("CARETTRIM",`(\\s*)${O[N.LONECARET]}\\s+`,!0);Zt.caretTrimReplace="$1^";Q("CARET",`^${O[N.LONECARET]}${O[N.XRANGEPLAIN]}$`);Q("CARETLOOSE",`^${O[N.LONECARET]}${O[N.XRANGEPLAINLOOSE]}$`);Q("COMPARATORLOOSE",`^${O[N.GTLT]}\\s*(${O[N.LOOSEPLAIN]})$|^$`);Q("COMPARATOR",`^${O[N.GTLT]}\\s*(${O[N.FULLPLAIN]})$|^$`);Q("COMPARATORTRIM",`(\\s*)${O[N.GTLT]}\\s*(${O[N.LOOSEPLAIN]}|${O[N.XRANGEPLAIN]})`,!0);Zt.comparatorTrimReplace="$1$2$3";Q("HYPHENRANGE",`^\\s*(${O[N.XRANGEPLAIN]})\\s+-\\s+(${O[N.XRANGEPLAIN]})\\s*$`);Q("HYPHENRANGELOOSE",`^\\s*(${O[N.XRANGEPLAINLOOSE]})\\s+-\\s+(${O[N.XRANGEPLAINLOOSE]})\\s*$`);Q("STAR","(<|>)?=?\\s*\\*");Q("GTE0","^\\s*>=\\s*0\\.0\\.0\\s*$");Q("GTE0PRE","^\\s*>=\\s*0\\.0\\.0-0\\s*$")});var Ts=M((Sk,Mu)=>{var qy=Object.freeze({loose:!0}),zy=Object.freeze({}),Gy=n=>n?typeof n!="object"?qy:n:zy;Mu.exports=Gy});var _a=M((kk,ju)=>{var Bu=/^[0-9]+$/,Fu=(n,e)=>{let t=Bu.test(n),r=Bu.test(e);return t&&r&&(n=+n,e=+e),n===e?0:t&&!r?-1:r&&!t?1:n<e?-1:1},Wy=(n,e)=>Fu(e,n);ju.exports={compareIdentifiers:Fu,rcompareIdentifiers:Wy}});var Ze=M((_k,zu)=>{var Cs=xi(),{MAX_LENGTH:Vu,MAX_SAFE_INTEGER:Is}=vi(),{safeRe:$u,safeSrc:qu,t:Rs}=Nr(),Hy=Ts(),{compareIdentifiers:Pr}=_a(),Aa=class n{constructor(e,t){if(t=Hy(t),e instanceof n){if(e.loose===!!t.loose&&e.includePrerelease===!!t.includePrerelease)return e;e=e.version}else if(typeof e!="string")throw new TypeError(`Invalid version. Must be a string. Got type "${typeof e}".`);if(e.length>Vu)throw new TypeError(`version is longer than ${Vu} characters`);Cs("SemVer",e,t),this.options=t,this.loose=!!t.loose,this.includePrerelease=!!t.includePrerelease;let r=e.trim().match(t.loose?$u[Rs.LOOSE]:$u[Rs.FULL]);if(!r)throw new TypeError(`Invalid Version: ${e}`);if(this.raw=e,this.major=+r[1],this.minor=+r[2],this.patch=+r[3],this.major>Is||this.major<0)throw new TypeError("Invalid major version");if(this.minor>Is||this.minor<0)throw new TypeError("Invalid minor version");if(this.patch>Is||this.patch<0)throw new TypeError("Invalid patch version");r[4]?this.prerelease=r[4].split(".").map(i=>{if(/^[0-9]+$/.test(i)){let s=+i;if(s>=0&&s<Is)return s}return i}):this.prerelease=[],this.build=r[5]?r[5].split("."):[],this.format()}format(){return this.version=`${this.major}.${this.minor}.${this.patch}`,this.prerelease.length&&(this.version+=`-${this.prerelease.join(".")}`),this.version}toString(){return this.version}compare(e){if(Cs("SemVer.compare",this.version,this.options,e),!(e instanceof n)){if(typeof e=="string"&&e===this.version)return 0;e=new n(e,this.options)}return e.version===this.version?0:this.compareMain(e)||this.comparePre(e)}compareMain(e){return e instanceof n||(e=new n(e,this.options)),Pr(this.major,e.major)||Pr(this.minor,e.minor)||Pr(this.patch,e.patch)}comparePre(e){if(e instanceof n||(e=new n(e,this.options)),this.prerelease.length&&!e.prerelease.length)return-1;if(!this.prerelease.length&&e.prerelease.length)return 1;if(!this.prerelease.length&&!e.prerelease.length)return 0;let t=0;do{let r=this.prerelease[t],i=e.prerelease[t];if(Cs("prerelease compare",t,r,i),r===void 0&&i===void 0)return 0;if(i===void 0)return 1;if(r===void 0)return-1;if(r===i)continue;return Pr(r,i)}while(++t)}compareBuild(e){e instanceof n||(e=new n(e,this.options));let t=0;do{let r=this.build[t],i=e.build[t];if(Cs("build compare",t,r,i),r===void 0&&i===void 0)return 0;if(i===void 0)return 1;if(r===void 0)return-1;if(r===i)continue;return Pr(r,i)}while(++t)}inc(e,t,r){if(e.startsWith("pre")){if(!t&&r===!1)throw new Error("invalid increment argument: identifier is empty");if(t){let i=new RegExp(`^${this.options.loose?qu[Rs.PRERELEASELOOSE]:qu[Rs.PRERELEASE]}$`),s=`-${t}`.match(i);if(!s||s[1]!==t)throw new Error(`invalid identifier: ${t}`)}}switch(e){case"premajor":this.prerelease.length=0,this.patch=0,this.minor=0,this.major++,this.inc("pre",t,r);break;case"preminor":this.prerelease.length=0,this.patch=0,this.minor++,this.inc("pre",t,r);break;case"prepatch":this.prerelease.length=0,this.inc("patch",t,r),this.inc("pre",t,r);break;case"prerelease":this.prerelease.length===0&&this.inc("patch",t,r),this.inc("pre",t,r);break;case"release":if(this.prerelease.length===0)throw new Error(`version ${this.raw} is not a prerelease`);this.prerelease.length=0;break;case"major":(this.minor!==0||this.patch!==0||this.prerelease.length===0)&&this.major++,this.minor=0,this.patch=0,this.prerelease=[];break;case"minor":(this.patch!==0||this.prerelease.length===0)&&this.minor++,this.patch=0,this.prerelease=[];break;case"patch":this.prerelease.length===0&&this.patch++,this.prerelease=[];break;case"pre":{let i=Number(r)?1:0;if(this.prerelease.length===0)this.prerelease=[i];else{let s=this.prerelease.length;for(;--s>=0;)typeof this.prerelease[s]=="number"&&(this.prerelease[s]++,s=-2);if(s===-1){if(t===this.prerelease.join(".")&&r===!1)throw new Error("invalid increment argument: identifier already exists");this.prerelease.push(i)}}if(t){let s=[t,i];r===!1&&(s=[t]),Pr(this.prerelease[0],t)===0?isNaN(this.prerelease[1])&&(this.prerelease=s):this.prerelease=s}break}default:throw new Error(`invalid increment argument: ${e}`)}return this.raw=this.format(),this.build.length&&(this.raw+=`+${this.build.join(".")}`),this}};zu.exports=Aa});var lr=M((Ak,Wu)=>{var Gu=Ze(),Ky=(n,e,t=!1)=>{if(n instanceof Gu)return n;try{return new Gu(n,e)}catch(r){if(!t)return null;throw r}};Wu.exports=Ky});var Ku=M((Tk,Hu)=>{var Jy=lr(),Yy=(n,e)=>{let t=Jy(n,e);return t?t.version:null};Hu.exports=Yy});var Yu=M((Ck,Ju)=>{var Xy=lr(),Qy=(n,e)=>{let t=Xy(n.trim().replace(/^[=v]+/,""),e);return t?t.version:null};Ju.exports=Qy});var Zu=M((Ik,Qu)=>{var Xu=Ze(),Zy=(n,e,t,r,i)=>{typeof t=="string"&&(i=r,r=t,t=void 0);try{return new Xu(n instanceof Xu?n.version:n,t).inc(e,r,i).version}catch{return null}};Qu.exports=Zy});var nh=M((Rk,th)=>{var eh=lr(),e0=(n,e)=>{let t=eh(n,null,!0),r=eh(e,null,!0),i=t.compare(r);if(i===0)return null;let s=i>0,o=s?t:r,a=s?r:t,c=!!o.prerelease.length;if(!!a.prerelease.length&&!c){if(!a.patch&&!a.minor)return"major";if(a.compareMain(o)===0)return a.minor&&!a.patch?"minor":"patch"}let l=c?"pre":"";return t.major!==r.major?l+"major":t.minor!==r.minor?l+"minor":t.patch!==r.patch?l+"patch":"prerelease"};th.exports=e0});var ih=M((Dk,rh)=>{var t0=Ze(),n0=(n,e)=>new t0(n,e).major;rh.exports=n0});var oh=M((Uk,sh)=>{var r0=Ze(),i0=(n,e)=>new r0(n,e).minor;sh.exports=i0});var ch=M((Ok,ah)=>{var s0=Ze(),o0=(n,e)=>new s0(n,e).patch;ah.exports=o0});var uh=M((Nk,lh)=>{var a0=lr(),c0=(n,e)=>{let t=a0(n,e);return t&&t.prerelease.length?t.prerelease:null};lh.exports=c0});var Tt=M((Pk,fh)=>{var hh=Ze(),l0=(n,e,t)=>new hh(n,t).compare(new hh(e,t));fh.exports=l0});var ph=M((Lk,dh)=>{var u0=Tt(),h0=(n,e,t)=>u0(e,n,t);dh.exports=h0});var mh=M((Mk,gh)=>{var f0=Tt(),d0=(n,e)=>f0(n,e,!0);gh.exports=d0});var Ds=M((Bk,wh)=>{var yh=Ze(),p0=(n,e,t)=>{let r=new yh(n,t),i=new yh(e,t);return r.compare(i)||r.compareBuild(i)};wh.exports=p0});var xh=M((Fk,vh)=>{var g0=Ds(),m0=(n,e)=>n.sort((t,r)=>g0(t,r,e));vh.exports=m0});var Eh=M((jk,bh)=>{var y0=Ds(),w0=(n,e)=>n.sort((t,r)=>y0(r,t,e));bh.exports=w0});var bi=M((Vk,Sh)=>{var v0=Tt(),x0=(n,e,t)=>v0(n,e,t)>0;Sh.exports=x0});var Us=M(($k,kh)=>{var b0=Tt(),E0=(n,e,t)=>b0(n,e,t)<0;kh.exports=E0});var Ta=M((qk,_h)=>{var S0=Tt(),k0=(n,e,t)=>S0(n,e,t)===0;_h.exports=k0});var Ca=M((zk,Ah)=>{var _0=Tt(),A0=(n,e,t)=>_0(n,e,t)!==0;Ah.exports=A0});var Os=M((Gk,Th)=>{var T0=Tt(),C0=(n,e,t)=>T0(n,e,t)>=0;Th.exports=C0});var Ns=M((Wk,Ch)=>{var I0=Tt(),R0=(n,e,t)=>I0(n,e,t)<=0;Ch.exports=R0});var Ia=M((Hk,Ih)=>{var D0=Ta(),U0=Ca(),O0=bi(),N0=Os(),P0=Us(),L0=Ns(),M0=(n,e,t,r)=>{switch(e){case"===":return typeof n=="object"&&(n=n.version),typeof t=="object"&&(t=t.version),n===t;case"!==":return typeof n=="object"&&(n=n.version),typeof t=="object"&&(t=t.version),n!==t;case"":case"=":case"==":return D0(n,t,r);case"!=":return U0(n,t,r);case">":return O0(n,t,r);case">=":return N0(n,t,r);case"<":return P0(n,t,r);case"<=":return L0(n,t,r);default:throw new TypeError(`Invalid operator: ${e}`)}};Ih.exports=M0});var Dh=M((Kk,Rh)=>{var B0=Ze(),F0=lr(),{safeRe:Ps,t:Ls}=Nr(),j0=(n,e)=>{if(n instanceof B0)return n;if(typeof n=="number"&&(n=String(n)),typeof n!="string")return null;e=e||{};let t=null;if(!e.rtl)t=n.match(e.includePrerelease?Ps[Ls.COERCEFULL]:Ps[Ls.COERCE]);else{let c=e.includePrerelease?Ps[Ls.COERCERTLFULL]:Ps[Ls.COERCERTL],u;for(;(u=c.exec(n))&&(!t||t.index+t[0].length!==n.length);)(!t||u.index+u[0].length!==t.index+t[0].length)&&(t=u),c.lastIndex=u.index+u[1].length+u[2].length;c.lastIndex=-1}if(t===null)return null;let r=t[2],i=t[3]||"0",s=t[4]||"0",o=e.includePrerelease&&t[5]?`-${t[5]}`:"",a=e.includePrerelease&&t[6]?`+${t[6]}`:"";return F0(`${r}.${i}.${s}${o}${a}`,e)};Rh.exports=j0});var Oh=M((Jk,Uh)=>{var Ra=class{constructor(){this.max=1e3,this.map=new Map}get(e){let t=this.map.get(e);if(t!==void 0)return this.map.delete(e),this.map.set(e,t),t}delete(e){return this.map.delete(e)}set(e,t){if(!this.delete(e)&&t!==void 0){if(this.map.size>=this.max){let i=this.map.keys().next().value;this.delete(i)}this.map.set(e,t)}return this}};Uh.exports=Ra});var Ct=M((Yk,Mh)=>{var V0=/\s+/g,Da=class n{constructor(e,t){if(t=q0(t),e instanceof n)return e.loose===!!t.loose&&e.includePrerelease===!!t.includePrerelease?e:new n(e.raw,t);if(e instanceof Ua)return this.raw=e.value,this.set=[[e]],this.formatted=void 0,this;if(this.options=t,this.loose=!!t.loose,this.includePrerelease=!!t.includePrerelease,this.raw=e.trim().replace(V0," "),this.set=this.raw.split("||").map(r=>this.parseRange(r.trim())).filter(r=>r.length),!this.set.length)throw new TypeError(`Invalid SemVer Range: ${this.raw}`);if(this.set.length>1){let r=this.set[0];if(this.set=this.set.filter(i=>!Ph(i[0])),this.set.length===0)this.set=[r];else if(this.set.length>1){for(let i of this.set)if(i.length===1&&Y0(i[0])){this.set=[i];break}}}this.formatted=void 0}get range(){if(this.formatted===void 0){this.formatted="";for(let e=0;e<this.set.length;e++){e>0&&(this.formatted+="||");let t=this.set[e];for(let r=0;r<t.length;r++)r>0&&(this.formatted+=" "),this.formatted+=t[r].toString().trim()}}return this.formatted}format(){return this.range}toString(){return this.range}parseRange(e){let r=((this.options.includePrerelease&&K0)|(this.options.loose&&J0))+":"+e,i=Nh.get(r);if(i)return i;let s=this.options.loose,o=s?ut[rt.HYPHENRANGELOOSE]:ut[rt.HYPHENRANGE];e=e.replace(o,ow(this.options.includePrerelease)),Te("hyphen replace",e),e=e.replace(ut[rt.COMPARATORTRIM],G0),Te("comparator trim",e),e=e.replace(ut[rt.TILDETRIM],W0),Te("tilde trim",e),e=e.replace(ut[rt.CARETTRIM],H0),Te("caret trim",e);let a=e.split(" ").map(h=>X0(h,this.options)).join(" ").split(/\s+/).map(h=>sw(h,this.options));s&&(a=a.filter(h=>(Te("loose invalid filter",h,this.options),!!h.match(ut[rt.COMPARATORLOOSE])))),Te("range list",a);let c=new Map,u=a.map(h=>new Ua(h,this.options));for(let h of u){if(Ph(h))return[h];c.set(h.value,h)}c.size>1&&c.has("")&&c.delete("");let l=[...c.values()];return Nh.set(r,l),l}intersects(e,t){if(!(e instanceof n))throw new TypeError("a Range is required");return this.set.some(r=>Lh(r,t)&&e.set.some(i=>Lh(i,t)&&r.every(s=>i.every(o=>s.intersects(o,t)))))}test(e){if(!e)return!1;if(typeof e=="string")try{e=new z0(e,this.options)}catch{return!1}for(let t=0;t<this.set.length;t++)if(aw(this.set[t],e,this.options))return!0;return!1}};Mh.exports=Da;var $0=Oh(),Nh=new $0,q0=Ts(),Ua=Ei(),Te=xi(),z0=Ze(),{safeRe:ut,t:rt,comparatorTrimReplace:G0,tildeTrimReplace:W0,caretTrimReplace:H0}=Nr(),{FLAG_INCLUDE_PRERELEASE:K0,FLAG_LOOSE:J0}=vi(),Ph=n=>n.value==="<0.0.0-0",Y0=n=>n.value==="",Lh=(n,e)=>{let t=!0,r=n.slice(),i=r.pop();for(;t&&r.length;)t=r.every(s=>i.intersects(s,e)),i=r.pop();return t},X0=(n,e)=>(Te("comp",n,e),n=ew(n,e),Te("caret",n),n=Q0(n,e),Te("tildes",n),n=nw(n,e),Te("xrange",n),n=iw(n,e),Te("stars",n),n),it=n=>!n||n.toLowerCase()==="x"||n==="*",Q0=(n,e)=>n.trim().split(/\s+/).map(t=>Z0(t,e)).join(" "),Z0=(n,e)=>{let t=e.loose?ut[rt.TILDELOOSE]:ut[rt.TILDE];return n.replace(t,(r,i,s,o,a)=>{Te("tilde",n,r,i,s,o,a);let c;return it(i)?c="":it(s)?c=`>=${i}.0.0 <${+i+1}.0.0-0`:it(o)?c=`>=${i}.${s}.0 <${i}.${+s+1}.0-0`:a?(Te("replaceTilde pr",a),c=`>=${i}.${s}.${o}-${a} <${i}.${+s+1}.0-0`):c=`>=${i}.${s}.${o} <${i}.${+s+1}.0-0`,Te("tilde return",c),c})},ew=(n,e)=>n.trim().split(/\s+/).map(t=>tw(t,e)).join(" "),tw=(n,e)=>{Te("caret",n,e);let t=e.loose?ut[rt.CARETLOOSE]:ut[rt.CARET],r=e.includePrerelease?"-0":"";return n.replace(t,(i,s,o,a,c)=>{Te("caret",n,i,s,o,a,c);let u;return it(s)?u="":it(o)?u=`>=${s}.0.0${r} <${+s+1}.0.0-0`:it(a)?s==="0"?u=`>=${s}.${o}.0${r} <${s}.${+o+1}.0-0`:u=`>=${s}.${o}.0${r} <${+s+1}.0.0-0`:c?(Te("replaceCaret pr",c),s==="0"?o==="0"?u=`>=${s}.${o}.${a}-${c} <${s}.${o}.${+a+1}-0`:u=`>=${s}.${o}.${a}-${c} <${s}.${+o+1}.0-0`:u=`>=${s}.${o}.${a}-${c} <${+s+1}.0.0-0`):(Te("no pr"),s==="0"?o==="0"?u=`>=${s}.${o}.${a}${r} <${s}.${o}.${+a+1}-0`:u=`>=${s}.${o}.${a}${r} <${s}.${+o+1}.0-0`:u=`>=${s}.${o}.${a} <${+s+1}.0.0-0`),Te("caret return",u),u})},nw=(n,e)=>(Te("replaceXRanges",n,e),n.split(/\s+/).map(t=>rw(t,e)).join(" ")),rw=(n,e)=>{n=n.trim();let t=e.loose?ut[rt.XRANGELOOSE]:ut[rt.XRANGE];return n.replace(t,(r,i,s,o,a,c)=>{Te("xRange",n,r,i,s,o,a,c);let u=it(s),l=u||it(o),h=l||it(a),f=h;return i==="="&&f&&(i=""),c=e.includePrerelease?"-0":"",u?i===">"||i==="<"?r="<0.0.0-0":r="*":i&&f?(l&&(o=0),a=0,i===">"?(i=">=",l?(s=+s+1,o=0,a=0):(o=+o+1,a=0)):i==="<="&&(i="<",l?s=+s+1:o=+o+1),i==="<"&&(c="-0"),r=`${i+s}.${o}.${a}${c}`):l?r=`>=${s}.0.0${c} <${+s+1}.0.0-0`:h&&(r=`>=${s}.${o}.0${c} <${s}.${+o+1}.0-0`),Te("xRange return",r),r})},iw=(n,e)=>(Te("replaceStars",n,e),n.trim().replace(ut[rt.STAR],"")),sw=(n,e)=>(Te("replaceGTE0",n,e),n.trim().replace(ut[e.includePrerelease?rt.GTE0PRE:rt.GTE0],"")),ow=n=>(e,t,r,i,s,o,a,c,u,l,h,f)=>(it(r)?t="":it(i)?t=`>=${r}.0.0${n?"-0":""}`:it(s)?t=`>=${r}.${i}.0${n?"-0":""}`:o?t=`>=${t}`:t=`>=${t}${n?"-0":""}`,it(u)?c="":it(l)?c=`<${+u+1}.0.0-0`:it(h)?c=`<${u}.${+l+1}.0-0`:f?c=`<=${u}.${l}.${h}-${f}`:n?c=`<${u}.${l}.${+h+1}-0`:c=`<=${c}`,`${t} ${c}`.trim()),aw=(n,e,t)=>{for(let r=0;r<n.length;r++)if(!n[r].test(e))return!1;if(e.prerelease.length&&!t.includePrerelease){for(let r=0;r<n.length;r++)if(Te(n[r].semver),n[r].semver!==Ua.ANY&&n[r].semver.prerelease.length>0){let i=n[r].semver;if(i.major===e.major&&i.minor===e.minor&&i.patch===e.patch)return!0}return!1}return!0}});var Ei=M((Xk,qh)=>{var Si=Symbol("SemVer ANY"),Pa=class n{static get ANY(){return Si}constructor(e,t){if(t=Bh(t),e instanceof n){if(e.loose===!!t.loose)return e;e=e.value}e=e.trim().split(/\s+/).join(" "),Na("comparator",e,t),this.options=t,this.loose=!!t.loose,this.parse(e),this.semver===Si?this.value="":this.value=this.operator+this.semver.version,Na("comp",this)}parse(e){let t=this.options.loose?Fh[jh.COMPARATORLOOSE]:Fh[jh.COMPARATOR],r=e.match(t);if(!r)throw new TypeError(`Invalid comparator: ${e}`);this.operator=r[1]!==void 0?r[1]:"",this.operator==="="&&(this.operator=""),r[2]?this.semver=new Vh(r[2],this.options.loose):this.semver=Si}toString(){return this.value}test(e){if(Na("Comparator.test",e,this.options.loose),this.semver===Si||e===Si)return!0;if(typeof e=="string")try{e=new Vh(e,this.options)}catch{return!1}return Oa(e,this.operator,this.semver,this.options)}intersects(e,t){if(!(e instanceof n))throw new TypeError("a Comparator is required");return this.operator===""?this.value===""?!0:new $h(e.value,t).test(this.value):e.operator===""?e.value===""?!0:new $h(this.value,t).test(e.semver):(t=Bh(t),t.includePrerelease&&(this.value==="<0.0.0-0"||e.value==="<0.0.0-0")||!t.includePrerelease&&(this.value.startsWith("<0.0.0")||e.value.startsWith("<0.0.0"))?!1:!!(this.operator.startsWith(">")&&e.operator.startsWith(">")||this.operator.startsWith("<")&&e.operator.startsWith("<")||this.semver.version===e.semver.version&&this.operator.includes("=")&&e.operator.includes("=")||Oa(this.semver,"<",e.semver,t)&&this.operator.startsWith(">")&&e.operator.startsWith("<")||Oa(this.semver,">",e.semver,t)&&this.operator.startsWith("<")&&e.operator.startsWith(">")))}};qh.exports=Pa;var Bh=Ts(),{safeRe:Fh,t:jh}=Nr(),Oa=Ia(),Na=xi(),Vh=Ze(),$h=Ct()});var ki=M((Qk,zh)=>{var cw=Ct(),lw=(n,e,t)=>{try{e=new cw(e,t)}catch{return!1}return e.test(n)};zh.exports=lw});var Wh=M((Zk,Gh)=>{var uw=Ct(),hw=(n,e)=>new uw(n,e).set.map(t=>t.map(r=>r.value).join(" ").trim().split(" "));Gh.exports=hw});var Kh=M((e_,Hh)=>{var fw=Ze(),dw=Ct(),pw=(n,e,t)=>{let r=null,i=null,s=null;try{s=new dw(e,t)}catch{return null}return n.forEach(o=>{s.test(o)&&(!r||i.compare(o)===-1)&&(r=o,i=new fw(r,t))}),r};Hh.exports=pw});var Yh=M((t_,Jh)=>{var gw=Ze(),mw=Ct(),yw=(n,e,t)=>{let r=null,i=null,s=null;try{s=new mw(e,t)}catch{return null}return n.forEach(o=>{s.test(o)&&(!r||i.compare(o)===1)&&(r=o,i=new gw(r,t))}),r};Jh.exports=yw});var Zh=M((n_,Qh)=>{var La=Ze(),ww=Ct(),Xh=bi(),vw=(n,e)=>{n=new ww(n,e);let t=new La("0.0.0");if(n.test(t)||(t=new La("0.0.0-0"),n.test(t)))return t;t=null;for(let r=0;r<n.set.length;++r){let i=n.set[r],s=null;i.forEach(o=>{let a=new La(o.semver.version);switch(o.operator){case">":a.prerelease.length===0?a.patch++:a.prerelease.push(0),a.raw=a.format();case"":case">=":(!s||Xh(a,s))&&(s=a);break;case"<":case"<=":break;default:throw new Error(`Unexpected operation: ${o.operator}`)}}),s&&(!t||Xh(t,s))&&(t=s)}return t&&n.test(t)?t:null};Qh.exports=vw});var tf=M((r_,ef)=>{var xw=Ct(),bw=(n,e)=>{try{return new xw(n,e).range||"*"}catch{return null}};ef.exports=bw});var Ms=M((i_,of)=>{var Ew=Ze(),sf=Ei(),{ANY:Sw}=sf,kw=Ct(),_w=ki(),nf=bi(),rf=Us(),Aw=Ns(),Tw=Os(),Cw=(n,e,t,r)=>{n=new Ew(n,r),e=new kw(e,r);let i,s,o,a,c;switch(t){case">":i=nf,s=Aw,o=rf,a=">",c=">=";break;case"<":i=rf,s=Tw,o=nf,a="<",c="<=";break;default:throw new TypeError('Must provide a hilo val of "<" or ">"')}if(_w(n,e,r))return!1;for(let u=0;u<e.set.length;++u){let l=e.set[u],h=null,f=null;if(l.forEach(d=>{d.semver===Sw&&(d=new sf(">=0.0.0")),h=h||d,f=f||d,i(d.semver,h.semver,r)?h=d:o(d.semver,f.semver,r)&&(f=d)}),h.operator===a||h.operator===c||(!f.operator||f.operator===a)&&s(n,f.semver))return!1;if(f.operator===c&&o(n,f.semver))return!1}return!0};of.exports=Cw});var cf=M((s_,af)=>{var Iw=Ms(),Rw=(n,e,t)=>Iw(n,e,">",t);af.exports=Rw});var uf=M((o_,lf)=>{var Dw=Ms(),Uw=(n,e,t)=>Dw(n,e,"<",t);lf.exports=Uw});var df=M((a_,ff)=>{var hf=Ct(),Ow=(n,e,t)=>(n=new hf(n,t),e=new hf(e,t),n.intersects(e,t));ff.exports=Ow});var gf=M((c_,pf)=>{var Nw=ki(),Pw=Tt();pf.exports=(n,e,t)=>{let r=[],i=null,s=null,o=n.sort((l,h)=>Pw(l,h,t));for(let l of o)Nw(l,e,t)?(s=l,i||(i=l)):(s&&r.push([i,s]),s=null,i=null);i&&r.push([i,null]);let a=[];for(let[l,h]of r)l===h?a.push(l):!h&&l===o[0]?a.push("*"):h?l===o[0]?a.push(`<=${h}`):a.push(`${l} - ${h}`):a.push(`>=${l}`);let c=a.join(" || "),u=typeof e.raw=="string"?e.raw:String(e);return c.length<u.length?c:e}});var bf=M((l_,xf)=>{var mf=Ct(),Ba=Ei(),{ANY:Ma}=Ba,_i=ki(),Fa=Tt(),Lw=(n,e,t={})=>{if(n===e)return!0;n=new mf(n,t),e=new mf(e,t);let r=!1;e:for(let i of n.set){for(let s of e.set){let o=Bw(i,s,t);if(r=r||o!==null,o)continue e}if(r)return!1}return!0},Mw=[new Ba(">=0.0.0-0")],yf=[new Ba(">=0.0.0")],Bw=(n,e,t)=>{if(n===e)return!0;if(n.length===1&&n[0].semver===Ma){if(e.length===1&&e[0].semver===Ma)return!0;t.includePrerelease?n=Mw:n=yf}if(e.length===1&&e[0].semver===Ma){if(t.includePrerelease)return!0;e=yf}let r=new Set,i,s;for(let d of n)d.operator===">"||d.operator===">="?i=wf(i,d,t):d.operator==="<"||d.operator==="<="?s=vf(s,d,t):r.add(d.semver);if(r.size>1)return null;let o;if(i&&s){if(o=Fa(i.semver,s.semver,t),o>0)return null;if(o===0&&(i.operator!==">="||s.operator!=="<="))return null}for(let d of r){if(i&&!_i(d,String(i),t)||s&&!_i(d,String(s),t))return null;for(let x of e)if(!_i(d,String(x),t))return!1;return!0}let a,c,u,l,h=s&&!t.includePrerelease&&s.semver.prerelease.length?s.semver:!1,f=i&&!t.includePrerelease&&i.semver.prerelease.length?i.semver:!1;h&&h.prerelease.length===1&&s.operator==="<"&&h.prerelease[0]===0&&(h=!1);for(let d of e){if(l=l||d.operator===">"||d.operator===">=",u=u||d.operator==="<"||d.operator==="<=",i){if(f&&d.semver.prerelease&&d.semver.prerelease.length&&d.semver.major===f.major&&d.semver.minor===f.minor&&d.semver.patch===f.patch&&(f=!1),d.operator===">"||d.operator===">="){if(a=wf(i,d,t),a===d&&a!==i)return!1}else if(i.operator===">="&&!_i(i.semver,String(d),t))return!1}if(s){if(h&&d.semver.prerelease&&d.semver.prerelease.length&&d.semver.major===h.major&&d.semver.minor===h.minor&&d.semver.patch===h.patch&&(h=!1),d.operator==="<"||d.operator==="<="){if(c=vf(s,d,t),c===d&&c!==s)return!1}else if(s.operator==="<="&&!_i(s.semver,String(d),t))return!1}if(!d.operator&&(s||i)&&o!==0)return!1}return!(i&&u&&!s&&o!==0||s&&l&&!i&&o!==0||f||h)},wf=(n,e,t)=>{if(!n)return e;let r=Fa(n.semver,e.semver,t);return r>0?n:r<0||e.operator===">"&&n.operator===">="?e:n},vf=(n,e,t)=>{if(!n)return e;let r=Fa(n.semver,e.semver,t);return r<0?n:r>0||e.operator==="<"&&n.operator==="<="?e:n};xf.exports=Lw});var Va=M((u_,kf)=>{var ja=Nr(),Ef=vi(),Fw=Ze(),Sf=_a(),jw=lr(),Vw=Ku(),$w=Yu(),qw=Zu(),zw=nh(),Gw=ih(),Ww=oh(),Hw=ch(),Kw=uh(),Jw=Tt(),Yw=ph(),Xw=mh(),Qw=Ds(),Zw=xh(),ev=Eh(),tv=bi(),nv=Us(),rv=Ta(),iv=Ca(),sv=Os(),ov=Ns(),av=Ia(),cv=Dh(),lv=Ei(),uv=Ct(),hv=ki(),fv=Wh(),dv=Kh(),pv=Yh(),gv=Zh(),mv=tf(),yv=Ms(),wv=cf(),vv=uf(),xv=df(),bv=gf(),Ev=bf();kf.exports={parse:jw,valid:Vw,clean:$w,inc:qw,diff:zw,major:Gw,minor:Ww,patch:Hw,prerelease:Kw,compare:Jw,rcompare:Yw,compareLoose:Xw,compareBuild:Qw,sort:Zw,rsort:ev,gt:tv,lt:nv,eq:rv,neq:iv,gte:sv,lte:ov,cmp:av,coerce:cv,Comparator:lv,Range:uv,satisfies:hv,toComparators:fv,maxSatisfying:dv,minSatisfying:pv,minVersion:gv,validRange:mv,outside:yv,gtr:wv,ltr:vv,intersects:xv,simplifyRange:bv,subset:Ev,SemVer:Fw,re:ja.re,src:ja.src,tokens:ja.t,SEMVER_SPEC_VERSION:Ef.SEMVER_SPEC_VERSION,RELEASE_TYPES:Ef.RELEASE_TYPES,compareIdentifiers:Sf.compareIdentifiers,rcompareIdentifiers:Sf.rcompareIdentifiers}});var gd=M(Js=>{"use strict";Js.byteLength=fx;Js.toByteArray=px;Js.fromByteArray=yx;var nn=[],Ut=[],hx=typeof Uint8Array<"u"?Uint8Array:Array,yc="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";for(wr=0,dd=yc.length;wr<dd;++wr)nn[wr]=yc[wr],Ut[yc.charCodeAt(wr)]=wr;var wr,dd;Ut[45]=62;Ut[95]=63;function pd(n){var e=n.length;if(e%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var t=n.indexOf("=");t===-1&&(t=e);var r=t===e?0:4-t%4;return[t,r]}function fx(n){var e=pd(n),t=e[0],r=e[1];return(t+r)*3/4-r}function dx(n,e,t){return(e+t)*3/4-t}function px(n){var e,t=pd(n),r=t[0],i=t[1],s=new hx(dx(n,r,i)),o=0,a=i>0?r-4:r,c;for(c=0;c<a;c+=4)e=Ut[n.charCodeAt(c)]<<18|Ut[n.charCodeAt(c+1)]<<12|Ut[n.charCodeAt(c+2)]<<6|Ut[n.charCodeAt(c+3)],s[o++]=e>>16&255,s[o++]=e>>8&255,s[o++]=e&255;return i===2&&(e=Ut[n.charCodeAt(c)]<<2|Ut[n.charCodeAt(c+1)]>>4,s[o++]=e&255),i===1&&(e=Ut[n.charCodeAt(c)]<<10|Ut[n.charCodeAt(c+1)]<<4|Ut[n.charCodeAt(c+2)]>>2,s[o++]=e>>8&255,s[o++]=e&255),s}function gx(n){return nn[n>>18&63]+nn[n>>12&63]+nn[n>>6&63]+nn[n&63]}function mx(n,e,t){for(var r,i=[],s=e;s<t;s+=3)r=(n[s]<<16&16711680)+(n[s+1]<<8&65280)+(n[s+2]&255),i.push(gx(r));return i.join("")}function yx(n){for(var e,t=n.length,r=t%3,i=[],s=16383,o=0,a=t-r;o<a;o+=s)i.push(mx(n,o,o+s>a?a:o+s));return r===1?(e=n[t-1],i.push(nn[e>>2]+nn[e<<4&63]+"==")):r===2&&(e=(n[t-2]<<8)+n[t-1],i.push(nn[e>>10]+nn[e>>4&63]+nn[e<<2&63]+"=")),i.join("")}});var na=M((CC,Vg)=>{function WE(n){var e=typeof n;return n!=null&&(e=="object"||e=="function")}Vg.exports=WE});var qg=M((IC,$g)=>{var HE=typeof globalThis=="object"&&globalThis&&globalThis.Object===Object&&globalThis;$g.exports=HE});var jl=M((RC,zg)=>{var KE=qg(),JE=typeof self=="object"&&self&&self.Object===Object&&self,YE=KE||JE||Function("return this")();zg.exports=YE});var Wg=M((DC,Gg)=>{var XE=jl(),QE=function(){return XE.Date.now()};Gg.exports=QE});var Kg=M((UC,Hg)=>{var ZE=/\s/;function eS(n){for(var e=n.length;e--&&ZE.test(n.charAt(e)););return e}Hg.exports=eS});var Yg=M((OC,Jg)=>{var tS=Kg(),nS=/^\s+/;function rS(n){return n&&n.slice(0,tS(n)+1).replace(nS,"")}Jg.exports=rS});var Vl=M((NC,Xg)=>{var iS=jl(),sS=iS.Symbol;Xg.exports=sS});var tm=M((PC,em)=>{var Qg=Vl(),Zg=Object.prototype,oS=Zg.hasOwnProperty,aS=Zg.toString,xs=Qg?Qg.toStringTag:void 0;function cS(n){var e=oS.call(n,xs),t=n[xs];try{n[xs]=void 0;var r=!0}catch{}var i=aS.call(n);return r&&(e?n[xs]=t:delete n[xs]),i}em.exports=cS});var rm=M((LC,nm)=>{var lS=Object.prototype,uS=lS.toString;function hS(n){return uS.call(n)}nm.exports=hS});var am=M((MC,om)=>{var im=Vl(),fS=tm(),dS=rm(),pS="[object Null]",gS="[object Undefined]",sm=im?im.toStringTag:void 0;function mS(n){return n==null?n===void 0?gS:pS:sm&&sm in Object(n)?fS(n):dS(n)}om.exports=mS});var lm=M((BC,cm)=>{function yS(n){return n!=null&&typeof n=="object"}cm.exports=yS});var hm=M((FC,um)=>{var wS=am(),vS=lm(),xS="[object Symbol]";function bS(n){return typeof n=="symbol"||vS(n)&&wS(n)==xS}um.exports=bS});var gm=M((jC,pm)=>{var ES=Yg(),fm=na(),SS=hm(),dm=NaN,kS=/^[-+]0x[0-9a-f]+$/i,_S=/^0b[01]+$/i,AS=/^0o[0-7]+$/i,TS=parseInt;function CS(n){if(typeof n=="number")return n;if(SS(n))return dm;if(fm(n)){var e=typeof n.valueOf=="function"?n.valueOf():n;n=fm(e)?e+"":e}if(typeof n!="string")return n===0?n:+n;n=ES(n);var t=_S.test(n);return t||AS.test(n)?TS(n.slice(2),t?2:8):kS.test(n)?dm:+n}pm.exports=CS});var ql=M((VC,ym)=>{var IS=na(),$l=Wg(),mm=gm(),RS="Expected a function",DS=Math.max,US=Math.min;function OS(n,e,t){var r,i,s,o,a,c,u=0,l=!1,h=!1,f=!0;if(typeof n!="function")throw new TypeError(RS);e=mm(e)||0,IS(t)&&(l=!!t.leading,h="maxWait"in t,s=h?DS(mm(t.maxWait)||0,e):s,f="trailing"in t?!!t.trailing:f);function d(z){var ne=r,X=i;return r=i=void 0,u=z,o=n.apply(X,ne),o}function x(z){return u=z,a=setTimeout(ue,e),l?d(z):o}function S(z){var ne=z-c,X=z-u,V=e-ne;return h?US(V,s-X):V}function j(z){var ne=z-c,X=z-u;return c===void 0||ne>=e||ne<0||h&&X>=s}function ue(){var z=$l();if(j(z))return he(z);a=setTimeout(ue,S(z))}function he(z){return a=void 0,f&&r?d(z):(r=i=void 0,o)}function le(){a!==void 0&&clearTimeout(a),u=0,r=c=i=a=void 0}function de(){return a===void 0?o:he($l())}function G(){var z=$l(),ne=j(z);if(r=arguments,i=this,c=z,ne){if(a===void 0)return x(c);if(h)return clearTimeout(a),a=setTimeout(ue,e),d(c)}return a===void 0&&(a=setTimeout(ue,e)),o}return G.cancel=le,G.flush=de,G}ym.exports=OS});var vm=M(($C,wm)=>{var NS=ql(),PS=na(),LS="Expected a function";function MS(n,e,t){var r=!0,i=!0;if(typeof n!="function")throw new TypeError(LS);return PS(t)&&(r="leading"in t?!!t.leading:r,i="trailing"in t?!!t.trailing:i),NS(n,e,{leading:r,maxWait:e,trailing:i})}wm.exports=MS});var mk={};Iu(mk,{activate:()=>pk,deactivate:()=>gk});module.exports=Ty(mk);var GR=Fe(Ea());function Ce(n){return typeof n=="object"&&n!==null}function Ou(n,e){return Array.isArray(n)?e?n.every(e):!0:!1}function At(n){return typeof n=="string"}var _f=Fe(Va(),1),Bt="0.3.0",$a=new _f.SemVer(Bt);function Af(n,e=$a){return e.major!==n.major?!1:e.major===0&&n.major===0?e.minor===n.minor:!0}var qa;(function(n){function e(t){return Ce(t)&&za.is(t.encryption)&&Ga.is(t.compression)}n.is=e})(qa||(qa={}));var ur={encryption:{keys:[]},compression:{algorithm:"none"}},za;(function(n){function e(t){return Ce(t)&&Ou(t.keys,Wa.is)}n.is=e})(za||(za={}));var Ga;(function(n){function e(t){return Ce(t)&&At(t.algorithm)}n.is=e})(Ga||(Ga={}));var Wa;(function(n){function e(t){return Ce(t)&&At(t.target)&&At(t.key)&&At(t.iv)}n.is=e})(Wa||(Wa={}));var ht;(function(n){function e(r){return Ce(r)&&At(r.version)&&At(r.kind)&&qa.is(r.metadata)}n.is=e;function t(r){return r.content instanceof Uint8Array}n.isEncrypted=t})(ht||(ht={}));var Lr;(function(n){function e(s){return{version:Bt,kind:"error",metadata:ur,content:{message:s}}}n.create=e;function t(s){return ht.is(s)&&s.kind==="error"}n.isAny=t;function r(s){return t(s)&&Ce(s.content)&&At(s.content.message)}n.is=r;function i(s){return t(s)&&ht.isEncrypted(s)}n.isBinary=i})(Lr||(Lr={}));var hr;(function(n){function e(s,o,a,c,u){return{version:Bt,id:o,metadata:ur,origin:a,target:c,kind:"request",content:{method:typeof s=="string"?s:s.method,params:u}}}n.create=e;function t(s){return ht.is(s)&&s.kind==="request"}n.isAny=t;function r(s){if(!t(s))return!1;let o=s.content;return Ce(o)&&At(o.method)}n.is=r;function i(s){return t(s)&&ht.isEncrypted(s)}n.isEncrypted=i})(hr||(hr={}));var fr;(function(n){function e(s,o){return{kind:"response",version:Bt,id:s,metadata:ur,content:{response:o}}}n.create=e;function t(s){return ht.is(s)&&s.kind==="response"}n.isAny=t;function r(s){return t(s)&&Ce(s.content)&&"response"in s.content}n.is=r;function i(s){return t(s)&&ht.isEncrypted(s)}n.isEncrypted=i})(fr||(fr={}));var dr;(function(n){function e(s,o){return typeof o=="string"?{kind:"response-error",version:Bt,metadata:ur,id:s,content:{message:o}}:{kind:"response-error",version:Bt,metadata:ur,id:s,content:o}}n.create=e;function t(s){return ht.is(s)&&s.kind==="response-error"}n.isAny=t;function r(s){return t(s)&&Ce(s.content)&&At(s.content.message)}n.is=r;function i(s){return t(s)&&ht.isEncrypted(s)}n.isEncrypted=i})(dr||(dr={}));var pr;(function(n){function e(s,o,a,c){return{version:Bt,kind:"notification",metadata:ur,target:a,origin:o,content:{method:typeof s=="string"?s:s.method,params:c}}}n.create=e;function t(s){return ht.is(s)&&s.kind==="notification"}n.isAny=t;function r(s){if(!t(s))return!1;let o=s.content;return Ce(o)&&At(o.method)}n.is=r;function i(s){return t(s)&&ht.isEncrypted(s)}n.isEncrypted=i})(pr||(pr={}));var Bn;(function(n){function e(s,o,a){return{version:Bt,kind:"broadcast",metadata:ur,origin:o,content:{method:typeof s=="string"?s:s.method,params:a}}}n.create=e;function t(s){return ht.is(s)&&s.kind==="broadcast"}n.isAny=t;function r(s){if(!t(s))return!1;let o=s.content;return Ce(o)&&At(o.method)}n.is=r;function i(s){return t(s)&&ht.isEncrypted(s)}n.isEncrypted=i})(Bn||(Bn={}));var Ai=class{method;constructor(e){this.method=e}},It=class extends Ai{_;constructor(e){super(e)}},Ft=class extends Ai{_;constructor(e){super(e)}},mn=class extends Ai{_;constructor(e){super(e)}};var Bs;(function(n){function e(r){return Ce(r)&&typeof r.dispose=="function"}n.is=e;function t(r){return{dispose:r}}n.create=t})(Bs||(Bs={}));Object.defineProperty(Bs,"NULL",{configurable:!1,enumerable:!0,get(){return{dispose:()=>{}}}});var gr=class{disposables=[];onDisposeEmitter=new yt;constructor(...e){e.forEach(t=>this.push(t))}get onDispose(){return this.onDisposeEmitter.event}checkDisposed(){this.disposed&&!this.disposingElements&&(this.onDisposeEmitter.fire(void 0),this.onDisposeEmitter.dispose())}get disposed(){return this.disposables.length===0}disposingElements=!1;dispose(){if(!(this.disposed||this.disposingElements)){for(this.disposingElements=!0;!this.disposed;)try{this.disposables.pop().dispose()}catch(e){console.error(e)}this.disposingElements=!1,this.checkDisposed()}}push(e){let t=this.disposables;t.push(e);let r=e.dispose.bind(e),i=Bs.create(()=>{let s=t.indexOf(e);s!==-1&&t.splice(s,1),this.checkDisposed()});return e.dispose=()=>{i.dispose(),e.dispose=r,r()},i}pushAll(e){return e.map(t=>this.push(t))}},Ti;(function(n){function e(r){return!!(r&&r.push)}n.canPush=e;function t(r){return!!(r&&r.add)}n.canAdd=t})(Ti||(Ti={}));var Ha;(function(n){let e={dispose(){}};function t(u){let{maxListeners:l}=u;return typeof l=="number"?l:0}n.getMaxListeners=t;function r(u,l){return typeof u.maxListeners=="number"?u.maxListeners=l:l}n.setMaxListeners=r;function i(u,l){return typeof u.maxListeners=="number"?u.maxListeners+=l:l}n.addMaxListeners=i,n.None=Object.assign(function(){return e},{get maxListeners(){return 0},set maxListeners(u){}});function s(u){return(l,h=void 0,f)=>{let d=!1,x;return x=u(S=>{if(!d)return x?x.dispose():d=!0,l.call(h,S)},void 0,f),d&&x.dispose(),x}}n.once=s;function o(u){return new Promise(l=>s(u)(l))}n.toPromise=o;function a(u,l){return Object.assign((h,f,d)=>u(x=>h.call(f,l(x)),void 0,d),{get maxListeners(){return 0},set maxListeners(h){}})}n.map=a;function c(...u){return(l,h=void 0,f)=>new gr(...u.map(d=>d(x=>l.call(h,x),void 0,f)))}n.any=c})(Ha||(Ha={}));var Ka=class{_callbacks;_contexts;get length(){return this._callbacks&&this._callbacks.length||0}add(e,t=void 0,r){this._callbacks||(this._callbacks=[],this._contexts=[]),this._callbacks.push(e),this._contexts.push(t),Array.isArray(r)&&r.push({dispose:()=>this.remove(e,t)})}remove(e,t=void 0){if(!this._callbacks)return;let r=!1;for(let i=0;i<this._callbacks.length;i++)if(this._callbacks[i]===e)if(this._contexts[i]===t){this._callbacks.splice(i,1),this._contexts.splice(i,1);return}else r=!0;if(r)throw new Error("When adding a listener with a context, you should remove it with the same context")}[Symbol.iterator](){if(!this._callbacks)return[][Symbol.iterator]();let e=this._callbacks.slice(0),t=this._contexts.slice(0);return e.map((r,i)=>(...s)=>r.apply(t[i],s))[Symbol.iterator]()}invoke(...e){let t=[];for(let r of this)try{t.push(r(...e))}catch(i){console.error(i)}return t}isEmpty(){return!this._callbacks||this._callbacks.length===0}dispose(){this._callbacks=void 0,this._contexts=void 0}},yt=class n{_options;static LEAK_WARNING_THRESHHOLD=175;static _noop=function(){};_event;_callbacks;_disposed=!1;_leakingStacks;_leakWarnCountdown=0;constructor(e){this._options=e}get event(){return this._event||(this._event=Object.assign((e,t,r)=>{this._callbacks||(this._callbacks=new Ka),this._options&&this._options.onFirstListenerAdd&&this._callbacks.isEmpty()&&this._options.onFirstListenerAdd(this),this._callbacks.add(e,t);let i=this.checkMaxListeners(Ha.getMaxListeners(this._event)),s={dispose:()=>{i&&i(),s.dispose=n._noop,this._disposed||(this._callbacks.remove(e,t),s.dispose=n._noop,this._options&&this._options.onLastListenerRemove&&this._callbacks.isEmpty()&&this._options.onLastListenerRemove(this))}};return Ti.canPush(r)?r.push(s):Ti.canAdd(r)&&r.add(s),s},{maxListeners:n.LEAK_WARNING_THRESHHOLD})),this._event}checkMaxListeners(e){if(e===0||!this._callbacks)return;let t=this._callbacks.length;if(t<=e)return;let r=this.pushLeakingStack();if(this._leakWarnCountdown-=1,this._leakWarnCountdown<=0){this._leakWarnCountdown=e*.5;let i,s=0;this._leakingStacks.forEach((o,a)=>{(!i||s<o)&&(i=a,s=o)}),console.warn(`Possible Emitter memory leak detected. ${t} listeners added. Use event.maxListeners to increase the limit (${e}). MOST frequent listener (${s}):`),console.warn(i)}return r}pushLeakingStack(){this._leakingStacks||(this._leakingStacks=new Map);let e=new Error().stack.split(`
`).slice(3).join(`
`),t=this._leakingStacks.get(e)||0;return this._leakingStacks.set(e,t+1),()=>this.popLeakingStack(e)}popLeakingStack(e){if(!this._leakingStacks)return;let t=this._leakingStacks.get(e)||0;this._leakingStacks.set(e,t-1)}fire(e){if(this._callbacks)return this._callbacks.invoke(e)}async sequence(e){if(this._callbacks){for(let t of this._callbacks)if(!await e(t))break}}dispose(){this._leakingStacks&&(this._leakingStacks.clear(),this._leakingStacks=void 0),this._callbacks&&(this._callbacks.dispose(),this._callbacks=void 0),this._disposed=!0}};var jt=class{resolve;reject;promise=new Promise((e,t)=>{this.resolve=r=>(e(r),this),this.reject=r=>(t(r),this)})};var Ya;try{Ya=new TextDecoder}catch{}var I,Dt,p=0;var Bf=[],Xa=Bf,Qa=0,ve={},ce,Fn,Rt=0,en=0,Ke,yn,ft=[],oe,Tf={useRecords:!1,mapsAsObjects:!0},Ci=class{},ec=new Ci;ec.name="MessagePack 0xC1";var jn=!1,Ff=2,Cf,If,Rf;try{new Function("")}catch{Ff=1/0}var yr=class n{constructor(e){e&&(e.useRecords===!1&&e.mapsAsObjects===void 0&&(e.mapsAsObjects=!0),e.sequential&&e.trusted!==!1&&(e.trusted=!0,!e.structures&&e.useRecords!=!1&&(e.structures=[],e.maxSharedStructures||(e.maxSharedStructures=0))),e.structures?e.structures.sharedLength=e.structures.length:e.getStructures&&((e.structures=[]).uninitialized=!0,e.structures.sharedLength=0),e.int64AsNumber&&(e.int64AsType="number")),Object.assign(this,e)}unpack(e,t){if(I)return zf(()=>(js(),this?this.unpack(e,t):n.prototype.unpack.call(Tf,e,t)));!e.buffer&&e.constructor===ArrayBuffer&&(e=typeof Buffer<"u"?Buffer.from(e):new Uint8Array(e)),typeof t=="object"?(Dt=t.end||e.length,p=t.start||0):(p=0,Dt=t>-1?t:e.length),Qa=0,en=0,Fn=null,Xa=Bf,Ke=null,I=e;try{oe=e.dataView||(e.dataView=new DataView(e.buffer,e.byteOffset,e.byteLength))}catch(r){throw I=null,e instanceof Uint8Array?r:new Error("Source must be a Uint8Array or Buffer but was a "+(e&&typeof e=="object"?e.constructor.name:typeof e))}if(this instanceof n){if(ve=this,this.structures)return ce=this.structures,Fs(t);(!ce||ce.length>0)&&(ce=[])}else ve=Tf,(!ce||ce.length>0)&&(ce=[]);return Fs(t)}unpackMultiple(e,t){let r,i=0;try{jn=!0;let s=e.length,o=this?this.unpack(e,s):$s.unpack(e,s);if(t){if(t(o,i,p)===!1)return;for(;p<s;)if(i=p,t(Fs(),i,p)===!1)return}else{for(r=[o];p<s;)i=p,r.push(Fs());return r}}catch(s){throw s.lastPosition=i,s.values=r,s}finally{jn=!1,js()}}_mergeStructures(e,t){If&&(e=If.call(this,e)),e=e||[],Object.isFrozen(e)&&(e=e.map(r=>r.slice(0)));for(let r=0,i=e.length;r<i;r++){let s=e[r];s&&(s.isShared=!0,r>=32&&(s.highByte=r-32>>5))}e.sharedLength=e.length;for(let r in t||[])if(r>=0){let i=e[r],s=t[r];s&&(i&&((e.restoreStructures||(e.restoreStructures=[]))[r]=i),e[r]=s)}return this.structures=e}decode(e,t){return this.unpack(e,t)}};function Fs(n){try{if(!ve.trusted&&!jn){let t=ce.sharedLength||0;t<ce.length&&(ce.length=t)}let e;if(ve.randomAccessStructure&&I[p]<64&&I[p]>=32&&Cf?(e=Cf(I,p,Dt,ve),I=null,!(n&&n.lazy)&&e&&(e=e.toJSON()),p=Dt):e=Le(),Ke&&(p=Ke.postBundlePosition,Ke=null),jn&&(ce.restoreStructures=null),p==Dt)ce&&ce.restoreStructures&&Df(),ce=null,I=null,yn&&(yn=null);else{if(p>Dt)throw new Error("Unexpected end of MessagePack data");if(!jn){let t;try{t=JSON.stringify(e,(r,i)=>typeof i=="bigint"?`${i}n`:i).slice(0,100)}catch(r){t="(JSON view not available "+r+")"}throw new Error("Data read, but end of buffer not reached "+t)}}return e}catch(e){throw ce&&ce.restoreStructures&&Df(),js(),(e instanceof RangeError||e.message.startsWith("Unexpected end of buffer")||p>Dt)&&(e.incomplete=!0),e}}function Df(){for(let n in ce.restoreStructures)ce[n]=ce.restoreStructures[n];ce.restoreStructures=null}function Le(){let n=I[p++];if(n<160)if(n<128){if(n<64)return n;{let e=ce[n&63]||ve.getStructures&&jf()[n&63];return e?(e.read||(e.read=tc(e,n&63)),e.read()):n}}else if(n<144)if(n-=128,ve.mapsAsObjects){let e={};for(let t=0;t<n;t++){let r=$f();r==="__proto__"&&(r="__proto_"),e[r]=Le()}return e}else{let e=new Map;for(let t=0;t<n;t++)e.set(Le(),Le());return e}else{n-=144;let e=new Array(n);for(let t=0;t<n;t++)e[t]=Le();return ve.freezeData?Object.freeze(e):e}else if(n<192){let e=n-160;if(en>=p)return Fn.slice(p-Rt,(p+=e)-Rt);if(en==0&&Dt<140){let t=e<16?nc(e):Vf(e);if(t!=null)return t}return Za(e)}else{let e;switch(n){case 192:return null;case 193:return Ke?(e=Le(),e>0?Ke[1].slice(Ke.position1,Ke.position1+=e):Ke[0].slice(Ke.position0,Ke.position0-=e)):ec;case 194:return!1;case 195:return!0;case 196:if(e=I[p++],e===void 0)throw new Error("Unexpected end of buffer");return Ja(e);case 197:return e=oe.getUint16(p),p+=2,Ja(e);case 198:return e=oe.getUint32(p),p+=4,Ja(e);case 199:return mr(I[p++]);case 200:return e=oe.getUint16(p),p+=2,mr(e);case 201:return e=oe.getUint32(p),p+=4,mr(e);case 202:if(e=oe.getFloat32(p),ve.useFloat32>2){let t=Vs[(I[p]&127)<<1|I[p+1]>>7];return p+=4,(t*e+(e>0?.5:-.5)>>0)/t}return p+=4,e;case 203:return e=oe.getFloat64(p),p+=8,e;case 204:return I[p++];case 205:return e=oe.getUint16(p),p+=2,e;case 206:return e=oe.getUint32(p),p+=4,e;case 207:return ve.int64AsType==="number"?(e=oe.getUint32(p)*4294967296,e+=oe.getUint32(p+4)):ve.int64AsType==="string"?e=oe.getBigUint64(p).toString():ve.int64AsType==="auto"?(e=oe.getBigUint64(p),e<=BigInt(2)<<BigInt(52)&&(e=Number(e))):e=oe.getBigUint64(p),p+=8,e;case 208:return oe.getInt8(p++);case 209:return e=oe.getInt16(p),p+=2,e;case 210:return e=oe.getInt32(p),p+=4,e;case 211:return ve.int64AsType==="number"?(e=oe.getInt32(p)*4294967296,e+=oe.getUint32(p+4)):ve.int64AsType==="string"?e=oe.getBigInt64(p).toString():ve.int64AsType==="auto"?(e=oe.getBigInt64(p),e>=BigInt(-2)<<BigInt(52)&&e<=BigInt(2)<<BigInt(52)&&(e=Number(e))):e=oe.getBigInt64(p),p+=8,e;case 212:if(e=I[p++],e==114)return Mf(I[p++]&63);{let t=ft[e];if(t)return t.read?(p++,t.read(Le())):t.noBuffer?(p++,t()):t(I.subarray(p,++p));throw new Error("Unknown extension "+e)}case 213:return e=I[p],e==114?(p++,Mf(I[p++]&63,I[p++])):mr(2);case 214:return mr(4);case 215:return mr(8);case 216:return mr(16);case 217:return e=I[p++],en>=p?Fn.slice(p-Rt,(p+=e)-Rt):_v(e);case 218:return e=oe.getUint16(p),p+=2,en>=p?Fn.slice(p-Rt,(p+=e)-Rt):Av(e);case 219:return e=oe.getUint32(p),p+=4,en>=p?Fn.slice(p-Rt,(p+=e)-Rt):Tv(e);case 220:return e=oe.getUint16(p),p+=2,Of(e);case 221:return e=oe.getUint32(p),p+=4,Of(e);case 222:return e=oe.getUint16(p),p+=2,Nf(e);case 223:return e=oe.getUint32(p),p+=4,Nf(e);default:if(n>=224)return n-256;if(n===void 0){let t=new Error("Unexpected end of MessagePack data");throw t.incomplete=!0,t}throw new Error("Unknown MessagePack token "+n)}}}var kv=/^[a-zA-Z_$][a-zA-Z\d_$]*$/;function tc(n,e){function t(){if(t.count++>Ff){let i=n.read=new Function("r","return function(){return "+(ve.freezeData?"Object.freeze":"")+"({"+n.map(s=>s==="__proto__"?"__proto_:r()":kv.test(s)?s+":r()":"["+JSON.stringify(s)+"]:r()").join(",")+"})}")(Le);return n.highByte===0&&(n.read=Uf(e,n.read)),i()}let r={};for(let i=0,s=n.length;i<s;i++){let o=n[i];o==="__proto__"&&(o="__proto_"),r[o]=Le()}return ve.freezeData?Object.freeze(r):r}return t.count=0,n.highByte===0?Uf(e,t):t}var Uf=(n,e)=>function(){let t=I[p++];if(t===0)return e();let r=n<32?-(n+(t<<5)):n+(t<<5),i=ce[r]||jf()[r];if(!i)throw new Error("Record id is not defined for "+r);return i.read||(i.read=tc(i,n)),i.read()};function jf(){let n=zf(()=>(I=null,ve.getStructures()));return ce=ve._mergeStructures(n,ce)}var Za=Ii,_v=Ii,Av=Ii,Tv=Ii;function Ii(n){let e;if(n<16&&(e=nc(n)))return e;if(n>64&&Ya)return Ya.decode(I.subarray(p,p+=n));let t=p+n,r=[];for(e="";p<t;){let i=I[p++];if((i&128)===0)r.push(i);else if((i&224)===192){let s=I[p++]&63;r.push((i&31)<<6|s)}else if((i&240)===224){let s=I[p++]&63,o=I[p++]&63;r.push((i&31)<<12|s<<6|o)}else if((i&248)===240){let s=I[p++]&63,o=I[p++]&63,a=I[p++]&63,c=(i&7)<<18|s<<12|o<<6|a;c>65535&&(c-=65536,r.push(c>>>10&1023|55296),c=56320|c&1023),r.push(c)}else r.push(i);r.length>=4096&&(e+=He.apply(String,r),r.length=0)}return r.length>0&&(e+=He.apply(String,r)),e}function Of(n){let e=new Array(n);for(let t=0;t<n;t++)e[t]=Le();return ve.freezeData?Object.freeze(e):e}function Nf(n){if(ve.mapsAsObjects){let e={};for(let t=0;t<n;t++){let r=$f();r==="__proto__"&&(r="__proto_"),e[r]=Le()}return e}else{let e=new Map;for(let t=0;t<n;t++)e.set(Le(),Le());return e}}var He=String.fromCharCode;function Vf(n){let e=p,t=new Array(n);for(let r=0;r<n;r++){let i=I[p++];if((i&128)>0){p=e;return}t[r]=i}return He.apply(String,t)}function nc(n){if(n<4)if(n<2){if(n===0)return"";{let e=I[p++];if((e&128)>1){p-=1;return}return He(e)}}else{let e=I[p++],t=I[p++];if((e&128)>0||(t&128)>0){p-=2;return}if(n<3)return He(e,t);let r=I[p++];if((r&128)>0){p-=3;return}return He(e,t,r)}else{let e=I[p++],t=I[p++],r=I[p++],i=I[p++];if((e&128)>0||(t&128)>0||(r&128)>0||(i&128)>0){p-=4;return}if(n<6){if(n===4)return He(e,t,r,i);{let s=I[p++];if((s&128)>0){p-=5;return}return He(e,t,r,i,s)}}else if(n<8){let s=I[p++],o=I[p++];if((s&128)>0||(o&128)>0){p-=6;return}if(n<7)return He(e,t,r,i,s,o);let a=I[p++];if((a&128)>0){p-=7;return}return He(e,t,r,i,s,o,a)}else{let s=I[p++],o=I[p++],a=I[p++],c=I[p++];if((s&128)>0||(o&128)>0||(a&128)>0||(c&128)>0){p-=8;return}if(n<10){if(n===8)return He(e,t,r,i,s,o,a,c);{let u=I[p++];if((u&128)>0){p-=9;return}return He(e,t,r,i,s,o,a,c,u)}}else if(n<12){let u=I[p++],l=I[p++];if((u&128)>0||(l&128)>0){p-=10;return}if(n<11)return He(e,t,r,i,s,o,a,c,u,l);let h=I[p++];if((h&128)>0){p-=11;return}return He(e,t,r,i,s,o,a,c,u,l,h)}else{let u=I[p++],l=I[p++],h=I[p++],f=I[p++];if((u&128)>0||(l&128)>0||(h&128)>0||(f&128)>0){p-=12;return}if(n<14){if(n===12)return He(e,t,r,i,s,o,a,c,u,l,h,f);{let d=I[p++];if((d&128)>0){p-=13;return}return He(e,t,r,i,s,o,a,c,u,l,h,f,d)}}else{let d=I[p++],x=I[p++];if((d&128)>0||(x&128)>0){p-=14;return}if(n<15)return He(e,t,r,i,s,o,a,c,u,l,h,f,d,x);let S=I[p++];if((S&128)>0){p-=15;return}return He(e,t,r,i,s,o,a,c,u,l,h,f,d,x,S)}}}}}function Pf(){let n=I[p++],e;if(n<192)e=n-160;else switch(n){case 217:e=I[p++];break;case 218:e=oe.getUint16(p),p+=2;break;case 219:e=oe.getUint32(p),p+=4;break;default:throw new Error("Expected string")}return Ii(e)}function Ja(n){return ve.copyBuffers?Uint8Array.prototype.slice.call(I,p,p+=n):I.subarray(p,p+=n)}function mr(n){let e=I[p++];if(ft[e]){let t;return ft[e](I.subarray(p,t=p+=n),r=>{p=r;try{return Le()}finally{p=t}})}else throw new Error("Unknown extension type "+e)}var Lf=new Array(4096);function $f(){let n=I[p++];if(n>=160&&n<192){if(n=n-160,en>=p)return Fn.slice(p-Rt,(p+=n)-Rt);if(!(en==0&&Dt<180))return Za(n)}else return p--,qf(Le());let e=(n<<5^(n>1?oe.getUint16(p):n>0?I[p]:0))&4095,t=Lf[e],r=p,i=p+n-3,s,o=0;if(t&&t.bytes==n){for(;r<i;){if(s=oe.getUint32(r),s!=t[o++]){r=1879048192;break}r+=4}for(i+=3;r<i;)if(s=I[r++],s!=t[o++]){r=1879048192;break}if(r===i)return p=r,t.string;i-=3,r=p}for(t=[],Lf[e]=t,t.bytes=n;r<i;)s=oe.getUint32(r),t.push(s),r+=4;for(i+=3;r<i;)s=I[r++],t.push(s);let a=n<16?nc(n):Vf(n);return a!=null?t.string=a:t.string=Za(n)}function qf(n){if(typeof n=="string")return n;if(typeof n=="number"||typeof n=="boolean"||typeof n=="bigint")return n.toString();if(n==null)return n+"";throw new Error("Invalid property type for record",typeof n)}var Mf=(n,e)=>{let t=Le().map(qf),r=n;e!==void 0&&(n=n<32?-((e<<5)+n):(e<<5)+n,t.highByte=e);let i=ce[n];return i&&(i.isShared||jn)&&((ce.restoreStructures||(ce.restoreStructures=[]))[n]=i),ce[n]=t,t.read=tc(t,r),t.read()};ft[0]=()=>{};ft[0].noBuffer=!0;ft[66]=n=>{let e=n.length,t=BigInt(n[0]&128?n[0]-256:n[0]);for(let r=1;r<e;r++)t<<=BigInt(8),t+=BigInt(n[r]);return t};var Cv={Error,TypeError,ReferenceError};ft[101]=()=>{let n=Le();return(Cv[n[0]]||Error)(n[1],{cause:n[2]})};ft[105]=n=>{if(ve.structuredClone===!1)throw new Error("Structured clone extension is disabled");let e=oe.getUint32(p-4);yn||(yn=new Map);let t=I[p],r;t>=144&&t<160||t==220||t==221?r=[]:r={};let i={target:r};yn.set(e,i);let s=Le();return i.used?Object.assign(r,s):(i.target=s,s)};ft[112]=n=>{if(ve.structuredClone===!1)throw new Error("Structured clone extension is disabled");let e=oe.getUint32(p-4),t=yn.get(e);return t.used=!0,t.target};ft[115]=()=>new Set(Le());var rc=["Int8","Uint8","Uint8Clamped","Int16","Uint16","Int32","Uint32","Float32","Float64","BigInt64","BigUint64"].map(n=>n+"Array"),Iv=typeof globalThis=="object"?globalThis:window;ft[116]=n=>{let e=n[0],t=rc[e];if(!t){if(e===16){let r=new ArrayBuffer(n.length-1);return new Uint8Array(r).set(n.subarray(1)),r}throw new Error("Could not find typed array for code "+e)}return new Iv[t](Uint8Array.prototype.slice.call(n,1).buffer)};ft[120]=()=>{let n=Le();return new RegExp(n[0],n[1])};var Rv=[];ft[98]=n=>{let e=(n[0]<<24)+(n[1]<<16)+(n[2]<<8)+n[3],t=p;return p+=e-n.length,Ke=Rv,Ke=[Pf(),Pf()],Ke.position0=0,Ke.position1=0,Ke.postBundlePosition=p,p=t,Le()};ft[255]=n=>n.length==4?new Date((n[0]*16777216+(n[1]<<16)+(n[2]<<8)+n[3])*1e3):n.length==8?new Date(((n[0]<<22)+(n[1]<<14)+(n[2]<<6)+(n[3]>>2))/1e6+((n[3]&3)*4294967296+n[4]*16777216+(n[5]<<16)+(n[6]<<8)+n[7])*1e3):n.length==12?new Date(((n[0]<<24)+(n[1]<<16)+(n[2]<<8)+n[3])/1e6+((n[4]&128?-281474976710656:0)+n[6]*1099511627776+n[7]*4294967296+n[8]*16777216+(n[9]<<16)+(n[10]<<8)+n[11])*1e3):new Date("invalid");function zf(n){Rf&&Rf();let e=Dt,t=p,r=Qa,i=Rt,s=en,o=Fn,a=Xa,c=yn,u=Ke,l=new Uint8Array(I.slice(0,Dt)),h=ce,f=ce.slice(0,ce.length),d=ve,x=jn,S=n();return Dt=e,p=t,Qa=r,Rt=i,en=s,Fn=o,Xa=a,yn=c,Ke=u,I=l,jn=x,ce=h,ce.splice(0,ce.length,...f),ve=d,oe=new DataView(I.buffer,I.byteOffset,I.byteLength),S}function js(){I=null,yn=null,ce=null}var Vs=new Array(147);for(let n=0;n<256;n++)Vs[n]=+("1e"+Math.floor(45.15-n*.30103));var $s=new yr({useRecords:!1}),Dv=$s.unpack,Uv=$s.unpackMultiple,ic=$s.unpack,qs={NEVER:0,ALWAYS:1,DECIMAL_ROUND:3,DECIMAL_FIT:4},Ov=new Float32Array(1),x_=new Uint8Array(Ov.buffer,0,4);var Gs;try{Gs=new TextEncoder}catch{}var sc,Jf,Ws=typeof Buffer<"u",zs=Ws?function(n){return Buffer.allocUnsafeSlow(n)}:Uint8Array,Yf=Ws?Buffer:Uint8Array,Gf=Ws?4294967296:2144337920,w,Ri,xe,g=0,st,Re=null,Nv,Pv=21760,Lv=/[\u0080-\uFFFF]/,Mr=Symbol("record-id"),Di=class extends yr{constructor(e){super(e),this.offset=0;let t,r,i,s,o,a=Yf.prototype.utf8Write?function(y,A){return w.utf8Write(y,A,w.byteLength-A)}:Gs&&Gs.encodeInto?function(y,A){return Gs.encodeInto(y,w.subarray(A)).written}:!1,c=this;e||(e={});let u=e&&e.sequential,l=e.structures||e.saveStructures,h=e.maxSharedStructures;if(h==null&&(h=l?32:0),h>8160)throw new Error("Maximum maxSharedStructure is 8160");e.structuredClone&&e.moreTypes==null&&(this.moreTypes=!0);let f=e.maxOwnStructures;f==null&&(f=l?32:64),!this.structures&&e.useRecords!=!1&&(this.structures=[]);let d=h>32||f+h>64,x=h+64,S=h+f+64;if(S>8256)throw new Error("Maximum maxSharedStructure + maxOwnStructure is 8192");let j=[],ue=0,he=0;this.pack=this.encode=function(y,A){if(w||(w=new zs(8192),xe=w.dataView||(w.dataView=new DataView(w.buffer,0,8192)),g=0),st=w.length-10,st-g<2048?(w=new zs(w.length),xe=w.dataView||(w.dataView=new DataView(w.buffer,0,w.length)),st=w.length-10,g=0):g=g+7&2147483640,r=g,A&ed&&(g+=A&255),o=c.structuredClone?new Map:null,c.bundleStrings&&typeof y!="string"?(Re=[],Re.size=1/0):Re=null,s=c.structures,s){s.uninitialized&&(s=c._mergeStructures(c.getStructures()));let E=s.sharedLength||0;if(E>h)throw new Error("Shared structures is larger than maximum shared structures, try increasing maxSharedStructures to "+s.sharedLength);if(!s.transitions){s.transitions=Object.create(null);for(let _=0;_<E;_++){let U=s[_];if(!U)continue;let ee,F=s.transitions;for(let T=0,W=U.length;T<W;T++){let we=U[T];ee=F[we],ee||(ee=F[we]=Object.create(null)),F=ee}F[Mr]=_+64}this.lastNamedStructuresLength=E}u||(s.nextId=E+64)}i&&(i=!1);let k;try{c.randomAccessStructure&&y&&y.constructor&&y.constructor===Object?kt(y):G(y);let E=Re;if(Re&&Kf(r,G,0),o&&o.idsToInsert){let _=o.idsToInsert.sort((T,W)=>T.offset>W.offset?1:-1),U=_.length,ee=-1;for(;E&&U>0;){let T=_[--U].offset+r;T<E.stringsPosition+r&&ee===-1&&(ee=0),T>E.position+r?ee>=0&&(ee+=6):(ee>=0&&(xe.setUint32(E.position+r,xe.getUint32(E.position+r)+ee),ee=-1),E=E.previous,U++)}ee>=0&&E&&xe.setUint32(E.position+r,xe.getUint32(E.position+r)+ee),g+=_.length*6,g>st&&pe(g),c.offset=g;let F=Bv(w.subarray(r,g),_);return o=null,F}return c.offset=g,A&Qf?(w.start=r,w.end=g,w):w.subarray(r,g)}catch(E){throw k=E,E}finally{if(s&&(le(),i&&c.saveStructures)){let E=s.sharedLength||0,_=w.subarray(r,g),U=Fv(s,c);if(!k)return c.saveStructures(U,U.isCompatible)===!1?c.pack(y,A):(c.lastNamedStructuresLength=E,w.length>1073741824&&(w=null),_)}w.length>1073741824&&(w=null),A&Zf&&(g=r)}};let le=()=>{he<10&&he++;let y=s.sharedLength||0;if(s.length>y&&!u&&(s.length=y),ue>1e4)s.transitions=null,he=0,ue=0,j.length>0&&(j=[]);else if(j.length>0&&!u){for(let A=0,k=j.length;A<k;A++)j[A][Mr]=0;j=[]}},de=y=>{var A=y.length;A<16?w[g++]=144|A:A<65536?(w[g++]=220,w[g++]=A>>8,w[g++]=A&255):(w[g++]=221,xe.setUint32(g,A),g+=4);for(let k=0;k<A;k++)G(y[k])},G=y=>{g>st&&(w=pe(g));var A=typeof y,k;if(A==="string"){let E=y.length;if(Re&&E>=4&&E<4096){if((Re.size+=E)>Pv){let F,T=(Re[0]?Re[0].length*3+Re[1].length:0)+10;g+T>st&&(w=pe(g+T));let W;Re.position?(W=Re,w[g]=200,g+=3,w[g++]=98,F=g-r,g+=4,Kf(r,G,0),xe.setUint16(F+r-3,g-r-F)):(w[g++]=214,w[g++]=98,F=g-r,g+=4),Re=["",""],Re.previous=W,Re.size=0,Re.position=F}let ee=Lv.test(y);Re[ee?0:1]+=y,w[g++]=193,G(ee?-E:E);return}let _;E<32?_=1:E<256?_=2:E<65536?_=3:_=5;let U=E*3;if(g+U>st&&(w=pe(g+U)),E<64||!a){let ee,F,T,W=g+_;for(ee=0;ee<E;ee++)F=y.charCodeAt(ee),F<128?w[W++]=F:F<2048?(w[W++]=F>>6|192,w[W++]=F&63|128):(F&64512)===55296&&((T=y.charCodeAt(ee+1))&64512)===56320?(F=65536+((F&1023)<<10)+(T&1023),ee++,w[W++]=F>>18|240,w[W++]=F>>12&63|128,w[W++]=F>>6&63|128,w[W++]=F&63|128):(w[W++]=F>>12|224,w[W++]=F>>6&63|128,w[W++]=F&63|128);k=W-g-_}else k=a(y,g+_);k<32?w[g++]=160|k:k<256?(_<2&&w.copyWithin(g+2,g+1,g+1+k),w[g++]=217,w[g++]=k):k<65536?(_<3&&w.copyWithin(g+3,g+2,g+2+k),w[g++]=218,w[g++]=k>>8,w[g++]=k&255):(_<5&&w.copyWithin(g+5,g+3,g+3+k),w[g++]=219,xe.setUint32(g,k),g+=4),g+=k}else if(A==="number")if(y>>>0===y)y<32||y<128&&this.useRecords===!1||y<64&&!this.randomAccessStructure?w[g++]=y:y<256?(w[g++]=204,w[g++]=y):y<65536?(w[g++]=205,w[g++]=y>>8,w[g++]=y&255):(w[g++]=206,xe.setUint32(g,y),g+=4);else if(y>>0===y)y>=-32?w[g++]=256+y:y>=-128?(w[g++]=208,w[g++]=y+256):y>=-32768?(w[g++]=209,xe.setInt16(g,y),g+=2):(w[g++]=210,xe.setInt32(g,y),g+=4);else{let E;if((E=this.useFloat32)>0&&y<4294967296&&y>=-2147483648){w[g++]=202,xe.setFloat32(g,y);let _;if(E<4||(_=y*Vs[(w[g]&127)<<1|w[g+1]>>7])>>0===_){g+=4;return}else g--}w[g++]=203,xe.setFloat64(g,y),g+=8}else if(A==="object"||A==="function")if(!y)w[g++]=192;else{if(o){let _=o.get(y);if(_){if(!_.id){let U=o.idsToInsert||(o.idsToInsert=[]);_.id=U.push(_)}w[g++]=214,w[g++]=112,xe.setUint32(g,_.id),g+=4;return}else o.set(y,{offset:g-r})}let E=y.constructor;if(E===Object)V(y);else if(E===Array)de(y);else if(E===Map)if(this.mapAsEmptyObject)w[g++]=128;else{k=y.size,k<16?w[g++]=128|k:k<65536?(w[g++]=222,w[g++]=k>>8,w[g++]=k&255):(w[g++]=223,xe.setUint32(g,k),g+=4);for(let[_,U]of y)G(_),G(U)}else{for(let _=0,U=sc.length;_<U;_++){let ee=Jf[_];if(y instanceof ee){let F=sc[_];if(F.write){F.type&&(w[g++]=212,w[g++]=F.type,w[g++]=0);let We=F.write.call(this,y);We===y?Array.isArray(y)?de(y):V(y):G(We);return}let T=w,W=xe,we=g;w=null;let q;try{q=F.pack.call(this,y,We=>(w=T,T=null,g+=We,g>st&&pe(g),{target:w,targetView:xe,position:g-We}),G)}finally{T&&(w=T,xe=W,g=we,st=w.length-10)}q&&(q.length+g>st&&pe(q.length+g),g=Mv(q,w,g,F.type));return}}if(Array.isArray(y))de(y);else{if(y.toJSON){let _=y.toJSON();if(_!==y)return G(_)}if(A==="function")return G(this.writeFunction&&this.writeFunction(y));V(y)}}}else if(A==="boolean")w[g++]=y?195:194;else if(A==="bigint"){if(y<BigInt(1)<<BigInt(63)&&y>=-(BigInt(1)<<BigInt(63)))w[g++]=211,xe.setBigInt64(g,y);else if(y<BigInt(1)<<BigInt(64)&&y>0)w[g++]=207,xe.setBigUint64(g,y);else if(this.largeBigIntToFloat)w[g++]=203,xe.setFloat64(g,Number(y));else{if(this.largeBigIntToString)return G(y.toString());if(this.useBigIntExtension&&y<BigInt(2)**BigInt(1023)&&y>-(BigInt(2)**BigInt(1023))){w[g++]=199,g++,w[g++]=66;let E=[],_;do{let U=y&BigInt(255);_=(U&BigInt(128))===(y<BigInt(0)?BigInt(128):BigInt(0)),E.push(U),y>>=BigInt(8)}while(!((y===BigInt(0)||y===BigInt(-1))&&_));w[g-2]=E.length;for(let U=E.length;U>0;)w[g++]=Number(E[--U]);return}else throw new RangeError(y+" was too large to fit in MessagePack 64-bit integer format, use useBigIntExtension, or set largeBigIntToFloat to convert to float-64, or set largeBigIntToString to convert to string")}g+=8}else if(A==="undefined")this.encodeUndefinedAsNil?w[g++]=192:(w[g++]=212,w[g++]=0,w[g++]=0);else throw new Error("Unknown type: "+A)},z=this.variableMapSize||this.coercibleKeyAsNumber||this.skipValues?y=>{let A;if(this.skipValues){A=[];for(let _ in y)(typeof y.hasOwnProperty!="function"||y.hasOwnProperty(_))&&!this.skipValues.includes(y[_])&&A.push(_)}else A=Object.keys(y);let k=A.length;k<16?w[g++]=128|k:k<65536?(w[g++]=222,w[g++]=k>>8,w[g++]=k&255):(w[g++]=223,xe.setUint32(g,k),g+=4);let E;if(this.coercibleKeyAsNumber)for(let _=0;_<k;_++){E=A[_];let U=Number(E);G(isNaN(U)?E:U),G(y[E])}else for(let _=0;_<k;_++)G(E=A[_]),G(y[E])}:y=>{w[g++]=222;let A=g-r;g+=2;let k=0;for(let E in y)(typeof y.hasOwnProperty!="function"||y.hasOwnProperty(E))&&(G(E),G(y[E]),k++);if(k>65535)throw new Error('Object is too large to serialize with fast 16-bit map size, use the "variableMapSize" option to serialize this object');w[A+++r]=k>>8,w[A+r]=k&255},ne=this.useRecords===!1?z:e.progressiveRecords&&!d?y=>{let A,k=s.transitions||(s.transitions=Object.create(null)),E=g++-r,_;for(let U in y)if(typeof y.hasOwnProperty!="function"||y.hasOwnProperty(U)){if(A=k[U],A)k=A;else{let ee=Object.keys(y),F=k;k=s.transitions;let T=0;for(let W=0,we=ee.length;W<we;W++){let q=ee[W];A=k[q],A||(A=k[q]=Object.create(null),T++),k=A}E+r+1==g?(g--,_e(k,ee,T)):Oe(k,ee,E,T),_=!0,k=F[U]}G(y[U])}if(!_){let U=k[Mr];U?w[E+r]=U:Oe(k,Object.keys(y),E,0)}}:y=>{let A,k=s.transitions||(s.transitions=Object.create(null)),E=0;for(let U in y)(typeof y.hasOwnProperty!="function"||y.hasOwnProperty(U))&&(A=k[U],A||(A=k[U]=Object.create(null),E++),k=A);let _=k[Mr];_?_>=96&&d?(w[g++]=((_-=96)&31)+96,w[g++]=_>>5):w[g++]=_:_e(k,k.__keys__||Object.keys(y),E);for(let U in y)(typeof y.hasOwnProperty!="function"||y.hasOwnProperty(U))&&G(y[U])},X=typeof this.useRecords=="function"&&this.useRecords,V=X?y=>{X(y)?ne(y):z(y)}:ne,pe=y=>{let A;if(y>16777216){if(y-r>Gf)throw new Error("Packed buffer would be larger than maximum buffer size");A=Math.min(Gf,Math.round(Math.max((y-r)*(y>67108864?1.25:2),4194304)/4096)*4096)}else A=(Math.max(y-r<<2,w.length-1)>>12)+1<<12;let k=new zs(A);return xe=k.dataView||(k.dataView=new DataView(k.buffer,0,A)),y=Math.min(y,w.length),w.copy?w.copy(k,0,r,y):k.set(w.slice(r,y)),g-=r,r=0,st=k.length-10,w=k},_e=(y,A,k)=>{let E=s.nextId;E||(E=64),E<x&&this.shouldShareStructure&&!this.shouldShareStructure(A)?(E=s.nextOwnId,E<S||(E=x),s.nextOwnId=E+1):(E>=S&&(E=x),s.nextId=E+1);let _=A.highByte=E>=96&&d?E-96>>5:-1;y[Mr]=E,y.__keys__=A,s[E-64]=A,E<x?(A.isShared=!0,s.sharedLength=E-63,i=!0,_>=0?(w[g++]=(E&31)+96,w[g++]=_):w[g++]=E):(_>=0?(w[g++]=213,w[g++]=114,w[g++]=(E&31)+96,w[g++]=_):(w[g++]=212,w[g++]=114,w[g++]=E),k&&(ue+=he*k),j.length>=f&&(j.shift()[Mr]=0),j.push(y),G(A))},Oe=(y,A,k,E)=>{let _=w,U=g,ee=st,F=r;w=Ri,g=0,r=0,w||(Ri=w=new zs(8192)),st=w.length-10,_e(y,A,E),Ri=w;let T=g;if(w=_,g=U,st=ee,r=F,T>1){let W=g+T-1;W>st&&pe(W);let we=k+r;w.copyWithin(we+T,we+1,g),w.set(Ri.slice(0,T),we),g=W}else w[k+r]=Ri[0]},kt=y=>{let A=Nv(y,w,r,g,s,pe,(k,E,_)=>{if(_)return i=!0;g=E;let U=w;return G(k),le(),U!==w?{position:g,targetView:xe,target:w}:g},this);if(A===0)return V(y);g=A}}useBuffer(e){w=e,w.dataView||(w.dataView=new DataView(w.buffer,w.byteOffset,w.byteLength)),g=0}set position(e){g=e}get position(){return g}clearSharedData(){this.structures&&(this.structures=[]),this.typedStructs&&(this.typedStructs=[])}};Jf=[Date,Set,Error,RegExp,ArrayBuffer,Object.getPrototypeOf(Uint8Array.prototype).constructor,Ci];sc=[{pack(n,e,t){let r=n.getTime()/1e3;if((this.useTimestamp32||n.getMilliseconds()===0)&&r>=0&&r<4294967296){let{target:i,targetView:s,position:o}=e(6);i[o++]=214,i[o++]=255,s.setUint32(o,r)}else if(r>0&&r<4294967296){let{target:i,targetView:s,position:o}=e(10);i[o++]=215,i[o++]=255,s.setUint32(o,n.getMilliseconds()*4e6+(r/1e3/4294967296>>0)),s.setUint32(o+4,r)}else if(isNaN(r)){if(this.onInvalidDate)return e(0),t(this.onInvalidDate());let{target:i,targetView:s,position:o}=e(3);i[o++]=212,i[o++]=255,i[o++]=255}else{let{target:i,targetView:s,position:o}=e(15);i[o++]=199,i[o++]=12,i[o++]=255,s.setUint32(o,n.getMilliseconds()*1e6),s.setBigInt64(o+4,BigInt(Math.floor(r)))}}},{pack(n,e,t){if(this.setAsEmptyObject)return e(0),t({});let r=Array.from(n),{target:i,position:s}=e(this.moreTypes?3:0);this.moreTypes&&(i[s++]=212,i[s++]=115,i[s++]=0),t(r)}},{pack(n,e,t){let{target:r,position:i}=e(this.moreTypes?3:0);this.moreTypes&&(r[i++]=212,r[i++]=101,r[i++]=0),t([n.name,n.message,n.cause])}},{pack(n,e,t){let{target:r,position:i}=e(this.moreTypes?3:0);this.moreTypes&&(r[i++]=212,r[i++]=120,r[i++]=0),t([n.source,n.flags])}},{pack(n,e){this.moreTypes?Wf(n,16,e):Hf(Ws?Buffer.from(n):new Uint8Array(n),e)}},{pack(n,e){let t=n.constructor;t!==Yf&&this.moreTypes?Wf(n,rc.indexOf(t.name),e):Hf(n,e)}},{pack(n,e){let{target:t,position:r}=e(1);t[r]=193}}];function Wf(n,e,t,r){let i=n.byteLength;if(i+1<256){var{target:s,position:o}=t(4+i);s[o++]=199,s[o++]=i+1}else if(i+1<65536){var{target:s,position:o}=t(5+i);s[o++]=200,s[o++]=i+1>>8,s[o++]=i+1&255}else{var{target:s,position:o,targetView:a}=t(7+i);s[o++]=201,a.setUint32(o,i+1),o+=4}s[o++]=116,s[o++]=e,n.buffer||(n=new Uint8Array(n)),s.set(new Uint8Array(n.buffer,n.byteOffset,n.byteLength),o)}function Hf(n,e){let t=n.byteLength;var r,i;if(t<256){var{target:r,position:i}=e(t+2);r[i++]=196,r[i++]=t}else if(t<65536){var{target:r,position:i}=e(t+3);r[i++]=197,r[i++]=t>>8,r[i++]=t&255}else{var{target:r,position:i,targetView:s}=e(t+5);r[i++]=198,s.setUint32(i,t),i+=4}r.set(n,i)}function Mv(n,e,t,r){let i=n.length;switch(i){case 1:e[t++]=212;break;case 2:e[t++]=213;break;case 4:e[t++]=214;break;case 8:e[t++]=215;break;case 16:e[t++]=216;break;default:i<256?(e[t++]=199,e[t++]=i):i<65536?(e[t++]=200,e[t++]=i>>8,e[t++]=i&255):(e[t++]=201,e[t++]=i>>24,e[t++]=i>>16&255,e[t++]=i>>8&255,e[t++]=i&255)}return e[t++]=r,e.set(n,t),t+=i,t}function Bv(n,e){let t,r=e.length*6,i=n.length-r;for(;t=e.pop();){let s=t.offset,o=t.id;n.copyWithin(s+r,s,i),r-=6;let a=s+r;n[a++]=214,n[a++]=105,n[a++]=o>>24,n[a++]=o>>16&255,n[a++]=o>>8&255,n[a++]=o&255,i=s}return n}function Kf(n,e,t){if(Re.length>0){xe.setUint32(Re.position+n,g+t-Re.position-n),Re.stringsPosition=g-n;let r=Re;Re=null,e(r[0]),e(r[1])}}function Fv(n,e){return n.isCompatible=t=>{let r=!t||(e.lastNamedStructuresLength||0)===t.length;return r||e._mergeStructures(t),r},n}var Xf=new Di({useRecords:!1}),jv=Xf.pack,oc=Xf.pack;var{NEVER:Vv,ALWAYS:$v,DECIMAL_ROUND:qv,DECIMAL_FIT:zv}=qs,Qf=512,Zf=1024,ed=2048;var Vn;(function(n){function e(r){return oc(r)}n.encode=e;function t(r){return ic(r)}n.decode=t})(Vn||(Vn={}));var Qe=Uint8Array,wt=Uint16Array,gc=Int32Array,Hs=new Qe([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),Ks=new Qe([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),uc=new Qe([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),id=function(n,e){for(var t=new wt(31),r=0;r<31;++r)t[r]=e+=1<<n[r-1];for(var i=new gc(t[30]),r=1;r<30;++r)for(var s=t[r];s<t[r+1];++s)i[s]=s-t[r]<<5|r;return{b:t,r:i}},sd=id(Hs,2),od=sd.b,hc=sd.r;od[28]=258,hc[258]=28;var ad=id(Ks,0),Wv=ad.b,td=ad.r,fc=new wt(32768);for(fe=0;fe<32768;++fe)wn=(fe&43690)>>1|(fe&21845)<<1,wn=(wn&52428)>>2|(wn&13107)<<2,wn=(wn&61680)>>4|(wn&3855)<<4,fc[fe]=((wn&65280)>>8|(wn&255)<<8)>>1;var wn,fe,tn=function(n,e,t){for(var r=n.length,i=0,s=new wt(e);i<r;++i)n[i]&&++s[n[i]-1];var o=new wt(e);for(i=1;i<e;++i)o[i]=o[i-1]+s[i-1]<<1;var a;if(t){a=new wt(1<<e);var c=15-e;for(i=0;i<r;++i)if(n[i])for(var u=i<<4|n[i],l=e-n[i],h=o[n[i]-1]++<<l,f=h|(1<<l)-1;h<=f;++h)a[fc[h]>>c]=u}else for(a=new wt(r),i=0;i<r;++i)n[i]&&(a[i]=fc[o[n[i]-1]++]>>15-n[i]);return a},$n=new Qe(288);for(fe=0;fe<144;++fe)$n[fe]=8;var fe;for(fe=144;fe<256;++fe)$n[fe]=9;var fe;for(fe=256;fe<280;++fe)$n[fe]=7;var fe;for(fe=280;fe<288;++fe)$n[fe]=8;var fe,Ni=new Qe(32);for(fe=0;fe<32;++fe)Ni[fe]=5;var fe,Hv=tn($n,9,0),Kv=tn($n,9,1),Jv=tn(Ni,5,0),Yv=tn(Ni,5,1),ac=function(n){for(var e=n[0],t=1;t<n.length;++t)n[t]>e&&(e=n[t]);return e},Vt=function(n,e,t){var r=e/8|0;return(n[r]|n[r+1]<<8)>>(e&7)&t},cc=function(n,e){var t=e/8|0;return(n[t]|n[t+1]<<8|n[t+2]<<16)>>(e&7)},mc=function(n){return(n+7)/8|0},cd=function(n,e,t){return(e==null||e<0)&&(e=0),(t==null||t>n.length)&&(t=n.length),new Qe(n.subarray(e,t))};var Xv=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],$t=function(n,e,t){var r=new Error(e||Xv[n]);if(r.code=n,Error.captureStackTrace&&Error.captureStackTrace(r,$t),!t)throw r;return r},Qv=function(n,e,t,r){var i=n.length,s=r?r.length:0;if(!i||e.f&&!e.l)return t||new Qe(0);var o=!t,a=o||e.i!=2,c=e.i;o&&(t=new Qe(i*3));var u=function(Mn){var _t=t.length;if(Mn>_t){var gn=new Qe(Math.max(_t*2,Mn));gn.set(t),t=gn}},l=e.f||0,h=e.p||0,f=e.b||0,d=e.l,x=e.d,S=e.m,j=e.n,ue=i*8;do{if(!d){l=Vt(n,h,1);var he=Vt(n,h+1,3);if(h+=3,he)if(he==1)d=Kv,x=Yv,S=9,j=5;else if(he==2){var z=Vt(n,h,31)+257,ne=Vt(n,h+10,15)+4,X=z+Vt(n,h+5,31)+1;h+=14;for(var V=new Qe(X),pe=new Qe(19),_e=0;_e<ne;++_e)pe[uc[_e]]=Vt(n,h+_e*3,7);h+=ne*3;for(var Oe=ac(pe),kt=(1<<Oe)-1,y=tn(pe,Oe,1),_e=0;_e<X;){var A=y[Vt(n,h,kt)];h+=A&15;var le=A>>4;if(le<16)V[_e++]=le;else{var k=0,E=0;for(le==16?(E=3+Vt(n,h,3),h+=2,k=V[_e-1]):le==17?(E=3+Vt(n,h,7),h+=3):le==18&&(E=11+Vt(n,h,127),h+=7);E--;)V[_e++]=k}}var _=V.subarray(0,z),U=V.subarray(z);S=ac(_),j=ac(U),d=tn(_,S,1),x=tn(U,j,1)}else $t(1);else{var le=mc(h)+4,de=n[le-4]|n[le-3]<<8,G=le+de;if(G>i){c&&$t(0);break}a&&u(f+de),t.set(n.subarray(le,G),f),e.b=f+=de,e.p=h=G*8,e.f=l;continue}if(h>ue){c&&$t(0);break}}a&&u(f+131072);for(var ee=(1<<S)-1,F=(1<<j)-1,T=h;;T=h){var k=d[cc(n,h)&ee],W=k>>4;if(h+=k&15,h>ue){c&&$t(0);break}if(k||$t(2),W<256)t[f++]=W;else if(W==256){T=h,d=null;break}else{var we=W-254;if(W>264){var _e=W-257,q=Hs[_e];we=Vt(n,h,(1<<q)-1)+od[_e],h+=q}var We=x[cc(n,h)&F],Ln=We>>4;We||$t(3),h+=We&15;var U=Wv[Ln];if(Ln>3){var q=Ks[Ln];U+=cc(n,h)&(1<<q)-1,h+=q}if(h>ue){c&&$t(0);break}a&&u(f+131072);var pn=f+we;if(f<U){var Ur=s-U,nt=Math.min(U,pn);for(Ur+f<0&&$t(3);f<nt;++f)t[f]=r[Ur+f]}for(;f<pn;++f)t[f]=t[f-U]}}e.l=d,e.p=T,e.b=f,e.f=l,d&&(l=1,e.m=S,e.d=x,e.n=j)}while(!l);return f!=t.length&&o?cd(t,0,f):t.subarray(0,f)},vn=function(n,e,t){t<<=e&7;var r=e/8|0;n[r]|=t,n[r+1]|=t>>8},Ui=function(n,e,t){t<<=e&7;var r=e/8|0;n[r]|=t,n[r+1]|=t>>8,n[r+2]|=t>>16},lc=function(n,e){for(var t=[],r=0;r<n.length;++r)n[r]&&t.push({s:r,f:n[r]});var i=t.length,s=t.slice();if(!i)return{t:ud,l:0};if(i==1){var o=new Qe(t[0].s+1);return o[t[0].s]=1,{t:o,l:1}}t.sort(function(G,z){return G.f-z.f}),t.push({s:-1,f:25001});var a=t[0],c=t[1],u=0,l=1,h=2;for(t[0]={s:-1,f:a.f+c.f,l:a,r:c};l!=i-1;)a=t[t[u].f<t[h].f?u++:h++],c=t[u!=l&&t[u].f<t[h].f?u++:h++],t[l++]={s:-1,f:a.f+c.f,l:a,r:c};for(var f=s[0].s,r=1;r<i;++r)s[r].s>f&&(f=s[r].s);var d=new wt(f+1),x=dc(t[l-1],d,0);if(x>e){var r=0,S=0,j=x-e,ue=1<<j;for(s.sort(function(z,ne){return d[ne.s]-d[z.s]||z.f-ne.f});r<i;++r){var he=s[r].s;if(d[he]>e)S+=ue-(1<<x-d[he]),d[he]=e;else break}for(S>>=j;S>0;){var le=s[r].s;d[le]<e?S-=1<<e-d[le]++-1:++r}for(;r>=0&&S;--r){var de=s[r].s;d[de]==e&&(--d[de],++S)}x=e}return{t:new Qe(d),l:x}},dc=function(n,e,t){return n.s==-1?Math.max(dc(n.l,e,t+1),dc(n.r,e,t+1)):e[n.s]=t},nd=function(n){for(var e=n.length;e&&!n[--e];);for(var t=new wt(++e),r=0,i=n[0],s=1,o=function(c){t[r++]=c},a=1;a<=e;++a)if(n[a]==i&&a!=e)++s;else{if(!i&&s>2){for(;s>138;s-=138)o(32754);s>2&&(o(s>10?s-11<<5|28690:s-3<<5|12305),s=0)}else if(s>3){for(o(i),--s;s>6;s-=6)o(8304);s>2&&(o(s-3<<5|8208),s=0)}for(;s--;)o(i);s=1,i=n[a]}return{c:t.subarray(0,r),n:e}},Oi=function(n,e){for(var t=0,r=0;r<e.length;++r)t+=n[r]*e[r];return t},ld=function(n,e,t){var r=t.length,i=mc(e+2);n[i]=r&255,n[i+1]=r>>8,n[i+2]=n[i]^255,n[i+3]=n[i+1]^255;for(var s=0;s<r;++s)n[i+s+4]=t[s];return(i+4+r)*8},rd=function(n,e,t,r,i,s,o,a,c,u,l){vn(e,l++,t),++i[256];for(var h=lc(i,15),f=h.t,d=h.l,x=lc(s,15),S=x.t,j=x.l,ue=nd(f),he=ue.c,le=ue.n,de=nd(S),G=de.c,z=de.n,ne=new wt(19),X=0;X<he.length;++X)++ne[he[X]&31];for(var X=0;X<G.length;++X)++ne[G[X]&31];for(var V=lc(ne,7),pe=V.t,_e=V.l,Oe=19;Oe>4&&!pe[uc[Oe-1]];--Oe);var kt=u+5<<3,y=Oi(i,$n)+Oi(s,Ni)+o,A=Oi(i,f)+Oi(s,S)+o+14+3*Oe+Oi(ne,pe)+2*ne[16]+3*ne[17]+7*ne[18];if(c>=0&&kt<=y&&kt<=A)return ld(e,l,n.subarray(c,c+u));var k,E,_,U;if(vn(e,l,1+(A<y)),l+=2,A<y){k=tn(f,d,0),E=f,_=tn(S,j,0),U=S;var ee=tn(pe,_e,0);vn(e,l,le-257),vn(e,l+5,z-1),vn(e,l+10,Oe-4),l+=14;for(var X=0;X<Oe;++X)vn(e,l+3*X,pe[uc[X]]);l+=3*Oe;for(var F=[he,G],T=0;T<2;++T)for(var W=F[T],X=0;X<W.length;++X){var we=W[X]&31;vn(e,l,ee[we]),l+=pe[we],we>15&&(vn(e,l,W[X]>>5&127),l+=W[X]>>12)}}else k=Hv,E=$n,_=Jv,U=Ni;for(var X=0;X<a;++X){var q=r[X];if(q>255){var we=q>>18&31;Ui(e,l,k[we+257]),l+=E[we+257],we>7&&(vn(e,l,q>>23&31),l+=Hs[we]);var We=q&31;Ui(e,l,_[We]),l+=U[We],We>3&&(Ui(e,l,q>>5&8191),l+=Ks[We])}else Ui(e,l,k[q]),l+=E[q]}return Ui(e,l,k[256]),l+E[256]},Zv=new gc([65540,131080,131088,131104,262176,1048704,1048832,2114560,2117632]),ud=new Qe(0),ex=function(n,e,t,r,i,s){var o=s.z||n.length,a=new Qe(r+o+5*(1+Math.ceil(o/7e3))+i),c=a.subarray(r,a.length-i),u=s.l,l=(s.r||0)&7;if(e){l&&(c[0]=s.r>>3);for(var h=Zv[e-1],f=h>>13,d=h&8191,x=(1<<t)-1,S=s.p||new wt(32768),j=s.h||new wt(x+1),ue=Math.ceil(t/3),he=2*ue,le=function(yi){return(n[yi]^n[yi+1]<<ue^n[yi+2]<<he)&x},de=new gc(25e3),G=new wt(288),z=new wt(32),ne=0,X=0,V=s.i||0,pe=0,_e=s.w||0,Oe=0;V+2<o;++V){var kt=le(V),y=V&32767,A=j[kt];if(S[y]=A,j[kt]=y,_e<=V){var k=o-V;if((ne>7e3||pe>24576)&&(k>423||!u)){l=rd(n,c,0,de,G,z,X,pe,Oe,V-Oe,l),pe=ne=X=0,Oe=V;for(var E=0;E<286;++E)G[E]=0;for(var E=0;E<30;++E)z[E]=0}var _=2,U=0,ee=d,F=y-A&32767;if(k>2&&kt==le(V-F))for(var T=Math.min(f,k)-1,W=Math.min(32767,V),we=Math.min(258,k);F<=W&&--ee&&y!=A;){if(n[V+_]==n[V+_-F]){for(var q=0;q<we&&n[V+q]==n[V+q-F];++q);if(q>_){if(_=q,U=F,q>T)break;for(var We=Math.min(F,q-2),Ln=0,E=0;E<We;++E){var pn=V-F+E&32767,Ur=S[pn],nt=pn-Ur&32767;nt>Ln&&(Ln=nt,A=pn)}}}y=A,A=S[y],F+=y-A&32767}if(U){de[pe++]=268435456|hc[_]<<18|td[U];var Mn=hc[_]&31,_t=td[U]&31;X+=Hs[Mn]+Ks[_t],++G[257+Mn],++z[_t],_e=V+_,++ne}else de[pe++]=n[V],++G[n[V]]}}for(V=Math.max(V,_e);V<o;++V)de[pe++]=n[V],++G[n[V]];l=rd(n,c,u,de,G,z,X,pe,Oe,V-Oe,l),u||(s.r=l&7|c[l/8|0]<<3,l-=7,s.h=j,s.p=S,s.i=V,s.w=_e)}else{for(var V=s.w||0;V<o+u;V+=65535){var gn=V+65535;gn>=o&&(c[l/8|0]=u,gn=o),l=ld(c,l+1,n.subarray(V,gn))}s.i=o}return cd(a,0,r+mc(l)+i)},tx=function(){for(var n=new Int32Array(256),e=0;e<256;++e){for(var t=e,r=9;--r;)t=(t&1&&-306674912)^t>>>1;n[e]=t}return n}(),nx=function(){var n=-1;return{p:function(e){for(var t=n,r=0;r<e.length;++r)t=tx[t&255^e[r]]^t>>>8;n=t},d:function(){return~n}}};var rx=function(n,e,t,r,i){if(!i&&(i={l:1},e.dictionary)){var s=e.dictionary.subarray(-32768),o=new Qe(s.length+n.length);o.set(s),o.set(n,s.length),n=o,i.w=s.length}return ex(n,e.level==null?6:e.level,e.mem==null?i.l?Math.ceil(Math.max(8,Math.min(13,Math.log(n.length)))*1.5):20:12+e.mem,t,r,i)};var pc=function(n,e,t){for(;t;++e)n[e]=t,t>>>=8},ix=function(n,e){var t=e.filename;if(n[0]=31,n[1]=139,n[2]=8,n[8]=e.level<2?4:e.level==9?2:0,n[9]=3,e.mtime!=0&&pc(n,4,Math.floor(new Date(e.mtime||Date.now())/1e3)),t){n[3]=8;for(var r=0;r<=t.length;++r)n[r+10]=t.charCodeAt(r)}},sx=function(n){(n[0]!=31||n[1]!=139||n[2]!=8)&&$t(6,"invalid gzip data");var e=n[3],t=10;e&4&&(t+=(n[10]|n[11]<<8)+2);for(var r=(e>>3&1)+(e>>4&1);r>0;r-=!n[t++]);return t+(e&2)},ox=function(n){var e=n.length;return(n[e-4]|n[e-3]<<8|n[e-2]<<16|n[e-1]<<24)>>>0},ax=function(n){return 10+(n.filename?n.filename.length+1:0)};function hd(n,e){e||(e={});var t=nx(),r=n.length;t.p(n);var i=rx(n,e,ax(e),8),s=i.length;return ix(i,e),pc(i,s-8,t.d()),pc(i,s-4,r),i}function fd(n,e){var t=sx(n);return t+8>n.length&&$t(6,"invalid gzip data"),Qv(n.subarray(t,-8),{i:2},e&&e.out||new Qe(ox(n)),e&&e.dictionary)}var cx=typeof TextDecoder<"u"&&new TextDecoder,lx=0;try{cx.decode(ud,{stream:!0}),lx=1}catch{}var Br;(function(n){function e(i){if(i.length===0)return"none";if(typeof i[0]=="string")return i[0];{let s=i,o=new Map,a=i[0];for(let l=0;l<a.length;l++){let h=a[l];h!=="none"&&o.set(h,l)}for(let l=1;l<s.length;l++){let h=s[l],f=new Set;for(let d=0;d<h.length;d++){let x=h[d];if(x!=="none"&&o.has(x)){let S=o.get(x)??0;o.set(x,S+d),f.add(x)}}for(let d of o.keys())f.has(d)||o.delete(d);if(o.size===0)break}let c="none",u=1/0;for(let[l,h]of o.entries())h<u&&(c=l,u=h);return c}}n.bestFit=e;async function t(i,s){if(s==="none"||s===void 0)return i;if(s==="gzip")return hd(i);throw new Error("Unsupported compression algorithm: "+s)}n.compress=t;async function r(i,s){if(s==="none"||s===void 0)return i;if(s==="gzip")return fd(i);throw new Error("Unsupported compression algorithm: "+s)}n.decompress=r})(Br||(Br={}));var Ys=Fe(gd(),1);function rn(n){return typeof Buffer>"u"?(0,Ys.toByteArray)(n):Buffer.from(n,"base64")}function qn(n){return typeof Buffer>"u"?(0,Ys.fromByteArray)(n):Buffer.from(n).toString("base64")}var wc,md=n=>{wc=n},vt=()=>{if(wc===void 0)throw new Error("Crypto module is not available. Please call the initializeProtocol() function first.");let n=wc.subtle;return{async generateKeyPair(){let e=await n.generateKey({name:"RSA-OAEP",modulusLength:4096,publicExponent:new Uint8Array([1,0,1]),hash:"SHA-256"},!0,["encrypt","decrypt"]),t=await n.exportKey("spki",e.publicKey),r=await n.exportKey("pkcs8",e.privateKey);return{privateKey:qn(new Uint8Array(r)),publicKey:qn(new Uint8Array(t))}},async generateSymKey(){let e=await n.generateKey({name:"AES-CBC",length:256},!0,["encrypt","decrypt"]),t=await n.exportKey("raw",e);return qn(new Uint8Array(t))},async generateIV(){let e=crypto.getRandomValues(new Uint8Array(16));return qn(e)},async symEncrypt(e,t,r){let i=await n.importKey("raw",rn(t),"AES-CBC",!1,["encrypt"]),s=await n.encrypt({name:"AES-CBC",iv:rn(r)},i,e);return new Uint8Array(s)},async symDecrypt(e,t,r){let i=await n.importKey("raw",rn(t),"AES-CBC",!1,["decrypt"]),s=await n.decrypt({name:"AES-CBC",iv:rn(r)},i,e);return new Uint8Array(s)},async publicEncrypt(e,t){let r=await n.importKey("spki",rn(t),{name:"RSA-OAEP",hash:"SHA-256"},!1,["encrypt"]),i=await n.encrypt({name:"RSA-OAEP"},r,e);return new Uint8Array(i)},async privateDecrypt(e,t){let r=await n.importKey("pkcs8",rn(t),{name:"RSA-OAEP",hash:"SHA-256"},!0,["decrypt"]),i=await n.decrypt({name:"RSA-OAEP"},r,e);return new Uint8Array(i)}}};var ot;(function(n){async function e(){return vt().generateKeyPair()}n.generateKeyPair=e;async function t(){return vt().generateSymKey()}n.generateSymKey=t;async function r(l,h,f){return vt().symEncrypt(l,h,f)}n.symEncrypt=r;async function i(l,h,f){return vt().symDecrypt(l,h,f)}n.symDecrypt=i;async function s(l,h){return vt().publicEncrypt(l,h)}n.publicEncrypt=s;async function o(l,h){return vt().privateDecrypt(l,h)}n.privateDecrypt=o;async function a(){return vt().generateIV()}n.generateIV=a;async function c(l,h,...f){let d=await h.symmetricKey,x=rn(d),S=l.content,j=Vn.encode(S),ue=Br.bestFit(f.map(z=>z.supportedCompression)),he=await Br.compress(j,ue),le=await vt().generateIV(),de=await vt().symEncrypt(he,d,le),G=await Promise.all(f.map(async z=>{let ne=h.cache?.[z.peerId];return ne||(ne=qn(await vt().publicEncrypt(x,z.publicKey)),h.cache&&(h.cache[z.peerId]=ne)),{target:z.peerId,key:ne,iv:le}}));return{...l,metadata:{...l.metadata,encryption:{keys:G},compression:{algorithm:ue}},content:de}}n.encrypt=c;async function u(l,h){if(l.metadata.encryption.keys.length!==1)throw new Error("Expected exactly one key for decryption");let f=l.metadata.encryption.keys[0],d=h.cache?.[f.key];d||(d=qn(await vt().privateDecrypt(rn(f.key),h.privateKey)),h.cache&&(h.cache[f.key]=d));let x=await vt().symDecrypt(l.content,d,f.iv),S=await Br.decompress(x,l.metadata.compression.algorithm),j=Vn.decode(S);return{...l,content:j}}n.decrypt=u})(ot||(ot={}));var Xs=class{options;messageHandlers=new Map;onErrorEmitter=new yt;onDisconnectEmitter=new yt;onConnectionErrorEmitter=new yt;onReconnectEmitter=new yt;onUnhandledRequestHandler;onUnhandledBroadcastHandler;onUnhandledNotificationHandler;get onError(){return this.onErrorEmitter.event}get onDisconnect(){return this.onDisconnectEmitter.event}get onReconnect(){return this.onReconnectEmitter.event}get onConnectionError(){return this.onConnectionErrorEmitter.event}requestMap=new Map;requestId=1;symKey=ot.generateSymKey();encryptionKeyCache={};decryptionKeyCache={};maxCacheSize=50;_ready=new jt;constructor(e){this.options=e,e.transport.read(t=>this.handleMessage(new Uint8Array(t))),e.transport.onDisconnect(()=>this.dispose()),e.transport.onError(t=>{this.onConnectionErrorEmitter.fire(t),this.dispose()}),e.transport.onReconnect(()=>this.onReconnectEmitter.fire())}dispose(){this.onDisconnectEmitter.fire(),this.onDisconnectEmitter.dispose(),this.onErrorEmitter.dispose(),this.messageHandlers.clear(),this.options.transport.dispose()}ready(){this._ready.resolve()}cleanupCaches(){let e=this.getPublicKeysLength()+this.maxCacheSize;Object.keys(this.encryptionKeyCache).length>e&&(this.encryptionKeyCache={}),Object.keys(this.decryptionKeyCache).length>e&&(this.decryptionKeyCache={})}async handleMessage(e){this.cleanupCaches();let t;try{t=Vn.decode(e)}catch(r){console.error("Decoding message error",r);return}if(fr.isAny(t)){let r=this.requestMap.get(t.id);try{let i;if(fr.isEncrypted(t))i=await ot.decrypt(t,{privateKey:this.options.privateKey,cache:this.decryptionKeyCache});else if(fr.is(t))i=t;else{console.error("Received invalid response message");return}r&&r.response.resolve(i.content.response)}catch(i){console.error("Failed to handle response message",i),r?.response.reject(i)}}else if(dr.isAny(t)){let r=this.requestMap.get(t.id);try{let i;if(dr.isEncrypted(t))i=await ot.decrypt(t,{privateKey:this.options.privateKey,cache:this.decryptionKeyCache});else if(dr.is(t))i=t;else{console.error("Received invalid response error message");return}r&&r.response.reject(new Error(i.content.message))}catch(i){console.error("Failed to handle response error message",i),r?.response.reject(i)}}else if(hr.isAny(t))try{let r;if(hr.isEncrypted(t))r=await ot.decrypt(t,{privateKey:this.options.privateKey,cache:this.decryptionKeyCache});else if(hr.is(t))r=t;else{console.error("Received invalid request message");return}let i=this.messageHandlers.get(r.content.method)??this.onUnhandledRequestHandler?.(r.content.method);if(!i){console.error(`No handler registered for ${r.kind} method ${r.content.method}.`);return}await this._ready.promise;let s;try{let o=await i(r.origin,...r.content.params??[]);s=fr.create(r.id,o)}catch(o){s=dr.create(r.id,String(o))}if(r.origin==="")await this.write(s);else{let o=this.getPublicKey(r.origin),a=await ot.encrypt(s,{symmetricKey:this.symKey,cache:this.encryptionKeyCache},o);await this.write(a)}}catch(r){console.error("Failed to handle request message",r)}else if(Bn.isAny(t)||pr.isAny(t))try{let r;if(pr.isEncrypted(t)||Bn.isEncrypted(t))r=await ot.decrypt(t,{privateKey:this.options.privateKey,cache:this.decryptionKeyCache});else if(pr.is(t)||Bn.is(t))r=t;else{console.error(`Received invalid ${t.kind} message`);return}let i=this.messageHandlers.get(r.content.method)??(Bn.is(r)?this.onUnhandledBroadcastHandler?.(r.content.method):this.onUnhandledNotificationHandler?.(r.content.method));if(!i){console.error(`No handler registered for ${t.kind} method ${r.content.method}.`);return}i(t.origin,...r.content.params??[])}catch(r){console.error(`Failed to handle ${t.kind} message`,r)}else if(Lr.isAny(t))try{let r;if(Lr.isBinary(t))r=await ot.decrypt(t,{privateKey:this.options.privateKey,cache:this.decryptionKeyCache});else if(Lr.is(t))r=t;else{console.error("Received invalid error message");return}this.onErrorEmitter.fire(r.content.message)}catch(r){console.error("Failed to handle error message",r)}}async write(e){await this.options.transport.write(Vn.encode(e))}onRequest(e,t){if(typeof e=="function")this.onUnhandledRequestHandler&&console.warn("Unhandled request handler already set. previous handler will be overwritten."),this.onUnhandledRequestHandler=r=>(i,...s)=>e(i,r,...s);else{let r=typeof e=="string"?e:e.method;this.messageHandlers.set(r,t)}}onNotification(e,t){if(typeof e=="function")this.onUnhandledNotificationHandler&&console.warn("Unhandled notification handler already set. previous handler will be overwritten."),this.onUnhandledNotificationHandler=r=>(i,...s)=>e(i,r,...s);else{let r=typeof e=="string"?e:e.method;this.messageHandlers.set(r,t)}}onBroadcast(e,t){if(typeof e=="function")this.onUnhandledNotificationHandler&&console.warn("Unhandled broadcast handler already set. previous handler will be overwritten."),this.onUnhandledBroadcastHandler=r=>(i,...s)=>e(i,r,...s);else{let r=typeof e=="string"?e:e.method;this.messageHandlers.set(r,t)}}async sendRequest(e,t,...r){await this._ready.promise;let i=this.requestId++,s=new jt,o=()=>{this.requestMap.delete(i),clearTimeout(a),s.reject(new Error("Request timed out"))},a=setTimeout(o,6e4),c={id:i,response:s,dispose:o};this.requestMap.set(i,c);let u=hr.create(e,i,"",t,r);if(t==="")await this.write(u);else{let l=await ot.encrypt(u,{symmetricKey:this.symKey,cache:this.encryptionKeyCache},this.getPublicKey(t));await this.write(l)}return s.promise}async sendNotification(e,t,...r){await this._ready.promise;let i=pr.create(e,"",t,r);if(t==="")await this.write(i);else{let s=await ot.encrypt(i,{symmetricKey:this.symKey,cache:this.encryptionKeyCache},this.getPublicKey(t));await this.write(s)}}async sendBroadcast(e,...t){await this._ready.promise;let r=Bn.create(e,"",t),i=this.getPublicKeys();if(i.length>0){let s=await ot.encrypt(r,{symmetricKey:this.symKey,cache:this.encryptionKeyCache},...i);await this.write(s)}}};var qt=Object.create(null);qt.open="0";qt.close="1";qt.ping="2";qt.pong="3";qt.message="4";qt.upgrade="5";qt.noop="6";var Pi=Object.create(null);Object.keys(qt).forEach(n=>{Pi[qt[n]]=n});var Li={type:"error",data:"parser error"};var vd=typeof Blob=="function"||typeof Blob<"u"&&Object.prototype.toString.call(Blob)==="[object BlobConstructor]",xd=typeof ArrayBuffer=="function",bd=n=>typeof ArrayBuffer.isView=="function"?ArrayBuffer.isView(n):n&&n.buffer instanceof ArrayBuffer,Mi=({type:n,data:e},t,r)=>vd&&e instanceof Blob?t?r(e):yd(e,r):xd&&(e instanceof ArrayBuffer||bd(e))?t?r(e):yd(new Blob([e]),r):r(qt[n]+(e||"")),yd=(n,e)=>{let t=new FileReader;return t.onload=function(){let r=t.result.split(",")[1];e("b"+(r||""))},t.readAsDataURL(n)};function wd(n){return n instanceof Uint8Array?n:n instanceof ArrayBuffer?new Uint8Array(n):new Uint8Array(n.buffer,n.byteOffset,n.byteLength)}var vc;function Ed(n,e){if(vd&&n.data instanceof Blob)return n.data.arrayBuffer().then(wd).then(e);if(xd&&(n.data instanceof ArrayBuffer||bd(n.data)))return e(wd(n.data));Mi(n,!1,t=>{vc||(vc=new TextEncoder),e(vc.encode(t))})}var Sd="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",Bi=typeof Uint8Array>"u"?[]:new Uint8Array(256);for(let n=0;n<Sd.length;n++)Bi[Sd.charCodeAt(n)]=n;var kd=n=>{let e=n.length*.75,t=n.length,r,i=0,s,o,a,c;n[n.length-1]==="="&&(e--,n[n.length-2]==="="&&e--);let u=new ArrayBuffer(e),l=new Uint8Array(u);for(r=0;r<t;r+=4)s=Bi[n.charCodeAt(r)],o=Bi[n.charCodeAt(r+1)],a=Bi[n.charCodeAt(r+2)],c=Bi[n.charCodeAt(r+3)],l[i++]=s<<2|o>>4,l[i++]=(o&15)<<4|a>>2,l[i++]=(a&3)<<6|c&63;return u};var wx=typeof ArrayBuffer=="function",Fi=(n,e)=>{if(typeof n!="string")return{type:"message",data:_d(n,e)};let t=n.charAt(0);return t==="b"?{type:"message",data:vx(n.substring(1),e)}:Pi[t]?n.length>1?{type:Pi[t],data:n.substring(1)}:{type:Pi[t]}:Li},vx=(n,e)=>{if(wx){let t=kd(n);return _d(t,e)}else return{base64:!0,data:n}},_d=(n,e)=>{switch(e){case"blob":return n instanceof Blob?n:new Blob([n]);case"arraybuffer":default:return n instanceof ArrayBuffer?n:n.buffer}};var Ad="",Td=(n,e)=>{let t=n.length,r=new Array(t),i=0;n.forEach((s,o)=>{Mi(s,!1,a=>{r[o]=a,++i===t&&e(r.join(Ad))})})},Cd=(n,e)=>{let t=n.split(Ad),r=[];for(let i=0;i<t.length;i++){let s=Fi(t[i],e);if(r.push(s),s.type==="error")break}return r};function Id(){return new TransformStream({transform(n,e){Ed(n,t=>{let r=t.length,i;if(r<126)i=new Uint8Array(1),new DataView(i.buffer).setUint8(0,r);else if(r<65536){i=new Uint8Array(3);let s=new DataView(i.buffer);s.setUint8(0,126),s.setUint16(1,r)}else{i=new Uint8Array(9);let s=new DataView(i.buffer);s.setUint8(0,127),s.setBigUint64(1,BigInt(r))}n.data&&typeof n.data!="string"&&(i[0]|=128),e.enqueue(i),e.enqueue(t)})}})}var xc;function Qs(n){return n.reduce((e,t)=>e+t.length,0)}function Zs(n,e){if(n[0].length===e)return n.shift();let t=new Uint8Array(e),r=0;for(let i=0;i<e;i++)t[i]=n[0][r++],r===n[0].length&&(n.shift(),r=0);return n.length&&r<n[0].length&&(n[0]=n[0].slice(r)),t}function Rd(n,e){xc||(xc=new TextDecoder);let t=[],r=0,i=-1,s=!1;return new TransformStream({transform(o,a){for(t.push(o);;){if(r===0){if(Qs(t)<1)break;let c=Zs(t,1);s=(c[0]&128)===128,i=c[0]&127,i<126?r=3:i===126?r=1:r=2}else if(r===1){if(Qs(t)<2)break;let c=Zs(t,2);i=new DataView(c.buffer,c.byteOffset,c.length).getUint16(0),r=3}else if(r===2){if(Qs(t)<8)break;let c=Zs(t,8),u=new DataView(c.buffer,c.byteOffset,c.length),l=u.getUint32(0);if(l>Math.pow(2,21)-1){a.enqueue(Li);break}i=l*Math.pow(2,32)+u.getUint32(4),r=3}else{if(Qs(t)<i)break;let c=Zs(t,i);a.enqueue(Fi(s?c:xc.decode(c),e)),r=0}if(i===0||i>n){a.enqueue(Li);break}}}})}var bc=4;function be(n){if(n)return xx(n)}function xx(n){for(var e in be.prototype)n[e]=be.prototype[e];return n}be.prototype.on=be.prototype.addEventListener=function(n,e){return this._callbacks=this._callbacks||{},(this._callbacks["$"+n]=this._callbacks["$"+n]||[]).push(e),this};be.prototype.once=function(n,e){function t(){this.off(n,t),e.apply(this,arguments)}return t.fn=e,this.on(n,t),this};be.prototype.off=be.prototype.removeListener=be.prototype.removeAllListeners=be.prototype.removeEventListener=function(n,e){if(this._callbacks=this._callbacks||{},arguments.length==0)return this._callbacks={},this;var t=this._callbacks["$"+n];if(!t)return this;if(arguments.length==1)return delete this._callbacks["$"+n],this;for(var r,i=0;i<t.length;i++)if(r=t[i],r===e||r.fn===e){t.splice(i,1);break}return t.length===0&&delete this._callbacks["$"+n],this};be.prototype.emit=function(n){this._callbacks=this._callbacks||{};for(var e=new Array(arguments.length-1),t=this._callbacks["$"+n],r=1;r<arguments.length;r++)e[r-1]=arguments[r];if(t){t=t.slice(0);for(var r=0,i=t.length;r<i;++r)t[r].apply(this,e)}return this};be.prototype.emitReserved=be.prototype.emit;be.prototype.listeners=function(n){return this._callbacks=this._callbacks||{},this._callbacks["$"+n]||[]};be.prototype.hasListeners=function(n){return!!this.listeners(n).length};var xn=typeof Promise=="function"&&typeof Promise.resolve=="function"?e=>Promise.resolve().then(e):(e,t)=>t(e,0),at=typeof self<"u"?self:typeof window<"u"?window:Function("return this")(),Dd="arraybuffer";function eo(n,...e){return e.reduce((t,r)=>(n.hasOwnProperty(r)&&(t[r]=n[r]),t),{})}var bx=at.setTimeout,Ex=at.clearTimeout;function bn(n,e){e.useNativeTimers?(n.setTimeoutFn=bx.bind(at),n.clearTimeoutFn=Ex.bind(at)):(n.setTimeoutFn=at.setTimeout.bind(at),n.clearTimeoutFn=at.clearTimeout.bind(at))}var Sx=1.33;function Ud(n){return typeof n=="string"?kx(n):Math.ceil((n.byteLength||n.size)*Sx)}function kx(n){let e=0,t=0;for(let r=0,i=n.length;r<i;r++)e=n.charCodeAt(r),e<128?t+=1:e<2048?t+=2:e<55296||e>=57344?t+=3:(r++,t+=4);return t}function to(){return Date.now().toString(36).substring(3)+Math.random().toString(36).substring(2,5)}function Od(n){let e="";for(let t in n)n.hasOwnProperty(t)&&(e.length&&(e+="&"),e+=encodeURIComponent(t)+"="+encodeURIComponent(n[t]));return e}function Nd(n){let e={},t=n.split("&");for(let r=0,i=t.length;r<i;r++){let s=t[r].split("=");e[decodeURIComponent(s[0])]=decodeURIComponent(s[1])}return e}var no=class extends Error{constructor(e,t,r){super(e),this.description=t,this.context=r,this.type="TransportError"}},En=class extends be{constructor(e){super(),this.writable=!1,bn(this,e),this.opts=e,this.query=e.query,this.socket=e.socket,this.supportsBinary=!e.forceBase64}onError(e,t,r){return super.emitReserved("error",new no(e,t,r)),this}open(){return this.readyState="opening",this.doOpen(),this}close(){return(this.readyState==="opening"||this.readyState==="open")&&(this.doClose(),this.onClose()),this}send(e){this.readyState==="open"&&this.write(e)}onOpen(){this.readyState="open",this.writable=!0,super.emitReserved("open")}onData(e){let t=Fi(e,this.socket.binaryType);this.onPacket(t)}onPacket(e){super.emitReserved("packet",e)}onClose(e){this.readyState="closed",super.emitReserved("close",e)}pause(e){}createUri(e,t={}){return e+"://"+this._hostname()+this._port()+this.opts.path+this._query(t)}_hostname(){let e=this.opts.hostname;return e.indexOf(":")===-1?e:"["+e+"]"}_port(){return this.opts.port&&(this.opts.secure&&+(this.opts.port!==443)||!this.opts.secure&&Number(this.opts.port)!==80)?":"+this.opts.port:""}_query(e){let t=Od(e);return t.length?"?"+t:""}};var ji=class extends En{constructor(){super(...arguments),this._polling=!1}get name(){return"polling"}doOpen(){this._poll()}pause(e){this.readyState="pausing";let t=()=>{this.readyState="paused",e()};if(this._polling||!this.writable){let r=0;this._polling&&(r++,this.once("pollComplete",function(){--r||t()})),this.writable||(r++,this.once("drain",function(){--r||t()}))}else t()}_poll(){this._polling=!0,this.doPoll(),this.emitReserved("poll")}onData(e){let t=r=>{if(this.readyState==="opening"&&r.type==="open"&&this.onOpen(),r.type==="close")return this.onClose({description:"transport closed by the server"}),!1;this.onPacket(r)};Cd(e,this.socket.binaryType).forEach(t),this.readyState!=="closed"&&(this._polling=!1,this.emitReserved("pollComplete"),this.readyState==="open"&&this._poll())}doClose(){let e=()=>{this.write([{type:"close"}])};this.readyState==="open"?e():this.once("open",e)}write(e){this.writable=!1,Td(e,t=>{this.doWrite(t,()=>{this.writable=!0,this.emitReserved("drain")})})}uri(){let e=this.opts.secure?"https":"http",t=this.query||{};return this.opts.timestampRequests!==!1&&(t[this.opts.timestampParam]=to()),!this.supportsBinary&&!t.sid&&(t.b64=1),this.createUri(e,t)}};var Pd=!1;try{Pd=typeof XMLHttpRequest<"u"&&"withCredentials"in new XMLHttpRequest}catch{}var Ld=Pd;function _x(){}var Ec=class extends ji{constructor(e){if(super(e),typeof location<"u"){let t=location.protocol==="https:",r=location.port;r||(r=t?"443":"80"),this.xd=typeof location<"u"&&e.hostname!==location.hostname||r!==e.port}}doWrite(e,t){let r=this.request({method:"POST",data:e});r.on("success",t),r.on("error",(i,s)=>{this.onError("xhr post error",i,s)})}doPoll(){let e=this.request();e.on("data",this.onData.bind(this)),e.on("error",(t,r)=>{this.onError("xhr poll error",t,r)}),this.pollXhr=e}},zn=class n extends be{constructor(e,t,r){super(),this.createRequest=e,bn(this,r),this._opts=r,this._method=r.method||"GET",this._uri=t,this._data=r.data!==void 0?r.data:null,this._create()}_create(){var e;let t=eo(this._opts,"agent","pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","autoUnref");t.xdomain=!!this._opts.xd;let r=this._xhr=this.createRequest(t);try{r.open(this._method,this._uri,!0);try{if(this._opts.extraHeaders){r.setDisableHeaderCheck&&r.setDisableHeaderCheck(!0);for(let i in this._opts.extraHeaders)this._opts.extraHeaders.hasOwnProperty(i)&&r.setRequestHeader(i,this._opts.extraHeaders[i])}}catch{}if(this._method==="POST")try{r.setRequestHeader("Content-type","text/plain;charset=UTF-8")}catch{}try{r.setRequestHeader("Accept","*/*")}catch{}(e=this._opts.cookieJar)===null||e===void 0||e.addCookies(r),"withCredentials"in r&&(r.withCredentials=this._opts.withCredentials),this._opts.requestTimeout&&(r.timeout=this._opts.requestTimeout),r.onreadystatechange=()=>{var i;r.readyState===3&&((i=this._opts.cookieJar)===null||i===void 0||i.parseCookies(r.getResponseHeader("set-cookie"))),r.readyState===4&&(r.status===200||r.status===1223?this._onLoad():this.setTimeoutFn(()=>{this._onError(typeof r.status=="number"?r.status:0)},0))},r.send(this._data)}catch(i){this.setTimeoutFn(()=>{this._onError(i)},0);return}typeof document<"u"&&(this._index=n.requestsCount++,n.requests[this._index]=this)}_onError(e){this.emitReserved("error",e,this._xhr),this._cleanup(!0)}_cleanup(e){if(!(typeof this._xhr>"u"||this._xhr===null)){if(this._xhr.onreadystatechange=_x,e)try{this._xhr.abort()}catch{}typeof document<"u"&&delete n.requests[this._index],this._xhr=null}}_onLoad(){let e=this._xhr.responseText;e!==null&&(this.emitReserved("data",e),this.emitReserved("success"),this._cleanup())}abort(){this._cleanup()}};zn.requestsCount=0;zn.requests={};if(typeof document<"u"){if(typeof attachEvent=="function")attachEvent("onunload",Md);else if(typeof addEventListener=="function"){let n="onpagehide"in at?"pagehide":"unload";addEventListener(n,Md,!1)}}function Md(){for(let n in zn.requests)zn.requests.hasOwnProperty(n)&&zn.requests[n].abort()}var Ax=function(){let n=Bd({xdomain:!1});return n&&n.responseType!==null}(),Gn=class extends Ec{constructor(e){super(e);let t=e&&e.forceBase64;this.supportsBinary=Ax&&!t}request(e={}){return Object.assign(e,{xd:this.xd},this.opts),new zn(Bd,this.uri(),e)}};function Bd(n){let e=n.xdomain;try{if(typeof XMLHttpRequest<"u"&&(!e||Ld))return new XMLHttpRequest}catch{}if(!e)try{return new at[["Active"].concat("Object").join("X")]("Microsoft.XMLHTTP")}catch{}}var Fd=typeof navigator<"u"&&typeof navigator.product=="string"&&navigator.product.toLowerCase()==="reactnative",kc=class extends En{get name(){return"websocket"}doOpen(){let e=this.uri(),t=this.opts.protocols,r=Fd?{}:eo(this.opts,"agent","perMessageDeflate","pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","localAddress","protocolVersion","origin","maxPayload","family","checkServerIdentity");this.opts.extraHeaders&&(r.headers=this.opts.extraHeaders);try{this.ws=this.createSocket(e,t,r)}catch(i){return this.emitReserved("error",i)}this.ws.binaryType=this.socket.binaryType,this.addEventListeners()}addEventListeners(){this.ws.onopen=()=>{this.opts.autoUnref&&this.ws._socket.unref(),this.onOpen()},this.ws.onclose=e=>this.onClose({description:"websocket connection closed",context:e}),this.ws.onmessage=e=>this.onData(e.data),this.ws.onerror=e=>this.onError("websocket error",e)}write(e){this.writable=!1;for(let t=0;t<e.length;t++){let r=e[t],i=t===e.length-1;Mi(r,this.supportsBinary,s=>{try{this.doWrite(r,s)}catch{}i&&xn(()=>{this.writable=!0,this.emitReserved("drain")},this.setTimeoutFn)})}}doClose(){typeof this.ws<"u"&&(this.ws.onerror=()=>{},this.ws.close(),this.ws=null)}uri(){let e=this.opts.secure?"wss":"ws",t=this.query||{};return this.opts.timestampRequests&&(t[this.opts.timestampParam]=to()),this.supportsBinary||(t.b64=1),this.createUri(e,t)}},Sc=at.WebSocket||at.MozWebSocket,Wn=class extends kc{createSocket(e,t,r){return Fd?new Sc(e,t,r):t?new Sc(e,t):new Sc(e)}doWrite(e,t){this.ws.send(t)}};var Fr=class extends En{get name(){return"webtransport"}doOpen(){try{this._transport=new WebTransport(this.createUri("https"),this.opts.transportOptions[this.name])}catch(e){return this.emitReserved("error",e)}this._transport.closed.then(()=>{this.onClose()}).catch(e=>{this.onError("webtransport error",e)}),this._transport.ready.then(()=>{this._transport.createBidirectionalStream().then(e=>{let t=Rd(Number.MAX_SAFE_INTEGER,this.socket.binaryType),r=e.readable.pipeThrough(t).getReader(),i=Id();i.readable.pipeTo(e.writable),this._writer=i.writable.getWriter();let s=()=>{r.read().then(({done:a,value:c})=>{a||(this.onPacket(c),s())}).catch(a=>{})};s();let o={type:"open"};this.query.sid&&(o.data=`{"sid":"${this.query.sid}"}`),this._writer.write(o).then(()=>this.onOpen())})})}write(e){this.writable=!1;for(let t=0;t<e.length;t++){let r=e[t],i=t===e.length-1;this._writer.write(r).then(()=>{i&&xn(()=>{this.writable=!0,this.emitReserved("drain")},this.setTimeoutFn)})}}doClose(){var e;(e=this._transport)===null||e===void 0||e.close()}};var _c={websocket:Wn,webtransport:Fr,polling:Gn};var Tx=/^(?:(?![^:@\/?#]+:[^:@\/]*@)(http|https|ws|wss):\/\/)?((?:(([^:@\/?#]*)(?::([^:@\/?#]*))?)?@)?((?:[a-f0-9]{0,4}:){2,7}[a-f0-9]{0,4}|[^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/,Cx=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"];function jr(n){if(n.length>8e3)throw"URI too long";let e=n,t=n.indexOf("["),r=n.indexOf("]");t!=-1&&r!=-1&&(n=n.substring(0,t)+n.substring(t,r).replace(/:/g,";")+n.substring(r,n.length));let i=Tx.exec(n||""),s={},o=14;for(;o--;)s[Cx[o]]=i[o]||"";return t!=-1&&r!=-1&&(s.source=e,s.host=s.host.substring(1,s.host.length-1).replace(/;/g,":"),s.authority=s.authority.replace("[","").replace("]","").replace(/;/g,":"),s.ipv6uri=!0),s.pathNames=Ix(s,s.path),s.queryKey=Rx(s,s.query),s}function Ix(n,e){let t=/\/{2,9}/g,r=e.replace(t,"/").split("/");return(e.slice(0,1)=="/"||e.length===0)&&r.splice(0,1),e.slice(-1)=="/"&&r.splice(r.length-1,1),r}function Rx(n,e){let t={};return e.replace(/(?:^|&)([^&=]*)=?([^&]*)/g,function(r,i,s){i&&(t[i]=s)}),t}var Ac=typeof addEventListener=="function"&&typeof removeEventListener=="function",ro=[];Ac&&addEventListener("offline",()=>{ro.forEach(n=>n())},!1);var vr=class n extends be{constructor(e,t){if(super(),this.binaryType=Dd,this.writeBuffer=[],this._prevBufferLen=0,this._pingInterval=-1,this._pingTimeout=-1,this._maxPayload=-1,this._pingTimeoutTime=1/0,e&&typeof e=="object"&&(t=e,e=null),e){let r=jr(e);t.hostname=r.host,t.secure=r.protocol==="https"||r.protocol==="wss",t.port=r.port,r.query&&(t.query=r.query)}else t.host&&(t.hostname=jr(t.host).host);bn(this,t),this.secure=t.secure!=null?t.secure:typeof location<"u"&&location.protocol==="https:",t.hostname&&!t.port&&(t.port=this.secure?"443":"80"),this.hostname=t.hostname||(typeof location<"u"?location.hostname:"localhost"),this.port=t.port||(typeof location<"u"&&location.port?location.port:this.secure?"443":"80"),this.transports=[],this._transportsByName={},t.transports.forEach(r=>{let i=r.prototype.name;this.transports.push(i),this._transportsByName[i]=r}),this.opts=Object.assign({path:"/engine.io",agent:!1,withCredentials:!1,upgrade:!0,timestampParam:"t",rememberUpgrade:!1,addTrailingSlash:!0,rejectUnauthorized:!0,perMessageDeflate:{threshold:1024},transportOptions:{},closeOnBeforeunload:!1},t),this.opts.path=this.opts.path.replace(/\/$/,"")+(this.opts.addTrailingSlash?"/":""),typeof this.opts.query=="string"&&(this.opts.query=Nd(this.opts.query)),Ac&&(this.opts.closeOnBeforeunload&&(this._beforeunloadEventListener=()=>{this.transport&&(this.transport.removeAllListeners(),this.transport.close())},addEventListener("beforeunload",this._beforeunloadEventListener,!1)),this.hostname!=="localhost"&&(this._offlineEventListener=()=>{this._onClose("transport close",{description:"network connection lost"})},ro.push(this._offlineEventListener))),this.opts.withCredentials&&(this._cookieJar=void 0),this._open()}createTransport(e){let t=Object.assign({},this.opts.query);t.EIO=bc,t.transport=e,this.id&&(t.sid=this.id);let r=Object.assign({},this.opts,{query:t,socket:this,hostname:this.hostname,secure:this.secure,port:this.port},this.opts.transportOptions[e]);return new this._transportsByName[e](r)}_open(){if(this.transports.length===0){this.setTimeoutFn(()=>{this.emitReserved("error","No transports available")},0);return}let e=this.opts.rememberUpgrade&&n.priorWebsocketSuccess&&this.transports.indexOf("websocket")!==-1?"websocket":this.transports[0];this.readyState="opening";let t=this.createTransport(e);t.open(),this.setTransport(t)}setTransport(e){this.transport&&this.transport.removeAllListeners(),this.transport=e,e.on("drain",this._onDrain.bind(this)).on("packet",this._onPacket.bind(this)).on("error",this._onError.bind(this)).on("close",t=>this._onClose("transport close",t))}onOpen(){this.readyState="open",n.priorWebsocketSuccess=this.transport.name==="websocket",this.emitReserved("open"),this.flush()}_onPacket(e){if(this.readyState==="opening"||this.readyState==="open"||this.readyState==="closing")switch(this.emitReserved("packet",e),this.emitReserved("heartbeat"),e.type){case"open":this.onHandshake(JSON.parse(e.data));break;case"ping":this._sendPacket("pong"),this.emitReserved("ping"),this.emitReserved("pong"),this._resetPingTimeout();break;case"error":let t=new Error("server error");t.code=e.data,this._onError(t);break;case"message":this.emitReserved("data",e.data),this.emitReserved("message",e.data);break}}onHandshake(e){this.emitReserved("handshake",e),this.id=e.sid,this.transport.query.sid=e.sid,this._pingInterval=e.pingInterval,this._pingTimeout=e.pingTimeout,this._maxPayload=e.maxPayload,this.onOpen(),this.readyState!=="closed"&&this._resetPingTimeout()}_resetPingTimeout(){this.clearTimeoutFn(this._pingTimeoutTimer);let e=this._pingInterval+this._pingTimeout;this._pingTimeoutTime=Date.now()+e,this._pingTimeoutTimer=this.setTimeoutFn(()=>{this._onClose("ping timeout")},e),this.opts.autoUnref&&this._pingTimeoutTimer.unref()}_onDrain(){this.writeBuffer.splice(0,this._prevBufferLen),this._prevBufferLen=0,this.writeBuffer.length===0?this.emitReserved("drain"):this.flush()}flush(){if(this.readyState!=="closed"&&this.transport.writable&&!this.upgrading&&this.writeBuffer.length){let e=this._getWritablePackets();this.transport.send(e),this._prevBufferLen=e.length,this.emitReserved("flush")}}_getWritablePackets(){if(!(this._maxPayload&&this.transport.name==="polling"&&this.writeBuffer.length>1))return this.writeBuffer;let t=1;for(let r=0;r<this.writeBuffer.length;r++){let i=this.writeBuffer[r].data;if(i&&(t+=Ud(i)),r>0&&t>this._maxPayload)return this.writeBuffer.slice(0,r);t+=2}return this.writeBuffer}_hasPingExpired(){if(!this._pingTimeoutTime)return!0;let e=Date.now()>this._pingTimeoutTime;return e&&(this._pingTimeoutTime=0,xn(()=>{this._onClose("ping timeout")},this.setTimeoutFn)),e}write(e,t,r){return this._sendPacket("message",e,t,r),this}send(e,t,r){return this._sendPacket("message",e,t,r),this}_sendPacket(e,t,r,i){if(typeof t=="function"&&(i=t,t=void 0),typeof r=="function"&&(i=r,r=null),this.readyState==="closing"||this.readyState==="closed")return;r=r||{},r.compress=r.compress!==!1;let s={type:e,data:t,options:r};this.emitReserved("packetCreate",s),this.writeBuffer.push(s),i&&this.once("flush",i),this.flush()}close(){let e=()=>{this._onClose("forced close"),this.transport.close()},t=()=>{this.off("upgrade",t),this.off("upgradeError",t),e()},r=()=>{this.once("upgrade",t),this.once("upgradeError",t)};return(this.readyState==="opening"||this.readyState==="open")&&(this.readyState="closing",this.writeBuffer.length?this.once("drain",()=>{this.upgrading?r():e()}):this.upgrading?r():e()),this}_onError(e){if(n.priorWebsocketSuccess=!1,this.opts.tryAllTransports&&this.transports.length>1&&this.readyState==="opening")return this.transports.shift(),this._open();this.emitReserved("error",e),this._onClose("transport error",e)}_onClose(e,t){if(this.readyState==="opening"||this.readyState==="open"||this.readyState==="closing"){if(this.clearTimeoutFn(this._pingTimeoutTimer),this.transport.removeAllListeners("close"),this.transport.close(),this.transport.removeAllListeners(),Ac&&(this._beforeunloadEventListener&&removeEventListener("beforeunload",this._beforeunloadEventListener,!1),this._offlineEventListener)){let r=ro.indexOf(this._offlineEventListener);r!==-1&&ro.splice(r,1)}this.readyState="closed",this.id=null,this.emitReserved("close",e,t),this.writeBuffer=[],this._prevBufferLen=0}}};vr.protocol=bc;var io=class extends vr{constructor(){super(...arguments),this._upgrades=[]}onOpen(){if(super.onOpen(),this.readyState==="open"&&this.opts.upgrade)for(let e=0;e<this._upgrades.length;e++)this._probe(this._upgrades[e])}_probe(e){let t=this.createTransport(e),r=!1;vr.priorWebsocketSuccess=!1;let i=()=>{r||(t.send([{type:"ping",data:"probe"}]),t.once("packet",h=>{if(!r)if(h.type==="pong"&&h.data==="probe"){if(this.upgrading=!0,this.emitReserved("upgrading",t),!t)return;vr.priorWebsocketSuccess=t.name==="websocket",this.transport.pause(()=>{r||this.readyState!=="closed"&&(l(),this.setTransport(t),t.send([{type:"upgrade"}]),this.emitReserved("upgrade",t),t=null,this.upgrading=!1,this.flush())})}else{let f=new Error("probe error");f.transport=t.name,this.emitReserved("upgradeError",f)}}))};function s(){r||(r=!0,l(),t.close(),t=null)}let o=h=>{let f=new Error("probe error: "+h);f.transport=t.name,s(),this.emitReserved("upgradeError",f)};function a(){o("transport closed")}function c(){o("socket closed")}function u(h){t&&h.name!==t.name&&s()}let l=()=>{t.removeListener("open",i),t.removeListener("error",o),t.removeListener("close",a),this.off("close",c),this.off("upgrading",u)};t.once("open",i),t.once("error",o),t.once("close",a),this.once("close",c),this.once("upgrading",u),this._upgrades.indexOf("webtransport")!==-1&&e!=="webtransport"?this.setTimeoutFn(()=>{r||t.open()},200):t.open()}onHandshake(e){this._upgrades=this._filterUpgrades(e.upgrades),super.onHandshake(e)}_filterUpgrades(e){let t=[];for(let r=0;r<e.length;r++)~this.transports.indexOf(e[r])&&t.push(e[r]);return t}},Vr=class extends io{constructor(e,t={}){let r=typeof e=="object"?e:t;(!r.transports||r.transports&&typeof r.transports[0]=="string")&&(r.transports=(r.transports||["polling","websocket","webtransport"]).map(i=>_c[i]).filter(i=>!!i)),super(e,r)}};var oT=Vr.protocol;function jd(n,e="",t){let r=n;t=t||typeof location<"u"&&location,n==null&&(n=t.protocol+"//"+t.host),typeof n=="string"&&(n.charAt(0)==="/"&&(n.charAt(1)==="/"?n=t.protocol+n:n=t.host+n),/^(https?|wss?):\/\//.test(n)||(typeof t<"u"?n=t.protocol+"//"+n:n="https://"+n),r=jr(n)),r.port||(/^(http|ws)$/.test(r.protocol)?r.port="80":/^(http|ws)s$/.test(r.protocol)&&(r.port="443")),r.path=r.path||"/";let s=r.host.indexOf(":")!==-1?"["+r.host+"]":r.host;return r.id=r.protocol+"://"+s+":"+r.port+e,r.href=r.protocol+"://"+s+(t&&t.port===r.port?"":":"+r.port),r}var Uc={};Iu(Uc,{Decoder:()=>Rc,Encoder:()=>Ic,PacketType:()=>ae,protocol:()=>Gd});var Ux=typeof ArrayBuffer=="function",Ox=n=>typeof ArrayBuffer.isView=="function"?ArrayBuffer.isView(n):n.buffer instanceof ArrayBuffer,Vd=Object.prototype.toString,Nx=typeof Blob=="function"||typeof Blob<"u"&&Vd.call(Blob)==="[object BlobConstructor]",Px=typeof File=="function"||typeof File<"u"&&Vd.call(File)==="[object FileConstructor]";function $i(n){return Ux&&(n instanceof ArrayBuffer||Ox(n))||Nx&&n instanceof Blob||Px&&n instanceof File}function Vi(n,e){if(!n||typeof n!="object")return!1;if(Array.isArray(n)){for(let t=0,r=n.length;t<r;t++)if(Vi(n[t]))return!0;return!1}if($i(n))return!0;if(n.toJSON&&typeof n.toJSON=="function"&&arguments.length===1)return Vi(n.toJSON(),!0);for(let t in n)if(Object.prototype.hasOwnProperty.call(n,t)&&Vi(n[t]))return!0;return!1}function $d(n){let e=[],t=n.data,r=n;return r.data=Tc(t,e),r.attachments=e.length,{packet:r,buffers:e}}function Tc(n,e){if(!n)return n;if($i(n)){let t={_placeholder:!0,num:e.length};return e.push(n),t}else if(Array.isArray(n)){let t=new Array(n.length);for(let r=0;r<n.length;r++)t[r]=Tc(n[r],e);return t}else if(typeof n=="object"&&!(n instanceof Date)){let t={};for(let r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=Tc(n[r],e));return t}return n}function qd(n,e){return n.data=Cc(n.data,e),delete n.attachments,n}function Cc(n,e){if(!n)return n;if(n&&n._placeholder===!0){if(typeof n.num=="number"&&n.num>=0&&n.num<e.length)return e[n.num];throw new Error("illegal attachments")}else if(Array.isArray(n))for(let t=0;t<n.length;t++)n[t]=Cc(n[t],e);else if(typeof n=="object")for(let t in n)Object.prototype.hasOwnProperty.call(n,t)&&(n[t]=Cc(n[t],e));return n}var Lx=["connect","connect_error","disconnect","disconnecting","newListener","removeListener"],Gd=5,ae;(function(n){n[n.CONNECT=0]="CONNECT",n[n.DISCONNECT=1]="DISCONNECT",n[n.EVENT=2]="EVENT",n[n.ACK=3]="ACK",n[n.CONNECT_ERROR=4]="CONNECT_ERROR",n[n.BINARY_EVENT=5]="BINARY_EVENT",n[n.BINARY_ACK=6]="BINARY_ACK"})(ae||(ae={}));var Ic=class{constructor(e){this.replacer=e}encode(e){return(e.type===ae.EVENT||e.type===ae.ACK)&&Vi(e)?this.encodeAsBinary({type:e.type===ae.EVENT?ae.BINARY_EVENT:ae.BINARY_ACK,nsp:e.nsp,data:e.data,id:e.id}):[this.encodeAsString(e)]}encodeAsString(e){let t=""+e.type;return(e.type===ae.BINARY_EVENT||e.type===ae.BINARY_ACK)&&(t+=e.attachments+"-"),e.nsp&&e.nsp!=="/"&&(t+=e.nsp+","),e.id!=null&&(t+=e.id),e.data!=null&&(t+=JSON.stringify(e.data,this.replacer)),t}encodeAsBinary(e){let t=$d(e),r=this.encodeAsString(t.packet),i=t.buffers;return i.unshift(r),i}};function zd(n){return Object.prototype.toString.call(n)==="[object Object]"}var Rc=class n extends be{constructor(e){super(),this.reviver=e}add(e){let t;if(typeof e=="string"){if(this.reconstructor)throw new Error("got plaintext data when reconstructing a packet");t=this.decodeString(e);let r=t.type===ae.BINARY_EVENT;r||t.type===ae.BINARY_ACK?(t.type=r?ae.EVENT:ae.ACK,this.reconstructor=new Dc(t),t.attachments===0&&super.emitReserved("decoded",t)):super.emitReserved("decoded",t)}else if($i(e)||e.base64)if(this.reconstructor)t=this.reconstructor.takeBinaryData(e),t&&(this.reconstructor=null,super.emitReserved("decoded",t));else throw new Error("got binary data when not reconstructing a packet");else throw new Error("Unknown type: "+e)}decodeString(e){let t=0,r={type:Number(e.charAt(0))};if(ae[r.type]===void 0)throw new Error("unknown packet type "+r.type);if(r.type===ae.BINARY_EVENT||r.type===ae.BINARY_ACK){let s=t+1;for(;e.charAt(++t)!=="-"&&t!=e.length;);let o=e.substring(s,t);if(o!=Number(o)||e.charAt(t)!=="-")throw new Error("Illegal attachments");r.attachments=Number(o)}if(e.charAt(t+1)==="/"){let s=t+1;for(;++t&&!(e.charAt(t)===","||t===e.length););r.nsp=e.substring(s,t)}else r.nsp="/";let i=e.charAt(t+1);if(i!==""&&Number(i)==i){let s=t+1;for(;++t;){let o=e.charAt(t);if(o==null||Number(o)!=o){--t;break}if(t===e.length)break}r.id=Number(e.substring(s,t+1))}if(e.charAt(++t)){let s=this.tryParse(e.substr(t));if(n.isPayloadValid(r.type,s))r.data=s;else throw new Error("invalid payload")}return r}tryParse(e){try{return JSON.parse(e,this.reviver)}catch{return!1}}static isPayloadValid(e,t){switch(e){case ae.CONNECT:return zd(t);case ae.DISCONNECT:return t===void 0;case ae.CONNECT_ERROR:return typeof t=="string"||zd(t);case ae.EVENT:case ae.BINARY_EVENT:return Array.isArray(t)&&(typeof t[0]=="number"||typeof t[0]=="string"&&Lx.indexOf(t[0])===-1);case ae.ACK:case ae.BINARY_ACK:return Array.isArray(t)}}destroy(){this.reconstructor&&(this.reconstructor.finishedReconstruction(),this.reconstructor=null)}},Dc=class{constructor(e){this.packet=e,this.buffers=[],this.reconPack=e}takeBinaryData(e){if(this.buffers.push(e),this.buffers.length===this.reconPack.attachments){let t=qd(this.reconPack,this.buffers);return this.finishedReconstruction(),t}return null}finishedReconstruction(){this.reconPack=null,this.buffers=[]}};function xt(n,e,t){return n.on(e,t),function(){n.off(e,t)}}var Mx=Object.freeze({connect:1,connect_error:1,disconnect:1,disconnecting:1,newListener:1,removeListener:1}),$r=class extends be{constructor(e,t,r){super(),this.connected=!1,this.recovered=!1,this.receiveBuffer=[],this.sendBuffer=[],this._queue=[],this._queueSeq=0,this.ids=0,this.acks={},this.flags={},this.io=e,this.nsp=t,r&&r.auth&&(this.auth=r.auth),this._opts=Object.assign({},r),this.io._autoConnect&&this.open()}get disconnected(){return!this.connected}subEvents(){if(this.subs)return;let e=this.io;this.subs=[xt(e,"open",this.onopen.bind(this)),xt(e,"packet",this.onpacket.bind(this)),xt(e,"error",this.onerror.bind(this)),xt(e,"close",this.onclose.bind(this))]}get active(){return!!this.subs}connect(){return this.connected?this:(this.subEvents(),this.io._reconnecting||this.io.open(),this.io._readyState==="open"&&this.onopen(),this)}open(){return this.connect()}send(...e){return e.unshift("message"),this.emit.apply(this,e),this}emit(e,...t){var r,i,s;if(Mx.hasOwnProperty(e))throw new Error('"'+e.toString()+'" is a reserved event name');if(t.unshift(e),this._opts.retries&&!this.flags.fromQueue&&!this.flags.volatile)return this._addToQueue(t),this;let o={type:ae.EVENT,data:t};if(o.options={},o.options.compress=this.flags.compress!==!1,typeof t[t.length-1]=="function"){let l=this.ids++,h=t.pop();this._registerAckCallback(l,h),o.id=l}let a=(i=(r=this.io.engine)===null||r===void 0?void 0:r.transport)===null||i===void 0?void 0:i.writable,c=this.connected&&!(!((s=this.io.engine)===null||s===void 0)&&s._hasPingExpired());return this.flags.volatile&&!a||(c?(this.notifyOutgoingListeners(o),this.packet(o)):this.sendBuffer.push(o)),this.flags={},this}_registerAckCallback(e,t){var r;let i=(r=this.flags.timeout)!==null&&r!==void 0?r:this._opts.ackTimeout;if(i===void 0){this.acks[e]=t;return}let s=this.io.setTimeoutFn(()=>{delete this.acks[e];for(let a=0;a<this.sendBuffer.length;a++)this.sendBuffer[a].id===e&&this.sendBuffer.splice(a,1);t.call(this,new Error("operation has timed out"))},i),o=(...a)=>{this.io.clearTimeoutFn(s),t.apply(this,a)};o.withError=!0,this.acks[e]=o}emitWithAck(e,...t){return new Promise((r,i)=>{let s=(o,a)=>o?i(o):r(a);s.withError=!0,t.push(s),this.emit(e,...t)})}_addToQueue(e){let t;typeof e[e.length-1]=="function"&&(t=e.pop());let r={id:this._queueSeq++,tryCount:0,pending:!1,args:e,flags:Object.assign({fromQueue:!0},this.flags)};e.push((i,...s)=>r!==this._queue[0]?void 0:(i!==null?r.tryCount>this._opts.retries&&(this._queue.shift(),t&&t(i)):(this._queue.shift(),t&&t(null,...s)),r.pending=!1,this._drainQueue())),this._queue.push(r),this._drainQueue()}_drainQueue(e=!1){if(!this.connected||this._queue.length===0)return;let t=this._queue[0];t.pending&&!e||(t.pending=!0,t.tryCount++,this.flags=t.flags,this.emit.apply(this,t.args))}packet(e){e.nsp=this.nsp,this.io._packet(e)}onopen(){typeof this.auth=="function"?this.auth(e=>{this._sendConnectPacket(e)}):this._sendConnectPacket(this.auth)}_sendConnectPacket(e){this.packet({type:ae.CONNECT,data:this._pid?Object.assign({pid:this._pid,offset:this._lastOffset},e):e})}onerror(e){this.connected||this.emitReserved("connect_error",e)}onclose(e,t){this.connected=!1,delete this.id,this.emitReserved("disconnect",e,t),this._clearAcks()}_clearAcks(){Object.keys(this.acks).forEach(e=>{if(!this.sendBuffer.some(r=>String(r.id)===e)){let r=this.acks[e];delete this.acks[e],r.withError&&r.call(this,new Error("socket has been disconnected"))}})}onpacket(e){if(e.nsp===this.nsp)switch(e.type){case ae.CONNECT:e.data&&e.data.sid?this.onconnect(e.data.sid,e.data.pid):this.emitReserved("connect_error",new Error("It seems you are trying to reach a Socket.IO server in v2.x with a v3.x client, but they are not compatible (more information here: https://socket.io/docs/v3/migrating-from-2-x-to-3-0/)"));break;case ae.EVENT:case ae.BINARY_EVENT:this.onevent(e);break;case ae.ACK:case ae.BINARY_ACK:this.onack(e);break;case ae.DISCONNECT:this.ondisconnect();break;case ae.CONNECT_ERROR:this.destroy();let r=new Error(e.data.message);r.data=e.data.data,this.emitReserved("connect_error",r);break}}onevent(e){let t=e.data||[];e.id!=null&&t.push(this.ack(e.id)),this.connected?this.emitEvent(t):this.receiveBuffer.push(Object.freeze(t))}emitEvent(e){if(this._anyListeners&&this._anyListeners.length){let t=this._anyListeners.slice();for(let r of t)r.apply(this,e)}super.emit.apply(this,e),this._pid&&e.length&&typeof e[e.length-1]=="string"&&(this._lastOffset=e[e.length-1])}ack(e){let t=this,r=!1;return function(...i){r||(r=!0,t.packet({type:ae.ACK,id:e,data:i}))}}onack(e){let t=this.acks[e.id];typeof t=="function"&&(delete this.acks[e.id],t.withError&&e.data.unshift(null),t.apply(this,e.data))}onconnect(e,t){this.id=e,this.recovered=t&&this._pid===t,this._pid=t,this.connected=!0,this.emitBuffered(),this.emitReserved("connect"),this._drainQueue(!0)}emitBuffered(){this.receiveBuffer.forEach(e=>this.emitEvent(e)),this.receiveBuffer=[],this.sendBuffer.forEach(e=>{this.notifyOutgoingListeners(e),this.packet(e)}),this.sendBuffer=[]}ondisconnect(){this.destroy(),this.onclose("io server disconnect")}destroy(){this.subs&&(this.subs.forEach(e=>e()),this.subs=void 0),this.io._destroy(this)}disconnect(){return this.connected&&this.packet({type:ae.DISCONNECT}),this.destroy(),this.connected&&this.onclose("io client disconnect"),this}close(){return this.disconnect()}compress(e){return this.flags.compress=e,this}get volatile(){return this.flags.volatile=!0,this}timeout(e){return this.flags.timeout=e,this}onAny(e){return this._anyListeners=this._anyListeners||[],this._anyListeners.push(e),this}prependAny(e){return this._anyListeners=this._anyListeners||[],this._anyListeners.unshift(e),this}offAny(e){if(!this._anyListeners)return this;if(e){let t=this._anyListeners;for(let r=0;r<t.length;r++)if(e===t[r])return t.splice(r,1),this}else this._anyListeners=[];return this}listenersAny(){return this._anyListeners||[]}onAnyOutgoing(e){return this._anyOutgoingListeners=this._anyOutgoingListeners||[],this._anyOutgoingListeners.push(e),this}prependAnyOutgoing(e){return this._anyOutgoingListeners=this._anyOutgoingListeners||[],this._anyOutgoingListeners.unshift(e),this}offAnyOutgoing(e){if(!this._anyOutgoingListeners)return this;if(e){let t=this._anyOutgoingListeners;for(let r=0;r<t.length;r++)if(e===t[r])return t.splice(r,1),this}else this._anyOutgoingListeners=[];return this}listenersAnyOutgoing(){return this._anyOutgoingListeners||[]}notifyOutgoingListeners(e){if(this._anyOutgoingListeners&&this._anyOutgoingListeners.length){let t=this._anyOutgoingListeners.slice();for(let r of t)r.apply(this,e.data)}}};function xr(n){n=n||{},this.ms=n.min||100,this.max=n.max||1e4,this.factor=n.factor||2,this.jitter=n.jitter>0&&n.jitter<=1?n.jitter:0,this.attempts=0}xr.prototype.duration=function(){var n=this.ms*Math.pow(this.factor,this.attempts++);if(this.jitter){var e=Math.random(),t=Math.floor(e*this.jitter*n);n=(Math.floor(e*10)&1)==0?n-t:n+t}return Math.min(n,this.max)|0};xr.prototype.reset=function(){this.attempts=0};xr.prototype.setMin=function(n){this.ms=n};xr.prototype.setMax=function(n){this.max=n};xr.prototype.setJitter=function(n){this.jitter=n};var qr=class extends be{constructor(e,t){var r;super(),this.nsps={},this.subs=[],e&&typeof e=="object"&&(t=e,e=void 0),t=t||{},t.path=t.path||"/socket.io",this.opts=t,bn(this,t),this.reconnection(t.reconnection!==!1),this.reconnectionAttempts(t.reconnectionAttempts||1/0),this.reconnectionDelay(t.reconnectionDelay||1e3),this.reconnectionDelayMax(t.reconnectionDelayMax||5e3),this.randomizationFactor((r=t.randomizationFactor)!==null&&r!==void 0?r:.5),this.backoff=new xr({min:this.reconnectionDelay(),max:this.reconnectionDelayMax(),jitter:this.randomizationFactor()}),this.timeout(t.timeout==null?2e4:t.timeout),this._readyState="closed",this.uri=e;let i=t.parser||Uc;this.encoder=new i.Encoder,this.decoder=new i.Decoder,this._autoConnect=t.autoConnect!==!1,this._autoConnect&&this.open()}reconnection(e){return arguments.length?(this._reconnection=!!e,e||(this.skipReconnect=!0),this):this._reconnection}reconnectionAttempts(e){return e===void 0?this._reconnectionAttempts:(this._reconnectionAttempts=e,this)}reconnectionDelay(e){var t;return e===void 0?this._reconnectionDelay:(this._reconnectionDelay=e,(t=this.backoff)===null||t===void 0||t.setMin(e),this)}randomizationFactor(e){var t;return e===void 0?this._randomizationFactor:(this._randomizationFactor=e,(t=this.backoff)===null||t===void 0||t.setJitter(e),this)}reconnectionDelayMax(e){var t;return e===void 0?this._reconnectionDelayMax:(this._reconnectionDelayMax=e,(t=this.backoff)===null||t===void 0||t.setMax(e),this)}timeout(e){return arguments.length?(this._timeout=e,this):this._timeout}maybeReconnectOnOpen(){!this._reconnecting&&this._reconnection&&this.backoff.attempts===0&&this.reconnect()}open(e){if(~this._readyState.indexOf("open"))return this;this.engine=new Vr(this.uri,this.opts);let t=this.engine,r=this;this._readyState="opening",this.skipReconnect=!1;let i=xt(t,"open",function(){r.onopen(),e&&e()}),s=a=>{this.cleanup(),this._readyState="closed",this.emitReserved("error",a),e?e(a):this.maybeReconnectOnOpen()},o=xt(t,"error",s);if(this._timeout!==!1){let a=this._timeout,c=this.setTimeoutFn(()=>{i(),s(new Error("timeout")),t.close()},a);this.opts.autoUnref&&c.unref(),this.subs.push(()=>{this.clearTimeoutFn(c)})}return this.subs.push(i),this.subs.push(o),this}connect(e){return this.open(e)}onopen(){this.cleanup(),this._readyState="open",this.emitReserved("open");let e=this.engine;this.subs.push(xt(e,"ping",this.onping.bind(this)),xt(e,"data",this.ondata.bind(this)),xt(e,"error",this.onerror.bind(this)),xt(e,"close",this.onclose.bind(this)),xt(this.decoder,"decoded",this.ondecoded.bind(this)))}onping(){this.emitReserved("ping")}ondata(e){try{this.decoder.add(e)}catch(t){this.onclose("parse error",t)}}ondecoded(e){xn(()=>{this.emitReserved("packet",e)},this.setTimeoutFn)}onerror(e){this.emitReserved("error",e)}socket(e,t){let r=this.nsps[e];return r?this._autoConnect&&!r.active&&r.connect():(r=new $r(this,e,t),this.nsps[e]=r),r}_destroy(e){let t=Object.keys(this.nsps);for(let r of t)if(this.nsps[r].active)return;this._close()}_packet(e){let t=this.encoder.encode(e);for(let r=0;r<t.length;r++)this.engine.write(t[r],e.options)}cleanup(){this.subs.forEach(e=>e()),this.subs.length=0,this.decoder.destroy()}_close(){this.skipReconnect=!0,this._reconnecting=!1,this.onclose("forced close")}disconnect(){return this._close()}onclose(e,t){var r;this.cleanup(),(r=this.engine)===null||r===void 0||r.close(),this.backoff.reset(),this._readyState="closed",this.emitReserved("close",e,t),this._reconnection&&!this.skipReconnect&&this.reconnect()}reconnect(){if(this._reconnecting||this.skipReconnect)return this;let e=this;if(this.backoff.attempts>=this._reconnectionAttempts)this.backoff.reset(),this.emitReserved("reconnect_failed"),this._reconnecting=!1;else{let t=this.backoff.duration();this._reconnecting=!0;let r=this.setTimeoutFn(()=>{e.skipReconnect||(this.emitReserved("reconnect_attempt",e.backoff.attempts),!e.skipReconnect&&e.open(i=>{i?(e._reconnecting=!1,e.reconnect(),this.emitReserved("reconnect_error",i)):e.onreconnect()}))},t);this.opts.autoUnref&&r.unref(),this.subs.push(()=>{this.clearTimeoutFn(r)})}}onreconnect(){let e=this.backoff.attempts;this._reconnecting=!1,this.backoff.reset(),this.emitReserved("reconnect",e)}};var qi={};function zi(n,e){typeof n=="object"&&(e=n,n=void 0),e=e||{};let t=jd(n,e.path||"/socket.io"),r=t.source,i=t.id,s=t.path,o=qi[i]&&s in qi[i].nsps,a=e.forceNew||e["force new connection"]||e.multiplex===!1||o,c;return a?c=new qr(r,e):(qi[i]||(qi[i]=new qr(r,e)),c=qi[i]),t.query&&!e.query&&(e.query=t.queryKey),c.socket(t.path,e)}Object.assign(zi,{Manager:qr,Socket:$r,io:zi,connect:zi});var Wd={id:"socket.io",createTransport:(n,e)=>{let t=zi(n,{extraHeaders:e});return new Oc(t)}},Oc=class{socket;id="socket.io";onReconnectEmitter=new yt;onDisconnectEmitter=new yt;onErrorEmitter=new yt;disconnectTimeout;ready=new jt;get onDisconnect(){return this.onDisconnectEmitter.event}get onReconnect(){return this.onReconnectEmitter.event}get onError(){return this.onErrorEmitter.event}constructor(e){this.socket=e,this.socket.on("disconnect",(t,r)=>{this.ready=new jt,this.disconnectTimeout=setTimeout(()=>{this.onDisconnectEmitter.fire(),this.disconnectTimeout=void 0},3e4)}),this.socket.io.on("reconnect",()=>{this.disconnectTimeout&&(clearTimeout(this.disconnectTimeout),this.disconnectTimeout=void 0,this.ready.resolve()),this.onReconnectEmitter.fire()}),this.socket.on("error",()=>this.onErrorEmitter.fire("Websocket connection closed unexpectedly.")),this.socket.on("connect",()=>this.ready.resolve())}async write(e){await this.ready.promise.then(()=>this.socket.send(e))}read(e){this.socket.on("message",t=>e(t))}dispose(){this.onDisconnectEmitter.dispose(),this.socket.close()}};var ge;(function(n){function e(r){return Ce(r)&&typeof r.code=="string"&&typeof r.message=="string"&&Array.isArray(r.params)&&r.params.every(i=>typeof i=="string")}n.is=e;let t;(function(r){r.PerformingLogin="PerformingLogin",r.InvalidServerVersion="InvalidServerVersion",r.IncompatibleProtocolVersions="IncompatibleProtocolVersions",r.AwaitingServerResponse="AwaitingServerResponse",r.AuthTimeout="AuthTimeout",r.AuthInternalError="AuthInternalError",r.RoomNotFound="RoomNotFound",r.JoinRequestNotFound="JoinRequestNotFound",r.JoinTimeout="JoinTimeout",r.JoinRejected="JoinRejected",r.WaitingForHost="WaitingForHost",r.UnverifiedLoginLabel="UnverifiedLoginLabel",r.UnverifiedLoginDetails="UnverifiedLoginDetails",r.BuiltinsGroup="BuiltinsGroup",r.UsernameLabel="UsernameLabel",r.UsernamePlaceholder="UsernamePlaceholder",r.EmailLabel="EmailLabel",r.EmailPlaceholder="EmailPlaceholder",r.ThirdParty="ThirdParty",r.GitHubLabel="GitHubLabel",r.GoogleLabel="GoogleLabel"})(t=n.Codes||(n.Codes={}))})(ge||(ge={}));var Hn=class extends Error{code;params;constructor(e){super(e.message),this.code=e.code,this.params=e.params}};function Nc(n,e){return n instanceof Hn||ge.is(n)?e?e(n):n.message:n instanceof Error?n.message:String(n)}var Hd=n=>{md(n.cryptoModule)};var Z;(function(n){let e;(function(o){o.Join=new Ft("peer/join"),o.Info=new mn("peer/info"),o.Init=new mn("peer/init")})(e=n.Peer||(n.Peer={}));let t;(function(o){o.Joined=new It("room/joined"),o.Left=new It("room/left"),o.Leave=new mn("room/leave"),o.PermissionsUpdated=new It("room/permissionsUpdated"),o.Closed=new It("room/closed")})(t=n.Room||(n.Room={}));let r;(function(o){o.Open=new mn("editor/open"),o.Close=new It("editor/close")})(r=n.Editor||(n.Editor={}));let i;(function(o){o.DataUpdate=new It("sync/dataUpdate"),o.DataNotify=new mn("sync/dataNotify"),o.AwarenessUpdate=new It("sync/awarenessUpdate"),o.AwarenessQuery=new It("sync/awarenessQuery"),o.AwarenessNotify=new mn("sync/awarenessNotify")})(i=n.Sync||(n.Sync={}));let s;(function(o){o.Stat=new Ft("fileSystem/stat"),o.Mkdir=new Ft("fileSystem/mkdir"),o.ReadFile=new Ft("fileSystem/readFile"),o.WriteFile=new Ft("fileSystem/writeFile"),o.ReadDir=new Ft("fileSystem/readDir"),o.Delete=new Ft("fileSystem/delete"),o.Rename=new Ft("fileSystem/rename"),o.Change=new It("fileSystem/change")})(s=n.FileSystem||(n.FileSystem={}))})(Z||(Z={}));function Kd(n){return new Pc(n)}var so=()=>{},Pc=class extends Xs{room={onJoin:e=>this.onBroadcast(Z.Room.Joined,(t,r)=>{this.onDidJoinRoom(r),e(t,r)}),leave:()=>this.sendNotification(Z.Room.Leave,""),onLeave:e=>this.onBroadcast(Z.Room.Left,(t,r)=>{this.onDidLeaveRoom(r),e(t,r)}),onClose:e=>this.onBroadcast(Z.Room.Closed,t=>{this.onDidClose(),e(t)}),onPermissions:e=>this.onBroadcast(Z.Room.PermissionsUpdated,e),updatePermissions:e=>this.sendBroadcast(Z.Room.PermissionsUpdated,e)};peer={onJoinRequest:e=>this.onRequest(Z.Peer.Join,e),onInfo:e=>this.onNotification(Z.Peer.Info,e),onInit:e=>this.onNotification(Z.Peer.Init,async(t,r)=>{this.onDidInit(r),e(t,r)}),init:(e,t)=>this.sendNotification(Z.Peer.Init,e,t)};fs={onReadFile:e=>this.onRequest(Z.FileSystem.ReadFile,e),readFile:(e,t)=>this.sendRequest(Z.FileSystem.ReadFile,e,t),onWriteFile:e=>this.onRequest(Z.FileSystem.WriteFile,e),writeFile:(e,t,r)=>this.sendRequest(Z.FileSystem.WriteFile,e,t,r),onReaddir:e=>this.onRequest(Z.FileSystem.ReadDir,e),readdir:(e,t)=>this.sendRequest(Z.FileSystem.ReadDir,e,t),onStat:e=>this.onRequest(Z.FileSystem.Stat,e),stat:(e,t)=>this.sendRequest(Z.FileSystem.Stat,e,t),onMkdir:e=>this.onRequest(Z.FileSystem.Mkdir,e),mkdir:(e,t)=>this.sendRequest(Z.FileSystem.Mkdir,e,t),onDelete:e=>this.onRequest(Z.FileSystem.Delete,e),delete:(e,t)=>this.sendRequest(Z.FileSystem.Delete,e,t),onRename:e=>this.onRequest(Z.FileSystem.Rename,e),rename:(e,t,r)=>this.sendRequest(Z.FileSystem.Rename,e,t,r),onChange:e=>this.onBroadcast(Z.FileSystem.Change,e),change:e=>this.sendBroadcast(Z.FileSystem.Change,e)};editor={onOpen:e=>this.onNotification(Z.Editor.Open,e),open:(e,t)=>this.sendNotification(Z.Editor.Open,e,t),onClose:e=>this.onBroadcast(Z.Editor.Close,e),close:e=>this.sendBroadcast(Z.Editor.Close,e)};sync={onDataUpdate:e=>{this.onBroadcast(Z.Sync.DataUpdate,e),this.onNotification(Z.Sync.DataNotify,e)},dataUpdate:async(e,t)=>{typeof e=="object"?await this.sendBroadcast(Z.Sync.DataUpdate,e):await this.sendNotification(Z.Sync.DataNotify,e,t)},onAwarenessUpdate:e=>{this.onBroadcast(Z.Sync.AwarenessUpdate,e),this.onNotification(Z.Sync.AwarenessNotify,e)},awarenessUpdate:async(e,t)=>{typeof e=="object"?await this.sendBroadcast(Z.Sync.AwarenessUpdate,e):await this.sendNotification(Z.Sync.AwarenessNotify,e,t)},onAwarenessQuery:e=>this.onBroadcast(Z.Sync.AwarenessQuery,e),awarenessQuery:()=>this.sendBroadcast(Z.Sync.AwarenessQuery)};peers=new Map;constructor(e){super({privateKey:e.privateKey,transport:e.transport}),e.host?this.onDidJoinRoom(e.host):this.ready(),this.room.onJoin(so),this.room.onLeave(so),this.room.onClose(so),this.peer.onInit(so)}getPublicKey(e){let t=this.peers.get(e);if(t)return{peerId:t.id,publicKey:t.metadata.encryption.publicKey,supportedCompression:t.metadata.compression.supported};throw new Error("No public key found for origin "+e)}onDidJoinRoom(e){this.peers.set(e.id,e)}onDidLeaveRoom(e){this.peers.delete(e.id)}onDidClose(){this.peers.clear()}onDidInit(e){for(let t of[e.host,...e.guests])this.peers.set(t.id,t);this.ready()}getPublicKeys(){return Array.from(this.peers.values()).map(e=>({peerId:e.id,publicKey:e.metadata.encryption.publicKey,supportedCompression:e.metadata.compression.supported}))}getPublicKeysLength(){return this.peers.size}};var Mc=Fe(Va(),1);var Gi;(function(n){function e(r){return Ce(r)&&typeof r.roomId=="string"&&typeof r.roomToken=="string"}n.is=e;function t(r,i,s){return{roomId:r,roomToken:i,loginToken:s}}n.create=t})(Gi||(Gi={}));var oo;(function(n){function e(r){return Ce(r)&&typeof r.valid=="boolean"}n.is=e;function t(r){return{valid:r}}n.create=t})(oo||(oo={}));var ao;(function(n){function e(r){return Ce(r)&&typeof r.pollToken=="string"&&typeof r.auth=="object"}n.is=e;function t(r,i){return{pollToken:r,auth:i}}n.create=t})(ao||(ao={}));var co;(function(n){function e(r){return Ce(r)&&(typeof r.loginToken>"u"||typeof r.loginToken=="string")}n.is=e;function t(r){return{loginToken:r}}n.create=t})(co||(co={}));var lo;(function(n){function e(r){return Ce(r)&&typeof r.pollToken=="string"&&typeof r.roomId=="string"}n.is=e;function t(r,i){return{pollToken:r,roomId:i}}n.create=t})(lo||(lo={}));var uo;(function(n){function e(r){return Ce(r)&&typeof r.roomId=="string"&&typeof r.roomToken=="string"&&typeof r.workspace=="object"&&typeof r.host=="object"}n.is=e;function t(r,i,s,o){return{roomId:r,roomToken:i,workspace:s,host:o}}n.create=t})(uo||(uo={}));var ho;(function(n){function e(r){return Lc.is(r)&&typeof r.failure=="boolean"}n.is=e;function t(r,i,s,o){return{code:r,params:i,message:s,failure:o}}n.create=t})(ho||(ho={}));var Lc;(function(n){function e(r){return Ce(r)&&typeof r.code=="string"&&Array.isArray(r.params)&&r.params.every(i=>typeof i=="string")&&typeof r.message=="string"}n.is=e;function t(r,i,s){return{code:r,params:i,message:s}}n.create=t})(Lc||(Lc={}));var Jd;(function(n){n[n.Readonly=1]="Readonly"})(Jd||(Jd={}));var Wi;(function(n){n[n.Unknown=0]="Unknown",n[n.File=1]="File",n[n.Directory=2]="Directory",n[n.SymbolicLink=64]="SymbolicLink"})(Wi||(Wi={}));var Sn;(function(n){n[n.Create=0]="Create",n[n.Update=1]="Update",n[n.Delete=2]="Delete"})(Sn||(Sn={}));var Hi;(function(n){function e(t){if(!t)return!1;let r=t;return Array.isArray(r.textSelections)}n.is=e})(Hi||(Hi={}));var Kn;(function(n){n.LeftToRight=1,n.RightToLeft=2})(Kn||(Kn={}));var fo;(function(n){function e(r){return r&&typeof r.line=="number"&&typeof r.character=="number"}n.is=e;function t(r,i){return{line:r,character:i}}n.create=t})(fo||(fo={}));var Yd;(function(n){function e(r){return r&&fo.is(r.start)&&fo.is(r.end)}n.is=e;function t(r,i){return{start:r,end:i}}n.create=t})(Yd||(Yd={}));var po=class{options;fetch;protocolVersion;constructor(e){if(this.options=e,this.fetch=e.fetch,this.userAuthToken=e.userToken,e.protocolVersion){let t=Mc.parse(e.protocolVersion);if(!t)throw new Error("Invalid protocol version provided: "+e.protocolVersion);this.protocolVersion=t}else this.protocolVersion=$a}userAuthToken;roomAuthToken;get authToken(){return this.userAuthToken}getUrl(e){let t=this.options.url;return t.endsWith("/")&&(t=t.slice(0,-1)),e.startsWith("/")&&(e=e.slice(1)),`${t}/${e}`}async login(e){e.reporter?.({code:"PerformingLogin",params:[],message:"Performing login"});let t=await this.fetch(this.getUrl("/api/login/initial"),{signal:e.abortSignal,method:"POST"});if(!t.ok)throw new Error("Failed to get login URL");let r=await t.json();if(!ao.is(r))throw new Error("Invalid login response");let i=r.pollToken,s=r.auth.loginPageUrl,o=s?.startsWith("/")?this.getUrl(s):s,a=new AbortController,c=this.mergeAbortSignals(e.abortSignal,a.signal);this.options.authenticationHandler(i,{...r.auth,loginPageUrl:o}).then(l=>{l||a.abort()},()=>a.abort());let u=await this.pollLogin(i,{...e,abortSignal:c});return this.userAuthToken=u,u}async pollLogin(e,t){for(;;){let r=await this.fetch(this.getUrl(`/api/login/poll/${e}`),{signal:t.abortSignal,method:"POST"});if(r.ok)try{let i=await r.json();if(co.is(i)&&i.loginToken)return i.loginToken}catch{}else throw await this.readError(r)}}async ensureCompatibility(){let e=await this.getMetaData(),t=Mc.parse(e.version);if(!t)throw new Hn({code:"InvalidServerVersion",message:"Invalid protocol version returned by server: "+e.version,params:[e.version]});if(!Af(t,this.protocolVersion))throw new Hn({code:"IncompatibleProtocolVersions",message:`Incompatible protocol versions: client ${this.protocolVersion.format()}, server ${t.format()}`,params:[this.protocolVersion.format(),t.format()]})}async validate(){if(this.userAuthToken)try{let t=await(await this.fetch(this.getUrl("/api/login/validate"),{method:"POST",headers:{"x-oct-jwt":this.userAuthToken}})).json();if(oo.is(t))return t.valid}catch{return!1}return!1}async createRoom(e){await this.ensureCompatibility();let t=await this.validate(),r;t||(r=await this.login({abortSignal:e.abortSignal,reporter:e.reporter})),e.reporter?.({code:"AwaitingServerResponse",params:[],message:"Awaiting server response"});let i=await this.fetch(this.getUrl("/api/session/create"),{method:"POST",signal:e.abortSignal,headers:{"x-oct-jwt":this.userAuthToken}});if(!i.ok)throw await this.readError(i);let s=await i.json();if(!Gi.is(s))throw new Error("Invalid create room response");return Gi.create(s.roomId,s.roomToken,r)}async joinRoom(e){await this.ensureCompatibility();let t=await this.validate(),r;t||(r=await this.login({abortSignal:e.abortSignal,reporter:e.reporter})),e.reporter?.({code:"AwaitingServerResponse",params:[],message:"Awaiting server response"});let i=await this.fetch(this.getUrl(`/api/session/join/${e.roomId}`),{method:"POST",signal:e.abortSignal,headers:{"x-oct-jwt":this.userAuthToken}});if(!i.ok)throw await this.readError(i);let s=await i.json();if(!lo.is(s))throw new Error("Invalid join room response");let o=s.pollToken,a=await this.pollJoin(o,e);return{loginToken:r,roomId:a.roomId,roomToken:a.roomToken,workspace:a.workspace,host:a.host}}async pollJoin(e,t){for(;;){let r=await this.fetch(this.getUrl(`/api/session/poll/${e}`),{method:"POST",signal:t.abortSignal,headers:{"x-oct-jwt":this.userAuthToken}});if(r.ok){let i=await r.json();if(ho.is(i)){if(i.failure)throw new Hn({code:i.code,params:i.params,message:i.message});t.reporter?.(i)}else{if(uo.is(i))return i;throw new Error("Received invalid join room poll response")}}else throw await this.readError(r)}}async readError(e){try{let t=await e.text();try{let r=JSON.parse(t);return ge.is(r)?new Hn(r):new Error(t)}catch{return new Error(t)}}catch{return new Error("Unknown error")}}async connect(e,t){let r=await this.getMetaData(),i=this.findFitting(r.transports,this.options.transports.map(u=>u.id)),s=this.options.transports[i],o=await ot.generateKeyPair(),a=s.createTransport(this.options.url,{"x-oct-jwt":e,"x-oct-public-key":o.publicKey,"x-oct-client":this.options.client??"Unknown OCT JS Client","x-oct-compression":"gzip"});return Kd({privateKey:o.privateKey,transport:a,host:t})}async getMetaData(){let e=await this.fetch(this.getUrl("/api/meta"));if(!e.ok)throw new Error("Failed to fetch metadata");return await e.json()}findFitting(e,t){let r=new Set(e);for(let i=0;i<t.length;i++)if(r.has(t[i]))return i;return-1}mergeAbortSignals(...e){let t=new AbortController;for(let r of e)if(r){if(r.aborted)return r;r.addEventListener("abort",()=>{t.abort()})}return t.signal}};var R=Fe(require("vscode"));var Je=()=>new Map,go=n=>{let e=Je();return n.forEach((t,r)=>{e.set(r,t)}),e},zt=(n,e,t)=>{let r=n.get(e);return r===void 0&&n.set(e,r=t()),r},Xd=(n,e)=>{let t=[];for(let[r,i]of n)t.push(e(i,r));return t},Qd=(n,e)=>{for(let[t,r]of n)if(e(r,t))return!0;return!1};var sn=()=>new Set;var mo=n=>n[n.length-1];var Zd=(n,e)=>{for(let t=0;t<e.length;t++)n.push(e[t])},Gt=Array.from;var Fc=Array.isArray;var zr=class{constructor(){this._observers=Je()}on(e,t){return zt(this._observers,e,sn).add(t),t}once(e,t){let r=(...i)=>{this.off(e,r),t(...i)};this.on(e,r)}off(e,t){let r=this._observers.get(e);r!==void 0&&(r.delete(t),r.size===0&&this._observers.delete(e))}emit(e,t){return Gt((this._observers.get(e)||Je()).values()).forEach(r=>r(...t))}destroy(){this._observers=Je()}},yo=class{constructor(){this._observers=Je()}on(e,t){zt(this._observers,e,sn).add(t)}once(e,t){let r=(...i)=>{this.off(e,r),t(...i)};this.on(e,r)}off(e,t){let r=this._observers.get(e);r!==void 0&&(r.delete(t),r.size===0&&this._observers.delete(e))}emit(e,t){return Gt((this._observers.get(e)||Je()).values()).forEach(r=>r(...t))}destroy(){this._observers=Je()}};var dt=Math.floor;var Gr=Math.abs;var wo=(n,e)=>n<e?n:e,kn=(n,e)=>n>e?n:e,L1=Number.isNaN;var vo=n=>n!==0?n<0:1/n<0;var Vc=Number.MAX_SAFE_INTEGER,M1=Number.MIN_SAFE_INTEGER,B1=1<<31;var ep=Number.isInteger||(n=>typeof n=="number"&&isFinite(n)&&dt(n)===n),F1=Number.isNaN,j1=Number.parseInt;var jx=String.fromCharCode,V1=String.fromCodePoint,$1=jx(65535),Vx=n=>n.toLowerCase(),$x=/^\s*/g,qx=n=>n.replace($x,""),zx=/([A-Z])/g,$c=(n,e)=>qx(n.replace(zx,t=>`${e}${Vx(t)}`));var Gx=n=>{let e=unescape(encodeURIComponent(n)),t=e.length,r=new Uint8Array(t);for(let i=0;i<t;i++)r[i]=e.codePointAt(i);return r},Hr=typeof TextEncoder<"u"?new TextEncoder:null,Wx=n=>Hr.encode(n),np=Hr?Wx:Gx;var Wr=typeof TextDecoder>"u"?null:new TextDecoder("utf-8",{fatal:!0,ignoreBOM:!0});Wr&&Wr.decode(new Uint8Array).length===1&&(Wr=null);var br=class{constructor(){this.cpos=0,this.cbuf=new Uint8Array(100),this.bufs=[]}},et=()=>new br;var Hx=n=>{let e=n.cpos;for(let t=0;t<n.bufs.length;t++)e+=n.bufs[t].length;return e};var ct=n=>{let e=new Uint8Array(Hx(n)),t=0;for(let r=0;r<n.bufs.length;r++){let i=n.bufs[r];e.set(i,t),t+=i.length}return e.set(new Uint8Array(n.cbuf.buffer,0,n.cpos),t),e},Kx=(n,e)=>{let t=n.cbuf.length;t-n.cpos<e&&(n.bufs.push(new Uint8Array(n.cbuf.buffer,0,n.cpos)),n.cbuf=new Uint8Array(kn(t,e)*2),n.cpos=0)},Ye=(n,e)=>{let t=n.cbuf.length;n.cpos===t&&(n.bufs.push(n.cbuf),n.cbuf=new Uint8Array(t*2),n.cpos=0),n.cbuf[n.cpos++]=e};var bo=Ye;var K=(n,e)=>{for(;e>127;)Ye(n,128|127&e),e=dt(e/128);Ye(n,127&e)},Eo=(n,e)=>{let t=vo(e);for(t&&(e=-e),Ye(n,(e>63?128:0)|(t?64:0)|63&e),e=dt(e/64);e>0;)Ye(n,(e>127?128:0)|127&e),e=dt(e/128)},zc=new Uint8Array(3e4),Jx=zc.length/3,Yx=(n,e)=>{if(e.length<Jx){let t=Hr.encodeInto(e,zc).written||0;K(n,t);for(let r=0;r<t;r++)Ye(n,zc[r])}else De(n,np(e))},Xx=(n,e)=>{let t=unescape(encodeURIComponent(e)),r=t.length;K(n,r);for(let i=0;i<r;i++)Ye(n,t.codePointAt(i))},_n=Hr&&Hr.encodeInto?Yx:Xx;var Xi=(n,e)=>{let t=n.cbuf.length,r=n.cpos,i=wo(t-r,e.length),s=e.length-i;n.cbuf.set(e.subarray(0,i),r),n.cpos+=i,s>0&&(n.bufs.push(n.cbuf),n.cbuf=new Uint8Array(kn(t*2,s)),n.cbuf.set(e.subarray(i)),n.cpos=s)},De=(n,e)=>{K(n,e.byteLength),Xi(n,e)},Gc=(n,e)=>{Kx(n,e);let t=new DataView(n.cbuf.buffer,n.cpos,e);return n.cpos+=e,t},Qx=(n,e)=>Gc(n,4).setFloat32(0,e,!1),Zx=(n,e)=>Gc(n,8).setFloat64(0,e,!1),eb=(n,e)=>Gc(n,8).setBigInt64(0,e,!1);var ip=new DataView(new ArrayBuffer(4)),tb=n=>(ip.setFloat32(0,n),ip.getFloat32(0)===n),Jr=(n,e)=>{switch(typeof e){case"string":Ye(n,119),_n(n,e);break;case"number":ep(e)&&Gr(e)<=2147483647?(Ye(n,125),Eo(n,e)):tb(e)?(Ye(n,124),Qx(n,e)):(Ye(n,123),Zx(n,e));break;case"bigint":Ye(n,122),eb(n,e);break;case"object":if(e===null)Ye(n,126);else if(Fc(e)){Ye(n,117),K(n,e.length);for(let t=0;t<e.length;t++)Jr(n,e[t])}else if(e instanceof Uint8Array)Ye(n,116),De(n,e);else{Ye(n,118);let t=Object.keys(e);K(n,t.length);for(let r=0;r<t.length;r++){let i=t[r];_n(n,i),Jr(n,e[i])}}break;case"boolean":Ye(n,e?120:121);break;default:Ye(n,127)}},Yi=class extends br{constructor(e){super(),this.w=e,this.s=null,this.count=0}write(e){this.s===e?this.count++:(this.count>0&&K(this,this.count-1),this.count=1,this.w(this,e),this.s=e)}};var sp=n=>{n.count>0&&(Eo(n.encoder,n.count===1?n.s:-n.s),n.count>1&&K(n.encoder,n.count-2))},Er=class{constructor(){this.encoder=new br,this.s=0,this.count=0}write(e){this.s===e?this.count++:(sp(this),this.count=1,this.s=e)}toUint8Array(){return sp(this),ct(this.encoder)}};var op=n=>{if(n.count>0){let e=n.diff*2+(n.count===1?0:1);Eo(n.encoder,e),n.count>1&&K(n.encoder,n.count-2)}},Yr=class{constructor(){this.encoder=new br,this.s=0,this.count=0,this.diff=0}write(e){this.diff===e-this.s?(this.s=e,this.count++):(op(this),this.count=1,this.diff=e-this.s,this.s=e)}toUint8Array(){return op(this),ct(this.encoder)}},xo=class{constructor(){this.sarr=[],this.s="",this.lensE=new Er}write(e){this.s+=e,this.s.length>19&&(this.sarr.push(this.s),this.s=""),this.lensE.write(e.length)}toUint8Array(){let e=new br;return this.sarr.push(this.s),this.s="",_n(e,this.sarr.join("")),Xi(e,this.lensE.toUint8Array()),ct(e)}};var on=n=>new Error(n),Wt=()=>{throw on("Method unimplemented")},Nt=()=>{throw on("Unexpected case")};var cp=on("Unexpected end of array"),lp=on("Integer out of Range"),Xr=class{constructor(e){this.arr=e,this.pos=0}},Ht=n=>new Xr(n),up=n=>n.pos!==n.arr.length;var nb=(n,e)=>{let t=new Uint8Array(n.arr.buffer,n.pos+n.arr.byteOffset,e);return n.pos+=e,t},$e=n=>nb(n,J(n));var Sr=n=>n.arr[n.pos++];var J=n=>{let e=0,t=1,r=n.arr.length;for(;n.pos<r;){let i=n.arr[n.pos++];if(e=e+(i&127)*t,t*=128,i<128)return e;if(e>Vc)throw lp}throw cp},_o=n=>{let e=n.arr[n.pos++],t=e&63,r=64,i=(e&64)>0?-1:1;if((e&128)===0)return i*t;let s=n.arr.length;for(;n.pos<s;){if(e=n.arr[n.pos++],t=t+(e&127)*r,r*=128,e<128)return i*t;if(t>Vc)throw lp}throw cp};var rb=n=>{let e=J(n);if(e===0)return"";{let t=String.fromCodePoint(Sr(n));if(--e<100)for(;e--;)t+=String.fromCodePoint(Sr(n));else for(;e>0;){let r=e<1e4?e:1e4,i=n.arr.subarray(n.pos,n.pos+r);n.pos+=r,t+=String.fromCodePoint.apply(null,i),e-=r}return decodeURIComponent(escape(t))}},ib=n=>Wr.decode($e(n)),An=Wr?ib:rb;var Wc=(n,e)=>{let t=new DataView(n.arr.buffer,n.arr.byteOffset+n.pos,e);return n.pos+=e,t},sb=n=>Wc(n,4).getFloat32(0,!1),ob=n=>Wc(n,8).getFloat64(0,!1),ab=n=>Wc(n,8).getBigInt64(0,!1);var cb=[n=>{},n=>null,_o,sb,ob,ab,n=>!1,n=>!0,An,n=>{let e=J(n),t={};for(let r=0;r<e;r++){let i=An(n);t[i]=Qr(n)}return t},n=>{let e=J(n),t=[];for(let r=0;r<e;r++)t.push(Qr(n));return t},$e],Qr=n=>cb[127-Sr(n)](n),Qi=class extends Xr{constructor(e,t){super(e),this.reader=t,this.s=null,this.count=0}read(){return this.count===0&&(this.s=this.reader(this),up(this)?this.count=J(this)+1:this.count=-1),this.count--,this.s}};var kr=class extends Xr{constructor(e){super(e),this.s=0,this.count=0}read(){if(this.count===0){this.s=_o(this);let e=vo(this.s);this.count=1,e&&(this.s=-this.s,this.count=J(this)+2)}return this.count--,this.s}};var Zr=class extends Xr{constructor(e){super(e),this.s=0,this.count=0,this.diff=0}read(){if(this.count===0){let e=_o(this),t=e&1;this.diff=dt(e/2),this.count=1,t&&(this.count=J(this)+2)}return this.s+=this.diff,this.count--,this.s}},ko=class{constructor(e){this.decoder=new kr(e),this.str=An(this.decoder),this.spos=0}read(){let e=this.spos+this.decoder.read(),t=this.str.slice(this.spos,e);return this.spos=e,t}};var G1=crypto.subtle,hp=crypto.getRandomValues.bind(crypto);var Hc=()=>hp(new Uint32Array(1))[0];var lb="10000000-1000-4000-8000"+-1e11,fp=()=>lb.replace(/[018]/g,n=>(n^Hc()&15>>n/4).toString(16));var _r=Date.now;var Kc=n=>new Promise(n);var K1=Promise.all.bind(Promise);var Jc=n=>n===void 0?null:n;var Yc=class{constructor(){this.map=new Map}setItem(e,t){this.map.set(e,t)}getItem(e){return this.map.get(e)}},pp=new Yc,db=!0;try{typeof localStorage<"u"&&localStorage&&(pp=localStorage,db=!1)}catch{}var gp=pp;var yp=Object.assign,wp=Object.keys,vp=(n,e)=>{for(let t in n)e(n[t],t)};var Xc=n=>wp(n).length,mp=n=>wp(n).length;var xp=n=>{for(let e in n)return!1;return!0},gb=(n,e)=>{for(let t in n)if(!e(n[t],t))return!1;return!0},Qc=(n,e)=>Object.prototype.hasOwnProperty.call(n,e),Zc=(n,e)=>n===e||mp(n)===mp(e)&&gb(n,(t,r)=>(t!==void 0||Qc(e,r))&&e[r]===t),mb=Object.freeze,el=n=>{for(let e in n){let t=n[e];(typeof t=="object"||typeof t=="function")&&el(n[e])}return mb(n)};var Zi=(n,e,t=0)=>{try{for(;t<n.length;t++)n[t](...e)}finally{t<n.length&&Zi(n,e,t+1)}};var Ep=n=>n,yb=(n,e)=>n===e;var ei=(n,e)=>{if(n==null||e==null)return yb(n,e);if(n.constructor!==e.constructor)return!1;if(n===e)return!0;switch(n.constructor){case ArrayBuffer:n=new Uint8Array(n),e=new Uint8Array(e);case Uint8Array:{if(n.byteLength!==e.byteLength)return!1;for(let t=0;t<n.length;t++)if(n[t]!==e[t])return!1;break}case Set:{if(n.size!==e.size)return!1;for(let t of n)if(!e.has(t))return!1;break}case Map:{if(n.size!==e.size)return!1;for(let t of n.keys())if(!e.has(t)||!ei(n.get(t),e.get(t)))return!1;break}case Object:if(Xc(n)!==Xc(e))return!1;for(let t in n)if(!Qc(n,t)||!ei(n[t],e[t]))return!1;break;case Array:if(n.length!==e.length)return!1;for(let t=0;t<n.length;t++)if(!ei(n[t],e[t]))return!1;break;default:return!1}return!0},Sp=(n,e)=>e.includes(n);var es=typeof process<"u"&&process.release&&/node|io\.js/.test(process.release.name)&&Object.prototype.toString.call(typeof process<"u"?process:0)==="[object process]";var J1=typeof navigator<"u"?/Mac/.test(navigator.platform):!1,an,wb=[],vb=()=>{if(an===void 0)if(es){an=Je();let n=process.argv,e=null;for(let t=0;t<n.length;t++){let r=n[t];r[0]==="-"?(e!==null&&an.set(e,""),e=r):e!==null?(an.set(e,r),e=null):wb.push(r)}e!==null&&an.set(e,"")}else typeof location=="object"?(an=Je(),(location.search||"?").slice(1).split("&").forEach(n=>{if(n.length!==0){let[e,t]=n.split("=");an.set(`--${$c(e,"-")}`,t),an.set(`-${$c(e,"-")}`,t)}})):an=Je();return an},nl=n=>vb().has(n);var ts=n=>es?Jc(process.env[n.toUpperCase().replaceAll("-","_")]):Jc(gp.getItem(n));var kp=n=>nl("--"+n)||ts(n)!==null,Y1=kp("production"),xb=es&&Sp(process.env.FORCE_COLOR,["true","1","2"]),_p=xb||!nl("--no-colors")&&!kp("no-color")&&(!es||process.stdout.isTTY)&&(!es||nl("--color")||ts("COLORTERM")!==null||(ts("TERM")||"").includes("color"));var bb=n=>new Uint8Array(n);var Tp=n=>{let e=bb(n.byteLength);return e.set(n),e};var rl=class{constructor(e,t){this.left=e,this.right=t}},cn=(n,e)=>new rl(n,e);var Ar=typeof document<"u"?document:{};var X1=typeof DOMParser<"u"?new DOMParser:null;var Cp=n=>Xd(n,(e,t)=>`${t}:${e};`).join("");var Q1=Ar.ELEMENT_NODE,Z1=Ar.TEXT_NODE,eC=Ar.CDATA_SECTION_NODE,tC=Ar.COMMENT_NODE,nC=Ar.DOCUMENT_NODE,rC=Ar.DOCUMENT_TYPE_NODE,iC=Ar.DOCUMENT_FRAGMENT_NODE;var ln=Symbol;var ns=ln(),rs=ln(),il=ln(),sl=ln(),ol=ln(),is=ln(),al=ln(),ti=ln(),cl=ln(),Ip=n=>{n.length===1&&n[0]?.constructor===Function&&(n=n[0]());let e=[],t=[],r=0;for(;r<n.length;r++){let i=n[r];if(i===void 0)break;if(i.constructor===String||i.constructor===Number)e.push(i);else if(i.constructor===Object)break}for(r>0&&t.push(e.join(""));r<n.length;r++){let i=n[r];i instanceof Symbol||t.push(i)}return t};var sC=_r();var Tb={[ns]:cn("font-weight","bold"),[rs]:cn("font-weight","normal"),[il]:cn("color","blue"),[ol]:cn("color","green"),[sl]:cn("color","grey"),[is]:cn("color","red"),[al]:cn("color","purple"),[ti]:cn("color","orange"),[cl]:cn("color","black")},Cb=n=>{n.length===1&&n[0]?.constructor===Function&&(n=n[0]());let e=[],t=[],r=Je(),i=[],s=0;for(;s<n.length;s++){let o=n[s],a=Tb[o];if(a!==void 0)r.set(a.left,a.right);else{if(o===void 0)break;if(o.constructor===String||o.constructor===Number){let c=Cp(r);s>0||c.length>0?(e.push("%c"+o),t.push(c)):e.push(o)}else break}}for(s>0&&(i=t,i.unshift(e.join("")));s<n.length;s++){let o=n[s];o instanceof Symbol||i.push(o)}return i},Rp=_p?Cb:Ip,Dp=(...n)=>{console.log(...Rp(n)),Op.forEach(e=>e.print(n))},Up=(...n)=>{console.warn(...Rp(n)),n.unshift(ti),Op.forEach(e=>e.print(n))};var Op=sn();var Np=n=>({[Symbol.iterator](){return this},next:n}),Pp=(n,e)=>Np(()=>{let t;do t=n.next();while(!t.done&&!e(t.value));return t}),To=(n,e)=>Np(()=>{let{done:t,value:r}=n.next();return{done:t,value:t?void 0:e(r)}});var os=class{constructor(e,t){this.clock=e,this.len=t}},Tr=class{constructor(){this.clients=new Map}},Yp=(n,e,t)=>e.clients.forEach((r,i)=>{let s=n.doc.store.clients.get(i);for(let o=0;o<r.length;o++){let a=r[o];lg(n,s,a.clock,a.len,t)}}),Ob=(n,e)=>{let t=0,r=n.length-1;for(;t<=r;){let i=dt((t+r)/2),s=n[i],o=s.clock;if(o<=e){if(e<o+s.len)return i;t=i+1}else r=i-1}return null},Xp=(n,e)=>{let t=n.clients.get(e.client);return t!==void 0&&Ob(t,e.clock)!==null},Tl=n=>{n.clients.forEach(e=>{e.sort((i,s)=>i.clock-s.clock);let t,r;for(t=1,r=1;t<e.length;t++){let i=e[r-1],s=e[t];i.clock+i.len>=s.clock?i.len=kn(i.len,s.clock+s.len-i.clock):(r<t&&(e[r]=s),r++)}e.length=r})},Nb=n=>{let e=new Tr;for(let t=0;t<n.length;t++)n[t].clients.forEach((r,i)=>{if(!e.clients.has(i)){let s=r.slice();for(let o=t+1;o<n.length;o++)Zd(s,n[o].clients.get(i)||[]);e.clients.set(i,s)}});return Tl(e),e},No=(n,e,t,r)=>{zt(n.clients,e,()=>[]).push(new os(t,r))},Qp=()=>new Tr,Pb=n=>{let e=Qp();return n.clients.forEach((t,r)=>{let i=[];for(let s=0;s<t.length;s++){let o=t[s];if(o.deleted){let a=o.id.clock,c=o.length;if(s+1<t.length)for(let u=t[s+1];s+1<t.length&&u.deleted;u=t[++s+1])c+=u.length;i.push(new os(a,c))}}i.length>0&&e.clients.set(r,i)}),e},ai=(n,e)=>{K(n.restEncoder,e.clients.size),Gt(e.clients.entries()).sort((t,r)=>r[0]-t[0]).forEach(([t,r])=>{n.resetDsCurVal(),K(n.restEncoder,t);let i=r.length;K(n.restEncoder,i);for(let s=0;s<i;s++){let o=r[s];n.writeDsClock(o.clock),n.writeDsLen(o.len)}})},Cl=n=>{let e=new Tr,t=J(n.restDecoder);for(let r=0;r<t;r++){n.resetDsCurVal();let i=J(n.restDecoder),s=J(n.restDecoder);if(s>0){let o=zt(e.clients,i,()=>[]);for(let a=0;a<s;a++)o.push(new os(n.readDsClock(),n.readDsLen()))}}return e},Bp=(n,e,t)=>{let r=new Tr,i=J(n.restDecoder);for(let s=0;s<i;s++){n.resetDsCurVal();let o=J(n.restDecoder),a=J(n.restDecoder),c=t.clients.get(o)||[],u=je(t,o);for(let l=0;l<a;l++){let h=n.readDsClock(),f=h+n.readDsLen();if(h<u){u<f&&No(r,o,u,f-u);let d=un(c,h),x=c[d];for(!x.deleted&&x.id.clock<h&&(c.splice(d+1,0,Go(e,x,h-x.id.clock)),d++);d<c.length&&(x=c[d++],x.id.clock<f);)x.deleted||(f<x.id.clock+x.length&&c.splice(d,0,Go(e,x,f-x.id.clock)),x.delete(e))}else No(r,o,h,f-h)}}if(r.clients.size>0){let s=new Tn;return K(s.restEncoder,0),ai(s,r),s.toUint8Array()}return null};var Zp=Hc,Cr=class n extends zr{constructor({guid:e=fp(),collectionid:t=null,gc:r=!0,gcFilter:i=()=>!0,meta:s=null,autoLoad:o=!1,shouldLoad:a=!0}={}){super(),this.gc=r,this.gcFilter=i,this.clientID=Zp(),this.guid=e,this.collectionid=t,this.share=new Map,this.store=new Fo,this._transaction=null,this._transactionCleanups=[],this.subdocs=new Set,this._item=null,this.shouldLoad=a,this.autoLoad=o,this.meta=s,this.isLoaded=!1,this.isSynced=!1,this.isDestroyed=!1,this.whenLoaded=Kc(u=>{this.on("load",()=>{this.isLoaded=!0,u(this)})});let c=()=>Kc(u=>{let l=h=>{(h===void 0||h===!0)&&(this.off("sync",l),u())};this.on("sync",l)});this.on("sync",u=>{u===!1&&this.isSynced&&(this.whenSynced=c()),this.isSynced=u===void 0||u===!0,this.isSynced&&!this.isLoaded&&this.emit("load",[this])}),this.whenSynced=c()}load(){let e=this._item;e!==null&&!this.shouldLoad&&Ee(e.parent.doc,t=>{t.subdocsLoaded.add(this)},null,!0),this.shouldLoad=!0}getSubdocs(){return this.subdocs}getSubdocGuids(){return new Set(Gt(this.subdocs).map(e=>e.guid))}transact(e,t=null){return Ee(this,e,t)}get(e,t=qe){let r=zt(this.share,e,()=>{let s=new t;return s._integrate(this,null),s}),i=r.constructor;if(t!==qe&&i!==t)if(i===qe){let s=new t;s._map=r._map,r._map.forEach(o=>{for(;o!==null;o=o.left)o.parent=s}),s._start=r._start;for(let o=s._start;o!==null;o=o.right)o.parent=s;return s._length=r._length,this.share.set(e,s),s._integrate(this,null),s}else throw new Error(`Type with the name ${e} has already been defined with a different constructor`);return r}getArray(e=""){return this.get(e,qo)}getText(e=""){return this.get(e,ds)}getMap(e=""){return this.get(e,hs)}getXmlElement(e=""){return this.get(e,ps)}getXmlFragment(e=""){return this.get(e,si)}toJSON(){let e={};return this.share.forEach((t,r)=>{e[r]=t.toJSON()}),e}destroy(){this.isDestroyed=!0,Gt(this.subdocs).forEach(t=>t.destroy());let e=this._item;if(e!==null){this._item=null;let t=e.content;t.doc=new n({guid:this.guid,...t.opts,shouldLoad:!1}),t.doc._item=e,Ee(e.parent.doc,r=>{let i=t.doc;e.deleted||r.subdocsAdded.add(i),r.subdocsRemoved.add(this)},null,!0)}this.emit("destroyed",[!0]),this.emit("destroy",[this]),super.destroy()}},Po=class{constructor(e){this.restDecoder=e}resetDsCurVal(){}readDsClock(){return J(this.restDecoder)}readDsLen(){return J(this.restDecoder)}},Lo=class extends Po{readLeftID(){return re(J(this.restDecoder),J(this.restDecoder))}readRightID(){return re(J(this.restDecoder),J(this.restDecoder))}readClient(){return J(this.restDecoder)}readInfo(){return Sr(this.restDecoder)}readString(){return An(this.restDecoder)}readParentInfo(){return J(this.restDecoder)===1}readTypeRef(){return J(this.restDecoder)}readLen(){return J(this.restDecoder)}readAny(){return Qr(this.restDecoder)}readBuf(){return Tp($e(this.restDecoder))}readJSON(){return JSON.parse(An(this.restDecoder))}readKey(){return An(this.restDecoder)}},ul=class{constructor(e){this.dsCurrVal=0,this.restDecoder=e}resetDsCurVal(){this.dsCurrVal=0}readDsClock(){return this.dsCurrVal+=J(this.restDecoder),this.dsCurrVal}readDsLen(){let e=J(this.restDecoder)+1;return this.dsCurrVal+=e,e}},Zn=class extends ul{constructor(e){super(e),this.keys=[],J(e),this.keyClockDecoder=new Zr($e(e)),this.clientDecoder=new kr($e(e)),this.leftClockDecoder=new Zr($e(e)),this.rightClockDecoder=new Zr($e(e)),this.infoDecoder=new Qi($e(e),Sr),this.stringDecoder=new ko($e(e)),this.parentInfoDecoder=new Qi($e(e),Sr),this.typeRefDecoder=new kr($e(e)),this.lenDecoder=new kr($e(e))}readLeftID(){return new Qn(this.clientDecoder.read(),this.leftClockDecoder.read())}readRightID(){return new Qn(this.clientDecoder.read(),this.rightClockDecoder.read())}readClient(){return this.clientDecoder.read()}readInfo(){return this.infoDecoder.read()}readString(){return this.stringDecoder.read()}readParentInfo(){return this.parentInfoDecoder.read()===1}readTypeRef(){return this.typeRefDecoder.read()}readLen(){return this.lenDecoder.read()}readAny(){return Qr(this.restDecoder)}readBuf(){return $e(this.restDecoder)}readJSON(){return Qr(this.restDecoder)}readKey(){let e=this.keyClockDecoder.read();if(e<this.keys.length)return this.keys[e];{let t=this.stringDecoder.read();return this.keys.push(t),t}}},Mo=class{constructor(){this.restEncoder=et()}toUint8Array(){return ct(this.restEncoder)}resetDsCurVal(){}writeDsClock(e){K(this.restEncoder,e)}writeDsLen(e){K(this.restEncoder,e)}},Ir=class extends Mo{writeLeftID(e){K(this.restEncoder,e.client),K(this.restEncoder,e.clock)}writeRightID(e){K(this.restEncoder,e.client),K(this.restEncoder,e.clock)}writeClient(e){K(this.restEncoder,e)}writeInfo(e){bo(this.restEncoder,e)}writeString(e){_n(this.restEncoder,e)}writeParentInfo(e){K(this.restEncoder,e?1:0)}writeTypeRef(e){K(this.restEncoder,e)}writeLen(e){K(this.restEncoder,e)}writeAny(e){Jr(this.restEncoder,e)}writeBuf(e){De(this.restEncoder,e)}writeJSON(e){_n(this.restEncoder,JSON.stringify(e))}writeKey(e){_n(this.restEncoder,e)}},Bo=class{constructor(){this.restEncoder=et(),this.dsCurrVal=0}toUint8Array(){return ct(this.restEncoder)}resetDsCurVal(){this.dsCurrVal=0}writeDsClock(e){let t=e-this.dsCurrVal;this.dsCurrVal=e,K(this.restEncoder,t)}writeDsLen(e){e===0&&Nt(),K(this.restEncoder,e-1),this.dsCurrVal+=e}},Tn=class extends Bo{constructor(){super(),this.keyMap=new Map,this.keyClock=0,this.keyClockEncoder=new Yr,this.clientEncoder=new Er,this.leftClockEncoder=new Yr,this.rightClockEncoder=new Yr,this.infoEncoder=new Yi(bo),this.stringEncoder=new xo,this.parentInfoEncoder=new Yi(bo),this.typeRefEncoder=new Er,this.lenEncoder=new Er}toUint8Array(){let e=et();return K(e,0),De(e,this.keyClockEncoder.toUint8Array()),De(e,this.clientEncoder.toUint8Array()),De(e,this.leftClockEncoder.toUint8Array()),De(e,this.rightClockEncoder.toUint8Array()),De(e,ct(this.infoEncoder)),De(e,this.stringEncoder.toUint8Array()),De(e,ct(this.parentInfoEncoder)),De(e,this.typeRefEncoder.toUint8Array()),De(e,this.lenEncoder.toUint8Array()),Xi(e,ct(this.restEncoder)),ct(e)}writeLeftID(e){this.clientEncoder.write(e.client),this.leftClockEncoder.write(e.clock)}writeRightID(e){this.clientEncoder.write(e.client),this.rightClockEncoder.write(e.clock)}writeClient(e){this.clientEncoder.write(e)}writeInfo(e){this.infoEncoder.write(e)}writeString(e){this.stringEncoder.write(e)}writeParentInfo(e){this.parentInfoEncoder.write(e?1:0)}writeTypeRef(e){this.typeRefEncoder.write(e)}writeLen(e){this.lenEncoder.write(e)}writeAny(e){Jr(this.restEncoder,e)}writeBuf(e){De(this.restEncoder,e)}writeJSON(e){Jr(this.restEncoder,e)}writeKey(e){let t=this.keyMap.get(e);t===void 0?(this.keyClockEncoder.write(this.keyClock++),this.stringEncoder.write(e)):this.keyClockEncoder.write(t)}},Lb=(n,e,t,r)=>{r=kn(r,e[0].id.clock);let i=un(e,r);K(n.restEncoder,e.length-i),n.writeClient(t),K(n.restEncoder,r);let s=e[i];s.write(n,r-s.id.clock);for(let o=i+1;o<e.length;o++)e[o].write(n,0)},Il=(n,e,t)=>{let r=new Map;t.forEach((i,s)=>{je(e,s)>i&&r.set(s,i)}),Wo(e).forEach((i,s)=>{t.has(s)||r.set(s,0)}),K(n.restEncoder,r.size),Gt(r.entries()).sort((i,s)=>s[0]-i[0]).forEach(([i,s])=>{Lb(n,e.clients.get(i),i,s)})},Mb=(n,e)=>{let t=Je(),r=J(n.restDecoder);for(let i=0;i<r;i++){let s=J(n.restDecoder),o=new Array(s),a=n.readClient(),c=J(n.restDecoder);t.set(a,{i:0,refs:o});for(let u=0;u<s;u++){let l=n.readInfo();switch(31&l){case 0:{let h=n.readLen();o[u]=new pt(re(a,c),h),c+=h;break}case 10:{let h=J(n.restDecoder);o[u]=new gt(re(a,c),h),c+=h;break}default:{let h=(l&192)===0,f=new Me(re(a,c),null,(l&128)===128?n.readLeftID():null,null,(l&64)===64?n.readRightID():null,h?n.readParentInfo()?e.get(n.readString()):n.readLeftID():null,h&&(l&32)===32?n.readString():null,Cg(n,l));o[u]=f,c+=f.length}}}}return t},Bb=(n,e,t)=>{let r=[],i=Gt(t.keys()).sort((d,x)=>d-x);if(i.length===0)return null;let s=()=>{if(i.length===0)return null;let d=t.get(i[i.length-1]);for(;d.refs.length===d.i;)if(i.pop(),i.length>0)d=t.get(i[i.length-1]);else return null;return d},o=s();if(o===null)return null;let a=new Fo,c=new Map,u=(d,x)=>{let S=c.get(d);(S==null||S>x)&&c.set(d,x)},l=o.refs[o.i++],h=new Map,f=()=>{for(let d of r){let x=d.id.client,S=t.get(x);S?(S.i--,a.clients.set(x,S.refs.slice(S.i)),t.delete(x),S.i=0,S.refs=[]):a.clients.set(x,[d]),i=i.filter(j=>j!==x)}r.length=0};for(;;){if(l.constructor!==gt){let x=zt(h,l.id.client,()=>je(e,l.id.client))-l.id.clock;if(x<0)r.push(l),u(l.id.client,l.id.clock-1),f();else{let S=l.getMissing(n,e);if(S!==null){r.push(l);let j=t.get(S)||{refs:[],i:0};if(j.refs.length===j.i)u(S,je(e,S)),f();else{l=j.refs[j.i++];continue}}else(x===0||x<l.length)&&(l.integrate(n,x),h.set(l.id.client,l.id.clock+l.length))}}if(r.length>0)l=r.pop();else if(o!==null&&o.i<o.refs.length)l=o.refs[o.i++];else{if(o=s(),o===null)break;l=o.refs[o.i++]}}if(a.clients.size>0){let d=new Tn;return Il(d,a,new Map),K(d.restEncoder,0),{missing:c,update:d.toUint8Array()}}return null},Fb=(n,e)=>Il(n,e.doc.store,e.beforeState),jb=(n,e,t,r=new Zn(n))=>Ee(e,i=>{i.local=!1;let s=!1,o=i.doc,a=o.store,c=Mb(r,o),u=Bb(i,a,c),l=a.pendingStructs;if(l){for(let[f,d]of l.missing)if(d<je(a,f)){s=!0;break}if(u){for(let[f,d]of u.missing){let x=l.missing.get(f);(x==null||x>d)&&l.missing.set(f,d)}l.update=jo([l.update,u.update])}}else a.pendingStructs=u;let h=Bp(r,i,a);if(a.pendingDs){let f=new Zn(Ht(a.pendingDs));J(f.restDecoder);let d=Bp(f,i,a);h&&d?a.pendingDs=jo([h,d]):a.pendingDs=h||d}else a.pendingDs=h;if(s){let f=a.pendingStructs.update;a.pendingStructs=null,eg(i.doc,f)}},t,!1);var eg=(n,e,t,r=Zn)=>{let i=Ht(e);jb(i,n,t,new r(i))},tg=(n,e,t)=>eg(n,e,t,Lo),Vb=(n,e,t=new Map)=>{Il(n,e.store,t),ai(n,Pb(e.store))},$b=(n,e=new Uint8Array([0]),t=new Tn)=>{let r=rg(e);Vb(t,n,r);let i=[t.toUint8Array()];if(n.store.pendingDs&&i.push(n.store.pendingDs),n.store.pendingStructs&&i.push(nE(n.store.pendingStructs.update,e)),i.length>1){if(t.constructor===Ir)return eE(i.map((s,o)=>o===0?s:iE(s)));if(t.constructor===Tn)return jo(i)}return i[0]},ng=(n,e)=>$b(n,e,new Ir),qb=n=>{let e=new Map,t=J(n.restDecoder);for(let r=0;r<t;r++){let i=J(n.restDecoder),s=J(n.restDecoder);e.set(i,s)}return e},rg=n=>qb(new Po(Ht(n))),ig=(n,e)=>(K(n.restEncoder,e.size),Gt(e.entries()).sort((t,r)=>r[0]-t[0]).forEach(([t,r])=>{K(n.restEncoder,t),K(n.restEncoder,r)}),n),zb=(n,e)=>ig(n,Wo(e.store)),Gb=(n,e=new Bo)=>(n instanceof Map?ig(e,n):zb(e,n),e.toUint8Array()),sg=n=>Gb(n,new Mo),hl=class{constructor(){this.l=[]}},Fp=()=>new hl,jp=(n,e)=>n.l.push(e),Vp=(n,e)=>{let t=n.l,r=t.length;n.l=t.filter(i=>e!==i),r===n.l.length&&console.error("[yjs] Tried to remove event handler that doesn't exist.")},og=(n,e,t)=>Zi(n.l,[e,t]),Qn=class{constructor(e,t){this.client=e,this.clock=t}},Co=(n,e)=>n===e||n!==null&&e!==null&&n.client===e.client&&n.clock===e.clock,re=(n,e)=>new Qn(n,e);var ag=n=>{for(let[e,t]of n.doc.share.entries())if(t===n)return e;throw Nt()};var fl=class{constructor(e,t,r,i=0){this.type=e,this.tname=t,this.item=r,this.assoc=i}};var dl=class{constructor(e,t,r=0){this.type=e,this.index=t,this.assoc=r}},Wb=(n,e,t=0)=>new dl(n,e,t),Io=(n,e,t)=>{let r=null,i=null;return n._item===null?i=ag(n):r=re(n._item.id.client,n._item.id.clock),new fl(r,i,e,t)},ws=(n,e,t=0)=>{let r=n._start;if(t<0){if(e===0)return Io(n,null,t);e--}for(;r!==null;){if(!r.deleted&&r.countable){if(r.length>e)return Io(n,re(r.id.client,r.id.clock+e),t);e-=r.length}if(r.right===null&&t<0)return Io(n,r.lastId,t);r=r.right}return Io(n,null,t)};var Hb=(n,e)=>{let t=ri(n,e),r=e.clock-t.id.clock;return{item:t,diff:r}},vs=(n,e,t=!0)=>{let r=e.store,i=n.item,s=n.type,o=n.tname,a=n.assoc,c=null,u=0;if(i!==null){if(je(r,i.client)<=i.clock)return null;let l=t?Jp(r,i):Hb(r,i),h=l.item;if(!(h instanceof Me))return null;if(c=h.parent,c._item===null||!c._item.deleted){u=h.deleted||!h.countable?0:l.diff+(a>=0?0:1);let f=h.left;for(;f!==null;)!f.deleted&&f.countable&&(u+=f.length),f=f.left}}else{if(o!==null)c=e.get(o);else if(s!==null){if(je(r,s.client)<=s.clock)return null;let{item:l}=t?Jp(r,s):{item:ri(r,s)};if(l instanceof Me&&l.content instanceof hn)c=l.content.type;else return null}else throw Nt();a>=0?u=c._length:u=0}return Wb(c,u,n.assoc)};var pl=class{constructor(e,t){this.ds=e,this.sv=t}};var Kb=(n,e)=>new pl(n,e),yC=Kb(Qp(),new Map);var ni=(n,e)=>e===void 0?!n.deleted:e.sv.has(n.id.client)&&(e.sv.get(n.id.client)||0)>n.id.clock&&!Xp(e.ds,n.id),gl=(n,e)=>{let t=zt(n.meta,gl,sn),r=n.doc.store;t.has(e)||(e.sv.forEach((i,s)=>{i<je(r,s)&&er(n,re(s,i))}),Yp(n,e.ds,i=>{}),t.add(e))};var Fo=class{constructor(){this.clients=new Map,this.pendingStructs=null,this.pendingDs=null}},Wo=n=>{let e=new Map;return n.clients.forEach((t,r)=>{let i=t[t.length-1];e.set(r,i.id.clock+i.length)}),e},je=(n,e)=>{let t=n.clients.get(e);if(t===void 0)return 0;let r=t[t.length-1];return r.id.clock+r.length},cg=(n,e)=>{let t=n.clients.get(e.id.client);if(t===void 0)t=[],n.clients.set(e.id.client,t);else{let r=t[t.length-1];if(r.id.clock+r.length!==e.id.clock)throw Nt()}t.push(e)},un=(n,e)=>{let t=0,r=n.length-1,i=n[r],s=i.id.clock;if(s===e)return r;let o=dt(e/(s+i.length-1)*r);for(;t<=r;){if(i=n[o],s=i.id.clock,s<=e){if(e<s+i.length)return o;t=o+1}else r=o-1;o=dt((t+r)/2)}throw Nt()},Jb=(n,e)=>{let t=n.clients.get(e.client);return t[un(t,e.clock)]},ri=Jb,ml=(n,e,t)=>{let r=un(e,t),i=e[r];return i.id.clock<t&&i instanceof Me?(e.splice(r+1,0,Go(n,i,t-i.id.clock)),r+1):r},er=(n,e)=>{let t=n.doc.store.clients.get(e.client);return t[ml(n,t,e.clock)]},$p=(n,e,t)=>{let r=e.clients.get(t.client),i=un(r,t.clock),s=r[i];return t.clock!==s.id.clock+s.length-1&&s.constructor!==pt&&r.splice(i+1,0,Go(n,s,t.clock-s.id.clock+1)),s},Yb=(n,e,t)=>{let r=n.clients.get(e.id.client);r[un(r,e.id.clock)]=t},lg=(n,e,t,r,i)=>{if(r===0)return;let s=t+r,o=ml(n,e,t),a;do a=e[o++],s<a.id.clock+a.length&&ml(n,e,s),i(a);while(o<e.length&&e[o].id.clock<s)},yl=class{constructor(e,t,r){this.doc=e,this.deleteSet=new Tr,this.beforeState=Wo(e.store),this.afterState=new Map,this.changed=new Map,this.changedParentTypes=new Map,this._mergeStructs=[],this.origin=t,this.meta=new Map,this.local=r,this.subdocsAdded=new Set,this.subdocsRemoved=new Set,this.subdocsLoaded=new Set,this._needFormattingCleanup=!1}},qp=(n,e)=>e.deleteSet.clients.size===0&&!Qd(e.afterState,(t,r)=>e.beforeState.get(r)!==t)?!1:(Tl(e.deleteSet),Fb(n,e),ai(n,e.deleteSet),!0),zp=(n,e,t)=>{let r=e._item;(r===null||r.id.clock<(n.beforeState.get(r.id.client)||0)&&!r.deleted)&&zt(n.changed,e,sn).add(t)},Uo=(n,e)=>{let t=n[e],r=n[e-1],i=e;for(;i>0;t=r,r=n[--i-1]){if(r.deleted===t.deleted&&r.constructor===t.constructor&&r.mergeWith(t)){t instanceof Me&&t.parentSub!==null&&t.parent._map.get(t.parentSub)===t&&t.parent._map.set(t.parentSub,r);continue}break}let s=e-i;return s&&n.splice(e+1-s,s),s},Xb=(n,e,t)=>{for(let[r,i]of n.clients.entries()){let s=e.clients.get(r);for(let o=i.length-1;o>=0;o--){let a=i[o],c=a.clock+a.len;for(let u=un(s,a.clock),l=s[u];u<s.length&&l.id.clock<c;l=s[++u]){let h=s[u];if(a.clock+a.len<=h.id.clock)break;h instanceof Me&&h.deleted&&!h.keep&&t(h)&&h.gc(e,!1)}}}},Qb=(n,e)=>{n.clients.forEach((t,r)=>{let i=e.clients.get(r);for(let s=t.length-1;s>=0;s--){let o=t[s],a=wo(i.length-1,1+un(i,o.clock+o.len-1));for(let c=a,u=i[c];c>0&&u.id.clock>=o.clock;u=i[c])c-=1+Uo(i,c)}})};var ug=(n,e)=>{if(e<n.length){let t=n[e],r=t.doc,i=r.store,s=t.deleteSet,o=t._mergeStructs;try{Tl(s),t.afterState=Wo(t.doc.store),r.emit("beforeObserverCalls",[t,r]);let a=[];t.changed.forEach((c,u)=>a.push(()=>{(u._item===null||!u._item.deleted)&&u._callObserver(t,c)})),a.push(()=>{t.changedParentTypes.forEach((c,u)=>{u._dEH.l.length>0&&(u._item===null||!u._item.deleted)&&(c=c.filter(l=>l.target._item===null||!l.target._item.deleted),c.forEach(l=>{l.currentTarget=u,l._path=null}),c.sort((l,h)=>l.path.length-h.path.length),og(u._dEH,c,t))})}),a.push(()=>r.emit("afterTransaction",[t,r])),Zi(a,[]),t._needFormattingCleanup&&gE(t)}finally{r.gc&&Xb(s,i,r.gcFilter),Qb(s,i),t.afterState.forEach((l,h)=>{let f=t.beforeState.get(h)||0;if(f!==l){let d=i.clients.get(h),x=kn(un(d,f),1);for(let S=d.length-1;S>=x;)S-=1+Uo(d,S)}});for(let l=o.length-1;l>=0;l--){let{client:h,clock:f}=o[l].id,d=i.clients.get(h),x=un(d,f);x+1<d.length&&Uo(d,x+1)>1||x>0&&Uo(d,x)}if(!t.local&&t.afterState.get(r.clientID)!==t.beforeState.get(r.clientID)&&(Dp(ti,ns,"[yjs] ",rs,is,"Changed the client-id because another client seems to be using it."),r.clientID=Zp()),r.emit("afterTransactionCleanup",[t,r]),r._observers.has("update")){let l=new Ir;qp(l,t)&&r.emit("update",[l.toUint8Array(),t.origin,r,t])}if(r._observers.has("updateV2")){let l=new Tn;qp(l,t)&&r.emit("updateV2",[l.toUint8Array(),t.origin,r,t])}let{subdocsAdded:a,subdocsLoaded:c,subdocsRemoved:u}=t;(a.size>0||u.size>0||c.size>0)&&(a.forEach(l=>{l.clientID=r.clientID,l.collectionid==null&&(l.collectionid=r.collectionid),r.subdocs.add(l)}),u.forEach(l=>r.subdocs.delete(l)),r.emit("subdocs",[{loaded:c,added:a,removed:u},r,t]),u.forEach(l=>l.destroy())),n.length<=e+1?(r._transactionCleanups=[],r.emit("afterAllTransactions",[r,n])):ug(n,e+1)}}},Ee=(n,e,t=null,r=!0)=>{let i=n._transactionCleanups,s=!1,o=null;n._transaction===null&&(s=!0,n._transaction=new yl(n,t,r),i.push(n._transaction),i.length===1&&n.emit("beforeAllTransactions",[n]),n.emit("beforeTransaction",[n._transaction,n]));try{o=e(n._transaction)}finally{if(s){let a=n._transaction===i[0];n._transaction=null,a&&ug(i,0)}}return o};function*Zb(n){let e=J(n.restDecoder);for(let t=0;t<e;t++){let r=J(n.restDecoder),i=n.readClient(),s=J(n.restDecoder);for(let o=0;o<r;o++){let a=n.readInfo();if(a===10){let c=J(n.restDecoder);yield new gt(re(i,s),c),s+=c}else if((31&a)!==0){let c=(a&192)===0,u=new Me(re(i,s),null,(a&128)===128?n.readLeftID():null,null,(a&64)===64?n.readRightID():null,c?n.readParentInfo()?n.readString():n.readLeftID():null,c&&(a&32)===32?n.readString():null,Cg(n,a));yield u,s+=u.length}else{let c=n.readLen();yield new pt(re(i,s),c),s+=c}}}}var as=class{constructor(e,t){this.gen=Zb(e),this.curr=null,this.done=!1,this.filterSkips=t,this.next()}next(){do this.curr=this.gen.next().value||null;while(this.filterSkips&&this.curr!==null&&this.curr.constructor===gt);return this.curr}};var cs=class{constructor(e){this.currClient=0,this.startClock=0,this.written=0,this.encoder=e,this.clientStructs=[]}},eE=n=>jo(n,Lo,Ir);var tE=(n,e)=>{if(n.constructor===pt){let{client:t,clock:r}=n.id;return new pt(re(t,r+e),n.length-e)}else if(n.constructor===gt){let{client:t,clock:r}=n.id;return new gt(re(t,r+e),n.length-e)}else{let t=n,{client:r,clock:i}=t.id;return new Me(re(r,i+e),null,re(r,i+e-1),null,t.rightOrigin,t.parent,t.parentSub,t.content.splice(e))}},jo=(n,e=Zn,t=Tn)=>{if(n.length===1)return n[0];let r=n.map(l=>new e(Ht(l))),i=r.map(l=>new as(l,!0)),s=null,o=new t,a=new cs(o);for(;i=i.filter(f=>f.curr!==null),i.sort((f,d)=>{if(f.curr.id.client===d.curr.id.client){let x=f.curr.id.clock-d.curr.id.clock;return x===0?f.curr.constructor===d.curr.constructor?0:f.curr.constructor===gt?1:-1:x}else return d.curr.id.client-f.curr.id.client}),i.length!==0;){let l=i[0],h=l.curr.id.client;if(s!==null){let f=l.curr,d=!1;for(;f!==null&&f.id.clock+f.length<=s.struct.id.clock+s.struct.length&&f.id.client>=s.struct.id.client;)f=l.next(),d=!0;if(f===null||f.id.client!==h||d&&f.id.clock>s.struct.id.clock+s.struct.length)continue;if(h!==s.struct.id.client)Yn(a,s.struct,s.offset),s={struct:f,offset:0},l.next();else if(s.struct.id.clock+s.struct.length<f.id.clock)if(s.struct.constructor===gt)s.struct.length=f.id.clock+f.length-s.struct.id.clock;else{Yn(a,s.struct,s.offset);let x=f.id.clock-s.struct.id.clock-s.struct.length;s={struct:new gt(re(h,s.struct.id.clock+s.struct.length),x),offset:0}}else{let x=s.struct.id.clock+s.struct.length-f.id.clock;x>0&&(s.struct.constructor===gt?s.struct.length-=x:f=tE(f,x)),s.struct.mergeWith(f)||(Yn(a,s.struct,s.offset),s={struct:f,offset:0},l.next())}}else s={struct:l.curr,offset:0},l.next();for(let f=l.curr;f!==null&&f.id.client===h&&f.id.clock===s.struct.id.clock+s.struct.length&&f.constructor!==gt;f=l.next())Yn(a,s.struct,s.offset),s={struct:f,offset:0}}s!==null&&(Yn(a,s.struct,s.offset),s=null),Rl(a);let c=r.map(l=>Cl(l)),u=Nb(c);return ai(o,u),o.toUint8Array()},nE=(n,e,t=Zn,r=Tn)=>{let i=rg(e),s=new r,o=new cs(s),a=new t(Ht(n)),c=new as(a,!1);for(;c.curr;){let l=c.curr,h=l.id.client,f=i.get(h)||0;if(c.curr.constructor===gt){c.next();continue}if(l.id.clock+l.length>f)for(Yn(o,l,kn(f-l.id.clock,0)),c.next();c.curr&&c.curr.id.client===h;)Yn(o,c.curr,0),c.next();else for(;c.curr&&c.curr.id.client===h&&c.curr.id.clock+c.curr.length<=f;)c.next()}Rl(o);let u=Cl(a);return ai(s,u),s.toUint8Array()};var hg=n=>{n.written>0&&(n.clientStructs.push({written:n.written,restEncoder:ct(n.encoder.restEncoder)}),n.encoder.restEncoder=et(),n.written=0)},Yn=(n,e,t)=>{n.written>0&&n.currClient!==e.id.client&&hg(n),n.written===0&&(n.currClient=e.id.client,n.encoder.writeClient(e.id.client),K(n.encoder.restEncoder,e.id.clock+t)),e.write(n.encoder,t),n.written++},Rl=n=>{hg(n);let e=n.encoder.restEncoder;K(e,n.clientStructs.length);for(let t=0;t<n.clientStructs.length;t++){let r=n.clientStructs[t];K(e,r.written),Xi(e,r.restEncoder)}},rE=(n,e,t,r)=>{let i=new t(Ht(n)),s=new as(i,!1),o=new r,a=new cs(o);for(let u=s.curr;u!==null;u=s.next())Yn(a,e(u),0);Rl(a);let c=Cl(i);return ai(o,c),o.toUint8Array()};var iE=n=>rE(n,Ep,Zn,Ir),Gp="You must not compute changes after the event-handler fired.",ii=class{constructor(e,t){this.target=e,this.currentTarget=e,this.transaction=t,this._changes=null,this._keys=null,this._delta=null,this._path=null}get path(){return this._path||(this._path=sE(this.currentTarget,this.target))}deletes(e){return Xp(this.transaction.deleteSet,e.id)}get keys(){if(this._keys===null){if(this.transaction.doc._transactionCleanups.length===0)throw on(Gp);let e=new Map,t=this.target;this.transaction.changed.get(t).forEach(i=>{if(i!==null){let s=t._map.get(i),o,a;if(this.adds(s)){let c=s.left;for(;c!==null&&this.adds(c);)c=c.left;if(this.deletes(s))if(c!==null&&this.deletes(c))o="delete",a=mo(c.content.getContent());else return;else c!==null&&this.deletes(c)?(o="update",a=mo(c.content.getContent())):(o="add",a=void 0)}else if(this.deletes(s))o="delete",a=mo(s.content.getContent());else return;e.set(i,{action:o,oldValue:a})}}),this._keys=e}return this._keys}get delta(){return this.changes.delta}adds(e){return e.id.clock>=(this.transaction.beforeState.get(e.id.client)||0)}get changes(){let e=this._changes;if(e===null){if(this.transaction.doc._transactionCleanups.length===0)throw on(Gp);let t=this.target,r=sn(),i=sn(),s=[];if(e={added:r,deleted:i,delta:s,keys:this.keys},this.transaction.changed.get(t).has(null)){let a=null,c=()=>{a&&s.push(a)};for(let u=t._start;u!==null;u=u.right)u.deleted?this.deletes(u)&&!this.adds(u)&&((a===null||a.delete===void 0)&&(c(),a={delete:0}),a.delete+=u.length,i.add(u)):this.adds(u)?((a===null||a.insert===void 0)&&(c(),a={insert:[]}),a.insert=a.insert.concat(u.content.getContent()),r.add(u)):((a===null||a.retain===void 0)&&(c(),a={retain:0}),a.retain+=u.length);a!==null&&a.retain===void 0&&c()}this._changes=e}return e}},sE=(n,e)=>{let t=[];for(;e._item!==null&&e!==n;){if(e._item.parentSub!==null)t.unshift(e._item.parentSub);else{let r=0,i=e._item.parent._start;for(;i!==e._item&&i!==null;)!i.deleted&&i.countable&&(r+=i.length),i=i.right;t.unshift(r)}e=e._item.parent}return t},tt=()=>{Up("Invalid access: Add Yjs type to a document before reading data.")},fg=80,Dl=0,wl=class{constructor(e,t){e.marker=!0,this.p=e,this.index=t,this.timestamp=Dl++}},oE=n=>{n.timestamp=Dl++},dg=(n,e,t)=>{n.p.marker=!1,n.p=e,e.marker=!0,n.index=t,n.timestamp=Dl++},aE=(n,e,t)=>{if(n.length>=fg){let r=n.reduce((i,s)=>i.timestamp<s.timestamp?i:s);return dg(r,e,t),r}else{let r=new wl(e,t);return n.push(r),r}},Ho=(n,e)=>{if(n._start===null||e===0||n._searchMarker===null)return null;let t=n._searchMarker.length===0?null:n._searchMarker.reduce((s,o)=>Gr(e-s.index)<Gr(e-o.index)?s:o),r=n._start,i=0;for(t!==null&&(r=t.p,i=t.index,oE(t));r.right!==null&&i<e;){if(!r.deleted&&r.countable){if(e<i+r.length)break;i+=r.length}r=r.right}for(;r.left!==null&&i>e;)r=r.left,!r.deleted&&r.countable&&(i-=r.length);for(;r.left!==null&&r.left.id.client===r.id.client&&r.left.id.clock+r.left.length===r.id.clock;)r=r.left,!r.deleted&&r.countable&&(i-=r.length);return t!==null&&Gr(t.index-i)<r.parent.length/fg?(dg(t,r,i),t):aE(n._searchMarker,r,i)},ls=(n,e,t)=>{for(let r=n.length-1;r>=0;r--){let i=n[r];if(t>0){let s=i.p;for(s.marker=!1;s&&(s.deleted||!s.countable);)s=s.left,s&&!s.deleted&&s.countable&&(i.index-=s.length);if(s===null||s.marker===!0){n.splice(r,1);continue}i.p=s,s.marker=!0}(e<i.index||t>0&&e===i.index)&&(i.index=kn(e,i.index+t))}};var Ko=(n,e,t)=>{let r=n,i=e.changedParentTypes;for(;zt(i,n,()=>[]).push(t),n._item!==null;)n=n._item.parent;og(r._eH,t,e)},qe=class{constructor(){this._item=null,this._map=new Map,this._start=null,this.doc=null,this._length=0,this._eH=Fp(),this._dEH=Fp(),this._searchMarker=null}get parent(){return this._item?this._item.parent:null}_integrate(e,t){this.doc=e,this._item=t}_copy(){throw Wt()}clone(){throw Wt()}_write(e){}get _first(){let e=this._start;for(;e!==null&&e.deleted;)e=e.right;return e}_callObserver(e,t){!e.local&&this._searchMarker&&(this._searchMarker.length=0)}observe(e){jp(this._eH,e)}observeDeep(e){jp(this._dEH,e)}unobserve(e){Vp(this._eH,e)}unobserveDeep(e){Vp(this._dEH,e)}toJSON(){}},pg=(n,e,t)=>{n.doc??tt(),e<0&&(e=n._length+e),t<0&&(t=n._length+t);let r=t-e,i=[],s=n._start;for(;s!==null&&r>0;){if(s.countable&&!s.deleted){let o=s.content.getContent();if(o.length<=e)e-=o.length;else{for(let a=e;a<o.length&&r>0;a++)i.push(o[a]),r--;e=0}}s=s.right}return i},gg=n=>{n.doc??tt();let e=[],t=n._start;for(;t!==null;){if(t.countable&&!t.deleted){let r=t.content.getContent();for(let i=0;i<r.length;i++)e.push(r[i])}t=t.right}return e};var us=(n,e)=>{let t=0,r=n._start;for(n.doc??tt();r!==null;){if(r.countable&&!r.deleted){let i=r.content.getContent();for(let s=0;s<i.length;s++)e(i[s],t++,n)}r=r.right}},mg=(n,e)=>{let t=[];return us(n,(r,i)=>{t.push(e(r,i,n))}),t},cE=n=>{let e=n._start,t=null,r=0;return{[Symbol.iterator](){return this},next:()=>{if(t===null){for(;e!==null&&e.deleted;)e=e.right;if(e===null)return{done:!0,value:void 0};t=e.content.getContent(),r=0,e=e.right}let i=t[r++];return t.length<=r&&(t=null),{done:!1,value:i}}}},yg=(n,e)=>{n.doc??tt();let t=Ho(n,e),r=n._start;for(t!==null&&(r=t.p,e-=t.index);r!==null;r=r.right)if(!r.deleted&&r.countable){if(e<r.length)return r.content.getContent()[e];e-=r.length}},Vo=(n,e,t,r)=>{let i=t,s=n.doc,o=s.clientID,a=s.store,c=t===null?e._start:t.right,u=[],l=()=>{u.length>0&&(i=new Me(re(o,je(a,o)),i,i&&i.lastId,c,c&&c.id,e,null,new oi(u)),i.integrate(n,0),u=[])};r.forEach(h=>{if(h===null)u.push(h);else switch(h.constructor){case Number:case Object:case Boolean:case Array:case String:u.push(h);break;default:switch(l(),h.constructor){case Uint8Array:case ArrayBuffer:i=new Me(re(o,je(a,o)),i,i&&i.lastId,c,c&&c.id,e,null,new ms(new Uint8Array(h))),i.integrate(n,0);break;case Cr:i=new Me(re(o,je(a,o)),i,i&&i.lastId,c,c&&c.id,e,null,new ys(h)),i.integrate(n,0);break;default:if(h instanceof qe)i=new Me(re(o,je(a,o)),i,i&&i.lastId,c,c&&c.id,e,null,new hn(h)),i.integrate(n,0);else throw new Error("Unexpected content type in insert operation")}}}),l()},wg=()=>on("Length exceeded!"),vg=(n,e,t,r)=>{if(t>e._length)throw wg();if(t===0)return e._searchMarker&&ls(e._searchMarker,t,r.length),Vo(n,e,null,r);let i=t,s=Ho(e,t),o=e._start;for(s!==null&&(o=s.p,t-=s.index,t===0&&(o=o.prev,t+=o&&o.countable&&!o.deleted?o.length:0));o!==null;o=o.right)if(!o.deleted&&o.countable){if(t<=o.length){t<o.length&&er(n,re(o.id.client,o.id.clock+t));break}t-=o.length}return e._searchMarker&&ls(e._searchMarker,i,r.length),Vo(n,e,o,r)},lE=(n,e,t)=>{let i=(e._searchMarker||[]).reduce((s,o)=>o.index>s.index?o:s,{index:0,p:e._start}).p;if(i)for(;i.right;)i=i.right;return Vo(n,e,i,t)},xg=(n,e,t,r)=>{if(r===0)return;let i=t,s=r,o=Ho(e,t),a=e._start;for(o!==null&&(a=o.p,t-=o.index);a!==null&&t>0;a=a.right)!a.deleted&&a.countable&&(t<a.length&&er(n,re(a.id.client,a.id.clock+t)),t-=a.length);for(;r>0&&a!==null;)a.deleted||(r<a.length&&er(n,re(a.id.client,a.id.clock+r)),a.delete(n),r-=a.length),a=a.right;if(r>0)throw wg();e._searchMarker&&ls(e._searchMarker,i,-s+r)},$o=(n,e,t)=>{let r=e._map.get(t);r!==void 0&&r.delete(n)},Ul=(n,e,t,r)=>{let i=e._map.get(t)||null,s=n.doc,o=s.clientID,a;if(r==null)a=new oi([r]);else switch(r.constructor){case Number:case Object:case Boolean:case Array:case String:a=new oi([r]);break;case Uint8Array:a=new ms(r);break;case Cr:a=new ys(r);break;default:if(r instanceof qe)a=new hn(r);else throw new Error("Unexpected content type")}new Me(re(o,je(s.store,o)),i,i&&i.lastId,null,null,e,t,a).integrate(n,0)},Ol=(n,e)=>{n.doc??tt();let t=n._map.get(e);return t!==void 0&&!t.deleted?t.content.getContent()[t.length-1]:void 0},bg=n=>{let e={};return n.doc??tt(),n._map.forEach((t,r)=>{t.deleted||(e[r]=t.content.getContent()[t.length-1])}),e},Eg=(n,e)=>{n.doc??tt();let t=n._map.get(e);return t!==void 0&&!t.deleted};var uE=(n,e)=>{let t={};return n._map.forEach((r,i)=>{let s=r;for(;s!==null&&(!e.sv.has(s.id.client)||s.id.clock>=(e.sv.get(s.id.client)||0));)s=s.left;s!==null&&ni(s,e)&&(t[i]=s.content.getContent()[s.length-1])}),t},Ro=n=>(n.doc??tt(),Pp(n._map.entries(),e=>!e[1].deleted)),vl=class extends ii{},qo=class n extends qe{constructor(){super(),this._prelimContent=[],this._searchMarker=[]}static from(e){let t=new n;return t.push(e),t}_integrate(e,t){super._integrate(e,t),this.insert(0,this._prelimContent),this._prelimContent=null}_copy(){return new n}clone(){let e=new n;return e.insert(0,this.toArray().map(t=>t instanceof qe?t.clone():t)),e}get length(){return this.doc??tt(),this._length}_callObserver(e,t){super._callObserver(e,t),Ko(this,e,new vl(this,e))}insert(e,t){this.doc!==null?Ee(this.doc,r=>{vg(r,this,e,t)}):this._prelimContent.splice(e,0,...t)}push(e){this.doc!==null?Ee(this.doc,t=>{lE(t,this,e)}):this._prelimContent.push(...e)}unshift(e){this.insert(0,e)}delete(e,t=1){this.doc!==null?Ee(this.doc,r=>{xg(r,this,e,t)}):this._prelimContent.splice(e,t)}get(e){return yg(this,e)}toArray(){return gg(this)}slice(e=0,t=this.length){return pg(this,e,t)}toJSON(){return this.map(e=>e instanceof qe?e.toJSON():e)}map(e){return mg(this,e)}forEach(e){us(this,e)}[Symbol.iterator](){return cE(this)}_write(e){e.writeTypeRef(UE)}},hE=n=>new qo,xl=class extends ii{constructor(e,t,r){super(e,t),this.keysChanged=r}},hs=class n extends qe{constructor(e){super(),this._prelimContent=null,e===void 0?this._prelimContent=new Map:this._prelimContent=new Map(e)}_integrate(e,t){super._integrate(e,t),this._prelimContent.forEach((r,i)=>{this.set(i,r)}),this._prelimContent=null}_copy(){return new n}clone(){let e=new n;return this.forEach((t,r)=>{e.set(r,t instanceof qe?t.clone():t)}),e}_callObserver(e,t){Ko(this,e,new xl(this,e,t))}toJSON(){this.doc??tt();let e={};return this._map.forEach((t,r)=>{if(!t.deleted){let i=t.content.getContent()[t.length-1];e[r]=i instanceof qe?i.toJSON():i}}),e}get size(){return[...Ro(this)].length}keys(){return To(Ro(this),e=>e[0])}values(){return To(Ro(this),e=>e[1].content.getContent()[e[1].length-1])}entries(){return To(Ro(this),e=>[e[0],e[1].content.getContent()[e[1].length-1]])}forEach(e){this.doc??tt(),this._map.forEach((t,r)=>{t.deleted||e(t.content.getContent()[t.length-1],r,this)})}[Symbol.iterator](){return this.entries()}delete(e){this.doc!==null?Ee(this.doc,t=>{$o(t,this,e)}):this._prelimContent.delete(e)}set(e,t){return this.doc!==null?Ee(this.doc,r=>{Ul(r,this,e,t)}):this._prelimContent.set(e,t),t}get(e){return Ol(this,e)}has(e){return Eg(this,e)}clear(){this.doc!==null?Ee(this.doc,e=>{this.forEach(function(t,r,i){$o(e,i,r)})}):this._prelimContent.clear()}_write(e){e.writeTypeRef(OE)}},fE=n=>new hs,Xn=(n,e)=>n===e||typeof n=="object"&&typeof e=="object"&&n&&e&&Zc(n,e),fs=class{constructor(e,t,r,i){this.left=e,this.right=t,this.index=r,this.currentAttributes=i}forward(){switch(this.right===null&&Nt(),this.right.content.constructor){case ze:this.right.deleted||ci(this.currentAttributes,this.right.content);break;default:this.right.deleted||(this.index+=this.right.length);break}this.left=this.right,this.right=this.right.right}},Wp=(n,e,t)=>{for(;e.right!==null&&t>0;){switch(e.right.content.constructor){case ze:e.right.deleted||ci(e.currentAttributes,e.right.content);break;default:e.right.deleted||(t<e.right.length&&er(n,re(e.right.id.client,e.right.id.clock+t)),e.index+=e.right.length,t-=e.right.length);break}e.left=e.right,e.right=e.right.right}return e},Do=(n,e,t,r)=>{let i=new Map,s=r?Ho(e,t):null;if(s){let o=new fs(s.p.left,s.p,s.index,i);return Wp(n,o,t-s.index)}else{let o=new fs(null,e._start,0,i);return Wp(n,o,t)}},Sg=(n,e,t,r)=>{for(;t.right!==null&&(t.right.deleted===!0||t.right.content.constructor===ze&&Xn(r.get(t.right.content.key),t.right.content.value));)t.right.deleted||r.delete(t.right.content.key),t.forward();let i=n.doc,s=i.clientID;r.forEach((o,a)=>{let c=t.left,u=t.right,l=new Me(re(s,je(i.store,s)),c,c&&c.lastId,u,u&&u.id,e,null,new ze(a,o));l.integrate(n,0),t.right=l,t.forward()})},ci=(n,e)=>{let{key:t,value:r}=e;r===null?n.delete(t):n.set(t,r)},kg=(n,e)=>{for(;n.right!==null;){if(!(n.right.deleted||n.right.content.constructor===ze&&Xn(e[n.right.content.key]??null,n.right.content.value)))break;n.forward()}},_g=(n,e,t,r)=>{let i=n.doc,s=i.clientID,o=new Map;for(let a in r){let c=r[a],u=t.currentAttributes.get(a)??null;if(!Xn(u,c)){o.set(a,u);let{left:l,right:h}=t;t.right=new Me(re(s,je(i.store,s)),l,l&&l.lastId,h,h&&h.id,e,null,new ze(a,c)),t.right.integrate(n,0),t.forward()}}return o},ll=(n,e,t,r,i)=>{t.currentAttributes.forEach((f,d)=>{i[d]===void 0&&(i[d]=null)});let s=n.doc,o=s.clientID;kg(t,i);let a=_g(n,e,t,i),c=r.constructor===String?new Cn(r):r instanceof qe?new hn(r):new Rr(r),{left:u,right:l,index:h}=t;e._searchMarker&&ls(e._searchMarker,t.index,c.getLength()),l=new Me(re(o,je(s.store,o)),u,u&&u.lastId,l,l&&l.id,e,null,c),l.integrate(n,0),t.right=l,t.index=h,t.forward(),Sg(n,e,t,a)},Hp=(n,e,t,r,i)=>{let s=n.doc,o=s.clientID;kg(t,i);let a=_g(n,e,t,i);e:for(;t.right!==null&&(r>0||a.size>0&&(t.right.deleted||t.right.content.constructor===ze));){if(!t.right.deleted)switch(t.right.content.constructor){case ze:{let{key:c,value:u}=t.right.content,l=i[c];if(l!==void 0){if(Xn(l,u))a.delete(c);else{if(r===0)break e;a.set(c,u)}t.right.delete(n)}else t.currentAttributes.set(c,u);break}default:r<t.right.length&&er(n,re(t.right.id.client,t.right.id.clock+r)),r-=t.right.length;break}t.forward()}if(r>0){let c="";for(;r>0;r--)c+=`
`;t.right=new Me(re(o,je(s.store,o)),t.left,t.left&&t.left.lastId,t.right,t.right&&t.right.id,e,null,new Cn(c)),t.right.integrate(n,0),t.forward()}Sg(n,e,t,a)},Ag=(n,e,t,r,i)=>{let s=e,o=Je();for(;s&&(!s.countable||s.deleted);){if(!s.deleted&&s.content.constructor===ze){let u=s.content;o.set(u.key,u)}s=s.right}let a=0,c=!1;for(;e!==s;){if(t===e&&(c=!0),!e.deleted){let u=e.content;switch(u.constructor){case ze:{let{key:l,value:h}=u,f=r.get(l)??null;(o.get(l)!==u||f===h)&&(e.delete(n),a++,!c&&(i.get(l)??null)===h&&f!==h&&(f===null?i.delete(l):i.set(l,f))),!c&&!e.deleted&&ci(i,u);break}}}e=e.right}return a},dE=(n,e)=>{for(;e&&e.right&&(e.right.deleted||!e.right.countable);)e=e.right;let t=new Set;for(;e&&(e.deleted||!e.countable);){if(!e.deleted&&e.content.constructor===ze){let r=e.content.key;t.has(r)?e.delete(n):t.add(r)}e=e.left}},pE=n=>{let e=0;return Ee(n.doc,t=>{let r=n._start,i=n._start,s=Je(),o=go(s);for(;i;){if(i.deleted===!1)switch(i.content.constructor){case ze:ci(o,i.content);break;default:e+=Ag(t,r,i,s,o),s=go(o),r=i;break}i=i.right}}),e},gE=n=>{let e=new Set,t=n.doc;for(let[r,i]of n.afterState.entries()){let s=n.beforeState.get(r)||0;i!==s&&lg(n,t.store.clients.get(r),s,i,o=>{!o.deleted&&o.content.constructor===ze&&o.constructor!==pt&&e.add(o.parent)})}Ee(t,r=>{Yp(n,n.deleteSet,i=>{if(i instanceof pt||!i.parent._hasFormatting||e.has(i.parent))return;let s=i.parent;i.content.constructor===ze?e.add(s):dE(r,i)});for(let i of e)pE(i)})},Kp=(n,e,t)=>{let r=t,i=go(e.currentAttributes),s=e.right;for(;t>0&&e.right!==null;){if(e.right.deleted===!1)switch(e.right.content.constructor){case hn:case Rr:case Cn:t<e.right.length&&er(n,re(e.right.id.client,e.right.id.clock+t)),t-=e.right.length,e.right.delete(n);break}e.forward()}s&&Ag(n,s,e.right,i,e.currentAttributes);let o=(e.left||e.right).parent;return o._searchMarker&&ls(o._searchMarker,e.index,-r+t),e},bl=class extends ii{constructor(e,t,r){super(e,t),this.childListChanged=!1,this.keysChanged=new Set,r.forEach(i=>{i===null?this.childListChanged=!0:this.keysChanged.add(i)})}get changes(){if(this._changes===null){let e={keys:this.keys,delta:this.delta,added:new Set,deleted:new Set};this._changes=e}return this._changes}get delta(){if(this._delta===null){let e=this.target.doc,t=[];Ee(e,r=>{let i=new Map,s=new Map,o=this.target._start,a=null,c={},u="",l=0,h=0,f=()=>{if(a!==null){let d=null;switch(a){case"delete":h>0&&(d={delete:h}),h=0;break;case"insert":(typeof u=="object"||u.length>0)&&(d={insert:u},i.size>0&&(d.attributes={},i.forEach((x,S)=>{x!==null&&(d.attributes[S]=x)}))),u="";break;case"retain":l>0&&(d={retain:l},xp(c)||(d.attributes=yp({},c))),l=0;break}d&&t.push(d),a=null}};for(;o!==null;){switch(o.content.constructor){case hn:case Rr:this.adds(o)?this.deletes(o)||(f(),a="insert",u=o.content.getContent()[0],f()):this.deletes(o)?(a!=="delete"&&(f(),a="delete"),h+=1):o.deleted||(a!=="retain"&&(f(),a="retain"),l+=1);break;case Cn:this.adds(o)?this.deletes(o)||(a!=="insert"&&(f(),a="insert"),u+=o.content.str):this.deletes(o)?(a!=="delete"&&(f(),a="delete"),h+=o.length):o.deleted||(a!=="retain"&&(f(),a="retain"),l+=o.length);break;case ze:{let{key:d,value:x}=o.content;if(this.adds(o)){if(!this.deletes(o)){let S=i.get(d)??null;Xn(S,x)?x!==null&&o.delete(r):(a==="retain"&&f(),Xn(x,s.get(d)??null)?delete c[d]:c[d]=x)}}else if(this.deletes(o)){s.set(d,x);let S=i.get(d)??null;Xn(S,x)||(a==="retain"&&f(),c[d]=S)}else if(!o.deleted){s.set(d,x);let S=c[d];S!==void 0&&(Xn(S,x)?S!==null&&o.delete(r):(a==="retain"&&f(),x===null?delete c[d]:c[d]=x))}o.deleted||(a==="insert"&&f(),ci(i,o.content));break}}o=o.right}for(f();t.length>0;){let d=t[t.length-1];if(d.retain!==void 0&&d.attributes===void 0)t.pop();else break}}),this._delta=t}return this._delta}},ds=class n extends qe{constructor(e){super(),this._pending=e!==void 0?[()=>this.insert(0,e)]:[],this._searchMarker=[],this._hasFormatting=!1}get length(){return this.doc??tt(),this._length}_integrate(e,t){super._integrate(e,t);try{this._pending.forEach(r=>r())}catch(r){console.error(r)}this._pending=null}_copy(){return new n}clone(){let e=new n;return e.applyDelta(this.toDelta()),e}_callObserver(e,t){super._callObserver(e,t);let r=new bl(this,e,t);Ko(this,e,r),!e.local&&this._hasFormatting&&(e._needFormattingCleanup=!0)}toString(){this.doc??tt();let e="",t=this._start;for(;t!==null;)!t.deleted&&t.countable&&t.content.constructor===Cn&&(e+=t.content.str),t=t.right;return e}toJSON(){return this.toString()}applyDelta(e,{sanitize:t=!0}={}){this.doc!==null?Ee(this.doc,r=>{let i=new fs(null,this._start,0,new Map);for(let s=0;s<e.length;s++){let o=e[s];if(o.insert!==void 0){let a=!t&&typeof o.insert=="string"&&s===e.length-1&&i.right===null&&o.insert.slice(-1)===`
`?o.insert.slice(0,-1):o.insert;(typeof a!="string"||a.length>0)&&ll(r,this,i,a,o.attributes||{})}else o.retain!==void 0?Hp(r,this,i,o.retain,o.attributes||{}):o.delete!==void 0&&Kp(r,i,o.delete)}}):this._pending.push(()=>this.applyDelta(e))}toDelta(e,t,r){this.doc??tt();let i=[],s=new Map,o=this.doc,a="",c=this._start;function u(){if(a.length>0){let h={},f=!1;s.forEach((x,S)=>{f=!0,h[S]=x});let d={insert:a};f&&(d.attributes=h),i.push(d),a=""}}let l=()=>{for(;c!==null;){if(ni(c,e)||t!==void 0&&ni(c,t))switch(c.content.constructor){case Cn:{let h=s.get("ychange");e!==void 0&&!ni(c,e)?(h===void 0||h.user!==c.id.client||h.type!=="removed")&&(u(),s.set("ychange",r?r("removed",c.id):{type:"removed"})):t!==void 0&&!ni(c,t)?(h===void 0||h.user!==c.id.client||h.type!=="added")&&(u(),s.set("ychange",r?r("added",c.id):{type:"added"})):h!==void 0&&(u(),s.delete("ychange")),a+=c.content.str;break}case hn:case Rr:{u();let h={insert:c.content.getContent()[0]};if(s.size>0){let f={};h.attributes=f,s.forEach((d,x)=>{f[x]=d})}i.push(h);break}case ze:ni(c,e)&&(u(),ci(s,c.content));break}c=c.right}u()};return e||t?Ee(o,h=>{e&&gl(h,e),t&&gl(h,t),l()},"cleanup"):l(),i}insert(e,t,r){if(t.length<=0)return;let i=this.doc;i!==null?Ee(i,s=>{let o=Do(s,this,e,!r);r||(r={},o.currentAttributes.forEach((a,c)=>{r[c]=a})),ll(s,this,o,t,r)}):this._pending.push(()=>this.insert(e,t,r))}insertEmbed(e,t,r){let i=this.doc;i!==null?Ee(i,s=>{let o=Do(s,this,e,!r);ll(s,this,o,t,r||{})}):this._pending.push(()=>this.insertEmbed(e,t,r||{}))}delete(e,t){if(t===0)return;let r=this.doc;r!==null?Ee(r,i=>{Kp(i,Do(i,this,e,!0),t)}):this._pending.push(()=>this.delete(e,t))}format(e,t,r){if(t===0)return;let i=this.doc;i!==null?Ee(i,s=>{let o=Do(s,this,e,!1);o.right!==null&&Hp(s,this,o,t,r)}):this._pending.push(()=>this.format(e,t,r))}removeAttribute(e){this.doc!==null?Ee(this.doc,t=>{$o(t,this,e)}):this._pending.push(()=>this.removeAttribute(e))}setAttribute(e,t){this.doc!==null?Ee(this.doc,r=>{Ul(r,this,e,t)}):this._pending.push(()=>this.setAttribute(e,t))}getAttribute(e){return Ol(this,e)}getAttributes(){return bg(this)}_write(e){e.writeTypeRef(NE)}},mE=n=>new ds,ss=class{constructor(e,t=()=>!0){this._filter=t,this._root=e,this._currentNode=e._start,this._firstCall=!0,e.doc??tt()}[Symbol.iterator](){return this}next(){let e=this._currentNode,t=e&&e.content&&e.content.type;if(e!==null&&(!this._firstCall||e.deleted||!this._filter(t)))do if(t=e.content.type,!e.deleted&&(t.constructor===ps||t.constructor===si)&&t._start!==null)e=t._start;else for(;e!==null;){let r=e.next;if(r!==null){e=r;break}else e.parent===this._root?e=null:e=e.parent._item}while(e!==null&&(e.deleted||!this._filter(e.content.type)));return this._firstCall=!1,e===null?{value:void 0,done:!0}:(this._currentNode=e,{value:e.content.type,done:!1})}},si=class n extends qe{constructor(){super(),this._prelimContent=[]}get firstChild(){let e=this._first;return e?e.content.getContent()[0]:null}_integrate(e,t){super._integrate(e,t),this.insert(0,this._prelimContent),this._prelimContent=null}_copy(){return new n}clone(){let e=new n;return e.insert(0,this.toArray().map(t=>t instanceof qe?t.clone():t)),e}get length(){return this.doc??tt(),this._prelimContent===null?this._length:this._prelimContent.length}createTreeWalker(e){return new ss(this,e)}querySelector(e){e=e.toUpperCase();let r=new ss(this,i=>i.nodeName&&i.nodeName.toUpperCase()===e).next();return r.done?null:r.value}querySelectorAll(e){return e=e.toUpperCase(),Gt(new ss(this,t=>t.nodeName&&t.nodeName.toUpperCase()===e))}_callObserver(e,t){Ko(this,e,new El(this,t,e))}toString(){return mg(this,e=>e.toString()).join("")}toJSON(){return this.toString()}toDOM(e=document,t={},r){let i=e.createDocumentFragment();return r!==void 0&&r._createAssociation(i,this),us(this,s=>{i.insertBefore(s.toDOM(e,t,r),null)}),i}insert(e,t){this.doc!==null?Ee(this.doc,r=>{vg(r,this,e,t)}):this._prelimContent.splice(e,0,...t)}insertAfter(e,t){if(this.doc!==null)Ee(this.doc,r=>{let i=e&&e instanceof qe?e._item:e;Vo(r,this,i,t)});else{let r=this._prelimContent,i=e===null?0:r.findIndex(s=>s===e)+1;if(i===0&&e!==null)throw on("Reference item not found");r.splice(i,0,...t)}}delete(e,t=1){this.doc!==null?Ee(this.doc,r=>{xg(r,this,e,t)}):this._prelimContent.splice(e,t)}toArray(){return gg(this)}push(e){this.insert(this.length,e)}unshift(e){this.insert(0,e)}get(e){return yg(this,e)}slice(e=0,t=this.length){return pg(this,e,t)}forEach(e){us(this,e)}_write(e){e.writeTypeRef(LE)}},yE=n=>new si,ps=class n extends si{constructor(e="UNDEFINED"){super(),this.nodeName=e,this._prelimAttrs=new Map}get nextSibling(){let e=this._item?this._item.next:null;return e?e.content.type:null}get prevSibling(){let e=this._item?this._item.prev:null;return e?e.content.type:null}_integrate(e,t){super._integrate(e,t),this._prelimAttrs.forEach((r,i)=>{this.setAttribute(i,r)}),this._prelimAttrs=null}_copy(){return new n(this.nodeName)}clone(){let e=new n(this.nodeName),t=this.getAttributes();return vp(t,(r,i)=>{typeof r=="string"&&e.setAttribute(i,r)}),e.insert(0,this.toArray().map(r=>r instanceof qe?r.clone():r)),e}toString(){let e=this.getAttributes(),t=[],r=[];for(let a in e)r.push(a);r.sort();let i=r.length;for(let a=0;a<i;a++){let c=r[a];t.push(c+'="'+e[c]+'"')}let s=this.nodeName.toLocaleLowerCase(),o=t.length>0?" "+t.join(" "):"";return`<${s}${o}>${super.toString()}</${s}>`}removeAttribute(e){this.doc!==null?Ee(this.doc,t=>{$o(t,this,e)}):this._prelimAttrs.delete(e)}setAttribute(e,t){this.doc!==null?Ee(this.doc,r=>{Ul(r,this,e,t)}):this._prelimAttrs.set(e,t)}getAttribute(e){return Ol(this,e)}hasAttribute(e){return Eg(this,e)}getAttributes(e){return e?uE(this,e):bg(this)}toDOM(e=document,t={},r){let i=e.createElement(this.nodeName),s=this.getAttributes();for(let o in s){let a=s[o];typeof a=="string"&&i.setAttribute(o,a)}return us(this,o=>{i.appendChild(o.toDOM(e,t,r))}),r!==void 0&&r._createAssociation(i,this),i}_write(e){e.writeTypeRef(PE),e.writeKey(this.nodeName)}},wE=n=>new ps(n.readKey()),El=class extends ii{constructor(e,t,r){super(e,r),this.childListChanged=!1,this.attributesChanged=new Set,t.forEach(i=>{i===null?this.childListChanged=!0:this.attributesChanged.add(i)})}},Sl=class n extends hs{constructor(e){super(),this.hookName=e}_copy(){return new n(this.hookName)}clone(){let e=new n(this.hookName);return this.forEach((t,r)=>{e.set(r,t)}),e}toDOM(e=document,t={},r){let i=t[this.hookName],s;return i!==void 0?s=i.createDom(this):s=document.createElement(this.hookName),s.setAttribute("data-yjs-hook",this.hookName),r!==void 0&&r._createAssociation(s,this),s}_write(e){e.writeTypeRef(ME),e.writeKey(this.hookName)}},vE=n=>new Sl(n.readKey()),kl=class n extends ds{get nextSibling(){let e=this._item?this._item.next:null;return e?e.content.type:null}get prevSibling(){let e=this._item?this._item.prev:null;return e?e.content.type:null}_copy(){return new n}clone(){let e=new n;return e.applyDelta(this.toDelta()),e}toDOM(e=document,t,r){let i=e.createTextNode(this.toString());return r!==void 0&&r._createAssociation(i,this),i}toString(){return this.toDelta().map(e=>{let t=[];for(let i in e.attributes){let s=[];for(let o in e.attributes[i])s.push({key:o,value:e.attributes[i][o]});s.sort((o,a)=>o.key<a.key?-1:1),t.push({nodeName:i,attrs:s})}t.sort((i,s)=>i.nodeName<s.nodeName?-1:1);let r="";for(let i=0;i<t.length;i++){let s=t[i];r+=`<${s.nodeName}`;for(let o=0;o<s.attrs.length;o++){let a=s.attrs[o];r+=` ${a.key}="${a.value}"`}r+=">"}r+=e.insert;for(let i=t.length-1;i>=0;i--)r+=`</${t[i].nodeName}>`;return r}).join("")}toJSON(){return this.toString()}_write(e){e.writeTypeRef(BE)}},xE=n=>new kl,gs=class{constructor(e,t){this.id=e,this.length=t}get deleted(){throw Wt()}mergeWith(e){return!1}write(e,t,r){throw Wt()}integrate(e,t){throw Wt()}},bE=0,pt=class extends gs{get deleted(){return!0}delete(){}mergeWith(e){return this.constructor!==e.constructor?!1:(this.length+=e.length,!0)}integrate(e,t){t>0&&(this.id.clock+=t,this.length-=t),cg(e.doc.store,this)}write(e,t){e.writeInfo(bE),e.writeLen(this.length-t)}getMissing(e,t){return null}},ms=class n{constructor(e){this.content=e}getLength(){return 1}getContent(){return[this.content]}isCountable(){return!0}copy(){return new n(this.content)}splice(e){throw Wt()}mergeWith(e){return!1}integrate(e,t){}delete(e){}gc(e){}write(e,t){e.writeBuf(this.content)}getRef(){return 3}},EE=n=>new ms(n.readBuf()),zo=class n{constructor(e){this.len=e}getLength(){return this.len}getContent(){return[]}isCountable(){return!1}copy(){return new n(this.len)}splice(e){let t=new n(this.len-e);return this.len=e,t}mergeWith(e){return this.len+=e.len,!0}integrate(e,t){No(e.deleteSet,t.id.client,t.id.clock,this.len),t.markDeleted()}delete(e){}gc(e){}write(e,t){e.writeLen(this.len-t)}getRef(){return 1}},SE=n=>new zo(n.readLen()),Tg=(n,e)=>new Cr({guid:n,...e,shouldLoad:e.shouldLoad||e.autoLoad||!1}),ys=class n{constructor(e){e._item&&console.error("This document was already integrated as a sub-document. You should create a second instance instead with the same guid."),this.doc=e;let t={};this.opts=t,e.gc||(t.gc=!1),e.autoLoad&&(t.autoLoad=!0),e.meta!==null&&(t.meta=e.meta)}getLength(){return 1}getContent(){return[this.doc]}isCountable(){return!0}copy(){return new n(Tg(this.doc.guid,this.opts))}splice(e){throw Wt()}mergeWith(e){return!1}integrate(e,t){this.doc._item=t,e.subdocsAdded.add(this.doc),this.doc.shouldLoad&&e.subdocsLoaded.add(this.doc)}delete(e){e.subdocsAdded.has(this.doc)?e.subdocsAdded.delete(this.doc):e.subdocsRemoved.add(this.doc)}gc(e){}write(e,t){e.writeString(this.doc.guid),e.writeAny(this.opts)}getRef(){return 9}},kE=n=>new ys(Tg(n.readString(),n.readAny())),Rr=class n{constructor(e){this.embed=e}getLength(){return 1}getContent(){return[this.embed]}isCountable(){return!0}copy(){return new n(this.embed)}splice(e){throw Wt()}mergeWith(e){return!1}integrate(e,t){}delete(e){}gc(e){}write(e,t){e.writeJSON(this.embed)}getRef(){return 5}},_E=n=>new Rr(n.readJSON()),ze=class n{constructor(e,t){this.key=e,this.value=t}getLength(){return 1}getContent(){return[]}isCountable(){return!1}copy(){return new n(this.key,this.value)}splice(e){throw Wt()}mergeWith(e){return!1}integrate(e,t){let r=t.parent;r._searchMarker=null,r._hasFormatting=!0}delete(e){}gc(e){}write(e,t){e.writeKey(this.key),e.writeJSON(this.value)}getRef(){return 6}},AE=n=>new ze(n.readKey(),n.readJSON()),_l=class n{constructor(e){this.arr=e}getLength(){return this.arr.length}getContent(){return this.arr}isCountable(){return!0}copy(){return new n(this.arr)}splice(e){let t=new n(this.arr.slice(e));return this.arr=this.arr.slice(0,e),t}mergeWith(e){return this.arr=this.arr.concat(e.arr),!0}integrate(e,t){}delete(e){}gc(e){}write(e,t){let r=this.arr.length;e.writeLen(r-t);for(let i=t;i<r;i++){let s=this.arr[i];e.writeString(s===void 0?"undefined":JSON.stringify(s))}}getRef(){return 2}},TE=n=>{let e=n.readLen(),t=[];for(let r=0;r<e;r++){let i=n.readString();i==="undefined"?t.push(void 0):t.push(JSON.parse(i))}return new _l(t)},CE=ts("node_env")==="development",oi=class n{constructor(e){this.arr=e,CE&&el(e)}getLength(){return this.arr.length}getContent(){return this.arr}isCountable(){return!0}copy(){return new n(this.arr)}splice(e){let t=new n(this.arr.slice(e));return this.arr=this.arr.slice(0,e),t}mergeWith(e){return this.arr=this.arr.concat(e.arr),!0}integrate(e,t){}delete(e){}gc(e){}write(e,t){let r=this.arr.length;e.writeLen(r-t);for(let i=t;i<r;i++){let s=this.arr[i];e.writeAny(s)}}getRef(){return 8}},IE=n=>{let e=n.readLen(),t=[];for(let r=0;r<e;r++)t.push(n.readAny());return new oi(t)},Cn=class n{constructor(e){this.str=e}getLength(){return this.str.length}getContent(){return this.str.split("")}isCountable(){return!0}copy(){return new n(this.str)}splice(e){let t=new n(this.str.slice(e));this.str=this.str.slice(0,e);let r=this.str.charCodeAt(e-1);return r>=55296&&r<=56319&&(this.str=this.str.slice(0,e-1)+"\uFFFD",t.str="\uFFFD"+t.str.slice(1)),t}mergeWith(e){return this.str+=e.str,!0}integrate(e,t){}delete(e){}gc(e){}write(e,t){e.writeString(t===0?this.str:this.str.slice(t))}getRef(){return 4}},RE=n=>new Cn(n.readString()),DE=[hE,fE,mE,wE,yE,vE,xE],UE=0,OE=1,NE=2,PE=3,LE=4,ME=5,BE=6,hn=class n{constructor(e){this.type=e}getLength(){return 1}getContent(){return[this.type]}isCountable(){return!0}copy(){return new n(this.type._copy())}splice(e){throw Wt()}mergeWith(e){return!1}integrate(e,t){this.type._integrate(e.doc,t)}delete(e){let t=this.type._start;for(;t!==null;)t.deleted?t.id.clock<(e.beforeState.get(t.id.client)||0)&&e._mergeStructs.push(t):t.delete(e),t=t.right;this.type._map.forEach(r=>{r.deleted?r.id.clock<(e.beforeState.get(r.id.client)||0)&&e._mergeStructs.push(r):r.delete(e)}),e.changed.delete(this.type)}gc(e){let t=this.type._start;for(;t!==null;)t.gc(e,!0),t=t.right;this.type._start=null,this.type._map.forEach(r=>{for(;r!==null;)r.gc(e,!0),r=r.left}),this.type._map=new Map}write(e,t){this.type._write(e)}getRef(){return 7}},FE=n=>new hn(DE[n.readTypeRef()](n)),Jp=(n,e)=>{let t=e,r=0,i;do r>0&&(t=re(t.client,t.clock+r)),i=ri(n,t),r=t.clock-i.id.clock,t=i.redone;while(t!==null&&i instanceof Me);return{item:i,diff:r}};var Go=(n,e,t)=>{let{client:r,clock:i}=e.id,s=new Me(re(r,i+t),e,re(r,i+t-1),e.right,e.rightOrigin,e.parent,e.parentSub,e.content.splice(t));return e.deleted&&s.markDeleted(),e.keep&&(s.keep=!0),e.redone!==null&&(s.redone=re(e.redone.client,e.redone.clock+t)),e.right=s,s.right!==null&&(s.right.left=s),n._mergeStructs.push(s),s.parentSub!==null&&s.right===null&&s.parent._map.set(s.parentSub,s),e.length=t,s};var Me=class n extends gs{constructor(e,t,r,i,s,o,a,c){super(e,c.getLength()),this.origin=r,this.left=t,this.right=i,this.rightOrigin=s,this.parent=o,this.parentSub=a,this.redone=null,this.content=c,this.info=this.content.isCountable()?2:0}set marker(e){(this.info&8)>0!==e&&(this.info^=8)}get marker(){return(this.info&8)>0}get keep(){return(this.info&1)>0}set keep(e){this.keep!==e&&(this.info^=1)}get countable(){return(this.info&2)>0}get deleted(){return(this.info&4)>0}set deleted(e){this.deleted!==e&&(this.info^=4)}markDeleted(){this.info|=4}getMissing(e,t){if(this.origin&&this.origin.client!==this.id.client&&this.origin.clock>=je(t,this.origin.client))return this.origin.client;if(this.rightOrigin&&this.rightOrigin.client!==this.id.client&&this.rightOrigin.clock>=je(t,this.rightOrigin.client))return this.rightOrigin.client;if(this.parent&&this.parent.constructor===Qn&&this.id.client!==this.parent.client&&this.parent.clock>=je(t,this.parent.client))return this.parent.client;if(this.origin&&(this.left=$p(e,t,this.origin),this.origin=this.left.lastId),this.rightOrigin&&(this.right=er(e,this.rightOrigin),this.rightOrigin=this.right.id),this.left&&this.left.constructor===pt||this.right&&this.right.constructor===pt)this.parent=null;else if(!this.parent)this.left&&this.left.constructor===n?(this.parent=this.left.parent,this.parentSub=this.left.parentSub):this.right&&this.right.constructor===n&&(this.parent=this.right.parent,this.parentSub=this.right.parentSub);else if(this.parent.constructor===Qn){let r=ri(t,this.parent);r.constructor===pt?this.parent=null:this.parent=r.content.type}return null}integrate(e,t){if(t>0&&(this.id.clock+=t,this.left=$p(e,e.doc.store,re(this.id.client,this.id.clock-1)),this.origin=this.left.lastId,this.content=this.content.splice(t),this.length-=t),this.parent){if(!this.left&&(!this.right||this.right.left!==null)||this.left&&this.left.right!==this.right){let r=this.left,i;if(r!==null)i=r.right;else if(this.parentSub!==null)for(i=this.parent._map.get(this.parentSub)||null;i!==null&&i.left!==null;)i=i.left;else i=this.parent._start;let s=new Set,o=new Set;for(;i!==null&&i!==this.right;){if(o.add(i),s.add(i),Co(this.origin,i.origin)){if(i.id.client<this.id.client)r=i,s.clear();else if(Co(this.rightOrigin,i.rightOrigin))break}else if(i.origin!==null&&o.has(ri(e.doc.store,i.origin)))s.has(ri(e.doc.store,i.origin))||(r=i,s.clear());else break;i=i.right}this.left=r}if(this.left!==null){let r=this.left.right;this.right=r,this.left.right=this}else{let r;if(this.parentSub!==null)for(r=this.parent._map.get(this.parentSub)||null;r!==null&&r.left!==null;)r=r.left;else r=this.parent._start,this.parent._start=this;this.right=r}this.right!==null?this.right.left=this:this.parentSub!==null&&(this.parent._map.set(this.parentSub,this),this.left!==null&&this.left.delete(e)),this.parentSub===null&&this.countable&&!this.deleted&&(this.parent._length+=this.length),cg(e.doc.store,this),this.content.integrate(e,this),zp(e,this.parent,this.parentSub),(this.parent._item!==null&&this.parent._item.deleted||this.parentSub!==null&&this.right!==null)&&this.delete(e)}else new pt(this.id,this.length).integrate(e,0)}get next(){let e=this.right;for(;e!==null&&e.deleted;)e=e.right;return e}get prev(){let e=this.left;for(;e!==null&&e.deleted;)e=e.left;return e}get lastId(){return this.length===1?this.id:re(this.id.client,this.id.clock+this.length-1)}mergeWith(e){if(this.constructor===e.constructor&&Co(e.origin,this.lastId)&&this.right===e&&Co(this.rightOrigin,e.rightOrigin)&&this.id.client===e.id.client&&this.id.clock+this.length===e.id.clock&&this.deleted===e.deleted&&this.redone===null&&e.redone===null&&this.content.constructor===e.content.constructor&&this.content.mergeWith(e.content)){let t=this.parent._searchMarker;return t&&t.forEach(r=>{r.p===e&&(r.p=this,!this.deleted&&this.countable&&(r.index-=this.length))}),e.keep&&(this.keep=!0),this.right=e.right,this.right!==null&&(this.right.left=this),this.length+=e.length,!0}return!1}delete(e){if(!this.deleted){let t=this.parent;this.countable&&this.parentSub===null&&(t._length-=this.length),this.markDeleted(),No(e.deleteSet,this.id.client,this.id.clock,this.length),zp(e,t,this.parentSub),this.content.delete(e)}}gc(e,t){if(!this.deleted)throw Nt();this.content.gc(e),t?Yb(e,this,new pt(this.id,this.length)):this.content=new zo(this.length)}write(e,t){let r=t>0?re(this.id.client,this.id.clock+t-1):this.origin,i=this.rightOrigin,s=this.parentSub,o=this.content.getRef()&31|(r===null?0:128)|(i===null?0:64)|(s===null?0:32);if(e.writeInfo(o),r!==null&&e.writeLeftID(r),i!==null&&e.writeRightID(i),r===null&&i===null){let a=this.parent;if(a._item!==void 0){let c=a._item;if(c===null){let u=ag(a);e.writeParentInfo(!0),e.writeString(u)}else e.writeParentInfo(!1),e.writeLeftID(c.id)}else a.constructor===String?(e.writeParentInfo(!0),e.writeString(a)):a.constructor===Qn?(e.writeParentInfo(!1),e.writeLeftID(a)):Nt();s!==null&&e.writeString(s)}this.content.write(e,t)}},Cg=(n,e)=>jE[e&31](n),jE=[()=>{Nt()},SE,TE,EE,RE,_E,AE,FE,IE,kE,()=>{Nt()}],VE=10,gt=class extends gs{get deleted(){return!0}delete(){}mergeWith(e){return this.constructor!==e.constructor?!1:(this.length+=e.length,!0)}integrate(e,t){Nt()}write(e,t){e.writeInfo(VE),K(e.restEncoder,this.length-t)}getMissing(e,t){return null}},Ig=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof globalThis<"u"?globalThis:{},Rg="__ $YJS$ __";Ig[Rg]===!0&&console.error("Yjs was already imported. This breaks constructor checks and will lead to issues! - https://github.com/yjs/yjs/issues/438");Ig[Rg]=!0;var Nl=3e4,Jo=class extends yo{constructor(e){super(),this.doc=e,this.clientID=e.clientID,this.states=new Map,this.meta=new Map,this._checkInterval=setInterval(()=>{let t=_r();this.getLocalState()!==null&&Nl/2<=t-this.meta.get(this.clientID).lastUpdated&&this.setLocalState(this.getLocalState());let r=[];this.meta.forEach((i,s)=>{s!==this.clientID&&Nl<=t-i.lastUpdated&&this.states.has(s)&&r.push(s)}),r.length>0&&Pl(this,r,"timeout")},dt(Nl/10)),e.on("destroy",()=>{this.destroy()}),this.setLocalState({})}destroy(){this.emit("destroy",[this]),this.setLocalState(null),super.destroy(),clearInterval(this._checkInterval)}getLocalState(){return this.states.get(this.clientID)||null}setLocalState(e){let t=this.clientID,r=this.meta.get(t),i=r===void 0?0:r.clock+1,s=this.states.get(t);e===null?this.states.delete(t):this.states.set(t,e),this.meta.set(t,{clock:i,lastUpdated:_r()});let o=[],a=[],c=[],u=[];e===null?u.push(t):s==null?e!=null&&o.push(t):(a.push(t),ei(s,e)||c.push(t)),(o.length>0||c.length>0||u.length>0)&&this.emit("change",[{added:o,updated:c,removed:u},"local"]),this.emit("update",[{added:o,updated:a,removed:u},"local"])}setLocalStateField(e,t){let r=this.getLocalState();r!==null&&this.setLocalState({...r,[e]:t})}getStates(){return this.states}},Pl=(n,e,t)=>{let r=[];for(let i=0;i<e.length;i++){let s=e[i];if(n.states.has(s)){if(n.states.delete(s),s===n.clientID){let o=n.meta.get(s);n.meta.set(s,{clock:o.clock+1,lastUpdated:_r()})}r.push(s)}}r.length>0&&(n.emit("change",[{added:[],updated:[],removed:r},t]),n.emit("update",[{added:[],updated:[],removed:r},t]))},Yo=(n,e,t=n.states)=>{let r=e.length,i=et();K(i,r);for(let s=0;s<r;s++){let o=e[s],a=t.get(o)||null,c=n.meta.get(o).clock;K(i,o),K(i,c),_n(i,JSON.stringify(a))}return ct(i)};var Ug=(n,e,t)=>{let r=Ht(e),i=_r(),s=[],o=[],a=[],c=[],u=J(r);for(let l=0;l<u;l++){let h=J(r),f=J(r),d=JSON.parse(An(r)),x=n.meta.get(h),S=n.states.get(h),j=x===void 0?0:x.clock;(j<f||j===f&&d===null&&n.states.has(h))&&(d===null?h===n.clientID&&n.getLocalState()!=null?f++:n.states.delete(h):n.states.set(h,d),n.meta.set(h,{clock:f,lastUpdated:i}),x===void 0&&d!==null?s.push(h):x!==void 0&&d===null?c.push(h):d!==null&&(ei(d,S)||a.push(h),o.push(h)))}(s.length>0||a.length>0||c.length>0)&&n.emit("change",[{added:s,updated:a,removed:c},t]),(s.length>0||o.length>0||c.length>0)&&n.emit("update",[{added:s,updated:o,removed:c},t])};var li=Fe(require("vscode"));var tr=Fe(require("vscode")),me;(s=>{s.SCHEME="oct";function e(o,a){return tr.Uri.parse(`${s.SCHEME}:///${o}${a?"/"+a:""}`)}s.create=e;function t(o){if(!o)return;let a=o.toString(!0),c=tr.workspace.workspaceFolders??[];for(let u of c){let l=u.uri.toString(!0)+"/";if(a.startsWith(l))return u.name+"/"+a.substring(l.length)}}s.getProtocolPath=t;function r(o){if(!o)return;let a=o.split("/"),c=a[0],u=a.slice(1),l=(tr.workspace.workspaceFolders??[]).find(h=>h.name===c);if(l){let h=i(l.uri.path,...u);return l.uri.with({path:h})}else return}s.getResourceUri=r;function i(...o){if(o.length===0)return".";let a;for(let c of o)c.length>0&&(a===void 0?a=c:a+="/"+c);return a===void 0?".":a}})(me||={});var In;(i=>{function n(s){return tr.Uri.parse(s.serverUrl).with({fragment:s.roomId}).toString(!0)}i.create=n;let e=/^[a-zA-Z0-9]+$/;function t(s){if(e.test(s))return{serverUrl:void 0,roomId:s};{let o=tr.Uri.parse(s,!0);if(!e.test(o.fragment))throw new Error(`Invalid room id: ${o.fragment}`);return{serverUrl:o.with({fragment:""}).toString(!0),roomId:o.fragment}}}i.parse=t;function r(s){return tr.Uri.parse(s).toString(!0)}i.normalizeServerUri=r})(In||={});var Xo=class{providerRegistration;fileSystemProvider;readOnly=!1;constructor(e,t,r){this.fileSystemProvider=new Ll(e,t,r)}registerFileSystemProvider(e){if(this.providerRegistration){if(this.readOnly===e)return;this.providerRegistration.dispose()}this.readOnly=e,this.providerRegistration=li.workspace.registerFileSystemProvider(me.SCHEME,this.fileSystemProvider,{isReadonly:e})}triggerChangeEvent(e){this.fileSystemProvider.triggerChangeEvent(e)}dispose(){this.providerRegistration?.dispose()}},Ll=class{connection;yjs;hostId;encoder=new TextEncoder;onDidChangeFileEmitter=new li.EventEmitter;constructor(e,t,r){this.connection=e,this.yjs=t,this.hostId=r}onDidChangeFile=this.onDidChangeFileEmitter.event;watch(){return li.Disposable.from()}async stat(e){let t=this.getHostPath(e);return await this.connection.fs.stat(this.hostId,t)}async readDirectory(e){let t=this.getHostPath(e),r=await this.connection.fs.readdir(this.hostId,t);return Object.entries(r)}createDirectory(e){let t=this.getHostPath(e);return this.connection.fs.mkdir(this.hostId,t)}async readFile(e){let t=this.getHostPath(e);if(this.yjs.share.has(t)){let r=this.yjs.getText(t);return this.encoder.encode(r.toString())}else return(await this.connection.fs.readFile(this.hostId,t)).content}writeFile(e,t,r){let i=this.getHostPath(e);this.connection.fs.writeFile(this.hostId,i,{content:t})}delete(e,t){return this.connection.fs.delete(this.hostId,this.getHostPath(e))}rename(e,t,r){return this.connection.fs.rename(this.hostId,this.getHostPath(e),this.getHostPath(t))}triggerChangeEvent(e){this.onDidChangeFileEmitter.fire(e)}getHostPath(e){return e.path.substring(1).split("/").slice(1).join("/")}};var Qo=0,Ng=1,Pg=2,Ml=(n,e)=>{K(n,Qo);let t=sg(e);De(n,t)},Bl=(n,e,t)=>{K(n,Ng),De(n,ng(e,t))},$E=(n,e,t)=>Bl(e,t,$e(n)),Lg=(n,e,t)=>{try{tg(e,$e(n),t)}catch(r){console.error("Caught error while handling a Yjs update",r)}},Mg=(n,e)=>{K(n,Pg),De(n,e)},qE=Lg,Bg=(n,e,t,r)=>{let i=J(n);switch(i){case Qo:$E(n,e,t);break;case Ng:Lg(n,t,r);break;case Pg:qE(n,t,r);break;default:throw new Error("Unknown message type")}return i};var Fg="local",Zo=class extends zr{connection;doc;awareness;constructor(e,t,r,i){super(),this.connection=e,this.doc=t,this.awareness=r,this.doc.on("update",this.yjsUpdateHandler.bind(this)),this.awareness.on("update",this.yjsAwarenessUpdateHandler.bind(this)),e.sync.onDataUpdate(this.ocpDataUpdateHandler.bind(this)),e.sync.onAwarenessUpdate(this.ocpAwarenessUpdateHandler.bind(this)),e.sync.onAwarenessQuery(this.ocpAwarenessQueryHandler.bind(this)),i?.resyncTimer&&i.resyncTimer>0&&this.setResyncInterval(i.resyncTimer)}setResyncInterval(e){let t=setInterval(()=>{let r=et();Ml(r,this.doc),this.connection.sync.dataUpdate(this.encode(r))},e);this.doc.on("destroy",()=>{clearInterval(t)})}ocpDataUpdateHandler(e,t){let r=this.decode(t),i=et();Bg(r,i,this.doc,e)===Qo&&this.connection.sync.dataUpdate(e,this.encode(i))}ocpAwarenessUpdateHandler(e,t){let r=this.decode(t);Ug(this.awareness,$e(r),e)}ocpAwarenessQueryHandler(e){let t=et();De(t,Yo(this.awareness,Array.from(this.awareness.getStates().keys()))),this.connection.sync.awarenessUpdate(e,this.encode(t))}yjsUpdateHandler(e,t){if(t!==this){let r=et();Mg(r,e),this.connection.sync.dataUpdate(this.encode(r))}}yjsAwarenessUpdateHandler(e){let t=e.added.concat(e.updated).concat(e.removed),r=et();De(r,Yo(this.awareness,t)),this.connection.sync.awarenessUpdate(this.encode(r))}connect(){let e=et();Ml(e,this.doc),this.connection.sync.dataUpdate(this.encode(e));let t=et();Bl(t,this.doc),this.connection.sync.dataUpdate(this.encode(t)),this.connection.sync.awarenessQuery();let r=et();De(r,Yo(this.awareness,[this.doc.clientID])),this.connection.sync.awarenessUpdate(this.encode(r))}dispose(){Pl(this.awareness,[this.doc.clientID],"client disconnected")}encode(e){return ct(e)}decode(e){return Ht(e)}};var ea;(function(n){function e(t){return[...t].sort((r,i)=>r.start-i.start)}n.sort=e})(ea||(ea={}));var Fl;(function(n){function e(s){return typeof s.insert=="string"}n.isInsert=e;function t(s){return typeof s.delete=="number"}n.isDelete=t;function r(s){return typeof s.retain=="number"}n.isRetain=r;function i(s){let o=[],a=0;for(let c of s)r(c)?a+=c.retain:e(c)?o.push({start:a,end:a,text:c.insert}):t(c)&&(o.push({start:a,end:a+c.delete,text:""}),a+=c.delete);return o}n.toChanges=i})(Fl||(Fl={}));var ta=class{_yjsText;_text;_textLength;_normalizedLength;_changeSets=[];_offsets;observer;constructor(e,t){this._yjsText=e,this._text=e.toString(),this.observer=r=>{this.observe(r,t)},e.observe(this.observer)}async observe(e,t){if(e.transaction.local)return;let r=this._text.includes("\r"),i=Fl.toChanges(e.delta),s=[];for(let l of i)s.push({start:this.originalOffset(l.start),end:this.originalOffset(l.end),text:this.normalize(l.text,r)});let o=this._text;this.doUpdate({changes:s},!1);let a=this._text,c={before:o,after:a};this._changeSets.push(c),await t(s);let u=this._changeSets.indexOf(c);u!==-1&&this._changeSets.splice(u,1)}dispose(){this._yjsText.unobserve(this.observer)}originalOffset(e){let t=this.findLineOffset(e,"normalized").offsets,r=e-t.normalized;return t.offset+r}originalOffsetAt(e){return this.offsetAt(e,"offset",this._textLength)}offsetAt(e,t,r){let i=this.getLineOffsets();if(e.line>=i.length)return r;if(e.line<0)return 0;let s=i[e.line][t];return e.character<=0?s:Math.min(s+e.character,r)}positionAtNormalized(e){return this.positionAt(this.originalOffset(e))}positionAt(e){let t=this.getLineOffsets(),r=0,i=t.length;if(i===0)return{line:0,character:e};for(;r<i;){let o=Math.floor((r+i)/2);t[o].offset>e?i=o:r=o+1}let s=r-1;return e=this.ensureBeforeEOL(e,t[s].offset),{line:s,character:e-t[s].offset}}normalizedOffset(e){let t=this.findLineOffset(e,"offset").offsets,r=e-t.offset;return t.normalized+r}normalizedOffsetAt(e){return this.offsetAt(e,"normalized",this._normalizedLength)}update(e){let t=()=>{typeof e.changes=="string"?this.doUpdate(e,!0):this.shouldApply(e.changes)&&this.doUpdate(e,!0)};this._yjsText.doc?this._yjsText.doc.transact(()=>t()):t()}shouldApply(e){e=ea.sort(e);for(let t of this._changeSets){let r=t.before,i=0;for(let s of e){let{start:o,end:a,text:c}=s;r=r.substring(0,o+i)+c+r.substring(a+i),i+=s.text.length-(a-o)}if(r===t.after)return!1}return!0}doUpdate(e,t){if(this._offsets=void 0,typeof e.changes=="string"){if(this._text=e.changes,t){let r=this._yjsText.toString();this._yjsText.delete(0,r.length),this._yjsText.insert(0,this.normalize(this._text,!1))}}else{let r=0;for(let i of ea.sort(e.changes)){let s=i.start+r,o=i.end+r,[a,c]=this.countNormalizedOffsets(s,o);this._text=this._text.substring(0,s)+i.text+this._text.substring(o),r+=i.text.length-(o-s),t&&(this._yjsText.delete(a,c-a),this._yjsText.insert(a,this.normalize(i.text,!1)))}}}countNormalizedOffsets(e,t){let r=0,i=0,s=0;for(;s<t;s++)this._text.charCodeAt(s)!==13&&(s<e&&r++,i++);return[r,i]}normalize(e,t){let r=t?`\r
`:`
`;return e.replace(/\r?\n/g,r)}ensureBeforeEOL(e,t){for(;e>t&&jg(this._text.charCodeAt(e-1));)e--;return e}findLineOffset(e,t){let r=this.getLineOffsets(),i=0,s=r.length;for(;i<s;){let a=(i+s)/2|0;r[a][t]>e?s=a:i=a+1}let o=i-1;return{offsets:r[o],index:o}}getLineOffsets(){if(this._offsets===void 0){let e=GE(this._text);this._offsets=e.offsets,this._textLength=e.length,this._normalizedLength=e.normalizedLength}return this._offsets}};function GE(n){let e=[{normalized:0,offset:0}],t=0;for(let r=0;r<n.length;r++){let i=n.charCodeAt(r);if(jg(i)){i===13&&r+1<n.length&&n.charCodeAt(r+1)===10&&(r++,t++);let s=r+1,o=s-t;e.push({normalized:o,offset:s})}}return{offsets:e,length:n.length,normalizedLength:n.length+e.length-t}}function jg(n){return n===13||n===10}var wu=Fe(ql()),ly=Fe(vm());var KC=Fe(Ea(),1);var zl=Symbol.for("@inversifyjs/common/islazyServiceIdentifier"),ui=class{[zl];#e;constructor(e){this.#e=e,this[zl]=!0}static is(e){return typeof e=="object"&&e!==null&&e[zl]===!0}unwrap(){return this.#e()}};function fn(n,e){return Reflect.getMetadata(e,n)}function Gl(n,e,t,r){let i=r(fn(n,e)??t);Reflect.defineMetadata(e,i,n)}var ra="named",Jl="name",Yl="unmanaged",Xl="optional",Ql="inject",Zl="multi_inject",bm="post_construct",Em="pre_destroy",BS=[Ql,Zl,Jl,Yl,ra,Xl],Wl=Symbol.for("@inversifyjs/core/InversifyCoreError"),Rn=class n extends Error{[Wl];kind;constructor(e,t,r){super(t,r),this[Wl]=!0,this.kind=e}static is(e){return typeof e=="object"&&e!==null&&e[Wl]===!0}static isErrorOfKind(e,t){return n.is(e)&&e.kind===t}},Dn,lt;function Sm(n,e){let t=[];for(let r=0;r<e.length;++r)e[r]===void 0&&t.push(r);if(t.length>0)throw new Rn(Dn.missingInjectionDecorator,`Found unexpected missing metadata on type "${n.name}" at constructor indexes "${t.join('", "')}".

Are you using @inject, @multiInject or @unmanaged decorators at those indexes?

If you're using typescript and want to rely on auto injection, set "emitDecoratorMetadata" compiler option to true`)}function km(n){return{kind:lt.singleInjection,name:void 0,optional:!1,tags:new Map,targetName:void 0,value:n}}function bs(n){let e=n.find(o=>o.key===Ql),t=n.find(o=>o.key===Zl);if(n.find(o=>o.key===Yl)!==void 0)return function(o,a){if(a!==void 0||o!==void 0)throw new Rn(Dn.missingInjectionDecorator,"Expected a single @inject, @multiInject or @unmanaged metadata");return{kind:lt.unmanaged}}(e,t);if(t===void 0&&e===void 0)throw new Rn(Dn.missingInjectionDecorator,"Expected @inject, @multiInject or @unmanaged metadata");let r=n.find(o=>o.key===ra),i=n.find(o=>o.key===Xl),s=n.find(o=>o.key===Jl);return{kind:e===void 0?lt.multipleInjection:lt.singleInjection,name:r?.value,optional:i!==void 0,tags:new Map(n.filter(o=>BS.every(a=>o.key!==a)).map(o=>[o.key,o.value])),targetName:s?.value,value:e===void 0?t?.value:e.value}}function _m(n,e,t){try{return bs(t)}catch(r){throw Rn.isErrorOfKind(r,Dn.missingInjectionDecorator)?new Rn(Dn.missingInjectionDecorator,`Expected a single @inject, @multiInject or @unmanaged decorator at type "${n.name}" at constructor arguments at index "${e.toString()}"`,{cause:r}):r}}function FS(n){let e=fn(n,"design:paramtypes"),t=fn(n,"inversify:tagged"),r=[];if(t!==void 0)for(let[i,s]of Object.entries(t)){let o=parseInt(i);r[o]=_m(n,o,s)}if(e!==void 0){for(let i=0;i<e.length;++i)if(r[i]===void 0){let s=e[i];r[i]=km(s)}}return Sm(n,r),r}function Am(n,e,t){try{return bs(t)}catch(r){throw Rn.isErrorOfKind(r,Dn.missingInjectionDecorator)?new Rn(Dn.missingInjectionDecorator,`Expected a single @inject, @multiInject or @unmanaged decorator at type "${n.name}" at property "${e.toString()}"`,{cause:r}):r}}function Tm(n){let e=fn(n,"inversify:tagged_props"),t=new Map;if(e!==void 0)for(let r of Reflect.ownKeys(e)){let i=e[r];t.set(r,Am(n,r,i))}return t}function jS(n){let e=fn(n,bm),t=fn(n,Em);return{constructorArguments:FS(n),lifecycle:{postConstructMethodName:e?.value,preDestroyMethodName:t?.value},properties:Tm(n)}}function VS(n,e){let t=e.getConstructorMetadata(n),r=[];for(let[i,s]of Object.entries(t.userGeneratedMetadata)){let o=parseInt(i);r[o]=_m(n,o,s)}if(t.compilerGeneratedMetadata!==void 0){for(let i=0;i<t.compilerGeneratedMetadata.length;++i)if(r[i]===void 0){let s=t.compilerGeneratedMetadata[i];r[i]=km(s)}}return Sm(n,r),r}function Cm(n,e){let t=e.getPropertiesMetadata(n),r=new Map;for(let i of Reflect.ownKeys(t)){let s=t[i];r.set(i,Am(n,i,s))}return r}function $S(n,e){let t=fn(n,bm),r=fn(n,Em);return{constructorArguments:VS(n,e),lifecycle:{postConstructMethodName:t?.value,preDestroyMethodName:r?.value},properties:Cm(n,e)}}function xm(n){return Object.getPrototypeOf(n.prototype)?.constructor}function qS(n){return n.kind===lt.unmanaged?[{key:Yl,value:!0}]:function(e){let t=[zS(e)];e.name!==void 0&&t.push({key:ra,value:e.name}),e.optional&&t.push({key:Xl,value:!0});for(let[r,i]of e.tags)t.push({key:r,value:i});return e.targetName!==void 0&&t.push({key:Jl,value:e.targetName}),t}(n)}function zS(n){let e;switch(n.kind){case lt.multipleInjection:e={key:Zl,value:n.value};break;case lt.singleInjection:e={key:Ql,value:n.value}}return e}(function(n){n[n.injectionDecoratorConflict=0]="injectionDecoratorConflict",n[n.missingInjectionDecorator=1]="missingInjectionDecorator",n[n.planning=2]="planning",n[n.unknown=3]="unknown"})(Dn||(Dn={})),function(n){n[n.multipleInjection=0]="multipleInjection",n[n.singleInjection=1]="singleInjection",n[n.unmanaged=2]="unmanaged"}(lt||(lt={}));var Kl=class{#e;constructor(e){this.#e=e}startsWith(e){return this.#e.startsWith(e)}endsWith(e){return this.#e.endsWith(e)}contains(e){return this.#e.includes(e)}equals(e){return this.#e===e}value(){return this.#e}},Hl="@inversifyjs/core/targetId",Dr=class{#e;#n;#r;#t;#i;#s;constructor(e,t,r){this.#n=function(){let i=fn(Object,Hl)??0;return i===Number.MAX_SAFE_INTEGER?Gl(Object,Hl,i,()=>Number.MIN_SAFE_INTEGER):Gl(Object,Hl,i,s=>s+1),i}(),this.#r=e,this.#t=void 0,this.#e=t,this.#i=new Kl(typeof e=="string"?e:e.toString().slice(7,-1)),this.#s=r}get id(){return this.#n}get identifier(){return this.#r}get metadata(){return this.#t===void 0&&(this.#t=qS(this.#e)),this.#t}get name(){return this.#i}get type(){return this.#s}get serviceIdentifier(){return ui.is(this.#e.value)?this.#e.value.unwrap():this.#e.value}getCustomTags(){return[...this.#e.tags.entries()].map(([e,t])=>({key:e,value:t}))}getNamedTag(){return this.#e.name===void 0?null:{key:ra,value:this.#e.name}}hasTag(e){return this.metadata.some(t=>t.key===e)}isArray(){return this.#e.kind===lt.multipleInjection}isNamed(){return this.#e.name!==void 0}isOptional(){return this.#e.optional}isTagged(){return this.#e.tags.size>0}matchesArray(e){return this.isArray()&&this.#e.value===e}matchesNamedTag(e){return this.#e.name===e}matchesTag(e){return t=>this.metadata.some(r=>r.key===e&&r.value===t)}},eu=n=>function(e,t){return function(r){let i=e(r),s=xm(r);for(;s!==void 0&&s!==Object;){let a=t(s);for(let[c,u]of a)i.properties.has(c)||i.properties.set(c,u);s=xm(s)}let o=[];for(let a of i.constructorArguments)if(a.kind!==lt.unmanaged){let c=a.targetName??"";o.push(new Dr(c,a,"ConstructorArgument"))}for(let[a,c]of i.properties)if(c.kind!==lt.unmanaged){let u=c.targetName??a;o.push(new Dr(u,c,"ClassProperty"))}return o}}(n===void 0?jS:e=>$S(e,n),n===void 0?Tm:e=>Cm(e,n));var bt="named",Bm="name",hu="unmanaged",fu="optional",ua="inject",ha="multi_inject",du="inversify:tagged",pu="inversify:tagged_props",nu="inversify:paramtypes",gu="design:paramtypes",sa="post_construct",_s="pre_destroy",GS=[ua,ha,Bm,hu,bt,fu],XC=Object.freeze({__proto__:null,DESIGN_PARAM_TYPES:gu,INJECT_TAG:ua,MULTI_INJECT_TAG:ha,NAMED_TAG:bt,NAME_TAG:Bm,NON_CUSTOM_TAG_KEYS:GS,OPTIONAL_TAG:fu,PARAM_TYPES:nu,POST_CONSTRUCT:sa,PRE_DESTROY:_s,TAGGED:du,TAGGED_PROP:pu,UNMANAGED_TAG:hu}),Be={Request:"Request",Singleton:"Singleton",Transient:"Transient"},Se={ConstantValue:"ConstantValue",Constructor:"Constructor",DynamicValue:"DynamicValue",Factory:"Factory",Function:"Function",Instance:"Instance",Invalid:"Invalid",Provider:"Provider"},Fm={ClassProperty:"ClassProperty",ConstructorArgument:"ConstructorArgument",Variable:"Variable"},WS=0;function fa(){return WS++}var ru=class n{id;moduleId;activated;serviceIdentifier;implementationType;cache;dynamicValue;scope;type;factory;provider;constraint;onActivation;onDeactivation;constructor(e,t){this.id=fa(),this.activated=!1,this.serviceIdentifier=e,this.scope=t,this.type=Se.Invalid,this.constraint=r=>!0,this.implementationType=null,this.cache=null,this.factory=null,this.provider=null,this.onActivation=null,this.onDeactivation=null,this.dynamicValue=null}clone(){let e=new n(this.serviceIdentifier,this.scope);return e.activated=e.scope===Be.Singleton&&this.activated,e.implementationType=this.implementationType,e.dynamicValue=this.dynamicValue,e.scope=this.scope,e.type=this.type,e.factory=this.factory,e.provider=this.provider,e.constraint=this.constraint,e.onActivation=this.onActivation,e.onDeactivation=this.onDeactivation,e.cache=this.cache,e}},jm="Metadata key was used more than once in a parameter:",Im="NULL argument",Rm="Key Not Found",HS="Ambiguous match found for serviceIdentifier:",KS="No matching bindings found for serviceIdentifier:",Vm="The @inject @multiInject @tagged and @named decorators must be applied to the parameters of a class constructor or a class property.",iu=(n,e)=>`onDeactivation() error in class ${n}: ${e}`,su=class{getConstructorMetadata(e){return{compilerGeneratedMetadata:Reflect.getMetadata(gu,e)??[],userGeneratedMetadata:Reflect.getMetadata(du,e)??{}}}getPropertiesMetadata(e){return Reflect.getMetadata(pu,e)??{}}},hi;function $m(n){return n instanceof RangeError||n.message==="Maximum call stack size exceeded"}(function(n){n[n.MultipleBindingsAvailable=2]="MultipleBindingsAvailable",n[n.NoBindingsAvailable=0]="NoBindingsAvailable",n[n.OnlyOneBindingAvailable=1]="OnlyOneBindingAvailable"})(hi||(hi={}));function nr(n){return typeof n=="function"?n.name:typeof n=="symbol"?n.toString():n}function Dm(n,e,t){let r="",i=t(n,e);return i.length!==0&&(r=`
Registered bindings:`,i.forEach(s=>{let o="Object";s.implementationType!==null&&(o=Gm(s.implementationType)),r=`${r}
 ${o}`,s.constraint.metaData&&(r=`${r} - ${s.constraint.metaData}`)})),r}function qm(n,e){return n.parentRequest!==null&&(n.parentRequest.serviceIdentifier===e||qm(n.parentRequest,e))}function zm(n){n.childRequests.forEach(e=>{if(qm(n,e.serviceIdentifier)){let t=function(r){return function s(o,a=[]){let c=nr(o.serviceIdentifier);return a.push(c),o.parentRequest!==null?s(o.parentRequest,a):a}(r).reverse().join(" --> ")}(e);throw new Error(`Circular dependency found: ${t}`)}zm(e)})}function Gm(n){if(n.name!=null&&n.name!=="")return n.name;{let e=n.toString(),t=e.match(/^function\s*([^\s(]+)/);return t===null?`Anonymous function: ${e}`:t[1]}}function Um(n){return`{"key":"${n.key.toString()}","value":"${n.value.toString()}"}`}var oa=class{id;container;plan;currentRequest;constructor(e){this.id=fa(),this.container=e}addPlan(e){this.plan=e}setCurrentRequest(e){this.currentRequest=e}},rr=class{key;value;constructor(e,t){this.key=e,this.value=t}toString(){return this.key===bt?`named: ${String(this.value).toString()} `:`tagged: { key:${this.key.toString()}, value: ${String(this.value)} }`}},ou=class{parentContext;rootRequest;constructor(e,t){this.parentContext=e,this.rootRequest=t}};function Wm(n,e){let t=function(a){return Object.getPrototypeOf(a.prototype)?.constructor}(e);if(t===void 0||t===Object)return 0;let r=eu(n)(t),i=r.map(a=>a.metadata.filter(c=>c.key===hu)),s=[].concat.apply([],i).length,o=r.length-s;return o>0?o:Wm(n,t)}var As=class n{id;serviceIdentifier;parentContext;parentRequest;bindings;childRequests;target;requestScope;constructor(e,t,r,i,s){this.id=fa(),this.serviceIdentifier=e,this.parentContext=t,this.parentRequest=r,this.target=s,this.childRequests=[],this.bindings=Array.isArray(i)?i:[i],this.requestScope=r===null?new Map:null}addChildRequest(e,t,r){let i=new n(e,this.parentContext,this,t,r);return this.childRequests.push(i),i}};function aa(n){return n._bindingDictionary}function Om(n,e,t,r,i){let s=Es(t.container,i.serviceIdentifier),o=[];return s.length===hi.NoBindingsAvailable&&t.container.options.autoBindInjectable===!0&&typeof i.serviceIdentifier=="function"&&n.getConstructorMetadata(i.serviceIdentifier).compilerGeneratedMetadata&&(t.container.bind(i.serviceIdentifier).toSelf(),s=Es(t.container,i.serviceIdentifier)),o=e?s:s.filter(a=>{let c=new As(a.serviceIdentifier,t,r,a,i);return a.constraint(c)}),function(a,c,u,l,h){switch(c.length){case hi.NoBindingsAvailable:if(l.isOptional())return c;{let f=nr(a),d=KS;throw d+=function(x,S){if(S.isTagged()||S.isNamed()){let j="",ue=S.getNamedTag(),he=S.getCustomTags();return ue!==null&&(j+=Um(ue)+`
`),he!==null&&he.forEach(le=>{j+=Um(le)+`
`}),` ${x}
 ${x} - ${j}`}return` ${x}`}(f,l),d+=Dm(h,f,Es),u!==null&&(d+=`
Trying to resolve bindings for "${nr(u.serviceIdentifier)}"`),new Error(d)}case hi.OnlyOneBindingAvailable:return c;case hi.MultipleBindingsAvailable:default:if(l.isArray())return c;{let f=nr(a),d=`${HS} ${f}`;throw d+=Dm(h,f,Es),new Error(d)}}}(i.serviceIdentifier,o,r,i,t.container),o}function Hm(n,e){let t=e.isMultiInject?ha:ua,r=[new rr(t,n)];return e.customTag!==void 0&&r.push(new rr(e.customTag.key,e.customTag.value)),e.isOptional===!0&&r.push(new rr(fu,!0)),r}function Km(n,e,t,r,i,s){let o,a;if(i===null){o=Om(n,e,r,null,s),a=new As(t,r,null,o,s);let c=new ou(r,a);r.addPlan(c)}else o=Om(n,e,r,i,s),a=i.addChildRequest(s.serviceIdentifier,o,s);o.forEach(c=>{let u=null;if(s.isArray())u=a.addChildRequest(c.serviceIdentifier,c,s);else{if(c.cache!==null)return;u=a}if(c.type===Se.Instance&&c.implementationType!==null){let l=function(h,f){return eu(h)(f)}(n,c.implementationType);if(r.container.options.skipBaseClassChecks!==!0){let h=Wm(n,c.implementationType);if(l.length<h){let f=`The number of constructor arguments in the derived class ${Gm(c.implementationType)} must be >= than the number of constructor arguments of its base class.`;throw new Error(f)}}l.forEach(h=>{Km(n,!1,h.serviceIdentifier,r,u,h)})}})}function Es(n,e){let t=[],r=aa(n);return r.hasKey(e)?t=r.get(e):n.parent!==null&&(t=Es(n.parent,e)),t}function JS(n,e,t,r,i,s=!1){let o=new oa(e),a=function(c,u,l){let h=Hm(u,l),f=bs(h);if(f.kind===lt.unmanaged)throw new Error("Unexpected metadata when creating target");return new Dr("",f,c)}(t,r,i);try{return Km(n,s,r,o,null,a),o}catch(c){throw $m(c)&&zm(o.plan.rootRequest),c}}function mt(n){return(typeof n=="object"&&n!==null||typeof n=="function")&&typeof n.then=="function"}function Jm(n){return!!mt(n)||Array.isArray(n)&&n.some(mt)}var YS=(n,e,t)=>{n.has(e.id)||n.set(e.id,t)},XS=(n,e)=>{n.cache=e,n.activated=!0,mt(e)&&QS(n,e)},QS=async(n,e)=>{try{let t=await e;n.cache=t}catch(t){throw n.cache=null,n.activated=!1,t}},ks;(function(n){n.DynamicValue="toDynamicValue",n.Factory="toFactory",n.Provider="toProvider"})(ks||(ks={}));function ZS(n,e,t){let r;if(e.length>0){let i=function(o,a){return o.reduce((c,u)=>{let l=a(u);return u.target.type===Fm.ConstructorArgument?c.constructorInjections.push(l):(c.propertyRequests.push(u),c.propertyInjections.push(l)),c.isAsync||(c.isAsync=Jm(l)),c},{constructorInjections:[],isAsync:!1,propertyInjections:[],propertyRequests:[]})}(e,t),s={...i,constr:n};r=i.isAsync?async function(o){let a=await Pm(o.constructorInjections),c=await Pm(o.propertyInjections);return Nm({...o,constructorInjections:a,propertyInjections:c})}(s):Nm(s)}else r=new n;return r}function Nm(n){let e=new n.constr(...n.constructorInjections);return n.propertyRequests.forEach((t,r)=>{let i=t.target.identifier,s=n.propertyInjections[r];t.target.isOptional()&&s===void 0||(e[i]=s)}),e}async function Pm(n){let e=[];for(let t of n)Array.isArray(t)?e.push(Promise.all(t)):e.push(t);return Promise.all(e)}function Lm(n,e){let t=function(r,i){if(Reflect.hasMetadata(sa,r)){let a=Reflect.getMetadata(sa,r);try{return i[a.value]?.()}catch(c){if(c instanceof Error)throw new Error((s=r.name,o=c.message,`@postConstruct error in class ${s}: ${o}`))}}var s,o}(n,e);return mt(t)?t.then(()=>e):e}function ek(n,e){n.scope!==Be.Singleton&&function(t,r){let i=`Class cannot be instantiated in ${t.scope===Be.Request?"request":"transient"} scope.`;if(typeof t.onDeactivation=="function")throw new Error(iu(r.name,i));if(Reflect.hasMetadata(_s,r))throw new Error(`@preDestroy error in class ${r.name}: ${i}`)}(n,e)}var mu=n=>e=>{e.parentContext.setCurrentRequest(e);let t=e.bindings,r=e.childRequests,i=e.target&&e.target.isArray(),s=!(e.parentRequest&&e.parentRequest.target&&e.target&&e.parentRequest.target.matchesArray(e.target.serviceIdentifier));if(i&&s)return r.map(o=>mu(n)(o));{if(e.target.isOptional()&&t.length===0)return;let o=t[0];return ik(n,e,o)}},tk=(n,e)=>{let t=(r=>{switch(r.type){case Se.Factory:return{factory:r.factory,factoryType:ks.Factory};case Se.Provider:return{factory:r.provider,factoryType:ks.Provider};case Se.DynamicValue:return{factory:r.dynamicValue,factoryType:ks.DynamicValue};default:throw new Error(`Unexpected factory type ${r.type}`)}})(n);return((r,i)=>{try{return r()}catch(s){throw $m(s)?i():s}})(()=>t.factory.bind(n)(e),()=>{return new Error((r=t.factoryType,i=e.currentRequest.serviceIdentifier.toString(),`It looks like there is a circular dependency in one of the '${r}' bindings. Please investigate bindings with service identifier '${i}'.`));var r,i})},nk=(n,e,t)=>{let r,i=e.childRequests;switch((s=>{let o=null;switch(s.type){case Se.ConstantValue:case Se.Function:o=s.cache;break;case Se.Constructor:case Se.Instance:o=s.implementationType;break;case Se.DynamicValue:o=s.dynamicValue;break;case Se.Provider:o=s.provider;break;case Se.Factory:o=s.factory}if(o===null){let a=nr(s.serviceIdentifier);throw new Error(`Invalid binding type: ${a}`)}})(t),t.type){case Se.ConstantValue:case Se.Function:r=t.cache;break;case Se.Constructor:r=t.implementationType;break;case Se.Instance:r=function(s,o,a,c){ek(s,o);let u=ZS(o,a,c);return mt(u)?u.then(l=>Lm(o,l)):Lm(o,u)}(t,t.implementationType,i,mu(n));break;default:r=tk(t,e.parentContext)}return r},rk=(n,e,t)=>{let r=((i,s)=>s.scope===Be.Singleton&&s.activated?s.cache:s.scope===Be.Request&&i.has(s.id)?i.get(s.id):null)(n,e);return r!==null||(r=t(),((i,s,o)=>{s.scope===Be.Singleton&&XS(s,o),s.scope===Be.Request&&YS(i,s,o)})(n,e,r)),r},ik=(n,e,t)=>rk(n,t,()=>{let r=nk(n,e,t);return r=mt(r)?r.then(i=>Mm(e,t,i)):Mm(e,t,r),r});function Mm(n,e,t){let r=sk(n.parentContext,e,t),i=ck(n.parentContext.container),s,o=i.next();do{s=o.value;let a=n.parentContext,c=n.serviceIdentifier,u=ak(s,c);r=mt(r)?Ym(u,a,r):ok(u,a,r),o=i.next()}while(o.done!==!0&&!aa(s).hasKey(n.serviceIdentifier));return r}var sk=(n,e,t)=>{let r;return r=typeof e.onActivation=="function"?e.onActivation(n,t):t,r},ok=(n,e,t)=>{let r=n.next();for(;r.done!==!0;){if(mt(t=r.value(e,t)))return Ym(n,e,t);r=n.next()}return t},Ym=async(n,e,t)=>{let r=await t,i=n.next();for(;i.done!==!0;)r=await i.value(e,r),i=n.next();return r},ak=(n,e)=>{let t=n._activations;return t.hasKey(e)?t.get(e).values():[].values()},ck=n=>{let e=[n],t=n.parent;for(;t!==null;)e.push(t),t=t.parent;return{next:()=>{let r=e.pop();return r!==void 0?{done:!1,value:r}:{done:!0,value:void 0}}}},Un=(n,e)=>{let t=n.parentRequest;return t!==null&&(!!e(t)||Un(t,e))},Ss=n=>e=>{let t=r=>r!==null&&r.target!==null&&r.target.matchesTag(n)(e);return t.metaData=new rr(n,e),t},ia=Ss(bt),tu=n=>e=>{let t=null;if(e!==null){if(t=e.bindings[0],typeof n=="string")return t.serviceIdentifier===n;{let r=e.bindings[0].implementationType;return n===r}}return!1},fi=class{_binding;constructor(e){this._binding=e}when(e){return this._binding.constraint=e,new Ge(this._binding)}whenTargetNamed(e){return this._binding.constraint=ia(e),new Ge(this._binding)}whenTargetIsDefault(){return this._binding.constraint=e=>e===null?!1:e.target!==null&&!e.target.isNamed()&&!e.target.isTagged(),new Ge(this._binding)}whenTargetTagged(e,t){return this._binding.constraint=Ss(e)(t),new Ge(this._binding)}whenInjectedInto(e){return this._binding.constraint=t=>t!==null&&tu(e)(t.parentRequest),new Ge(this._binding)}whenParentNamed(e){return this._binding.constraint=t=>t!==null&&ia(e)(t.parentRequest),new Ge(this._binding)}whenParentTagged(e,t){return this._binding.constraint=r=>r!==null&&Ss(e)(t)(r.parentRequest),new Ge(this._binding)}whenAnyAncestorIs(e){return this._binding.constraint=t=>t!==null&&Un(t,tu(e)),new Ge(this._binding)}whenNoAncestorIs(e){return this._binding.constraint=t=>t!==null&&!Un(t,tu(e)),new Ge(this._binding)}whenAnyAncestorNamed(e){return this._binding.constraint=t=>t!==null&&Un(t,ia(e)),new Ge(this._binding)}whenNoAncestorNamed(e){return this._binding.constraint=t=>t!==null&&!Un(t,ia(e)),new Ge(this._binding)}whenAnyAncestorTagged(e,t){return this._binding.constraint=r=>r!==null&&Un(r,Ss(e)(t)),new Ge(this._binding)}whenNoAncestorTagged(e,t){return this._binding.constraint=r=>r!==null&&!Un(r,Ss(e)(t)),new Ge(this._binding)}whenAnyAncestorMatches(e){return this._binding.constraint=t=>t!==null&&Un(t,e),new Ge(this._binding)}whenNoAncestorMatches(e){return this._binding.constraint=t=>t!==null&&!Un(t,e),new Ge(this._binding)}},Ge=class{_binding;constructor(e){this._binding=e}onActivation(e){return this._binding.onActivation=e,new fi(this._binding)}onDeactivation(e){return this._binding.onDeactivation=e,new fi(this._binding)}},Kt=class{_bindingWhenSyntax;_bindingOnSyntax;_binding;constructor(e){this._binding=e,this._bindingWhenSyntax=new fi(this._binding),this._bindingOnSyntax=new Ge(this._binding)}when(e){return this._bindingWhenSyntax.when(e)}whenTargetNamed(e){return this._bindingWhenSyntax.whenTargetNamed(e)}whenTargetIsDefault(){return this._bindingWhenSyntax.whenTargetIsDefault()}whenTargetTagged(e,t){return this._bindingWhenSyntax.whenTargetTagged(e,t)}whenInjectedInto(e){return this._bindingWhenSyntax.whenInjectedInto(e)}whenParentNamed(e){return this._bindingWhenSyntax.whenParentNamed(e)}whenParentTagged(e,t){return this._bindingWhenSyntax.whenParentTagged(e,t)}whenAnyAncestorIs(e){return this._bindingWhenSyntax.whenAnyAncestorIs(e)}whenNoAncestorIs(e){return this._bindingWhenSyntax.whenNoAncestorIs(e)}whenAnyAncestorNamed(e){return this._bindingWhenSyntax.whenAnyAncestorNamed(e)}whenAnyAncestorTagged(e,t){return this._bindingWhenSyntax.whenAnyAncestorTagged(e,t)}whenNoAncestorNamed(e){return this._bindingWhenSyntax.whenNoAncestorNamed(e)}whenNoAncestorTagged(e,t){return this._bindingWhenSyntax.whenNoAncestorTagged(e,t)}whenAnyAncestorMatches(e){return this._bindingWhenSyntax.whenAnyAncestorMatches(e)}whenNoAncestorMatches(e){return this._bindingWhenSyntax.whenNoAncestorMatches(e)}onActivation(e){return this._bindingOnSyntax.onActivation(e)}onDeactivation(e){return this._bindingOnSyntax.onDeactivation(e)}},au=class{_binding;constructor(e){this._binding=e}inRequestScope(){return this._binding.scope=Be.Request,new Kt(this._binding)}inSingletonScope(){return this._binding.scope=Be.Singleton,new Kt(this._binding)}inTransientScope(){return this._binding.scope=Be.Transient,new Kt(this._binding)}},ca=class{_bindingInSyntax;_bindingWhenSyntax;_bindingOnSyntax;_binding;constructor(e){this._binding=e,this._bindingWhenSyntax=new fi(this._binding),this._bindingOnSyntax=new Ge(this._binding),this._bindingInSyntax=new au(e)}inRequestScope(){return this._bindingInSyntax.inRequestScope()}inSingletonScope(){return this._bindingInSyntax.inSingletonScope()}inTransientScope(){return this._bindingInSyntax.inTransientScope()}when(e){return this._bindingWhenSyntax.when(e)}whenTargetNamed(e){return this._bindingWhenSyntax.whenTargetNamed(e)}whenTargetIsDefault(){return this._bindingWhenSyntax.whenTargetIsDefault()}whenTargetTagged(e,t){return this._bindingWhenSyntax.whenTargetTagged(e,t)}whenInjectedInto(e){return this._bindingWhenSyntax.whenInjectedInto(e)}whenParentNamed(e){return this._bindingWhenSyntax.whenParentNamed(e)}whenParentTagged(e,t){return this._bindingWhenSyntax.whenParentTagged(e,t)}whenAnyAncestorIs(e){return this._bindingWhenSyntax.whenAnyAncestorIs(e)}whenNoAncestorIs(e){return this._bindingWhenSyntax.whenNoAncestorIs(e)}whenAnyAncestorNamed(e){return this._bindingWhenSyntax.whenAnyAncestorNamed(e)}whenAnyAncestorTagged(e,t){return this._bindingWhenSyntax.whenAnyAncestorTagged(e,t)}whenNoAncestorNamed(e){return this._bindingWhenSyntax.whenNoAncestorNamed(e)}whenNoAncestorTagged(e,t){return this._bindingWhenSyntax.whenNoAncestorTagged(e,t)}whenAnyAncestorMatches(e){return this._bindingWhenSyntax.whenAnyAncestorMatches(e)}whenNoAncestorMatches(e){return this._bindingWhenSyntax.whenNoAncestorMatches(e)}onActivation(e){return this._bindingOnSyntax.onActivation(e)}onDeactivation(e){return this._bindingOnSyntax.onDeactivation(e)}},cu=class{_binding;constructor(e){this._binding=e}to(e){return this._binding.type=Se.Instance,this._binding.implementationType=e,new ca(this._binding)}toSelf(){if(typeof this._binding.serviceIdentifier!="function")throw new Error("The toSelf function can only be applied when a constructor is used as service identifier");let e=this._binding.serviceIdentifier;return this.to(e)}toConstantValue(e){return this._binding.type=Se.ConstantValue,this._binding.cache=e,this._binding.dynamicValue=null,this._binding.implementationType=null,this._binding.scope=Be.Singleton,new Kt(this._binding)}toDynamicValue(e){return this._binding.type=Se.DynamicValue,this._binding.cache=null,this._binding.dynamicValue=e,this._binding.implementationType=null,new ca(this._binding)}toConstructor(e){return this._binding.type=Se.Constructor,this._binding.implementationType=e,this._binding.scope=Be.Singleton,new Kt(this._binding)}toFactory(e){return this._binding.type=Se.Factory,this._binding.factory=e,this._binding.scope=Be.Singleton,new Kt(this._binding)}toFunction(e){if(typeof e!="function")throw new Error("Value provided to function binding must be a function!");let t=this.toConstantValue(e);return this._binding.type=Se.Function,this._binding.scope=Be.Singleton,t}toAutoFactory(e){return this._binding.type=Se.Factory,this._binding.factory=t=>()=>t.container.get(e),this._binding.scope=Be.Singleton,new Kt(this._binding)}toAutoNamedFactory(e){return this._binding.type=Se.Factory,this._binding.factory=t=>r=>t.container.getNamed(e,r),new Kt(this._binding)}toProvider(e){return this._binding.type=Se.Provider,this._binding.provider=e,this._binding.scope=Be.Singleton,new Kt(this._binding)}toService(e){this._binding.type=Se.DynamicValue,Object.defineProperty(this._binding,"cache",{configurable:!0,enumerable:!0,get:()=>null,set(t){}}),this._binding.dynamicValue=t=>{try{return t.container.get(e)}catch{return t.container.getAsync(e)}},this._binding.implementationType=null}},lu=class n{bindings;activations;deactivations;middleware;moduleActivationStore;static of(e,t,r,i,s){let o=new n;return o.bindings=e,o.middleware=t,o.deactivations=i,o.activations=r,o.moduleActivationStore=s,o}},On=class n{_map;constructor(){this._map=new Map}getMap(){return this._map}add(e,t){if(this._checkNonNulish(e),t==null)throw new Error(Im);let r=this._map.get(e);r!==void 0?r.push(t):this._map.set(e,[t])}get(e){this._checkNonNulish(e);let t=this._map.get(e);if(t!==void 0)return t;throw new Error(Rm)}remove(e){if(this._checkNonNulish(e),!this._map.delete(e))throw new Error(Rm)}removeIntersection(e){this.traverse((t,r)=>{let i=e.hasKey(t)?e.get(t):void 0;if(i!==void 0){let s=r.filter(o=>!i.some(a=>o===a));this._setValue(t,s)}})}removeByCondition(e){let t=[];return this._map.forEach((r,i)=>{let s=[];for(let o of r)e(o)?t.push(o):s.push(o);this._setValue(i,s)}),t}hasKey(e){return this._checkNonNulish(e),this._map.has(e)}clone(){let e=new n;return this._map.forEach((t,r)=>{t.forEach(i=>{var s;e.add(r,typeof(s=i)=="object"&&s!==null&&"clone"in s&&typeof s.clone=="function"?i.clone():i)})}),e}traverse(e){this._map.forEach((t,r)=>{e(r,t)})}_checkNonNulish(e){if(e==null)throw new Error(Im)}_setValue(e,t){t.length>0?this._map.set(e,t):this._map.delete(e)}},uu=class n{_map=new Map;remove(e){let t=this._map.get(e);return t===void 0?this._getEmptyHandlersStore():(this._map.delete(e),t)}addDeactivation(e,t,r){this._getModuleActivationHandlers(e).onDeactivations.add(t,r)}addActivation(e,t,r){this._getModuleActivationHandlers(e).onActivations.add(t,r)}clone(){let e=new n;return this._map.forEach((t,r)=>{e._map.set(r,{onActivations:t.onActivations.clone(),onDeactivations:t.onDeactivations.clone()})}),e}_getModuleActivationHandlers(e){let t=this._map.get(e);return t===void 0&&(t=this._getEmptyHandlersStore(),this._map.set(e,t)),t}_getEmptyHandlersStore(){return{onActivations:new On,onDeactivations:new On}}},la=class n{id;parent;options;_middleware;_bindingDictionary;_activations;_deactivations;_snapshots;_metadataReader;_moduleActivationStore;constructor(e){let t=e||{};if(typeof t!="object")throw new Error("Invalid Container constructor argument. Container options must be an object.");if(t.defaultScope===void 0)t.defaultScope=Be.Transient;else if(t.defaultScope!==Be.Singleton&&t.defaultScope!==Be.Transient&&t.defaultScope!==Be.Request)throw new Error('Invalid Container option. Default scope must be a string ("singleton" or "transient").');if(t.autoBindInjectable===void 0)t.autoBindInjectable=!1;else if(typeof t.autoBindInjectable!="boolean")throw new Error("Invalid Container option. Auto bind injectable must be a boolean");if(t.skipBaseClassChecks===void 0)t.skipBaseClassChecks=!1;else if(typeof t.skipBaseClassChecks!="boolean")throw new Error("Invalid Container option. Skip base check must be a boolean");this.options={autoBindInjectable:t.autoBindInjectable,defaultScope:t.defaultScope,skipBaseClassChecks:t.skipBaseClassChecks},this.id=fa(),this._bindingDictionary=new On,this._snapshots=[],this._middleware=null,this._activations=new On,this._deactivations=new On,this.parent=null,this._metadataReader=new su,this._moduleActivationStore=new uu}static merge(e,t,...r){let i=new n,s=[e,t,...r].map(a=>aa(a)),o=aa(i);return s.forEach(a=>{var c;c=o,a.traverse((u,l)=>{l.forEach(h=>{c.add(h.serviceIdentifier,h.clone())})})}),i}load(...e){let t=this._getContainerModuleHelpersFactory();for(let r of e){let i=t(r.id);r.registry(i.bindFunction,i.unbindFunction,i.isboundFunction,i.rebindFunction,i.unbindAsyncFunction,i.onActivationFunction,i.onDeactivationFunction)}}async loadAsync(...e){let t=this._getContainerModuleHelpersFactory();for(let r of e){let i=t(r.id);await r.registry(i.bindFunction,i.unbindFunction,i.isboundFunction,i.rebindFunction,i.unbindAsyncFunction,i.onActivationFunction,i.onDeactivationFunction)}}unload(...e){e.forEach(t=>{let r=this._removeModuleBindings(t.id);this._deactivateSingletons(r),this._removeModuleHandlers(t.id)})}async unloadAsync(...e){for(let t of e){let r=this._removeModuleBindings(t.id);await this._deactivateSingletonsAsync(r),this._removeModuleHandlers(t.id)}}bind(e){return this._bind(this._buildBinding(e))}rebind(e){return this.unbind(e),this.bind(e)}async rebindAsync(e){return await this.unbindAsync(e),this.bind(e)}unbind(e){if(this._bindingDictionary.hasKey(e)){let t=this._bindingDictionary.get(e);this._deactivateSingletons(t)}this._removeServiceFromDictionary(e)}async unbindAsync(e){if(this._bindingDictionary.hasKey(e)){let t=this._bindingDictionary.get(e);await this._deactivateSingletonsAsync(t)}this._removeServiceFromDictionary(e)}unbindAll(){this._bindingDictionary.traverse((e,t)=>{this._deactivateSingletons(t)}),this._bindingDictionary=new On}async unbindAllAsync(){let e=[];this._bindingDictionary.traverse((t,r)=>{e.push(this._deactivateSingletonsAsync(r))}),await Promise.all(e),this._bindingDictionary=new On}onActivation(e,t){this._activations.add(e,t)}onDeactivation(e,t){this._deactivations.add(e,t)}isBound(e){let t=this._bindingDictionary.hasKey(e);return!t&&this.parent&&(t=this.parent.isBound(e)),t}isCurrentBound(e){return this._bindingDictionary.hasKey(e)}isBoundNamed(e,t){return this.isBoundTagged(e,bt,t)}isBoundTagged(e,t,r){let i=!1;if(this._bindingDictionary.hasKey(e)){let s=this._bindingDictionary.get(e),o=function(a,c,u){let l=Hm(c,u),h=bs(l);if(h.kind===lt.unmanaged)throw new Error("Unexpected metadata when creating target");let f=new Dr("",h,"Variable"),d=new oa(a);return new As(c,d,null,[],f)}(this,e,{customTag:{key:t,value:r},isMultiInject:!1});i=s.some(a=>a.constraint(o))}return!i&&this.parent&&(i=this.parent.isBoundTagged(e,t,r)),i}snapshot(){this._snapshots.push(lu.of(this._bindingDictionary.clone(),this._middleware,this._activations.clone(),this._deactivations.clone(),this._moduleActivationStore.clone()))}restore(){let e=this._snapshots.pop();if(e===void 0)throw new Error("No snapshot available to restore.");this._bindingDictionary=e.bindings,this._activations=e.activations,this._deactivations=e.deactivations,this._middleware=e.middleware,this._moduleActivationStore=e.moduleActivationStore}createChild(e){let t=new n(e||this.options);return t.parent=this,t}applyMiddleware(...e){let t=this._middleware?this._middleware:this._planAndResolve();this._middleware=e.reduce((r,i)=>i(r),t)}applyCustomMetadataReader(e){this._metadataReader=e}get(e){let t=this._getNotAllArgs(e,!1,!1);return this._getButThrowIfAsync(t)}async getAsync(e){let t=this._getNotAllArgs(e,!1,!1);return this._get(t)}getTagged(e,t,r){let i=this._getNotAllArgs(e,!1,!1,t,r);return this._getButThrowIfAsync(i)}async getTaggedAsync(e,t,r){let i=this._getNotAllArgs(e,!1,!1,t,r);return this._get(i)}getNamed(e,t){return this.getTagged(e,bt,t)}async getNamedAsync(e,t){return this.getTaggedAsync(e,bt,t)}getAll(e,t){let r=this._getAllArgs(e,t,!1);return this._getButThrowIfAsync(r)}async getAllAsync(e,t){let r=this._getAllArgs(e,t,!1);return this._getAll(r)}getAllTagged(e,t,r){let i=this._getNotAllArgs(e,!0,!1,t,r);return this._getButThrowIfAsync(i)}async getAllTaggedAsync(e,t,r){let i=this._getNotAllArgs(e,!0,!1,t,r);return this._getAll(i)}getAllNamed(e,t){return this.getAllTagged(e,bt,t)}async getAllNamedAsync(e,t){return this.getAllTaggedAsync(e,bt,t)}resolve(e){let t=this.isBound(e);t||this.bind(e).toSelf();let r=this.get(e);return t||this.unbind(e),r}tryGet(e){let t=this._getNotAllArgs(e,!1,!0);return this._getButThrowIfAsync(t)}async tryGetAsync(e){let t=this._getNotAllArgs(e,!1,!0);return this._get(t)}tryGetTagged(e,t,r){let i=this._getNotAllArgs(e,!1,!0,t,r);return this._getButThrowIfAsync(i)}async tryGetTaggedAsync(e,t,r){let i=this._getNotAllArgs(e,!1,!0,t,r);return this._get(i)}tryGetNamed(e,t){return this.tryGetTagged(e,bt,t)}async tryGetNamedAsync(e,t){return this.tryGetTaggedAsync(e,bt,t)}tryGetAll(e,t){let r=this._getAllArgs(e,t,!0);return this._getButThrowIfAsync(r)}async tryGetAllAsync(e,t){let r=this._getAllArgs(e,t,!0);return this._getAll(r)}tryGetAllTagged(e,t,r){let i=this._getNotAllArgs(e,!0,!0,t,r);return this._getButThrowIfAsync(i)}async tryGetAllTaggedAsync(e,t,r){let i=this._getNotAllArgs(e,!0,!0,t,r);return this._getAll(i)}tryGetAllNamed(e,t){return this.tryGetAllTagged(e,bt,t)}async tryGetAllNamedAsync(e,t){return this.tryGetAllTaggedAsync(e,bt,t)}_preDestroy(e,t){if(e!==void 0&&Reflect.hasMetadata(_s,e)){let r=Reflect.getMetadata(_s,e);return t[r.value]?.()}}_removeModuleHandlers(e){let t=this._moduleActivationStore.remove(e);this._activations.removeIntersection(t.onActivations),this._deactivations.removeIntersection(t.onDeactivations)}_removeModuleBindings(e){return this._bindingDictionary.removeByCondition(t=>t.moduleId===e)}_deactivate(e,t){let r=t==null?void 0:Object.getPrototypeOf(t).constructor;try{if(this._deactivations.hasKey(e.serviceIdentifier)){let s=this._deactivateContainer(t,this._deactivations.get(e.serviceIdentifier).values());if(mt(s))return this._handleDeactivationError(s.then(async()=>this._propagateContainerDeactivationThenBindingAndPreDestroyAsync(e,t,r)),e.serviceIdentifier)}let i=this._propagateContainerDeactivationThenBindingAndPreDestroy(e,t,r);if(mt(i))return this._handleDeactivationError(i,e.serviceIdentifier)}catch(i){if(i instanceof Error)throw new Error(iu(nr(e.serviceIdentifier),i.message))}}async _handleDeactivationError(e,t){try{await e}catch(r){if(r instanceof Error)throw new Error(iu(nr(t),r.message))}}_deactivateContainer(e,t){let r=t.next();for(;typeof r.value=="function";){let i=r.value(e);if(mt(i))return i.then(async()=>this._deactivateContainerAsync(e,t));r=t.next()}}async _deactivateContainerAsync(e,t){let r=t.next();for(;typeof r.value=="function";)await r.value(e),r=t.next()}_getContainerModuleHelpersFactory(){let e=c=>u=>{let l=this._buildBinding(u);return l.moduleId=c,this._bind(l)},t=()=>c=>{this.unbind(c)},r=()=>async c=>this.unbindAsync(c),i=()=>c=>this.isBound(c),s=c=>{let u=e(c);return l=>(this.unbind(l),u(l))},o=c=>(u,l)=>{this._moduleActivationStore.addActivation(c,u,l),this.onActivation(u,l)},a=c=>(u,l)=>{this._moduleActivationStore.addDeactivation(c,u,l),this.onDeactivation(u,l)};return c=>({bindFunction:e(c),isboundFunction:i(),onActivationFunction:o(c),onDeactivationFunction:a(c),rebindFunction:s(c),unbindAsyncFunction:r(),unbindFunction:t()})}_bind(e){return this._bindingDictionary.add(e.serviceIdentifier,e),new cu(e)}_buildBinding(e){let t=this.options.defaultScope||Be.Transient;return new ru(e,t)}async _getAll(e){return Promise.all(this._get(e))}_get(e){let t={...e,contextInterceptor:r=>r,targetType:Fm.Variable};if(this._middleware){let r=this._middleware(t);if(r==null)throw new Error("Invalid return type in middleware. Middleware must return!");return r}return this._planAndResolve()(t)}_getButThrowIfAsync(e){let t=this._get(e);if(Jm(t))throw new Error(`You are attempting to construct ${function(r){return typeof r=="function"?`[function/class ${r.name||"<anonymous>"}]`:typeof r=="symbol"?r.toString():`'${r}'`}(e.serviceIdentifier)} in a synchronous way but it has asynchronous dependencies.`);return t}_getAllArgs(e,t,r){return{avoidConstraints:!t?.enforceBindingConstraints,isMultiInject:!0,isOptional:r,serviceIdentifier:e}}_getNotAllArgs(e,t,r,i,s){return{avoidConstraints:!1,isMultiInject:t,isOptional:r,key:i,serviceIdentifier:e,value:s}}_getPlanMetadataFromNextArgs(e){let t={isMultiInject:e.isMultiInject};return e.key!==void 0&&(t.customTag={key:e.key,value:e.value}),e.isOptional===!0&&(t.isOptional=!0),t}_planAndResolve(){return e=>{let t=JS(this._metadataReader,this,e.targetType,e.serviceIdentifier,this._getPlanMetadataFromNextArgs(e),e.avoidConstraints);return t=e.contextInterceptor(t),function(i){return mu(i.plan.rootRequest.requestScope)(i.plan.rootRequest)}(t)}}_deactivateIfSingleton(e){if(e.activated)return mt(e.cache)?e.cache.then(t=>this._deactivate(e,t)):this._deactivate(e,e.cache)}_deactivateSingletons(e){for(let t of e)if(mt(this._deactivateIfSingleton(t)))throw new Error("Attempting to unbind dependency with asynchronous destruction (@preDestroy or onDeactivation)")}async _deactivateSingletonsAsync(e){await Promise.all(e.map(async t=>this._deactivateIfSingleton(t)))}_propagateContainerDeactivationThenBindingAndPreDestroy(e,t,r){return this.parent?this._deactivate.bind(this.parent)(e,t):this._bindingDeactivationAndPreDestroy(e,t,r)}async _propagateContainerDeactivationThenBindingAndPreDestroyAsync(e,t,r){this.parent?await this._deactivate.bind(this.parent)(e,t):await this._bindingDeactivationAndPreDestroyAsync(e,t,r)}_removeServiceFromDictionary(e){try{this._bindingDictionary.remove(e)}catch{throw new Error(`Could not unbind serviceIdentifier: ${nr(e)}`)}}_bindingDeactivationAndPreDestroy(e,t,r){if(typeof e.onDeactivation=="function"){let i=e.onDeactivation(t);if(mt(i))return i.then(()=>this._preDestroy(r,t))}return this._preDestroy(r,t)}async _bindingDeactivationAndPreDestroyAsync(e,t,r){typeof e.onDeactivation=="function"&&await e.onDeactivation(t),await this._preDestroy(r,t)}};function lk(n,e,t,r){(function(i){if(i!==void 0)throw new Error(Vm)})(e),Xm(du,n,t.toString(),r)}function uk(n){let e=[];if(Array.isArray(n)){e=n;let t=function(r){let i=new Set;for(let s of r){if(i.has(s))return s;i.add(s)}}(e.map(r=>r.key));if(t!==void 0)throw new Error(`${jm} ${t.toString()}`)}else e=[n];return e}function Xm(n,e,t,r){let i=uk(r),s={};Reflect.hasOwnMetadata(n,e)&&(s=Reflect.getMetadata(n,e));let o=s[t];if(o===void 0)o=[];else for(let a of o)if(i.some(c=>c.key===a.key))throw new Error(`${jm} ${a.key.toString()}`);o.push(...i),s[t]=o,Reflect.defineMetadata(n,s,e)}function hk(n){return(e,t,r)=>{typeof r=="number"?lk(e,t,r,n):function(i,s,o){if(i.prototype!==void 0)throw new Error(Vm);Xm(pu,i.constructor,s,o)}(e,t,n)}}function Xe(){return function(n){if(Reflect.hasOwnMetadata(nu,n))throw new Error("Cannot apply @injectable decorator multiple times.");let e=Reflect.getMetadata(gu,n)||[];return Reflect.defineMetadata(nu,e,n),n}}function Qm(n){return e=>(t,r,i)=>{if(e===void 0){let s=typeof t=="function"?t.name:t.constructor.name;throw new Error(`@inject called with undefined this could mean that the class ${s} has a circular dependency problem. You can use a LazyServiceIdentifer to overcome this limitation.`)}hk(new rr(n,e))(t,r,i)}}var ye=Qm(ua);var QC=Qm(ha);function Zm(n,e){return()=>(t,r)=>{let i=new rr(n,r);if(Reflect.hasOwnMetadata(n,t.constructor))throw new Error(e);Reflect.defineMetadata(n,i,t.constructor)}}var da=Zm(sa,"Cannot apply @postConstruct decorator multiple times in the same class"),ZC=Zm(_s,"Cannot apply @preDestroy decorator multiple times in the same class");var Jt=Fe(require("vscode"));var ey="useandom-26T198340PX75pxJACKVERYMINDBUSHWOLF_GQZbfghjklqvwyzrict";var ty=(n=21)=>{let e="",t=crypto.getRandomValues(new Uint8Array(n|=0));for(;n--;)e+=ey[t[n]&63];return e};var ny=Fe(require("vscode")),di=ny.env.appRoot==="";function pi(){let n=Jt.workspace.workspaceFolders??[];if(n.length>0){let e=[];for(let t of n)t.uri.scheme!==me.SCHEME&&e.push(t);e.length!==n.length&&Jt.workspace.updateWorkspaceFolders(0,n.length,...e)}}async function ry(n,e){if(!(!Jt.workspace.fs.isWritableFileSystem(e.scheme)||di))try{let r=ty(24),i=e.with({path:e.path+`/workspaces/${r}`}),s={folders:n.map(c=>({name:c.name,uri:c.uri.toString(!0)}))};await Jt.workspace.fs.createDirectory(i);let o=i.with({path:i.path+"/Open Collaboration.code-workspace"}),a=new TextEncoder;return await Jt.workspace.fs.writeFile(o,a.encode(JSON.stringify(s,void 0,2))),o}catch{return}}async function pa(){let e=Jt.window.tabGroups.all.flatMap(t=>t.tabs).filter(t=>typeof t.input=="object"&&t.input&&"uri"in t.input&&t.input.uri instanceof Jt.Uri?t.input.uri.scheme===me.SCHEME:!1);await Jt.window.tabGroups.close(e)}var sy="0.3.1";var oy={resourceLabelFormatters:[{scheme:"oct",formatting:{label:"${path}",separator:"/",workspaceSuffix:"Open Collaboration Tools"}}],configuration:{title:"Open Collaboration Tools",properties:{"oct.serverUrl":{type:"string",default:"https://api.open-collab.tools/",description:"%oct.serverUrl%"},"oct.alwaysAskToOverrideServerUrl":{type:"boolean",default:!0,description:"%oct.alwaysAskToOverrideServerUrl%"}}},views:{explorer:[{id:"oct.roomView",name:"%oct.roomView%",when:"oct.connection"}]},menus:{commandPalette:[{command:"oct.followPeer",when:"oct.connection"},{command:"oct.stopFollowPeer",when:"oct.connection && oct.following"}],"view/item/context":[{command:"oct.followPeer",when:"viewItem == peer",group:"inline"},{command:"oct.stopFollowPeer",when:"viewItem == followedPeer",group:"inline"}]},commands:[{command:"oct.dev.fuzzing",title:"Run Fuzzing Test",category:"Open Collaboration Tools Developer",enablement:"oct.dev"},{command:"oct.followPeer",title:"%oct.followPeer%",category:"Open Collaboration Tools",icon:"$(eye)"},{command:"oct.stopFollowPeer",title:"%oct.stopFollowPeer%",category:"Open Collaboration Tools",icon:"$(eye-closed)"},{command:"oct.closeConnection",title:"%oct.closeConnection%",category:"Open Collaboration Tools",icon:"$(close)",enablement:"oct.connection"},{command:"oct.joinRoom",title:"%oct.joinRoom%",category:"Open Collaboration Tools",icon:"$(vm-connect)",enablement:"!oct.connection"},{command:"oct.createRoom",title:"%oct.createRoom%",category:"Open Collaboration Tools",icon:"$(vm-connect)",enablement:"workbenchState != empty && !oct.connection"},{command:"oct.signOut",title:"%oct.signOut%",category:"Open Collaboration Tools",icon:"$(sign-out)"}],colors:[{id:"oct.user.yellow",description:"%oct.user.color%",defaults:{dark:"#fcb900",light:"#fcb900"}},{id:"oct.user.green",description:"%oct.user.color%",defaults:{dark:"#107c10",light:"#107c10"}},{id:"oct.user.magenta",description:"%oct.user.color%",defaults:{dark:"#b4009e",light:"#b4009e"}},{id:"oct.user.lightGreen",description:"%oct.user.color%",defaults:{dark:"#bad80a",light:"#bad80a"}},{id:"oct.user.lightOrange",description:"%oct.user.color%",defaults:{dark:"#ff8c00",light:"#ff8c00"}},{id:"oct.user.lightMagenta",description:"%oct.user.color%",defaults:{dark:"#e3008c",light:"#e3008c"}}]};var ay=sy,yu=oy.colors.map(n=>n.id).filter(n=>n.startsWith("oct.user."));var ga=class{peer;disposables=[];yjsAwareness;decoration;get clientId(){let e=this.yjsAwareness.getStates();for(let[t,r]of e.entries())if(r.peer===this.peer.id)return t}get lastUpdated(){let e=this.clientId;if(e!==void 0){let t=this.yjsAwareness.meta.get(e);if(t)return t.lastUpdated}}constructor(e,t){this.peer=t,this.yjsAwareness=e,this.decoration=this.createDecorationType(),this.disposables.push(this.decoration)}createDecorationType(){let e=dk(),t=`var(--vscode-${e.replaceAll(".","-")})`,r={backgroundColor:`color-mix(in srgb, ${t} 25%, transparent)`,borderRadius:"0.1em"},i={color:t,contentText:"\u16D9",margin:"0px 0px 0px -0.25ch",fontWeight:"bold",textDecoration:"none; position: absolute; display: inline-block; top: 0; font-size: 200%; font-weight: bold; z-index: 1;"},s=R.window.createTextEditorDecorationType({rangeBehavior:R.DecorationRangeBehavior.ClosedClosed,...r,before:i}),o=R.window.createTextEditorDecorationType({rangeBehavior:R.DecorationRangeBehavior.ClosedClosed,...r,after:i}),a=this.createNameTag(t,"top: -1rem;"),c=this.createNameTag(t,"bottom: -1rem;");return new vu(s,o,{default:a,inverted:c},e)}createNameTag(e,t){let r={contentText:this.peer.name,backgroundColor:e,textDecoration:`none; position: absolute; border-radius: 0.15rem; padding:0px 0.5ch; display: inline-block;
                                pointer-events: none; color: #000; font-size: 0.7rem; z-index: 10; font-weight: bold;${t??""}`};return R.window.createTextEditorDecorationType({backgroundColor:e,rangeBehavior:R.DecorationRangeBehavior.ClosedClosed,before:r})}dispose(){for(let e of this.disposables)e.dispose()}},cy=0;function dk(){return cy%=yu.length,yu[cy++]}var vu=class{constructor(e,t,r,i){this.before=e;this.after=t;this.nameTags=r;this.color=i;this.toDispose=R.Disposable.from(e,t,r.default,r.inverted)}toDispose;dispose(){this.toDispose.dispose()}getThemeColor(){return new R.ThemeColor(this.color)}},ma=Symbol("CollaborationInstanceFactory"),xu=Symbol("CollaborationInstanceOptions"),ke=class{yjs=new Cr;yjsAwareness=new Jo(this.yjs);identity=new jt;toDispose=new gr;yjsProvider;resyncing=new Set;documentDisposables=new Map;peers=new Map;throttles=new Map;yjsDocuments=new Map;_permissions={readonly:!1};get permissions(){return this._permissions}_following;get following(){return this._following}_ready=new jt;get ready(){return Promise.all([this._ready.promise,this.identity.promise]).then(()=>{})}onDidUsersChangeEmitter=new R.EventEmitter;onDidUsersChange=this.onDidUsersChangeEmitter.event;onDidDisposeEmitter=new R.EventEmitter;onDidDispose=this.onDidDisposeEmitter.event;get connectedUsers(){return this.ownUserData.then(e=>{let t=Array.from(this.peers.values()).map(r=>({...r.peer,color:r.decoration.color}));return t.push(e),Array.from(t)})}get ownUserData(){return this.identity.promise}get host(){return this.options.host}get roomId(){return this.options.roomId}get connection(){return this.options.connection}get serverUrl(){return this.options.serverUrl}options;fileSystemManager;init(){this.options.host&&this._ready.resolve(),ke.Current=this;let e=this.options.connection;this.yjsProvider=new Zo(e,this.yjs,this.yjsAwareness,{resyncTimer:1e4}),this.options.hostId&&(this.fileSystemManager=new Xo(e,this.yjs,this.options.hostId),this.toDispose.push(this.fileSystemManager)),this.yjsProvider.connect(),this.toDispose.push(e),this.toDispose.push(e.onDisconnect(()=>{this.dispose()})),this.toDispose.push(e.onConnectionError(t=>{R.window.showErrorMessage(R.l10n.t("Connection error: {0}",t))})),this.toDispose.push(e.onReconnect(()=>{this.yjsProvider.connect()})),this.toDispose.push(this.yjsProvider),this.toDispose.push({dispose:()=>{this.yjs.destroy(),this.yjsAwareness.destroy()}}),this.toDispose.push(this.onDidUsersChangeEmitter),this.toDispose.push(this.onDidDisposeEmitter),e.peer.onJoinRequest(async(t,r)=>{let i=R.l10n.t("User {0} via {1} login wants to join the collaboration session",r.email?`${r.name} (${r.email})`:r.name,r.authProvider??"unknown"),s=R.l10n.t("Allow"),o=R.l10n.t("Deny"),a=await R.window.showInformationMessage(i,s,o),c=R.workspace.workspaceFolders??[];return a===s?{workspace:{name:R.workspace.name??"Collaboration",folders:c.map(u=>u.name)}}:void 0}),e.peer.onInit(async(t,r)=>{await this.initialize(r)}),e.room.onJoin(async(t,r)=>{if(this.host){let i=R.workspace.workspaceFolders??[],s={protocol:Bt,host:await this.identity.promise,guests:Array.from(this.peers.values()).map(o=>o.peer),capabilities:{},permissions:this._permissions,workspace:{name:R.workspace.name??"Collaboration",folders:i.map(o=>o.name)}};e.peer.init(r.id,s)}this.peers.set(r.id,new ga(this.yjsAwareness,r)),this.onDidUsersChangeEmitter.fire()}),e.room.onLeave(async(t,r)=>{let i=this.peers.get(r.id);i&&(i.dispose(),this.peers.delete(r.id),this.onDidUsersChangeEmitter.fire()),this.rerenderPresence()}),e.room.onClose(async()=>{this.options.host||(R.window.showInformationMessage(R.l10n.t("Collaboration session closed")),pi(),this.dispose())}),e.room.onPermissions((t,r)=>{this._permissions=r,this.fileSystemManager?.registerFileSystemProvider(r.readonly)}),e.peer.onInfo((t,r)=>{this.yjsAwareness.setLocalStateField("peer",r.id),this.identity.resolve(r),this.onDidUsersChangeEmitter.fire()}),this.registerFileEvents(),this.registerEditorEvents()}registerFileEvents(){let e=this.connection;e.fs.onStat(async(t,r)=>{let i=me.getResourceUri(r);if(i){let s=await R.workspace.fs.stat(i);return{type:s.type===R.FileType.Directory?Wi.Directory:Wi.File,mtime:s.mtime,ctime:s.ctime,size:s.size}}else throw new Error("Could not stat file")}),e.fs.onReaddir(async(t,r)=>{let i=me.getResourceUri(r);if(i)return(await R.workspace.fs.readDirectory(i)).reduce((o,[a,c])=>(o[a]=c,o),{});throw new Error("Could not read directory")}),e.fs.onReadFile(async(t,r)=>{let i=me.getResourceUri(r);if(i)return{content:await R.workspace.fs.readFile(i)};throw new Error("Could not read file")}),e.fs.onDelete(async(t,r)=>{let i=me.getResourceUri(r);if(i)await R.workspace.fs.delete(i,{recursive:!0});else throw new Error("Could not delete file")}),e.fs.onRename(async(t,r,i)=>{let s=me.getResourceUri(r),o=me.getResourceUri(i);if(s&&o)await R.workspace.fs.rename(s,o,{overwrite:!0});else throw new Error("Could not rename file")}),e.fs.onMkdir(async(t,r)=>{let i=me.getResourceUri(r);if(i)await R.workspace.fs.createDirectory(i);else throw new Error("Could not create directory")}),e.fs.onChange(async(t,r)=>{if(this.fileSystemManager){let i=[];for(let s of r.changes){let o=me.getResourceUri(s.path);o&&i.push({type:this.convertChangeType(s.type),uri:o})}this.fileSystemManager.triggerChangeEvent(i)}}),e.fs.onWriteFile(async(t,r,i)=>{let s=me.getResourceUri(r);if(s){let o=this.findDocument(s);if(o){let a=new TextDecoder().decode(i.content);a!==o.getText()&&await this.applyEdit([],()=>{let c=this.findDocument(s);c&&this.createFullDocumentEdit(c,a)}),await o.save()}else await R.workspace.fs.writeFile(s,i.content)}})}convertChangeType(e){switch(e){case Sn.Create:return R.FileChangeType.Created;case Sn.Delete:return R.FileChangeType.Deleted;case Sn.Update:return R.FileChangeType.Changed}}setPermissions(e){this._permissions=e,this.connection.room.updatePermissions(this._permissions)}async leave(){try{await this.connection.room.leave(),await new Promise(e=>setTimeout(e,100))}catch{}}dispose(){ke.Current=void 0,this.peers.forEach(e=>e.dispose()),this.peers.clear(),this.documentDisposables.forEach(e=>e.dispose()),this.documentDisposables.clear(),this.yjsDocuments.forEach(e=>e.dispose()),this.yjsDocuments.clear(),this.throttles.clear(),this.onDidDisposeEmitter.fire(),this.toDispose.dispose()}pushDocumentDisposable(e,t){let r=this.documentDisposables.get(e);r||(r=new gr,this.documentDisposables.set(e,r)),r.push(t)}registerEditorEvents(){this.connection.editor.onOpen(async(t,r)=>{let i=me.getResourceUri(r);if(i)await R.workspace.openTextDocument(i);else throw new Error("Could not open file")}),R.workspace.textDocuments.forEach(t=>{this.isNotebookCell(t)||this.registerTextDocument(t)}),this.toDispose.push(R.workspace.onDidOpenTextDocument(t=>{this.isNotebookCell(t)||this.registerTextDocument(t)})),this.toDispose.push(R.workspace.onDidChangeTextDocument(t=>{this.isNotebookCell(t.document)||this.updateTextDocument(t)})),this.toDispose.push(R.window.onDidChangeVisibleTextEditors(()=>{this.updateTextSelection(R.window.activeTextEditor),this.rerenderPresence()})),this.toDispose.push(R.workspace.onDidCloseTextDocument(t=>{let r=t.uri.toString();this.documentDisposables.get(r)?.dispose(),this.documentDisposables.delete(r),this.yjsDocuments.get(r)?.dispose(),this.yjsDocuments.delete(r);let i=me.getProtocolPath(t.uri);i&&this.throttles.delete(i)})),this.toDispose.push(R.window.onDidChangeTextEditorSelection(t=>{this.updateTextSelection(t.textEditor)})),this.toDispose.push(R.window.onDidChangeTextEditorVisibleRanges(t=>{this.updateTextSelection(t.textEditor)})),this.host&&this.createFileWatcher();let e=(0,wu.default)(()=>{this.rerenderPresence()},2e3);this.yjsAwareness.on("change",async(t,r)=>{r!==Fg&&(this.updateFollow(),this.rerenderPresence(),e())})}createFileWatcher(){let e=[],t=(0,ly.default)(()=>{let s=e.splice(0,e.length);this.connection.fs.change({changes:s})},100,{leading:!1,trailing:!0}),r=(s,o)=>{let a=me.getProtocolPath(s);a&&(e.push({path:a,type:o}),t())},i=R.workspace.createFileSystemWatcher("**/*");i.onDidChange(s=>r(s,Sn.Update)),i.onDidCreate(s=>r(s,Sn.Create)),i.onDidDelete(s=>r(s,Sn.Delete)),this.toDispose.push(i)}isNotebookCell(e){return e.uri.scheme==="vscode-notebook-cell"}followUser(e){this._following=e,this.updateFollow()}updateFollow(){if(this._following){let e,t=this.yjsAwareness.getStates();for(let r of t.values())this.peers.get(r.peer)?.peer.id===this._following&&(e=r);e&&Hi.is(e.selection)&&this.followSelection(e.selection)}}async followSelection(e){let t=me.getResourceUri(e.path);if(t&&e.visibleRanges&&e.visibleRanges.length>0){let r=R.window.visibleTextEditors.find(o=>o.document.uri.toString()===t.toString());if(!r){let o=await R.workspace.openTextDocument(t);r=await R.window.showTextDocument(o)}let i=e.visibleRanges[0],s=new R.Range(i.start.line,i.start.character,i.end.line,i.end.character);r.revealRange(s)}}updateTextSelection(e){if(!e){this.setSharedSelection(void 0);return}let t=e.document.uri,r=me.getProtocolPath(t);if(r){let i=this.yjs.getText(r),s=this.getNormalizedDocument(e.document,r),o=[];for(let c of e.selections){let u=s.normalizedOffsetAt(c.start),l=s.normalizedOffsetAt(c.end),h=c.isReversed?Kn.RightToLeft:Kn.LeftToRight,f={start:ws(i,u),end:ws(i,l),direction:h};o.push(f)}let a={path:r,textSelections:o,visibleRanges:e.visibleRanges.map(c=>({start:{line:c.start.line,character:c.start.character},end:{line:c.end.line,character:c.end.character}}))};this.setSharedSelection(a)}else this.setSharedSelection(void 0)}registerTextDocument(e){let t=e.uri,r=me.getProtocolPath(t);if(r){let i=e.getText(),s=this.getNormalizedDocument(e,r);this.host?s.update({changes:i}):this.options.connection.editor.open(this.options.hostId,r),this.pushDocumentDisposable(r,s)}}updateTextDocument(e){if(e.contentChanges.length===0)return;let t=e.document.uri,r=me.getProtocolPath(t);if(r){if(this.resyncing.has(r))return;let i=this.getNormalizedDocument(e.document,r),s=[];for(let o of e.contentChanges){let a=o.rangeOffset,c=o.rangeOffset+o.rangeLength;s.push({start:a,end:c,text:o.text})}i.update({changes:s}),this.getOrCreateThrottle(r)()}}getOrCreateThrottle(e){let t=this.throttles.get(e);if(t)return t;let r=me.getResourceUri(e);return r?(t=(0,wu.default)(async()=>{let i=this.findDocument(r);if(i){let s=this.yjs.getText(e),o=this.adjustEol(s.toString(),i.eol);o!==i.getText()&&(this.resyncing.add(e),await this.applyEdit([],()=>{let a=this.findDocument(r);return a?this.createFullDocumentEdit(a,o):void 0}),this.resyncing.delete(e))}},100,{leading:!1,trailing:!0,maxWait:500}),this.throttles.set(e,t)):(console.warn("Could not determine URI for path",e),t=()=>{}),t}async applyEdit(e,t){let r=!1,i=0,s=20;for(;!r&&i++<s;)try{let o=t(e);if(!o)return!0;r=await R.workspace.applyEdit(o)}catch{return!1}return r}findDocument(e){return R.workspace.textDocuments.find(t=>t.uri.toString()===e.toString())}createFullDocumentEdit(e,t){let r=new R.WorkspaceEdit,i=new R.Position(0,0),s=e.lineAt(e.lineCount-1).range.end;return r.replace(e.uri,new R.Range(i,s),t),r}rerenderPresence(){let e=this.yjsAwareness.getStates();for(let[t,r]of e.entries()){if(t===this.yjs.clientID)continue;let i=r.peer,s=this.peers.get(i);!r.selection||!s||Hi.is(r.selection)&&this.renderTextPresence(s,r.selection)}}renderTextPresence(e,t){let r=e.lastUpdated!==void 0&&Date.now()-e.lastUpdated<1900,{path:i,textSelections:s}=t,o=me.getResourceUri(i),a=new Set(R.window.visibleTextEditors);if(o){let c=R.window.visibleTextEditors.filter(u=>u.document.uri.toString()===o.toString());if(c.length>0){let u=c[0].document,l=this.getNormalizedDocument(u,i),h=[],f=[],d=[],x=[];for(let S of s){let j=S.direction===1,ue=vs(S.start,this.yjs),he=vs(S.end,this.yjs);if(ue&&he){let le=l.positionAtNormalized(ue.index),de=new R.Position(le.line,le.character),G=l.positionAtNormalized(he.index),z=new R.Position(G.line,G.character),ne=j&&z.line===0||!j&&de.line===0,X=new R.Range(de,z);if(j){if(h.push(X),r){let V=new R.Range(z,z);(ne?x:d).push(V)}}else if(f.push(X),r){let V=new R.Range(de,de);(ne?x:d).push(V)}}}for(let S of c)a.delete(S),S.setDecorations(e.decoration.before,f),S.setDecorations(e.decoration.after,h),S.setDecorations(e.decoration.nameTags.default,d),S.setDecorations(e.decoration.nameTags.inverted,x)}}for(let c of a)c.setDecorations(e.decoration.before,[]),c.setDecorations(e.decoration.after,[]),c.setDecorations(e.decoration.nameTags.default,[]),c.setDecorations(e.decoration.nameTags.inverted,[])}getNormalizedDocument(e,t){let r=e.uri,i=r.toString(),s=this.yjsDocuments.get(i);return s||(s=new ta(this.yjs.getText(t),async o=>{let a=this.findDocument(r);a&&(await this.applyEdit(o,c=>{let u=new R.WorkspaceEdit;for(let l of c){let h=a.positionAt(l.start),f=a.positionAt(l.end);u.replace(r,new R.Range(h,f),l.text)}return u}),this.getOrCreateThrottle(t)())}),this.yjsDocuments.set(i,s)),s}setSharedSelection(e){this.yjsAwareness.setLocalStateField("selection",e)}createSelectionFromRelative(e,t){let r=vs(e.start,this.yjs),i=vs(e.end,this.yjs);if(r&&i){let s=t.positionAt(r.index),o=t.positionAt(i.index);return e.direction===Kn.RightToLeft&&([s,o]=[o,s]),new R.Selection(s,o)}}createRelativeSelection(e,t,r){let i=ws(r,t.offsetAt(e.start)),s=ws(r,t.offsetAt(e.end));return{start:i,end:s,direction:e.isReversed?Kn.RightToLeft:Kn.LeftToRight}}async initialize(e){if(!this.fileSystemManager)throw new Error("File system manager not initialized");for(let t of[e.host,...e.guests])this.peers.set(t.id,new ga(this.yjsAwareness,t));this._permissions=e.permissions,this.fileSystemManager.registerFileSystemProvider(e.permissions.readonly),this.onDidUsersChangeEmitter.fire(),this._ready.resolve()}adjustEol(e,t){let r=t===R.EndOfLine.LF?`
`:`\r
`;return e.replace(/\r?\n/g,r)}};Du(ke,"Current"),te([ye(xu)],ke.prototype,"options",2),te([da()],ke.prototype,"init",1),ke=te([Xe()],ke);var Nn=Symbol("ExtensionContext");function uy(n){let e=new la({autoBindInjectable:!0,defaultScope:"Singleton"});return e.bind(Nn).toConstantValue(n),e.bind(ma).toFactory(t=>r=>{if(ke.Current)throw new Error("Only one collaboration instance can be active at a time");let i=t.container.createChild();return i.bind(ke).toSelf(),i.bind(xu).toConstantValue(r),i.get(ke)}),e}var Y=Fe(require("vscode"));var hy=Fe(require("vscode"));function gi(n,e){if(Array.isArray(n)){let r=n;n=hy.window.createQuickPick(),n.items=r,e&&(n.placeholder=e.placeholder,n.buttons=e.buttons??[],e.onDidTriggerButton&&n.onDidTriggerButton(e.onDidTriggerButton),e.onDidTriggerItemButton&&n.onDidTriggerItemButton(e.onDidTriggerItemButton),n.matchOnDescription=e.matchOnDescription??!1,n.matchOnDetail=e.matchOnDetail??!1,n.keepScrollPosition=e.keepScrollPosition??!1)}let t=n;return new Promise(r=>{t.show(),t.onDidAccept(()=>{r(t.activeItems[0].key),t.hide()}),t.onDidHide(()=>{r(void 0)})})}var Yt=Fe(require("vscode"));var ir=class{onDidChangeTreeDataEmitter=new Yt.EventEmitter;onDidChangeTreeData=this.onDidChangeTreeDataEmitter.event;instance;onConnection(e){this.instance=e,e.onDidUsersChange(()=>{this.onDidChangeTreeDataEmitter.fire()}),e.onDidDispose(()=>{this.instance=void 0,this.onDidChangeTreeDataEmitter.fire()}),this.onDidChangeTreeDataEmitter.fire()}async getTreeItem(e){let t=await this.instance?.ownUserData,r=new Yt.TreeItem(e.name),i=[];if(e.id===t?.id&&i.push(Yt.l10n.t("You")),e.host&&i.push(Yt.l10n.t("Host")),r.description=i.length?"("+i.join(" \u2022 ")+")":void 0,r.contextValue="self",t?.id!==e.id){let s=e.color?new Yt.ThemeColor(e.color):void 0;r.iconPath=new Yt.ThemeIcon("circle-filled",s),r.contextValue=this.instance?.following===e.id?"followedPeer":"peer"}return r}getChildren(e){return!e&&this.instance?this.instance.connectedUsers:[]}update(){this.onDidChangeTreeDataEmitter.fire()}};ir=te([Xe()],ir);var fy=Fe(require("vscode"));var dn=class{set(e,t){fy.commands.executeCommand("setContext",e,t)}setConnection(e){this.set("oct.connection",!!e),this.set("oct.roomId",e?.roomId)}setFollowing(e){this.set("oct.following",e)}};dn=te([Xe()],dn);var sr=class{viewDataProvider;contextKeyService;async followPeer(e){if(ke.Current){if(!e){let r=(await ke.Current.connectedUsers).map(i=>({label:i.name,detail:i.id,key:i.id}));e=await gi(r)}e&&(ke.Current.followUser(e),this.viewDataProvider.update(),this.contextKeyService.setFollowing(!0))}}async unfollowPeer(){ke.Current&&(ke.Current.followUser(void 0),this.viewDataProvider.update(),this.contextKeyService.setFollowing(!1))}};te([ye(ir)],sr.prototype,"viewDataProvider",2),te([ye(dn)],sr.prototype,"contextKeyService",2),sr=te([Xe()],sr);var H=Fe(require("vscode"));var Ie=Fe(require("vscode"));var ya="oct.userTokens",wa="oct.roomToken",Xt=class{context;async deleteAll(){await Promise.all([this.context.secrets.delete(ya),this.context.secrets.delete(wa)])}async storeUserToken(e,t){let r=await this.retrieveUserTokens();r[e]=t,await this.storeUserTokens(r)}async storeUserTokens(e){await this.storeJsonToken(ya,e)}async deleteUserTokens(){await this.context.secrets.delete(ya)}async retrieveUserToken(e){return(await this.retrieveUserTokens())[e]}async retrieveUserTokens(){return await this.retrieveJsonToken(ya)??{}}async consumeRoomData(){let e=await this.retrieveRoomData();return await this.storeRoomData(void 0),e}async storeRoomData(e){e===void 0?await this.context.secrets.delete(wa):await this.storeJsonToken(wa,e)}async retrieveRoomData(){return this.retrieveJsonToken(wa)}async storeJsonToken(e,t){await this.context.secrets.store(e,JSON.stringify(t))}async retrieveJsonToken(e){let t=await this.context.secrets.get(e);if(t)try{return JSON.parse(t)}catch{await this.context.secrets.delete(e);return}}};te([ye(Nn)],Xt.prototype,"context",2),Xt=te([Xe()],Xt);var Ue=require("vscode");function Et(n){switch(n.code){case ge.Codes.AuthInternalError:return Ue.l10n.t("Internal authentication server error");case ge.Codes.AuthTimeout:return Ue.l10n.t("Authentication timed out");case ge.Codes.AwaitingServerResponse:return Ue.l10n.t("Awaiting server response");case ge.Codes.IncompatibleProtocolVersions:return Ue.l10n.t("Incompatible protocol versions: client {0}, server {1}",...n.params);case ge.Codes.InvalidServerVersion:return Ue.l10n.t("Invalid protocol version returned by server: {0}",...n.params);case ge.Codes.JoinRejected:return Ue.l10n.t("Join request has been rejected");case ge.Codes.JoinRequestNotFound:return Ue.l10n.t("Join request not found");case ge.Codes.JoinTimeout:return Ue.l10n.t("Join request timed out");case ge.Codes.PerformingLogin:return Ue.l10n.t("Performing login");case ge.Codes.RoomNotFound:return Ue.l10n.t("Session not found");case ge.Codes.WaitingForHost:return Ue.l10n.t("Waiting for host to accept join request");case ge.Codes.UnverifiedLoginLabel:return Ue.l10n.t("Unverified");case ge.Codes.UnverifiedLoginDetails:return Ue.l10n.t("Login with a user name and an optional email address");case ge.Codes.GitHubLabel:return Ue.l10n.t("GitHub");case ge.Codes.GoogleLabel:return Ue.l10n.t("Google");case ge.Codes.BuiltinsGroup:return Ue.l10n.t("Built-in");case ge.Codes.ThirdParty:return Ue.l10n.t("Third-party");case ge.Codes.EmailLabel:return Ue.l10n.t("Email");case ge.Codes.EmailPlaceholder:return Ue.l10n.t("Your email that will be shown to the host when joining the session");case ge.Codes.UsernameLabel:return Ue.l10n.t("Username");case ge.Codes.UsernamePlaceholder:return Ue.l10n.t("Your user name that will be shown to all session participants")}return n.message}var bu=Symbol("Fetch"),or=class{secretStorage;fetch;async createConnection(e){let t=await this.secretStorage.retrieveUserToken(e);return new po({url:e,client:`OCT_CODE_${Ie.env.appName.replace(/[\s\-_]+/g,"_")}@${ay}`,authenticationHandler:async(r,i)=>{if(!!!i.providers.length&&i.loginPageUrl)return i.loginPageUrl?await Ie.env.openExternal(Ie.Uri.parse(i.loginPageUrl)):(Ie.window.showErrorMessage(Ie.l10n.t("No authentication method provided by the server.")),!1);let o=this.enhanceQuickPickGroups(i.providers.map(c=>({label:Et(c.label),description:c.details&&Et(c.details),provider:c}))),a=await Ie.window.showQuickPick(o,{title:Ie.l10n.t("Select Authentication Method")});if(a)switch(a.provider.type){case"form":return this.handleFormAuth(r,a.provider,e);case"web":return this.handleWebAuth(r,a.provider,e)}return!1},transports:[Wd],userToken:t,fetch:this.fetch})}enhanceQuickPickGroups(e){let t=new Map;for(let i of e){let s=Et(i.provider.group);t.has(s)||t.set(s,[]),t.get(s).push(i)}let r=[];for(let[i,s]of t)r.push({label:i,kind:Ie.QuickPickItemKind.Separator,provider:void 0}),r.push(...s);return r}async handleFormAuth(e,t,r){let i=t.fields,s={token:e};for(let c of i){let u;c.placeHolder?u=Et(c.placeHolder):u=Et(c.label),u+=c.required?"":` (${Ie.l10n.t("optional")})`;let l=await Ie.window.showInputBox({prompt:Et(c.label),placeHolder:u});if(l)s[c.name]=l;else if(c.required)return Ie.window.showErrorMessage(Ie.l10n.t("The {0} field is required. Login aborted.",Et(c.label))),!1}let o=Ie.Uri.parse(r).with({path:t.endpoint}),a=await this.fetch(o.toString(),{method:"POST",body:JSON.stringify(s),headers:{"Content-Type":"application/json"}});return a.ok?Ie.window.showInformationMessage(Ie.l10n.t("Login successful.")):Ie.window.showErrorMessage(Ie.l10n.t("Login failed.")),a.ok}async handleWebAuth(e,t,r){let i=Ie.Uri.parse(r).with({path:t.endpoint,query:`token=${e}`});return await Ie.env.openExternal(i)}};te([ye(Xt)],or.prototype,"secretStorage",2),te([ye(bu)],or.prototype,"fetch",2),or=te([Xe()],or);var ar=Fe(require("vscode"));var cr;(o=>{o.SERVER_URL="oct.serverUrl",o.ALWAYS_ASK_TO_OVERRIDE_SERVER_URL="oct.alwaysAskToOverrideServerUrl";function t(){let a=ar.workspace.getConfiguration().get(o.SERVER_URL);if(typeof a=="string")return In.normalizeServerUri(a)}o.getServerUrl=t;async function r(a){await ar.workspace.getConfiguration().update(o.SERVER_URL,a,ar.ConfigurationTarget.Global)}o.setServerUrl=r;function i(){let a=ar.workspace.getConfiguration().get(o.ALWAYS_ASK_TO_OVERRIDE_SERVER_URL);return typeof a=="boolean"?a:!1}o.getServerUrlOverride=i;async function s(a){await ar.workspace.getConfiguration().update(o.ALWAYS_ASK_TO_OVERRIDE_SERVER_URL,a,ar.ConfigurationTarget.Global)}o.setServerUrlOverride=s})(cr||={});var St;(c=>(c.FollowPeer="oct.followPeer",c.StopFollowPeer="oct.stopFollowPeer",c.Enter="oct.enter",c.JoinRoom="oct.joinRoom",c.CreateRoom="oct.createRoom",c.CloseConnection="oct.closeConnection",c.SignOut="oct.signOut",c.DevFuzzing="oct.dev.fuzzing"))(St||={});var mi;(r=>(r.CloseFolder="workbench.action.closeFolder",r.OpenSettings="workbench.action.openSettings",r.OpenFolder="vscode.openFolder"))(mi||={});var Pt=class{connectionProvider;instanceFactory;context;secretStore;onDidJoinRoomEmitter=new H.EventEmitter;onDidJoinRoom=this.onDidJoinRoomEmitter.event;tokenSource=new H.CancellationTokenSource;async tryConnect(){let e=await this.secretStore.consumeRoomData();if(e){let r=await(await this.connectionProvider.createConnection(e.serverUrl)).connect(e.roomToken,e.host),i=this.instanceFactory({connection:r,serverUrl:e.serverUrl,host:!1,roomId:e.roomId,hostId:e.host.id});return this.onDidJoinRoomEmitter.fire(i),i}}async createRoom(){this.withConnectionProvider(void 0,async(e,t)=>{this.tokenSource.cancel(),this.tokenSource=new H.CancellationTokenSource,await H.window.withProgress({location:H.ProgressLocation.Notification,title:H.l10n.t("Creating Session"),cancellable:!0},async(r,i)=>{let s=this.tokenSource.token;try{let o=await e.createRoom({abortSignal:this.toAbortSignal(this.tokenSource.token,i),reporter:f=>r.report({message:Et(f)})});if(o.loginToken){let f=o.loginToken;await this.secretStore.storeUserToken(t,f)}let a=await e.connect(o.roomToken),c=this.instanceFactory({serverUrl:t,connection:a,host:!0,roomId:o.roomId});await H.env.clipboard.writeText(o.roomId);let u=H.l10n.t("Copy to Clipboard"),l=H.l10n.t("Copy with Server URL"),h=H.l10n.t("Created session {0}. Invitation code was automatically written to clipboard.",o.roomId);H.window.showInformationMessage(h,u,l).then(f=>{f===u?H.env.clipboard.writeText(o.roomId):f===l&&H.env.clipboard.writeText(In.create({roomId:o.roomId,serverUrl:t}))}),this.onDidJoinRoomEmitter.fire(c)}catch(o){this.showError(!0,o,s,i)}})})}async joinRoom(e){if(!e&&(e=await H.window.showInputBox({placeHolder:H.l10n.t("Enter the invitation code")}),!e))return;let t;try{let r=In.parse(e);e=r.roomId,r.serverUrl&&(t=r.serverUrl,this.askToOverrideServerUrl(t))}catch{H.window.showErrorMessage(H.l10n.t("Invalid invitation code! Invitation codes must be either a string of alphanumeric characters or a URL with a fragment."));return}await this.withConnectionProvider(t,async(r,i)=>{this.tokenSource.cancel(),this.tokenSource=new H.CancellationTokenSource,await H.window.withProgress({location:H.ProgressLocation.Notification,title:H.l10n.t("Joining Session"),cancellable:!0},async(o,a)=>{if(e){let c=this.tokenSource.token;try{let u=await r.joinRoom({roomId:e,reporter:S=>o.report({message:Et(S)}),abortSignal:this.toAbortSignal(c,a)});if(u.loginToken){let S=u.loginToken;await this.secretStore.storeUserToken(i,S)}let l={serverUrl:i,roomToken:u.roomToken,roomId:u.roomId,host:u.host};await this.secretStore.storeRoomData(l);let h=H.workspace.workspaceFolders??[],f=u.workspace,d=f.folders.map(S=>({name:S,uri:me.create(f.name,S)})),x=await ry(d,this.context.globalStorageUri);return x?(await H.commands.executeCommand(mi.OpenFolder,x,{forceNewWindow:!1,forceReuseWindow:!0,noRecentEntry:!0}),!0):H.workspace.updateWorkspaceFolders(0,h.length,...d)}catch(u){this.showError(!1,u,c,a)}}return!1})&&di&&setTimeout(()=>{this.tryConnect()},500)})}showError(e,t,r,i){r.isCancellationRequested||(i.isCancellationRequested?H.window.showInformationMessage(H.l10n.t("Action was cancelled by the user")):e?H.window.showErrorMessage(H.l10n.t("Failed to create session: {0}",Nc(t,Et))):H.window.showErrorMessage(H.l10n.t("Failed to join session: {0}",Nc(t,Et))))}toAbortSignal(...e){let t=new AbortController;return e.forEach(r=>r.onCancellationRequested(()=>t.abort())),t.signal}async withConnectionProvider(e,t){if(e?e=In.normalizeServerUri(e):e=cr.getServerUrl(),e){let r=await this.connectionProvider.createConnection(e);await t(r,e)}else this.showServerUrlMissingError()}showServerUrlMissingError(){let e=H.l10n.t("No Open Collaboration Server configured. Please set the server URL in the settings."),t=H.l10n.t("Open Settings");H.window.showInformationMessage(e,t).then(r=>{r===t&&H.commands.executeCommand(mi.OpenSettings,cr.SERVER_URL)})}async askToOverrideServerUrl(e){if(cr.getServerUrl()===e||!cr.getServerUrlOverride())return;let r=H.l10n.t("Do you want to override the server URL setting with {0}?",e),i=H.l10n.t("Yes"),s=H.l10n.t("No"),o=H.l10n.t("Never"),a=await H.window.showInformationMessage(r,i,s,o);a===i?cr.setServerUrl(e):a===o&&cr.setServerUrlOverride(!1)}};te([ye(or)],Pt.prototype,"connectionProvider",2),te([ye(ma)],Pt.prototype,"instanceFactory",2),te([ye(Nn)],Pt.prototype,"context",2),te([ye(Xt)],Pt.prototype,"secretStore",2),Pt=te([Xe()],Pt);var Pn=Fe(require("vscode"));var Qt=class{context;roomService;viewDataProvider;contextKeyService;statusBarItem=Pn.window.createStatusBarItem(Pn.StatusBarAlignment.Left,5);init(){this.roomService.onDidJoinRoom(e=>{this.setState(e.host?1:2),this.viewDataProvider.onConnection(e),this.contextKeyService.setConnection(e),e.onDidDispose(()=>{this.setState(0),this.contextKeyService.setConnection(void 0),e.host||(pa(),pi())})}),this.context.subscriptions.push(Pn.window.registerTreeDataProvider("oct.roomView",this.viewDataProvider),this.statusBarItem)}initialize(e){if(this.setState(0),this.statusBarItem.command=e,this.statusBarItem.tooltip=Pn.l10n.t("Start a collaboration session"),this.statusBarItem.show(),di){let t=setInterval(()=>this.statusBarItem.show(),200);setTimeout(()=>clearInterval(t),3e4)}}setState(e){switch(e){case 0:this.statusBarItem.text="$(git-compare) Open Collaboration";break;case 1:this.statusBarItem.text="$(broadcast) "+Pn.l10n.t("Sharing");break;case 2:this.statusBarItem.text="$(broadcast) "+Pn.l10n.t("Collaborating");break}}};te([ye(Nn)],Qt.prototype,"context",2),te([ye(Pt)],Qt.prototype,"roomService",2),te([ye(ir)],Qt.prototype,"viewDataProvider",2),te([ye(dn)],Qt.prototype,"contextKeyService",2),te([da()],Qt.prototype,"init",1),Qt=te([Xe()],Qt);var Lt=class{context;followService;contextKeyService;roomService;statusService;secretStorage;initialize(){this.context.subscriptions.push(Y.commands.registerCommand(St.FollowPeer,e=>this.followService.followPeer(e?.id)),Y.commands.registerCommand(St.StopFollowPeer,()=>this.followService.unfollowPeer()),Y.commands.registerCommand(St.Enter,async()=>{await this.openMainQuickpick()}),Y.commands.registerCommand(St.JoinRoom,async()=>{await this.roomService.joinRoom()}),Y.commands.registerCommand(St.CreateRoom,async()=>{await this.roomService.createRoom()}),Y.commands.registerCommand(St.CloseConnection,async()=>{let e=ke.Current;e&&(await e.leave(),e.dispose(),this.contextKeyService.setConnection(void 0),e.host||await Y.commands.executeCommand(mi.CloseFolder))}),Y.commands.registerCommand(St.SignOut,async()=>{await Y.commands.executeCommand(St.CloseConnection),await this.secretStorage.deleteUserTokens(),Y.window.showInformationMessage(Y.l10n.t("Signed out successfully!"))})),typeof process=="object"&&process&&process.env?.DEVELOPMENT==="true"&&(this.contextKeyService.set("oct.dev",!0),this.context.subscriptions.push(Y.commands.registerCommand(St.DevFuzzing,async()=>{let e=Y.window.activeTextEditor,t=String.fromCharCode(Math.floor(Math.random()*26)+97);if(e){let r=setInterval(()=>{if(Y.window.activeTextEditor!==e){clearInterval(r);return}e.edit(i=>{i.insert(e.selection.start,t)})},50)}}))),this.statusService.initialize(St.Enter)}async openMainQuickpick(){let e=ke.Current;e?await this.openMainQuickpickInSession(e):await this.openMainQuickpickOutsideSession()}async openMainQuickpickOutsideSession(){let e=[{key:"join",label:"$(vm-connect) "+Y.l10n.t("Join Collaboration Session"),detail:Y.l10n.t("Join an open collaboration session using an invitation code")}];Y.workspace.workspaceFolders?.length&&e.unshift({key:"create",label:"$(add) "+Y.l10n.t("Create New Collaboration Session"),detail:Y.l10n.t("Become the host of a new collaboration session in your current workspace")});let t=await gi(e,{placeholder:Y.l10n.t("Select Collaboration Option")});t==="create"?await this.roomService.createRoom():t==="join"&&await this.roomService.joinRoom()}async openMainQuickpickInSession(e){let t=[{key:"invite",label:"$(clippy) "+Y.l10n.t("Invite Others (Copy Code)"),detail:Y.l10n.t("Copy the invitation code to the clipboard to share with others")}];e.host?(t.push({key:"update",label:"$(gear) "+Y.l10n.t("Configure Collaboration Session"),detail:Y.l10n.t("Configure the options and permissions of the current session")}),t.push({key:"stop",label:"$(circle-slash) "+Y.l10n.t("Stop Collaboration Session"),detail:Y.l10n.t("Stop the collaboration session, stop sharing all content and remove all participants")})):t.push({key:"stop",label:"$(circle-slash) "+Y.l10n.t("Leave Collaboration Session"),detail:Y.l10n.t("Leave the collaboration session, closing the current workspace")});let r=await gi(t,{placeholder:Y.l10n.t("Select Collaboration Option")});r==="invite"?await this.inviteCallback(e):r==="update"?await this.updatePermissions(e):r==="stop"&&await Y.commands.executeCommand(St.CloseConnection)}async inviteCallback(e){Y.env.clipboard.writeText(e.roomId);let t=Y.l10n.t("Copy with Server URL");Y.window.showInformationMessage(Y.l10n.t("Invitation code {0} copied to clipboard!",e.roomId),t).then(r=>{r===t&&Y.env.clipboard.writeText(In.create({roomId:e.roomId,serverUrl:e.serverUrl}))})}async updatePermissions(e){let t=[];e.permissions.readonly?t.push({key:"readwrite",label:"$(unlock) "+Y.l10n.t("Enable Editing"),detail:Y.l10n.t("Allow all participants to edit files in the workspace")}):t.push({key:"readonly",label:"$(lock) "+Y.l10n.t("Make Read-Only"),detail:Y.l10n.t("Prevent all participants from editing the workspace")});let r=await gi(t,{placeholder:Y.l10n.t("Select Permissions")});r==="readonly"?e.setPermissions({readonly:!0}):r==="readwrite"&&e.setPermissions({readonly:!1})}};te([ye(Nn)],Lt.prototype,"context",2),te([ye(sr)],Lt.prototype,"followService",2),te([ye(dn)],Lt.prototype,"contextKeyService",2),te([ye(Pt)],Lt.prototype,"roomService",2),te([ye(Qt)],Lt.prototype,"statusService",2),te([ye(Xt)],Lt.prototype,"secretStorage",2),Lt=te([Xe()],Lt);Hd({cryptoModule:globalThis.crypto});async function pk(n){let e=uy(n);e.bind(bu).toConstantValue(fetch),e.get(Lt).initialize()}async function gk(){await ke.Current?.leave(),ke.Current?.dispose(),await pa(),pi()}
/*! Bundled license information:

reflect-metadata/Reflect.js:
  (*! *****************************************************************************
  Copyright (C) Microsoft. All rights reserved.
  Licensed under the Apache License, Version 2.0 (the "License"); you may not use
  this file except in compliance with the License. You may obtain a copy of the
  License at http://www.apache.org/licenses/LICENSE-2.0
  
  THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
  KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
  WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
  MERCHANTABLITY OR NON-INFRINGEMENT.
  
  See the Apache Version 2.0 License for specific language governing permissions
  and limitations under the License.
  ***************************************************************************** *)
*/
